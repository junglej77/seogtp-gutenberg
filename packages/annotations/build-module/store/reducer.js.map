{"version":3,"names":["filterWithReference","collection","predicate","filteredCollection","filter","length","mapValues","obj","callback","Object","entries","reduce","acc","key","value","isValidAnnotationRange","annotation","start","end","annotations","state","action","_state$blockClientId","type","blockClientId","newAnnotation","id","richTextIdentifier","source","selector","range","previousAnnotationsForBlock","annotationsForBlock","annotationId","hasChangedRange","newAnnotations","map"],"sources":["@wordpress/annotations/src/store/reducer.js"],"sourcesContent":["/**\r\n * Filters an array based on the predicate, but keeps the reference the same if\r\n * the array hasn't changed.\r\n *\r\n * @param {Array}    collection The collection to filter.\r\n * @param {Function} predicate  Function that determines if the item should stay\r\n *                              in the array.\r\n * @return {Array} Filtered array.\r\n */\r\nfunction filterWithReference( collection, predicate ) {\r\n\tconst filteredCollection = collection.filter( predicate );\r\n\r\n\treturn collection.length === filteredCollection.length\r\n\t\t? collection\r\n\t\t: filteredCollection;\r\n}\r\n\r\n/**\r\n * Creates a new object with the same keys, but with `callback()` called as\r\n * a transformer function on each of the values.\r\n *\r\n * @param {Object}   obj      The object to transform.\r\n * @param {Function} callback The function to transform each object value.\r\n * @return {Array} Transformed object.\r\n */\r\nconst mapValues = ( obj, callback ) =>\r\n\tObject.entries( obj ).reduce(\r\n\t\t( acc, [ key, value ] ) => ( {\r\n\t\t\t...acc,\r\n\t\t\t[ key ]: callback( value ),\r\n\t\t} ),\r\n\t\t{}\r\n\t);\r\n\r\n/**\r\n * Verifies whether the given annotations is a valid annotation.\r\n *\r\n * @param {Object} annotation The annotation to verify.\r\n * @return {boolean} Whether the given annotation is valid.\r\n */\r\nfunction isValidAnnotationRange( annotation ) {\r\n\treturn (\r\n\t\ttypeof annotation.start === 'number' &&\r\n\t\ttypeof annotation.end === 'number' &&\r\n\t\tannotation.start <= annotation.end\r\n\t);\r\n}\r\n\r\n/**\r\n * Reducer managing annotations.\r\n *\r\n * @param {Object} state  The annotations currently shown in the editor.\r\n * @param {Object} action Dispatched action.\r\n *\r\n * @return {Array} Updated state.\r\n */\r\nexport function annotations( state = {}, action ) {\r\n\tswitch ( action.type ) {\r\n\t\tcase 'ANNOTATION_ADD':\r\n\t\t\tconst blockClientId = action.blockClientId;\r\n\t\t\tconst newAnnotation = {\r\n\t\t\t\tid: action.id,\r\n\t\t\t\tblockClientId,\r\n\t\t\t\trichTextIdentifier: action.richTextIdentifier,\r\n\t\t\t\tsource: action.source,\r\n\t\t\t\tselector: action.selector,\r\n\t\t\t\trange: action.range,\r\n\t\t\t};\r\n\r\n\t\t\tif (\r\n\t\t\t\tnewAnnotation.selector === 'range' &&\r\n\t\t\t\t! isValidAnnotationRange( newAnnotation.range )\r\n\t\t\t) {\r\n\t\t\t\treturn state;\r\n\t\t\t}\r\n\r\n\t\t\tconst previousAnnotationsForBlock = state?.[ blockClientId ] ?? [];\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\t[ blockClientId ]: [\r\n\t\t\t\t\t...previousAnnotationsForBlock,\r\n\t\t\t\t\tnewAnnotation,\r\n\t\t\t\t],\r\n\t\t\t};\r\n\r\n\t\tcase 'ANNOTATION_REMOVE':\r\n\t\t\treturn mapValues( state, ( annotationsForBlock ) => {\r\n\t\t\t\treturn filterWithReference(\r\n\t\t\t\t\tannotationsForBlock,\r\n\t\t\t\t\t( annotation ) => {\r\n\t\t\t\t\t\treturn annotation.id !== action.annotationId;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} );\r\n\r\n\t\tcase 'ANNOTATION_UPDATE_RANGE':\r\n\t\t\treturn mapValues( state, ( annotationsForBlock ) => {\r\n\t\t\t\tlet hasChangedRange = false;\r\n\r\n\t\t\t\tconst newAnnotations = annotationsForBlock.map(\r\n\t\t\t\t\t( annotation ) => {\r\n\t\t\t\t\t\tif ( annotation.id === action.annotationId ) {\r\n\t\t\t\t\t\t\thasChangedRange = true;\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t...annotation,\r\n\t\t\t\t\t\t\t\trange: {\r\n\t\t\t\t\t\t\t\t\tstart: action.start,\r\n\t\t\t\t\t\t\t\t\tend: action.end,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn annotation;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t\treturn hasChangedRange ? newAnnotations : annotationsForBlock;\r\n\t\t\t} );\r\n\r\n\t\tcase 'ANNOTATION_REMOVE_SOURCE':\r\n\t\t\treturn mapValues( state, ( annotationsForBlock ) => {\r\n\t\t\t\treturn filterWithReference(\r\n\t\t\t\t\tannotationsForBlock,\r\n\t\t\t\t\t( annotation ) => {\r\n\t\t\t\t\t\treturn annotation.source !== action.source;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} );\r\n\t}\r\n\r\n\treturn state;\r\n}\r\n\r\nexport default annotations;\r\n"],"mappings":"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","ignoreList":[]}