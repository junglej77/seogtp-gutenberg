{"version":3,"names":["__","createNonceMiddleware","createRootURLMiddleware","createPreloadingMiddleware","fetchAllMiddleware","namespaceEndpointMiddleware","httpV1Middleware","userLocaleMiddleware","mediaUploadMiddleware","createThemePreviewMiddleware","parseResponseAndNormalizeError","parseAndThrowError","DEFAULT_HEADERS","Accept","DEFAULT_OPTIONS","credentials","middlewares","registerMiddleware","middleware","unshift","checkStatus","response","status","defaultFetchHandler","nextOptions","url","path","data","parse","remainingOptions","body","headers","JSON","stringify","responsePromise","window","fetch","location","href","then","value","Promise","resolve","catch","err","name","code","message","fetchHandler","setFetchHandler","newFetchHandler","apiFetch","options","enhancedHandler","reduceRight","next","workingOptions","error","reject","nonceEndpoint","text","nonceMiddleware","nonce","use"],"sources":["@wordpress/api-fetch/src/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport createNonceMiddleware from './middlewares/nonce';\r\nimport createRootURLMiddleware from './middlewares/root-url';\r\nimport createPreloadingMiddleware from './middlewares/preloading';\r\nimport fetchAllMiddleware from './middlewares/fetch-all-middleware';\r\nimport namespaceEndpointMiddleware from './middlewares/namespace-endpoint';\r\nimport httpV1Middleware from './middlewares/http-v1';\r\nimport userLocaleMiddleware from './middlewares/user-locale';\r\nimport mediaUploadMiddleware from './middlewares/media-upload';\r\nimport createThemePreviewMiddleware from './middlewares/theme-preview';\r\nimport {\r\n\tparseResponseAndNormalizeError,\r\n\tparseAndThrowError,\r\n} from './utils/response';\r\n\r\n/**\r\n * Default set of header values which should be sent with every request unless\r\n * explicitly provided through apiFetch options.\r\n *\r\n * @type {Record<string, string>}\r\n */\r\nconst DEFAULT_HEADERS = {\r\n\t// The backend uses the Accept header as a condition for considering an\r\n\t// incoming request as a REST request.\r\n\t//\r\n\t// See: https://core.trac.wordpress.org/ticket/44534\r\n\tAccept: 'application/json, */*;q=0.1',\r\n};\r\n\r\n/**\r\n * Default set of fetch option values which should be sent with every request\r\n * unless explicitly provided through apiFetch options.\r\n *\r\n * @type {Object}\r\n */\r\nconst DEFAULT_OPTIONS = {\r\n\tcredentials: 'include',\r\n};\r\n\r\n/** @typedef {import('./types').APIFetchMiddleware} APIFetchMiddleware */\r\n/** @typedef {import('./types').APIFetchOptions} APIFetchOptions */\r\n\r\n/**\r\n * @type {import('./types').APIFetchMiddleware[]}\r\n */\r\nconst middlewares = [\r\n\tuserLocaleMiddleware,\r\n\tnamespaceEndpointMiddleware,\r\n\thttpV1Middleware,\r\n\tfetchAllMiddleware,\r\n];\r\n\r\n/**\r\n * Register a middleware\r\n *\r\n * @param {import('./types').APIFetchMiddleware} middleware\r\n */\r\nfunction registerMiddleware( middleware ) {\r\n\tmiddlewares.unshift( middleware );\r\n}\r\n\r\n/**\r\n * Checks the status of a response, throwing the Response as an error if\r\n * it is outside the 200 range.\r\n *\r\n * @param {Response} response\r\n * @return {Response} The response if the status is in the 200 range.\r\n */\r\nconst checkStatus = ( response ) => {\r\n\tif ( response.status >= 200 && response.status < 300 ) {\r\n\t\treturn response;\r\n\t}\r\n\r\n\tthrow response;\r\n};\r\n\r\n/** @typedef {(options: import('./types').APIFetchOptions) => Promise<any>} FetchHandler*/\r\n\r\n/**\r\n * @type {FetchHandler}\r\n */\r\nconst defaultFetchHandler = ( nextOptions ) => {\r\n\tconst { url, path, data, parse = true, ...remainingOptions } = nextOptions;\r\n\tlet { body, headers } = nextOptions;\r\n\r\n\t// Merge explicitly-provided headers with default values.\r\n\theaders = { ...DEFAULT_HEADERS, ...headers };\r\n\r\n\t// The `data` property is a shorthand for sending a JSON body.\r\n\tif ( data ) {\r\n\t\tbody = JSON.stringify( data );\r\n\t\theaders[ 'Content-Type' ] = 'application/json';\r\n\t}\r\n\r\n\tconst responsePromise = window.fetch(\r\n\t\t// Fall back to explicitly passing `window.location` which is the behavior if `undefined` is passed.\r\n\t\turl || path || window.location.href,\r\n\t\t{\r\n\t\t\t...DEFAULT_OPTIONS,\r\n\t\t\t...remainingOptions,\r\n\t\t\tbody,\r\n\t\t\theaders,\r\n\t\t}\r\n\t);\r\n\r\n\treturn responsePromise.then(\r\n\t\t( value ) =>\r\n\t\t\tPromise.resolve( value )\r\n\t\t\t\t.then( checkStatus )\r\n\t\t\t\t.catch( ( response ) => parseAndThrowError( response, parse ) )\r\n\t\t\t\t.then( ( response ) =>\r\n\t\t\t\t\tparseResponseAndNormalizeError( response, parse )\r\n\t\t\t\t),\r\n\t\t( err ) => {\r\n\t\t\t// Re-throw AbortError for the users to handle it themselves.\r\n\t\t\tif ( err && err.name === 'AbortError' ) {\r\n\t\t\t\tthrow err;\r\n\t\t\t}\r\n\r\n\t\t\t// Otherwise, there is most likely no network connection.\r\n\t\t\t// Unfortunately the message might depend on the browser.\r\n\t\t\tthrow {\r\n\t\t\t\tcode: 'fetch_error',\r\n\t\t\t\tmessage: __( 'You are probably offline.' ),\r\n\t\t\t};\r\n\t\t}\r\n\t);\r\n};\r\n\r\n/** @type {FetchHandler} */\r\nlet fetchHandler = defaultFetchHandler;\r\n\r\n/**\r\n * Defines a custom fetch handler for making the requests that will override\r\n * the default one using window.fetch\r\n *\r\n * @param {FetchHandler} newFetchHandler The new fetch handler\r\n */\r\nfunction setFetchHandler( newFetchHandler ) {\r\n\tfetchHandler = newFetchHandler;\r\n}\r\n\r\n/**\r\n * @template T\r\n * @param {import('./types').APIFetchOptions} options\r\n * @return {Promise<T>} A promise representing the request processed via the registered middlewares.\r\n */\r\nfunction apiFetch( options ) {\r\n\t// creates a nested function chain that calls all middlewares and finally the `fetchHandler`,\r\n\t// converting `middlewares = [ m1, m2, m3 ]` into:\r\n\t// ```\r\n\t// opts1 => m1( opts1, opts2 => m2( opts2, opts3 => m3( opts3, fetchHandler ) ) );\r\n\t// ```\r\n\tconst enhancedHandler = middlewares.reduceRight(\r\n\t\t( /** @type {FetchHandler} */ next, middleware ) => {\r\n\t\t\treturn ( workingOptions ) => middleware( workingOptions, next );\r\n\t\t},\r\n\t\tfetchHandler\r\n\t);\r\n\r\n\treturn enhancedHandler( options ).catch( ( error ) => {\r\n\t\tif ( error.code !== 'rest_cookie_invalid_nonce' ) {\r\n\t\t\treturn Promise.reject( error );\r\n\t\t}\r\n\r\n\t\t// If the nonce is invalid, refresh it and try again.\r\n\t\treturn (\r\n\t\t\twindow\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\t.fetch( apiFetch.nonceEndpoint )\r\n\t\t\t\t.then( checkStatus )\r\n\t\t\t\t.then( ( data ) => data.text() )\r\n\t\t\t\t.then( ( text ) => {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tapiFetch.nonceMiddleware.nonce = text;\r\n\t\t\t\t\treturn apiFetch( options );\r\n\t\t\t\t} )\r\n\t\t);\r\n\t} );\r\n}\r\n\r\napiFetch.use = registerMiddleware;\r\napiFetch.setFetchHandler = setFetchHandler;\r\n\r\napiFetch.createNonceMiddleware = createNonceMiddleware;\r\napiFetch.createPreloadingMiddleware = createPreloadingMiddleware;\r\napiFetch.createRootURLMiddleware = createRootURLMiddleware;\r\napiFetch.fetchAllMiddleware = fetchAllMiddleware;\r\napiFetch.mediaUploadMiddleware = mediaUploadMiddleware;\r\napiFetch.createThemePreviewMiddleware = createThemePreviewMiddleware;\r\n\r\nexport default apiFetch;\r\n"],"mappings":"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","ignoreList":[]}