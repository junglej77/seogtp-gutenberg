{"version":3,"names":["addQueryArgs","getQueryArgs","normalizePath","createPreloadingMiddleware","preloadedData","cache","Object","fromEntries","entries","map","path","data","options","next","parse","rawPath","url","rest_route","pathFromQuery","queryArgs","method","cacheData","prepareResponse","responseData","Promise","resolve","body","window","Response","JSON","stringify","status","statusText","headers"],"sources":["@wordpress/api-fetch/src/middlewares/preloading.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { addQueryArgs, getQueryArgs, normalizePath } from '@wordpress/url';\r\n\r\n/**\r\n * @param {Record<string, any>} preloadedData\r\n * @return {import('../types').APIFetchMiddleware} Preloading middleware.\r\n */\r\nfunction createPreloadingMiddleware( preloadedData ) {\r\n\tconst cache = Object.fromEntries(\r\n\t\tObject.entries( preloadedData ).map( ( [ path, data ] ) => [\r\n\t\t\tnormalizePath( path ),\r\n\t\t\tdata,\r\n\t\t] )\r\n\t);\r\n\r\n\treturn ( options, next ) => {\r\n\t\tconst { parse = true } = options;\r\n\t\t/** @type {string | void} */\r\n\t\tlet rawPath = options.path;\r\n\t\tif ( ! rawPath && options.url ) {\r\n\t\t\tconst { rest_route: pathFromQuery, ...queryArgs } = getQueryArgs(\r\n\t\t\t\toptions.url\r\n\t\t\t);\r\n\r\n\t\t\tif ( typeof pathFromQuery === 'string' ) {\r\n\t\t\t\trawPath = addQueryArgs( pathFromQuery, queryArgs );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( typeof rawPath !== 'string' ) {\r\n\t\t\treturn next( options );\r\n\t\t}\r\n\r\n\t\tconst method = options.method || 'GET';\r\n\t\tconst path = normalizePath( rawPath );\r\n\r\n\t\tif ( 'GET' === method && cache[ path ] ) {\r\n\t\t\tconst cacheData = cache[ path ];\r\n\r\n\t\t\t// Unsetting the cache key ensures that the data is only used a single time.\r\n\t\t\tdelete cache[ path ];\r\n\r\n\t\t\treturn prepareResponse( cacheData, !! parse );\r\n\t\t} else if (\r\n\t\t\t'OPTIONS' === method &&\r\n\t\t\tcache[ method ] &&\r\n\t\t\tcache[ method ][ path ]\r\n\t\t) {\r\n\t\t\tconst cacheData = cache[ method ][ path ];\r\n\r\n\t\t\t// Unsetting the cache key ensures that the data is only used a single time.\r\n\t\t\tdelete cache[ method ][ path ];\r\n\r\n\t\t\treturn prepareResponse( cacheData, !! parse );\r\n\t\t}\r\n\r\n\t\treturn next( options );\r\n\t};\r\n}\r\n\r\n/**\r\n * This is a helper function that sends a success response.\r\n *\r\n * @param {Record<string, any>} responseData\r\n * @param {boolean}             parse\r\n * @return {Promise<any>} Promise with the response.\r\n */\r\nfunction prepareResponse( responseData, parse ) {\r\n\treturn Promise.resolve(\r\n\t\tparse\r\n\t\t\t? responseData.body\r\n\t\t\t: new window.Response( JSON.stringify( responseData.body ), {\r\n\t\t\t\t\tstatus: 200,\r\n\t\t\t\t\tstatusText: 'OK',\r\n\t\t\t\t\theaders: responseData.headers,\r\n\t\t\t  } )\r\n\t);\r\n}\r\n\r\nexport default createPreloadingMiddleware;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,YAAY,EAAEC,YAAY,EAAEC,aAAa,QAAQ,gBAAgB;;AAE1E;AACA;AACA;AACA;AACA,SAASC,0BAA0BA,CAAEC,aAAa,EAAG;EACpD,MAAMC,KAAK,GAAGC,MAAM,CAACC,WAAW,CAC/BD,MAAM,CAACE,OAAO,CAAEJ,aAAc,CAAC,CAACK,GAAG,CAAE,CAAE,CAAEC,IAAI,EAAEC,IAAI,CAAE,KAAM,CAC1DT,aAAa,CAAEQ,IAAK,CAAC,EACrBC,IAAI,CACH,CACH,CAAC;EAED,OAAO,CAAEC,OAAO,EAAEC,IAAI,KAAM;IAC3B,MAAM;MAAEC,KAAK,GAAG;IAAK,CAAC,GAAGF,OAAO;IAChC;IACA,IAAIG,OAAO,GAAGH,OAAO,CAACF,IAAI;IAC1B,IAAK,CAAEK,OAAO,IAAIH,OAAO,CAACI,GAAG,EAAG;MAC/B,MAAM;QAAEC,UAAU,EAAEC,aAAa;QAAE,GAAGC;MAAU,CAAC,GAAGlB,YAAY,CAC/DW,OAAO,CAACI,GACT,CAAC;MAED,IAAK,OAAOE,aAAa,KAAK,QAAQ,EAAG;QACxCH,OAAO,GAAGf,YAAY,CAAEkB,aAAa,EAAEC,SAAU,CAAC;MACnD;IACD;IAEA,IAAK,OAAOJ,OAAO,KAAK,QAAQ,EAAG;MAClC,OAAOF,IAAI,CAAED,OAAQ,CAAC;IACvB;IAEA,MAAMQ,MAAM,GAAGR,OAAO,CAACQ,MAAM,IAAI,KAAK;IACtC,MAAMV,IAAI,GAAGR,aAAa,CAAEa,OAAQ,CAAC;IAErC,IAAK,KAAK,KAAKK,MAAM,IAAIf,KAAK,CAAEK,IAAI,CAAE,EAAG;MACxC,MAAMW,SAAS,GAAGhB,KAAK,CAAEK,IAAI,CAAE;;MAE/B;MACA,OAAOL,KAAK,CAAEK,IAAI,CAAE;MAEpB,OAAOY,eAAe,CAAED,SAAS,EAAE,CAAC,CAAEP,KAAM,CAAC;IAC9C,CAAC,MAAM,IACN,SAAS,KAAKM,MAAM,IACpBf,KAAK,CAAEe,MAAM,CAAE,IACff,KAAK,CAAEe,MAAM,CAAE,CAAEV,IAAI,CAAE,EACtB;MACD,MAAMW,SAAS,GAAGhB,KAAK,CAAEe,MAAM,CAAE,CAAEV,IAAI,CAAE;;MAEzC;MACA,OAAOL,KAAK,CAAEe,MAAM,CAAE,CAAEV,IAAI,CAAE;MAE9B,OAAOY,eAAe,CAAED,SAAS,EAAE,CAAC,CAAEP,KAAM,CAAC;IAC9C;IAEA,OAAOD,IAAI,CAAED,OAAQ,CAAC;EACvB,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASU,eAAeA,CAAEC,YAAY,EAAET,KAAK,EAAG;EAC/C,OAAOU,OAAO,CAACC,OAAO,CACrBX,KAAK,GACFS,YAAY,CAACG,IAAI,GACjB,IAAIC,MAAM,CAACC,QAAQ,CAAEC,IAAI,CAACC,SAAS,CAAEP,YAAY,CAACG,IAAK,CAAC,EAAE;IAC1DK,MAAM,EAAE,GAAG;IACXC,UAAU,EAAE,IAAI;IAChBC,OAAO,EAAEV,YAAY,CAACU;EACtB,CAAE,CACN,CAAC;AACF;AAEA,eAAe9B,0BAA0B","ignoreList":[]}