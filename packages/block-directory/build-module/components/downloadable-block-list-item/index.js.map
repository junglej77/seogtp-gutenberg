{"version":3,"names":["__","_n","sprintf","Button","Spinner","VisuallyHidden","Composite","createInterpolateElement","decodeEntities","getBlockType","useSelect","BlockRatings","DownloadableBlockIcon","DownloadableBlockNotice","store","blockDirectoryStore","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","getDownloadableBlockLabel","title","rating","ratingCount","hasNotice","isInstalled","isInstalling","stars","Math","round","DownloadableBlockListItem","item","onClick","author","description","icon","name","isInstallable","select","getErrorNoticeForBlock","isBlockInstalling","notice","id","hasFatal","isFatal","statusText","Item","render","__next40pxDefaultSize","accessibleWhenDisabled","type","role","className","isBusy","event","preventDefault","label","showTooltip","tooltipPosition","disabled","children","span","block"],"sources":["@wordpress/block-directory/src/components/downloadable-block-list-item/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, _n, sprintf } from '@wordpress/i18n';\r\nimport {\r\n\tButton,\r\n\tSpinner,\r\n\tVisuallyHidden,\r\n\tComposite,\r\n} from '@wordpress/components';\r\nimport { createInterpolateElement } from '@wordpress/element';\r\nimport { decodeEntities } from '@wordpress/html-entities';\r\nimport { getBlockType } from '@wordpress/blocks';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport BlockRatings from '../block-ratings';\r\nimport DownloadableBlockIcon from '../downloadable-block-icon';\r\nimport DownloadableBlockNotice from '../downloadable-block-notice';\r\nimport { store as blockDirectoryStore } from '../../store';\r\n\r\n// Return the appropriate block item label, given the block data and status.\r\nfunction getDownloadableBlockLabel(\r\n\t{ title, rating, ratingCount },\r\n\t{ hasNotice, isInstalled, isInstalling }\r\n) {\r\n\tconst stars = Math.round( rating / 0.5 ) * 0.5;\r\n\r\n\tif ( ! isInstalled && hasNotice ) {\r\n\t\t/* translators: %1$s: block title */\r\n\t\treturn sprintf( 'Retry installing %s.', decodeEntities( title ) );\r\n\t}\r\n\r\n\tif ( isInstalled ) {\r\n\t\t/* translators: %1$s: block title */\r\n\t\treturn sprintf( 'Add %s.', decodeEntities( title ) );\r\n\t}\r\n\r\n\tif ( isInstalling ) {\r\n\t\t/* translators: %1$s: block title */\r\n\t\treturn sprintf( 'Installing %s.', decodeEntities( title ) );\r\n\t}\r\n\r\n\t// No ratings yet, just use the title.\r\n\tif ( ratingCount < 1 ) {\r\n\t\t/* translators: %1$s: block title */\r\n\t\treturn sprintf( 'Install %s.', decodeEntities( title ) );\r\n\t}\r\n\r\n\treturn sprintf(\r\n\t\t/* translators: %1$s: block title, %2$s: average rating, %3$s: total ratings count. */\r\n\t\t_n(\r\n\t\t\t'Install %1$s. %2$s stars with %3$s review.',\r\n\t\t\t'Install %1$s. %2$s stars with %3$s reviews.',\r\n\t\t\tratingCount\r\n\t\t),\r\n\t\tdecodeEntities( title ),\r\n\t\tstars,\r\n\t\tratingCount\r\n\t);\r\n}\r\n\r\nfunction DownloadableBlockListItem( { item, onClick } ) {\r\n\tconst { author, description, icon, rating, title } = item;\r\n\t// getBlockType returns a block object if this block exists, or null if not.\r\n\tconst isInstalled = !! getBlockType( item.name );\r\n\r\n\tconst { hasNotice, isInstalling, isInstallable } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getErrorNoticeForBlock, isInstalling: isBlockInstalling } =\r\n\t\t\t\tselect( blockDirectoryStore );\r\n\t\t\tconst notice = getErrorNoticeForBlock( item.id );\r\n\t\t\tconst hasFatal = notice && notice.isFatal;\r\n\t\t\treturn {\r\n\t\t\t\thasNotice: !! notice,\r\n\t\t\t\tisInstalling: isBlockInstalling( item.id ),\r\n\t\t\t\tisInstallable: ! hasFatal,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ item ]\r\n\t);\r\n\r\n\tlet statusText = '';\r\n\tif ( isInstalled ) {\r\n\t\tstatusText = __( 'Installed!' );\r\n\t} else if ( isInstalling ) {\r\n\t\tstatusText = __( 'Installingâ€¦' );\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Composite.Item\r\n\t\t\trender={\r\n\t\t\t\t<Button\r\n\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\trole=\"option\"\r\n\t\t\t\t\tclassName=\"block-directory-downloadable-block-list-item\"\r\n\t\t\t\t\tisBusy={ isInstalling }\r\n\t\t\t\t\tonClick={ ( event ) => {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tonClick();\r\n\t\t\t\t\t} }\r\n\t\t\t\t\tlabel={ getDownloadableBlockLabel( item, {\r\n\t\t\t\t\t\thasNotice,\r\n\t\t\t\t\t\tisInstalled,\r\n\t\t\t\t\t\tisInstalling,\r\n\t\t\t\t\t} ) }\r\n\t\t\t\t\tshowTooltip\r\n\t\t\t\t\ttooltipPosition=\"top center\"\r\n\t\t\t\t/>\r\n\t\t\t}\r\n\t\t\tdisabled={ isInstalling || ! isInstallable }\r\n\t\t>\r\n\t\t\t<div className=\"block-directory-downloadable-block-list-item__icon\">\r\n\t\t\t\t<DownloadableBlockIcon icon={ icon } title={ title } />\r\n\t\t\t\t{ isInstalling ? (\r\n\t\t\t\t\t<span className=\"block-directory-downloadable-block-list-item__spinner\">\r\n\t\t\t\t\t\t<Spinner />\r\n\t\t\t\t\t</span>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<BlockRatings rating={ rating } />\r\n\t\t\t\t) }\r\n\t\t\t</div>\r\n\t\t\t<span className=\"block-directory-downloadable-block-list-item__details\">\r\n\t\t\t\t<span className=\"block-directory-downloadable-block-list-item__title\">\r\n\t\t\t\t\t{ createInterpolateElement(\r\n\t\t\t\t\t\tsprintf(\r\n\t\t\t\t\t\t\t/* translators: %1$s: block title, %2$s: author name. */\r\n\t\t\t\t\t\t\t__( '%1$s <span>by %2$s</span>' ),\r\n\t\t\t\t\t\t\tdecodeEntities( title ),\r\n\t\t\t\t\t\t\tauthor\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tspan: (\r\n\t\t\t\t\t\t\t\t<span className=\"block-directory-downloadable-block-list-item__author\" />\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t) }\r\n\t\t\t\t</span>\r\n\t\t\t\t{ hasNotice ? (\r\n\t\t\t\t\t<DownloadableBlockNotice block={ item } />\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<span className=\"block-directory-downloadable-block-list-item__desc\">\r\n\t\t\t\t\t\t\t{ !! statusText\r\n\t\t\t\t\t\t\t\t? statusText\r\n\t\t\t\t\t\t\t\t: decodeEntities( description ) }\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t{ isInstallable &&\r\n\t\t\t\t\t\t\t! ( isInstalled || isInstalling ) && (\r\n\t\t\t\t\t\t\t\t<VisuallyHidden>\r\n\t\t\t\t\t\t\t\t\t{ __( 'Install block' ) }\r\n\t\t\t\t\t\t\t\t</VisuallyHidden>\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t</>\r\n\t\t\t\t) }\r\n\t\t\t</span>\r\n\t\t</Composite.Item>\r\n\t);\r\n}\r\n\r\nexport default DownloadableBlockListItem;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAE,EAAEC,EAAE,EAAEC,OAAO,QAAQ,iBAAiB;AACjD,SACCC,MAAM,EACNC,OAAO,EACPC,cAAc,EACdC,SAAS,QACH,uBAAuB;AAC9B,SAASC,wBAAwB,QAAQ,oBAAoB;AAC7D,SAASC,cAAc,QAAQ,0BAA0B;AACzD,SAASC,YAAY,QAAQ,mBAAmB;AAChD,SAASC,SAAS,QAAQ,iBAAiB;;AAE3C;AACA;AACA;AACA,OAAOC,YAAY,MAAM,kBAAkB;AAC3C,OAAOC,qBAAqB,MAAM,4BAA4B;AAC9D,OAAOC,uBAAuB,MAAM,8BAA8B;AAClE,SAASC,KAAK,IAAIC,mBAAmB,QAAQ,aAAa;;AAE1D;AAAA,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AACA,SAASC,yBAAyBA,CACjC;EAAEC,KAAK;EAAEC,MAAM;EAAEC;AAAY,CAAC,EAC9B;EAAEC,SAAS;EAAEC,WAAW;EAAEC;AAAa,CAAC,EACvC;EACD,MAAMC,KAAK,GAAGC,IAAI,CAACC,KAAK,CAAEP,MAAM,GAAG,GAAI,CAAC,GAAG,GAAG;EAE9C,IAAK,CAAEG,WAAW,IAAID,SAAS,EAAG;IACjC;IACA,OAAOxB,OAAO,CAAE,sBAAsB,EAAEM,cAAc,CAAEe,KAAM,CAAE,CAAC;EAClE;EAEA,IAAKI,WAAW,EAAG;IAClB;IACA,OAAOzB,OAAO,CAAE,SAAS,EAAEM,cAAc,CAAEe,KAAM,CAAE,CAAC;EACrD;EAEA,IAAKK,YAAY,EAAG;IACnB;IACA,OAAO1B,OAAO,CAAE,gBAAgB,EAAEM,cAAc,CAAEe,KAAM,CAAE,CAAC;EAC5D;;EAEA;EACA,IAAKE,WAAW,GAAG,CAAC,EAAG;IACtB;IACA,OAAOvB,OAAO,CAAE,aAAa,EAAEM,cAAc,CAAEe,KAAM,CAAE,CAAC;EACzD;EAEA,OAAOrB,OAAO,EACb;EACAD,EAAE,CACD,4CAA4C,EAC5C,6CAA6C,EAC7CwB,WACD,CAAC,EACDjB,cAAc,CAAEe,KAAM,CAAC,EACvBM,KAAK,EACLJ,WACD,CAAC;AACF;AAEA,SAASO,yBAAyBA,CAAE;EAAEC,IAAI;EAAEC;AAAQ,CAAC,EAAG;EACvD,MAAM;IAAEC,MAAM;IAAEC,WAAW;IAAEC,IAAI;IAAEb,MAAM;IAAED;EAAM,CAAC,GAAGU,IAAI;EACzD;EACA,MAAMN,WAAW,GAAG,CAAC,CAAElB,YAAY,CAAEwB,IAAI,CAACK,IAAK,CAAC;EAEhD,MAAM;IAAEZ,SAAS;IAAEE,YAAY;IAAEW;EAAc,CAAC,GAAG7B,SAAS,CACzD8B,MAAM,IAAM;IACb,MAAM;MAAEC,sBAAsB;MAAEb,YAAY,EAAEc;IAAkB,CAAC,GAChEF,MAAM,CAAEzB,mBAAoB,CAAC;IAC9B,MAAM4B,MAAM,GAAGF,sBAAsB,CAAER,IAAI,CAACW,EAAG,CAAC;IAChD,MAAMC,QAAQ,GAAGF,MAAM,IAAIA,MAAM,CAACG,OAAO;IACzC,OAAO;MACNpB,SAAS,EAAE,CAAC,CAAEiB,MAAM;MACpBf,YAAY,EAAEc,iBAAiB,CAAET,IAAI,CAACW,EAAG,CAAC;MAC1CL,aAAa,EAAE,CAAEM;IAClB,CAAC;EACF,CAAC,EACD,CAAEZ,IAAI,CACP,CAAC;EAED,IAAIc,UAAU,GAAG,EAAE;EACnB,IAAKpB,WAAW,EAAG;IAClBoB,UAAU,GAAG/C,EAAE,CAAE,YAAa,CAAC;EAChC,CAAC,MAAM,IAAK4B,YAAY,EAAG;IAC1BmB,UAAU,GAAG/C,EAAE,CAAE,aAAc,CAAC;EACjC;EAEA,oBACCmB,KAAA,CAACb,SAAS,CAAC0C,IAAI;IACdC,MAAM,eACLhC,IAAA,CAACd;IACA;IAAA;MACA+C,qBAAqB,EAAG,KAAO;MAC/BC,sBAAsB;MACtBC,IAAI,EAAC,QAAQ;MACbC,IAAI,EAAC,QAAQ;MACbC,SAAS,EAAC,8CAA8C;MACxDC,MAAM,EAAG3B,YAAc;MACvBM,OAAO,EAAKsB,KAAK,IAAM;QACtBA,KAAK,CAACC,cAAc,CAAC,CAAC;QACtBvB,OAAO,CAAC,CAAC;MACV,CAAG;MACHwB,KAAK,EAAGpC,yBAAyB,CAAEW,IAAI,EAAE;QACxCP,SAAS;QACTC,WAAW;QACXC;MACD,CAAE,CAAG;MACL+B,WAAW;MACXC,eAAe,EAAC;IAAY,CAC5B,CACD;IACDC,QAAQ,EAAGjC,YAAY,IAAI,CAAEW,aAAe;IAAAuB,QAAA,gBAE5C3C,KAAA;MAAKmC,SAAS,EAAC,oDAAoD;MAAAQ,QAAA,gBAClE7C,IAAA,CAACL,qBAAqB;QAACyB,IAAI,EAAGA,IAAM;QAACd,KAAK,EAAGA;MAAO,CAAE,CAAC,EACrDK,YAAY,gBACbX,IAAA;QAAMqC,SAAS,EAAC,uDAAuD;QAAAQ,QAAA,eACtE7C,IAAA,CAACb,OAAO,IAAE;MAAC,CACN,CAAC,gBAEPa,IAAA,CAACN,YAAY;QAACa,MAAM,EAAGA;MAAQ,CAAE,CACjC;IAAA,CACG,CAAC,eACNL,KAAA;MAAMmC,SAAS,EAAC,uDAAuD;MAAAQ,QAAA,gBACtE7C,IAAA;QAAMqC,SAAS,EAAC,qDAAqD;QAAAQ,QAAA,EAClEvD,wBAAwB,CACzBL,OAAO,EACN;QACAF,EAAE,CAAE,2BAA4B,CAAC,EACjCQ,cAAc,CAAEe,KAAM,CAAC,EACvBY,MACD,CAAC,EACD;UACC4B,IAAI,eACH9C,IAAA;YAAMqC,SAAS,EAAC;UAAsD,CAAE;QAE1E,CACD;MAAC,CACI,CAAC,EACL5B,SAAS,gBACVT,IAAA,CAACJ,uBAAuB;QAACmD,KAAK,EAAG/B;MAAM,CAAE,CAAC,gBAE1Cd,KAAA,CAAAE,SAAA;QAAAyC,QAAA,gBACC7C,IAAA;UAAMqC,SAAS,EAAC,oDAAoD;UAAAQ,QAAA,EACjE,CAAC,CAAEf,UAAU,GACZA,UAAU,GACVvC,cAAc,CAAE4B,WAAY;QAAC,CAC3B,CAAC,EACLG,aAAa,IACd,EAAIZ,WAAW,IAAIC,YAAY,CAAE,iBAChCX,IAAA,CAACZ,cAAc;UAAAyD,QAAA,EACZ9D,EAAE,CAAE,eAAgB;QAAC,CACR,CAChB;MAAA,CACD,CACF;IAAA,CACI,CAAC;EAAA,CACQ,CAAC;AAEnB;AAEA,eAAegC,yBAAyB","ignoreList":[]}