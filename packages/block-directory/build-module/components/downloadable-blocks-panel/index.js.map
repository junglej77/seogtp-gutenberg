{"version":3,"names":["__","Spinner","store","coreStore","useSelect","getBlockType","DownloadableBlocksList","DownloadableBlocksInserterPanel","DownloadableBlocksNoResults","blockDirectoryStore","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","EMPTY_ARRAY","useDownloadableBlocks","filterValue","select","getDownloadableBlocks","isRequestingDownloadableBlocks","getInstalledBlockTypes","hasPermission","canUser","downloadableBlocks","installedBlockTypes","installableBlocks","filter","name","isJustInstalled","some","blockType","isPreviouslyInstalled","length","isLoading","DownloadableBlocksPanel","onSelect","onHover","hasLocalBlocks","isTyping","undefined","children","className","downloadableItems","items"],"sources":["@wordpress/block-directory/src/components/downloadable-blocks-panel/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { Spinner } from '@wordpress/components';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { getBlockType } from '@wordpress/blocks';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport DownloadableBlocksList from '../downloadable-blocks-list';\r\nimport DownloadableBlocksInserterPanel from './inserter-panel';\r\nimport DownloadableBlocksNoResults from './no-results';\r\nimport { store as blockDirectoryStore } from '../../store';\r\n\r\nconst EMPTY_ARRAY = [];\r\n\r\nconst useDownloadableBlocks = ( filterValue ) =>\r\n\tuseSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst {\r\n\t\t\t\tgetDownloadableBlocks,\r\n\t\t\t\tisRequestingDownloadableBlocks,\r\n\t\t\t\tgetInstalledBlockTypes,\r\n\t\t\t} = select( blockDirectoryStore );\r\n\r\n\t\t\tconst hasPermission = select( coreStore ).canUser(\r\n\t\t\t\t'read',\r\n\t\t\t\t'block-directory/search'\r\n\t\t\t);\r\n\r\n\t\t\tlet downloadableBlocks = EMPTY_ARRAY;\r\n\t\t\tif ( hasPermission ) {\r\n\t\t\t\tdownloadableBlocks = getDownloadableBlocks( filterValue );\r\n\r\n\t\t\t\t// Filter out blocks that are already installed.\r\n\t\t\t\tconst installedBlockTypes = getInstalledBlockTypes();\r\n\t\t\t\tconst installableBlocks = downloadableBlocks.filter(\r\n\t\t\t\t\t( { name } ) => {\r\n\t\t\t\t\t\t// Check if the block has just been installed, in which case it\r\n\t\t\t\t\t\t// should still show in the list to avoid suddenly disappearing.\r\n\t\t\t\t\t\t// `installedBlockTypes` only returns blocks stored in state\r\n\t\t\t\t\t\t// immediately after installation, not all installed blocks.\r\n\t\t\t\t\t\tconst isJustInstalled = installedBlockTypes.some(\r\n\t\t\t\t\t\t\t( blockType ) => blockType.name === name\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tconst isPreviouslyInstalled = getBlockType( name );\r\n\t\t\t\t\t\treturn isJustInstalled || ! isPreviouslyInstalled;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Keep identity of the `downloadableBlocks` array if nothing was filtered out\r\n\t\t\t\tif ( installableBlocks.length !== downloadableBlocks.length ) {\r\n\t\t\t\t\tdownloadableBlocks = installableBlocks;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Return identical empty array when there are no blocks\r\n\t\t\t\tif ( downloadableBlocks.length === 0 ) {\r\n\t\t\t\t\tdownloadableBlocks = EMPTY_ARRAY;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\thasPermission,\r\n\t\t\t\tdownloadableBlocks,\r\n\t\t\t\tisLoading: isRequestingDownloadableBlocks( filterValue ),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ filterValue ]\r\n\t);\r\n\r\nexport default function DownloadableBlocksPanel( {\r\n\tonSelect,\r\n\tonHover,\r\n\thasLocalBlocks,\r\n\tisTyping,\r\n\tfilterValue,\r\n} ) {\r\n\tconst { hasPermission, downloadableBlocks, isLoading } =\r\n\t\tuseDownloadableBlocks( filterValue );\r\n\r\n\tif ( hasPermission === undefined || isLoading || isTyping ) {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t{ hasPermission && ! hasLocalBlocks && (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<p className=\"block-directory-downloadable-blocks-panel__no-local\">\r\n\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t'No results available from your installed blocks.'\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t<div className=\"block-editor-inserter__quick-inserter-separator\" />\r\n\t\t\t\t\t</>\r\n\t\t\t\t) }\r\n\t\t\t\t<div className=\"block-directory-downloadable-blocks-panel has-blocks-loading\">\r\n\t\t\t\t\t<Spinner />\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( false === hasPermission ) {\r\n\t\tif ( ! hasLocalBlocks ) {\r\n\t\t\treturn <DownloadableBlocksNoResults />;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif ( downloadableBlocks.length === 0 ) {\r\n\t\treturn hasLocalBlocks ? null : <DownloadableBlocksNoResults />;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DownloadableBlocksInserterPanel\r\n\t\t\tdownloadableItems={ downloadableBlocks }\r\n\t\t\thasLocalBlocks={ hasLocalBlocks }\r\n\t\t>\r\n\t\t\t<DownloadableBlocksList\r\n\t\t\t\titems={ downloadableBlocks }\r\n\t\t\t\tonSelect={ onSelect }\r\n\t\t\t\tonHover={ onHover }\r\n\t\t\t/>\r\n\t\t</DownloadableBlocksInserterPanel>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}