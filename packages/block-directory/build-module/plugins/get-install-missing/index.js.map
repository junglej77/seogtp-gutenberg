{"version":3,"names":["__","sprintf","Button","createBlock","RawHTML","useDispatch","useSelect","store","coreStore","Warning","useBlockProps","blockEditorStore","InstallButton","blockDirectoryStore","jsx","_jsx","jsxs","_jsxs","getInstallMissing","OriginalComponent","props","originalName","attributes","block","hasPermission","select","getDownloadableBlocks","blocks","filter","name","canUser","length","ModifiedWarning","originalBlock","originalUndelimitedContent","clientId","replaceBlock","convertToHTML","content","hasContent","hasHTMLBlock","canInsertBlockType","getBlockRootClientId","messageHTML","title","actions","push","__next40pxDefaultSize","onClick","variant","children"],"sources":["@wordpress/block-directory/src/plugins/get-install-missing/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { Button } from '@wordpress/components';\r\nimport { createBlock } from '@wordpress/blocks';\r\nimport { RawHTML } from '@wordpress/element';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport {\r\n\tWarning,\r\n\tuseBlockProps,\r\n\tstore as blockEditorStore,\r\n} from '@wordpress/block-editor';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport InstallButton from './install-button';\r\nimport { store as blockDirectoryStore } from '../../store';\r\n\r\nconst getInstallMissing = ( OriginalComponent ) => ( props ) => {\r\n\tconst { originalName } = props.attributes;\r\n\t// Disable reason: This is a valid component, but it's mistaken for a callback.\r\n\t// eslint-disable-next-line react-hooks/rules-of-hooks\r\n\tconst { block, hasPermission } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getDownloadableBlocks } = select( blockDirectoryStore );\r\n\t\t\tconst blocks = getDownloadableBlocks(\r\n\t\t\t\t'block:' + originalName\r\n\t\t\t).filter( ( { name } ) => originalName === name );\r\n\t\t\treturn {\r\n\t\t\t\thasPermission: select( coreStore ).canUser(\r\n\t\t\t\t\t'read',\r\n\t\t\t\t\t'block-directory/search'\r\n\t\t\t\t),\r\n\t\t\t\tblock: blocks.length && blocks[ 0 ],\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ originalName ]\r\n\t);\r\n\r\n\t// The user can't install blocks, or the block isn't available for download.\r\n\tif ( ! hasPermission || ! block ) {\r\n\t\treturn <OriginalComponent { ...props } />;\r\n\t}\r\n\r\n\treturn <ModifiedWarning { ...props } originalBlock={ block } />;\r\n};\r\n\r\nconst ModifiedWarning = ( { originalBlock, ...props } ) => {\r\n\tconst { originalName, originalUndelimitedContent, clientId } =\r\n\t\tprops.attributes;\r\n\tconst { replaceBlock } = useDispatch( blockEditorStore );\r\n\tconst convertToHTML = () => {\r\n\t\treplaceBlock(\r\n\t\t\tprops.clientId,\r\n\t\t\tcreateBlock( 'core/html', {\r\n\t\t\t\tcontent: originalUndelimitedContent,\r\n\t\t\t} )\r\n\t\t);\r\n\t};\r\n\r\n\tconst hasContent = !! originalUndelimitedContent;\r\n\tconst hasHTMLBlock = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { canInsertBlockType, getBlockRootClientId } =\r\n\t\t\t\tselect( blockEditorStore );\r\n\r\n\t\t\treturn canInsertBlockType(\r\n\t\t\t\t'core/html',\r\n\t\t\t\tgetBlockRootClientId( clientId )\r\n\t\t\t);\r\n\t\t},\r\n\t\t[ clientId ]\r\n\t);\r\n\r\n\tlet messageHTML = sprintf(\r\n\t\t/* translators: %s: block name */\r\n\t\t__(\r\n\t\t\t'Your site doesn’t include support for the %s block. You can try installing the block or remove it entirely.'\r\n\t\t),\r\n\t\toriginalBlock.title || originalName\r\n\t);\r\n\tconst actions = [\r\n\t\t<InstallButton\r\n\t\t\tkey=\"install\"\r\n\t\t\tblock={ originalBlock }\r\n\t\t\tattributes={ props.attributes }\r\n\t\t\tclientId={ props.clientId }\r\n\t\t/>,\r\n\t];\r\n\r\n\tif ( hasContent && hasHTMLBlock ) {\r\n\t\tmessageHTML = sprintf(\r\n\t\t\t/* translators: %s: block name */\r\n\t\t\t__(\r\n\t\t\t\t'Your site doesn’t include support for the %s block. You can try installing the block, convert it to a Custom HTML block, or remove it entirely.'\r\n\t\t\t),\r\n\t\t\toriginalBlock.title || originalName\r\n\t\t);\r\n\t\tactions.push(\r\n\t\t\t<Button\r\n\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\tkey=\"convert\"\r\n\t\t\t\tonClick={ convertToHTML }\r\n\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t>\r\n\t\t\t\t{ __( 'Keep as HTML' ) }\r\n\t\t\t</Button>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div { ...useBlockProps() }>\r\n\t\t\t<Warning actions={ actions }>{ messageHTML }</Warning>\r\n\t\t\t<RawHTML>{ originalUndelimitedContent }</RawHTML>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default getInstallMissing;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAE,EAAEC,OAAO,QAAQ,iBAAiB;AAC7C,SAASC,MAAM,QAAQ,uBAAuB;AAC9C,SAASC,WAAW,QAAQ,mBAAmB;AAC/C,SAASC,OAAO,QAAQ,oBAAoB;AAC5C,SAASC,WAAW,EAAEC,SAAS,QAAQ,iBAAiB;AACxD,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;AACzD,SACCC,OAAO,EACPC,aAAa,EACbH,KAAK,IAAII,gBAAgB,QACnB,yBAAyB;;AAEhC;AACA;AACA;AACA,OAAOC,aAAa,MAAM,kBAAkB;AAC5C,SAASL,KAAK,IAAIM,mBAAmB,QAAQ,aAAa;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAE3D,MAAMC,iBAAiB,GAAKC,iBAAiB,IAAQC,KAAK,IAAM;EAC/D,MAAM;IAAEC;EAAa,CAAC,GAAGD,KAAK,CAACE,UAAU;EACzC;EACA;EACA,MAAM;IAAEC,KAAK;IAAEC;EAAc,CAAC,GAAGlB,SAAS,CACvCmB,MAAM,IAAM;IACb,MAAM;MAAEC;IAAsB,CAAC,GAAGD,MAAM,CAAEZ,mBAAoB,CAAC;IAC/D,MAAMc,MAAM,GAAGD,qBAAqB,CACnC,QAAQ,GAAGL,YACZ,CAAC,CAACO,MAAM,CAAE,CAAE;MAAEC;IAAK,CAAC,KAAMR,YAAY,KAAKQ,IAAK,CAAC;IACjD,OAAO;MACNL,aAAa,EAAEC,MAAM,CAAEjB,SAAU,CAAC,CAACsB,OAAO,CACzC,MAAM,EACN,wBACD,CAAC;MACDP,KAAK,EAAEI,MAAM,CAACI,MAAM,IAAIJ,MAAM,CAAE,CAAC;IAClC,CAAC;EACF,CAAC,EACD,CAAEN,YAAY,CACf,CAAC;;EAED;EACA,IAAK,CAAEG,aAAa,IAAI,CAAED,KAAK,EAAG;IACjC,oBAAOR,IAAA,CAACI,iBAAiB;MAAA,GAAMC;IAAK,CAAI,CAAC;EAC1C;EAEA,oBAAOL,IAAA,CAACiB,eAAe;IAAA,GAAMZ,KAAK;IAAGa,aAAa,EAAGV;EAAO,CAAE,CAAC;AAChE,CAAC;AAED,MAAMS,eAAe,GAAGA,CAAE;EAAEC,aAAa;EAAE,GAAGb;AAAM,CAAC,KAAM;EAC1D,MAAM;IAAEC,YAAY;IAAEa,0BAA0B;IAAEC;EAAS,CAAC,GAC3Df,KAAK,CAACE,UAAU;EACjB,MAAM;IAAEc;EAAa,CAAC,GAAG/B,WAAW,CAAEM,gBAAiB,CAAC;EACxD,MAAM0B,aAAa,GAAGA,CAAA,KAAM;IAC3BD,YAAY,CACXhB,KAAK,CAACe,QAAQ,EACdhC,WAAW,CAAE,WAAW,EAAE;MACzBmC,OAAO,EAAEJ;IACV,CAAE,CACH,CAAC;EACF,CAAC;EAED,MAAMK,UAAU,GAAG,CAAC,CAAEL,0BAA0B;EAChD,MAAMM,YAAY,GAAGlC,SAAS,CAC3BmB,MAAM,IAAM;IACb,MAAM;MAAEgB,kBAAkB;MAAEC;IAAqB,CAAC,GACjDjB,MAAM,CAAEd,gBAAiB,CAAC;IAE3B,OAAO8B,kBAAkB,CACxB,WAAW,EACXC,oBAAoB,CAAEP,QAAS,CAChC,CAAC;EACF,CAAC,EACD,CAAEA,QAAQ,CACX,CAAC;EAED,IAAIQ,WAAW,GAAG1C,OAAO,EACxB;EACAD,EAAE,CACD,6GACD,CAAC,EACDiC,aAAa,CAACW,KAAK,IAAIvB,YACxB,CAAC;EACD,MAAMwB,OAAO,GAAG,cACf9B,IAAA,CAACH,aAAa;IAEbW,KAAK,EAAGU,aAAe;IACvBX,UAAU,EAAGF,KAAK,CAACE,UAAY;IAC/Ba,QAAQ,EAAGf,KAAK,CAACe;EAAU,GAHvB,SAIJ,CAAC,CACF;EAED,IAAKI,UAAU,IAAIC,YAAY,EAAG;IACjCG,WAAW,GAAG1C,OAAO,EACpB;IACAD,EAAE,CACD,iJACD,CAAC,EACDiC,aAAa,CAACW,KAAK,IAAIvB,YACxB,CAAC;IACDwB,OAAO,CAACC,IAAI,eACX/B,IAAA,CAACb;IACA;IAAA;MACA6C,qBAAqB,EAAG,KAAO;MAE/BC,OAAO,EAAGX,aAAe;MACzBY,OAAO,EAAC,UAAU;MAAAC,QAAA,EAEhBlD,EAAE,CAAE,cAAe;IAAC,GAJlB,SAKG,CACT,CAAC;EACF;EAEA,oBACCiB,KAAA;IAAA,GAAUP,aAAa,CAAC,CAAC;IAAAwC,QAAA,gBACxBnC,IAAA,CAACN,OAAO;MAACoC,OAAO,EAAGA,OAAS;MAAAK,QAAA,EAAGP;IAAW,CAAW,CAAC,eACtD5B,IAAA,CAACX,OAAO;MAAA8C,QAAA,EAAGhB;IAA0B,CAAW,CAAC;EAAA,CAC7C,CAAC;AAER,CAAC;AAED,eAAehB,iBAAiB","ignoreList":[]}