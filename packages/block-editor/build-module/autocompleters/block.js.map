{"version":3,"names":["useSelect","createBlock","createBlocksFromInnerBlocksTemplate","parse","useMemo","searchBlockItems","useBlockTypesState","BlockIcon","store","blockEditorStore","orderBy","orderInserterBlockItems","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","noop","SHOWN_BLOCK_TYPES","createBlockCompleter","name","className","triggerPrefix","useItems","filterValue","rootClientId","selectedBlockName","prioritizedBlocks","select","getSelectedBlockClientId","getBlockName","getBlockListSettings","getBlockRootClientId","selectedBlockClientId","_rootClientId","prioritizedInserterBlocks","items","categories","collections","filteredItems","initialFilteredItems","trim","filter","item","slice","options","map","blockItem","title","icon","isDisabled","key","id","value","label","children","showColors","allowContext","before","after","test","getOptionCompletion","inserterItem","initialAttributes","innerBlocks","syncStatus","content","action","__unstableSkipMigrationLogs"],"sources":["@wordpress/block-editor/src/autocompleters/block.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect } from '@wordpress/data';\r\nimport {\r\n\tcreateBlock,\r\n\tcreateBlocksFromInnerBlocksTemplate,\r\n\tparse,\r\n} from '@wordpress/blocks';\r\nimport { useMemo } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { searchBlockItems } from '../components/inserter/search-items';\r\nimport useBlockTypesState from '../components/inserter/hooks/use-block-types-state';\r\nimport BlockIcon from '../components/block-icon';\r\nimport { store as blockEditorStore } from '../store';\r\nimport { orderBy } from '../utils/sorting';\r\nimport { orderInserterBlockItems } from '../utils/order-inserter-block-items';\r\n\r\nconst noop = () => {};\r\nconst SHOWN_BLOCK_TYPES = 9;\r\n\r\n/** @typedef {import('@wordpress/components').WPCompleter} WPCompleter */\r\n\r\n/**\r\n * Creates a blocks repeater for replacing the current block with a selected block type.\r\n *\r\n * @return {WPCompleter} A blocks completer.\r\n */\r\nfunction createBlockCompleter() {\r\n\treturn {\r\n\t\tname: 'blocks',\r\n\t\tclassName: 'block-editor-autocompleters__block',\r\n\t\ttriggerPrefix: '/',\r\n\r\n\t\tuseItems( filterValue ) {\r\n\t\t\tconst { rootClientId, selectedBlockName, prioritizedBlocks } =\r\n\t\t\t\tuseSelect( ( select ) => {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tgetSelectedBlockClientId,\r\n\t\t\t\t\t\tgetBlockName,\r\n\t\t\t\t\t\tgetBlockListSettings,\r\n\t\t\t\t\t\tgetBlockRootClientId,\r\n\t\t\t\t\t} = select( blockEditorStore );\r\n\t\t\t\t\tconst selectedBlockClientId = getSelectedBlockClientId();\r\n\t\t\t\t\tconst _rootClientId = getBlockRootClientId(\r\n\t\t\t\t\t\tselectedBlockClientId\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tselectedBlockName: selectedBlockClientId\r\n\t\t\t\t\t\t\t? getBlockName( selectedBlockClientId )\r\n\t\t\t\t\t\t\t: null,\r\n\t\t\t\t\t\trootClientId: _rootClientId,\r\n\t\t\t\t\t\tprioritizedBlocks:\r\n\t\t\t\t\t\t\tgetBlockListSettings( _rootClientId )\r\n\t\t\t\t\t\t\t\t?.prioritizedInserterBlocks,\r\n\t\t\t\t\t};\r\n\t\t\t\t}, [] );\r\n\t\t\tconst [ items, categories, collections ] = useBlockTypesState(\r\n\t\t\t\trootClientId,\r\n\t\t\t\tnoop,\r\n\t\t\t\ttrue\r\n\t\t\t);\r\n\r\n\t\t\tconst filteredItems = useMemo( () => {\r\n\t\t\t\tconst initialFilteredItems = !! filterValue.trim()\r\n\t\t\t\t\t? searchBlockItems(\r\n\t\t\t\t\t\t\titems,\r\n\t\t\t\t\t\t\tcategories,\r\n\t\t\t\t\t\t\tcollections,\r\n\t\t\t\t\t\t\tfilterValue\r\n\t\t\t\t\t  )\r\n\t\t\t\t\t: orderInserterBlockItems(\r\n\t\t\t\t\t\t\torderBy( items, 'frecency', 'desc' ),\r\n\t\t\t\t\t\t\tprioritizedBlocks\r\n\t\t\t\t\t  );\r\n\r\n\t\t\t\treturn initialFilteredItems\r\n\t\t\t\t\t.filter( ( item ) => item.name !== selectedBlockName )\r\n\t\t\t\t\t.slice( 0, SHOWN_BLOCK_TYPES );\r\n\t\t\t}, [\r\n\t\t\t\tfilterValue,\r\n\t\t\t\tselectedBlockName,\r\n\t\t\t\titems,\r\n\t\t\t\tcategories,\r\n\t\t\t\tcollections,\r\n\t\t\t\tprioritizedBlocks,\r\n\t\t\t] );\r\n\r\n\t\t\tconst options = useMemo(\r\n\t\t\t\t() =>\r\n\t\t\t\t\tfilteredItems.map( ( blockItem ) => {\r\n\t\t\t\t\t\tconst { title, icon, isDisabled } = blockItem;\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tkey: `block-${ blockItem.id }`,\r\n\t\t\t\t\t\t\tvalue: blockItem,\r\n\t\t\t\t\t\t\tlabel: (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<BlockIcon\r\n\t\t\t\t\t\t\t\t\t\tkey=\"icon\"\r\n\t\t\t\t\t\t\t\t\t\ticon={ icon }\r\n\t\t\t\t\t\t\t\t\t\tshowColors\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t{ title }\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\tisDisabled,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} ),\r\n\t\t\t\t[ filteredItems ]\r\n\t\t\t);\r\n\r\n\t\t\treturn [ options ];\r\n\t\t},\r\n\t\tallowContext( before, after ) {\r\n\t\t\treturn ! ( /\\S/.test( before ) || /\\S/.test( after ) );\r\n\t\t},\r\n\t\tgetOptionCompletion( inserterItem ) {\r\n\t\t\tconst {\r\n\t\t\t\tname,\r\n\t\t\t\tinitialAttributes,\r\n\t\t\t\tinnerBlocks,\r\n\t\t\t\tsyncStatus,\r\n\t\t\t\tcontent,\r\n\t\t\t} = inserterItem;\r\n\r\n\t\t\treturn {\r\n\t\t\t\taction: 'replace',\r\n\t\t\t\tvalue:\r\n\t\t\t\t\tsyncStatus === 'unsynced'\r\n\t\t\t\t\t\t? parse( content, {\r\n\t\t\t\t\t\t\t\t__unstableSkipMigrationLogs: true,\r\n\t\t\t\t\t\t  } )\r\n\t\t\t\t\t\t: createBlock(\r\n\t\t\t\t\t\t\t\tname,\r\n\t\t\t\t\t\t\t\tinitialAttributes,\r\n\t\t\t\t\t\t\t\tcreateBlocksFromInnerBlocksTemplate(\r\n\t\t\t\t\t\t\t\t\tinnerBlocks\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t  ),\r\n\t\t\t};\r\n\t\t},\r\n\t};\r\n}\r\n\r\n/**\r\n * Creates a blocks repeater for replacing the current block with a selected block type.\r\n *\r\n * @return {WPCompleter} A blocks completer.\r\n */\r\nexport default createBlockCompleter();\r\n"],"mappings":"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","ignoreList":[]}