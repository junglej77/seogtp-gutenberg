{"version":3,"names":["store","blocksStore","Draggable","useSelect","useDispatch","useEffect","useRef","throttle","BlockDraggableChip","useScrollWhenDragging","blockEditorStore","useBlockElement","isDropTargetValid","jsx","_jsx","BlockDraggable","appendToOwnerDocument","children","clientIds","cloneClassname","elementId","onDragStart","onDragEnd","fadeWhenDisabled","dragComponent","srcRootClientId","isDraggable","icon","visibleInserter","getBlockType","select","canMoveBlocks","getBlockRootClientId","getBlockName","getBlockAttributes","isBlockInsertionPointVisible","_getBlockType","getActiveBlockVariation","rootClientId","blockName","variation","isDraggingRef","startScrolling","scrollOnDragOver","stopScrolling","getAllowedBlocks","getBlockNamesByClientId","startDraggingBlocks","stopDraggingBlocks","current","blockEl","editorRoot","closest","onDragOver","event","target","draggedBlockNames","targetClientId","getAttribute","allowedBlocks","targetBlockName","dropTargetValid","length","targetRootClientId","targetRootBlockName","rootAllowedBlocks","window","document","body","classList","add","remove","throttledOnDragOver","addEventListener","removeEventListener","draggable","transferData","type","srcClientIds","__experimentalTransferDataType","requestAnimationFrame","__experimentalDragComponent","undefined","count","onDraggableStart","onDraggableEnd"],"sources":["@wordpress/block-editor/src/components/block-draggable/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { store as blocksStore } from '@wordpress/blocks';\r\nimport { Draggable } from '@wordpress/components';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useRef } from '@wordpress/element';\r\nimport { throttle } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport BlockDraggableChip from './draggable-chip';\r\nimport useScrollWhenDragging from './use-scroll-when-dragging';\r\nimport { store as blockEditorStore } from '../../store';\r\nimport { useBlockElement } from '../block-list/use-block-props/use-block-refs';\r\nimport { isDropTargetValid } from '../use-block-drop-zone';\r\n\r\nconst BlockDraggable = ( {\r\n\tappendToOwnerDocument,\r\n\tchildren,\r\n\tclientIds,\r\n\tcloneClassname,\r\n\telementId,\r\n\tonDragStart,\r\n\tonDragEnd,\r\n\tfadeWhenDisabled = false,\r\n\tdragComponent,\r\n} ) => {\r\n\tconst {\r\n\t\tsrcRootClientId,\r\n\t\tisDraggable,\r\n\t\ticon,\r\n\t\tvisibleInserter,\r\n\t\tgetBlockType,\r\n\t} = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst {\r\n\t\t\t\tcanMoveBlocks,\r\n\t\t\t\tgetBlockRootClientId,\r\n\t\t\t\tgetBlockName,\r\n\t\t\t\tgetBlockAttributes,\r\n\t\t\t\tisBlockInsertionPointVisible,\r\n\t\t\t} = select( blockEditorStore );\r\n\t\t\tconst { getBlockType: _getBlockType, getActiveBlockVariation } =\r\n\t\t\t\tselect( blocksStore );\r\n\t\t\tconst rootClientId = getBlockRootClientId( clientIds[ 0 ] );\r\n\t\t\tconst blockName = getBlockName( clientIds[ 0 ] );\r\n\t\t\tconst variation = getActiveBlockVariation(\r\n\t\t\t\tblockName,\r\n\t\t\t\tgetBlockAttributes( clientIds[ 0 ] )\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tsrcRootClientId: rootClientId,\r\n\t\t\t\tisDraggable: canMoveBlocks( clientIds ),\r\n\t\t\t\ticon: variation?.icon || _getBlockType( blockName )?.icon,\r\n\t\t\t\tvisibleInserter: isBlockInsertionPointVisible(),\r\n\t\t\t\tgetBlockType: _getBlockType,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ clientIds ]\r\n\t);\r\n\r\n\tconst isDraggingRef = useRef( false );\r\n\tconst [ startScrolling, scrollOnDragOver, stopScrolling ] =\r\n\t\tuseScrollWhenDragging();\r\n\r\n\tconst { getAllowedBlocks, getBlockNamesByClientId, getBlockRootClientId } =\r\n\t\tuseSelect( blockEditorStore );\r\n\r\n\tconst { startDraggingBlocks, stopDraggingBlocks } =\r\n\t\tuseDispatch( blockEditorStore );\r\n\r\n\t// Stop dragging blocks if the block draggable is unmounted.\r\n\tuseEffect( () => {\r\n\t\treturn () => {\r\n\t\t\tif ( isDraggingRef.current ) {\r\n\t\t\t\tstopDraggingBlocks();\r\n\t\t\t}\r\n\t\t};\r\n\t}, [] );\r\n\r\n\t// Find the root of the editor iframe.\r\n\tconst blockEl = useBlockElement( clientIds[ 0 ] );\r\n\tconst editorRoot = blockEl?.closest( 'body' );\r\n\r\n\t/*\r\n\t * Add a dragover event listener to the editor root to track the blocks being dragged over.\r\n\t * The listener has to be inside the editor iframe otherwise the target isn't accessible.\r\n\t */\r\n\tuseEffect( () => {\r\n\t\tif ( ! editorRoot || ! fadeWhenDisabled ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst onDragOver = ( event ) => {\r\n\t\t\tif ( ! event.target.closest( '[data-block]' ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst draggedBlockNames = getBlockNamesByClientId( clientIds );\r\n\t\t\tconst targetClientId = event.target\r\n\t\t\t\t.closest( '[data-block]' )\r\n\t\t\t\t.getAttribute( 'data-block' );\r\n\r\n\t\t\tconst allowedBlocks = getAllowedBlocks( targetClientId );\r\n\t\t\tconst targetBlockName = getBlockNamesByClientId( [\r\n\t\t\t\ttargetClientId,\r\n\t\t\t] )[ 0 ];\r\n\r\n\t\t\t/*\r\n\t\t\t * Check if the target is valid to drop in.\r\n\t\t\t * If the target's allowedBlocks is an empty array,\r\n\t\t\t * it isn't a container block, in which case we check\r\n\t\t\t * its parent's validity instead.\r\n\t\t\t */\r\n\t\t\tlet dropTargetValid;\r\n\t\t\tif ( allowedBlocks?.length === 0 ) {\r\n\t\t\t\tconst targetRootClientId =\r\n\t\t\t\t\tgetBlockRootClientId( targetClientId );\r\n\t\t\t\tconst targetRootBlockName = getBlockNamesByClientId( [\r\n\t\t\t\t\ttargetRootClientId,\r\n\t\t\t\t] )[ 0 ];\r\n\t\t\t\tconst rootAllowedBlocks =\r\n\t\t\t\t\tgetAllowedBlocks( targetRootClientId );\r\n\t\t\t\tdropTargetValid = isDropTargetValid(\r\n\t\t\t\t\tgetBlockType,\r\n\t\t\t\t\trootAllowedBlocks,\r\n\t\t\t\t\tdraggedBlockNames,\r\n\t\t\t\t\ttargetRootBlockName\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tdropTargetValid = isDropTargetValid(\r\n\t\t\t\t\tgetBlockType,\r\n\t\t\t\t\tallowedBlocks,\r\n\t\t\t\t\tdraggedBlockNames,\r\n\t\t\t\t\ttargetBlockName\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\t * Update the body class to reflect if drop target is valid.\r\n\t\t\t * This has to be done on the document body because the draggable\r\n\t\t\t * chip is rendered outside of the editor iframe.\r\n\t\t\t */\r\n\t\t\tif ( ! dropTargetValid && ! visibleInserter ) {\r\n\t\t\t\twindow?.document?.body?.classList?.add(\r\n\t\t\t\t\t'block-draggable-invalid-drag-token'\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\twindow?.document?.body?.classList?.remove(\r\n\t\t\t\t\t'block-draggable-invalid-drag-token'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst throttledOnDragOver = throttle( onDragOver, 200 );\r\n\r\n\t\teditorRoot.addEventListener( 'dragover', throttledOnDragOver );\r\n\r\n\t\treturn () => {\r\n\t\t\teditorRoot.removeEventListener( 'dragover', throttledOnDragOver );\r\n\t\t};\r\n\t}, [\r\n\t\tclientIds,\r\n\t\teditorRoot,\r\n\t\tfadeWhenDisabled,\r\n\t\tgetAllowedBlocks,\r\n\t\tgetBlockNamesByClientId,\r\n\t\tgetBlockRootClientId,\r\n\t\tgetBlockType,\r\n\t\tvisibleInserter,\r\n\t] );\r\n\r\n\tif ( ! isDraggable ) {\r\n\t\treturn children( { draggable: false } );\r\n\t}\r\n\r\n\tconst transferData = {\r\n\t\ttype: 'block',\r\n\t\tsrcClientIds: clientIds,\r\n\t\tsrcRootClientId,\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Draggable\r\n\t\t\tappendToOwnerDocument={ appendToOwnerDocument }\r\n\t\t\tcloneClassname={ cloneClassname }\r\n\t\t\t__experimentalTransferDataType=\"wp-blocks\"\r\n\t\t\ttransferData={ transferData }\r\n\t\t\tonDragStart={ ( event ) => {\r\n\t\t\t\t// Defer hiding the dragged source element to the next\r\n\t\t\t\t// frame to enable dragging.\r\n\t\t\t\twindow.requestAnimationFrame( () => {\r\n\t\t\t\t\tstartDraggingBlocks( clientIds );\r\n\t\t\t\t\tisDraggingRef.current = true;\r\n\r\n\t\t\t\t\tstartScrolling( event );\r\n\r\n\t\t\t\t\tif ( onDragStart ) {\r\n\t\t\t\t\t\tonDragStart();\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\t\t\t} }\r\n\t\t\tonDragOver={ scrollOnDragOver }\r\n\t\t\tonDragEnd={ () => {\r\n\t\t\t\tstopDraggingBlocks();\r\n\t\t\t\tisDraggingRef.current = false;\r\n\r\n\t\t\t\tstopScrolling();\r\n\r\n\t\t\t\tif ( onDragEnd ) {\r\n\t\t\t\t\tonDragEnd();\r\n\t\t\t\t}\r\n\t\t\t} }\r\n\t\t\t__experimentalDragComponent={\r\n\t\t\t\t// Check against `undefined` so that `null` can be used to disable\r\n\t\t\t\t// the default drag component.\r\n\t\t\t\tdragComponent !== undefined ? (\r\n\t\t\t\t\tdragComponent\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<BlockDraggableChip\r\n\t\t\t\t\t\tcount={ clientIds.length }\r\n\t\t\t\t\t\ticon={ icon }\r\n\t\t\t\t\t\tfadeWhenDisabled\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\telementId={ elementId }\r\n\t\t>\r\n\t\t\t{ ( { onDraggableStart, onDraggableEnd } ) => {\r\n\t\t\t\treturn children( {\r\n\t\t\t\t\tdraggable: true,\r\n\t\t\t\t\tonDragStart: onDraggableStart,\r\n\t\t\t\t\tonDragEnd: onDraggableEnd,\r\n\t\t\t\t} );\r\n\t\t\t} }\r\n\t\t</Draggable>\r\n\t);\r\n};\r\n\r\nexport default BlockDraggable;\r\n"],"mappings":"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","ignoreList":[]}