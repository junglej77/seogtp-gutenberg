{"version":3,"names":["getScrollContainer","useCallback","useEffect","useRef","SCROLL_INACTIVE_DISTANCE_PX","SCROLL_INTERVAL_MS","PIXELS_PER_SECOND_PER_PERCENTAGE","VELOCITY_MULTIPLIER","useScrollWhenDragging","dragStartYRef","velocityYRef","scrollParentYRef","scrollEditorIntervalRef","current","clearInterval","startScrolling","event","clientY","target","setInterval","newTop","scrollTop","scroll","top","scrollOnDragOver","scrollParentHeight","offsetHeight","offsetDragStartPosition","offsetTop","offsetDragPosition","moveableDistance","Math","max","dragDistance","distancePercentage","stopScrolling"],"sources":["@wordpress/block-editor/src/components/block-draggable/use-scroll-when-dragging.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { getScrollContainer } from '@wordpress/dom';\r\nimport { useCallback, useEffect, useRef } from '@wordpress/element';\r\n\r\nconst SCROLL_INACTIVE_DISTANCE_PX = 50;\r\nconst SCROLL_INTERVAL_MS = 25;\r\nconst PIXELS_PER_SECOND_PER_PERCENTAGE = 1000;\r\nconst VELOCITY_MULTIPLIER =\r\n\tPIXELS_PER_SECOND_PER_PERCENTAGE * ( SCROLL_INTERVAL_MS / 1000 );\r\n\r\n/**\r\n * React hook that scrolls the scroll container when a block is being dragged.\r\n *\r\n * @return {Function[]} `startScrolling`, `scrollOnDragOver`, `stopScrolling`\r\n *                      functions to be called in `onDragStart`, `onDragOver`\r\n *                      and `onDragEnd` events respectively.\r\n */\r\nexport default function useScrollWhenDragging() {\r\n\tconst dragStartYRef = useRef( null );\r\n\tconst velocityYRef = useRef( null );\r\n\tconst scrollParentYRef = useRef( null );\r\n\tconst scrollEditorIntervalRef = useRef( null );\r\n\r\n\t// Clear interval when unmounting.\r\n\tuseEffect(\r\n\t\t() => () => {\r\n\t\t\tif ( scrollEditorIntervalRef.current ) {\r\n\t\t\t\tclearInterval( scrollEditorIntervalRef.current );\r\n\t\t\t\tscrollEditorIntervalRef.current = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\tconst startScrolling = useCallback( ( event ) => {\r\n\t\tdragStartYRef.current = event.clientY;\r\n\r\n\t\t// Find nearest parent(s) to scroll.\r\n\t\tscrollParentYRef.current = getScrollContainer( event.target );\r\n\r\n\t\tscrollEditorIntervalRef.current = setInterval( () => {\r\n\t\t\tif ( scrollParentYRef.current && velocityYRef.current ) {\r\n\t\t\t\tconst newTop =\r\n\t\t\t\t\tscrollParentYRef.current.scrollTop + velocityYRef.current;\r\n\r\n\t\t\t\t// Setting `behavior: 'smooth'` as a scroll property seems to hurt performance.\r\n\t\t\t\t// Better to use a small scroll interval.\r\n\t\t\t\tscrollParentYRef.current.scroll( {\r\n\t\t\t\t\ttop: newTop,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}, SCROLL_INTERVAL_MS );\r\n\t}, [] );\r\n\r\n\tconst scrollOnDragOver = useCallback( ( event ) => {\r\n\t\tif ( ! scrollParentYRef.current ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst scrollParentHeight = scrollParentYRef.current.offsetHeight;\r\n\t\tconst offsetDragStartPosition =\r\n\t\t\tdragStartYRef.current - scrollParentYRef.current.offsetTop;\r\n\t\tconst offsetDragPosition =\r\n\t\t\tevent.clientY - scrollParentYRef.current.offsetTop;\r\n\r\n\t\tif ( event.clientY > offsetDragStartPosition ) {\r\n\t\t\t// User is dragging downwards.\r\n\t\t\tconst moveableDistance = Math.max(\r\n\t\t\t\tscrollParentHeight -\r\n\t\t\t\t\toffsetDragStartPosition -\r\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\tconst dragDistance = Math.max(\r\n\t\t\t\toffsetDragPosition -\r\n\t\t\t\t\toffsetDragStartPosition -\r\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\tconst distancePercentage =\r\n\t\t\t\tmoveableDistance === 0 || dragDistance === 0\r\n\t\t\t\t\t? 0\r\n\t\t\t\t\t: dragDistance / moveableDistance;\r\n\t\t\tvelocityYRef.current = VELOCITY_MULTIPLIER * distancePercentage;\r\n\t\t} else if ( event.clientY < offsetDragStartPosition ) {\r\n\t\t\t// User is dragging upwards.\r\n\t\t\tconst moveableDistance = Math.max(\r\n\t\t\t\toffsetDragStartPosition - SCROLL_INACTIVE_DISTANCE_PX,\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\tconst dragDistance = Math.max(\r\n\t\t\t\toffsetDragStartPosition -\r\n\t\t\t\t\toffsetDragPosition -\r\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\tconst distancePercentage =\r\n\t\t\t\tmoveableDistance === 0 || dragDistance === 0\r\n\t\t\t\t\t? 0\r\n\t\t\t\t\t: dragDistance / moveableDistance;\r\n\t\t\tvelocityYRef.current = -VELOCITY_MULTIPLIER * distancePercentage;\r\n\t\t} else {\r\n\t\t\tvelocityYRef.current = 0;\r\n\t\t}\r\n\t}, [] );\r\n\r\n\tconst stopScrolling = () => {\r\n\t\tdragStartYRef.current = null;\r\n\t\tscrollParentYRef.current = null;\r\n\r\n\t\tif ( scrollEditorIntervalRef.current ) {\r\n\t\t\tclearInterval( scrollEditorIntervalRef.current );\r\n\t\t\tscrollEditorIntervalRef.current = null;\r\n\t\t}\r\n\t};\r\n\r\n\treturn [ startScrolling, scrollOnDragOver, stopScrolling ];\r\n}\r\n"],"mappings":"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","ignoreList":[]}