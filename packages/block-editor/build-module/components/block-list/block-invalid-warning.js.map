{"version":3,"names":["__","_x","Button","Modal","useState","useCallback","useMemo","createBlock","rawHandler","useDispatch","useSelect","Warning","BlockCompare","store","blockEditorStore","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","blockToBlocks","block","HTML","originalContent","BlockInvalidWarning","clientId","canInsertHTMLBlock","canInsertClassicBlock","select","canInsertBlockType","getBlock","getBlockRootClientId","rootClientId","replaceBlock","compare","setCompare","onCompareClose","convert","toClassic","classicBlock","content","toHTML","htmlBlock","toBlocks","newBlocks","toRecoveredBlock","recoveredBlock","name","attributes","innerBlocks","secondaryActions","title","onClick","filter","Boolean","children","actions","__next40pxDefaultSize","variant","onRequestClose","className","onKeep","onConvert","convertor","convertButtonText"],"sources":["@wordpress/block-editor/src/components/block-list/block-invalid-warning.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, _x } from '@wordpress/i18n';\r\nimport { Button, Modal } from '@wordpress/components';\r\nimport { useState, useCallback, useMemo } from '@wordpress/element';\r\nimport { createBlock, rawHandler } from '@wordpress/blocks';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport Warning from '../warning';\r\nimport BlockCompare from '../block-compare';\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\nconst blockToBlocks = ( block ) =>\r\n\trawHandler( {\r\n\t\tHTML: block.originalContent,\r\n\t} );\r\n\r\nexport default function BlockInvalidWarning( { clientId } ) {\r\n\tconst { block, canInsertHTMLBlock, canInsertClassicBlock } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { canInsertBlockType, getBlock, getBlockRootClientId } =\r\n\t\t\t\tselect( blockEditorStore );\r\n\r\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\r\n\r\n\t\t\treturn {\r\n\t\t\t\tblock: getBlock( clientId ),\r\n\t\t\t\tcanInsertHTMLBlock: canInsertBlockType(\r\n\t\t\t\t\t'core/html',\r\n\t\t\t\t\trootClientId\r\n\t\t\t\t),\r\n\t\t\t\tcanInsertClassicBlock: canInsertBlockType(\r\n\t\t\t\t\t'core/freeform',\r\n\t\t\t\t\trootClientId\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ clientId ]\r\n\t);\r\n\tconst { replaceBlock } = useDispatch( blockEditorStore );\r\n\r\n\tconst [ compare, setCompare ] = useState( false );\r\n\tconst onCompareClose = useCallback( () => setCompare( false ), [] );\r\n\r\n\tconst convert = useMemo(\r\n\t\t() => ( {\r\n\t\t\ttoClassic() {\r\n\t\t\t\tconst classicBlock = createBlock( 'core/freeform', {\r\n\t\t\t\t\tcontent: block.originalContent,\r\n\t\t\t\t} );\r\n\t\t\t\treturn replaceBlock( block.clientId, classicBlock );\r\n\t\t\t},\r\n\t\t\ttoHTML() {\r\n\t\t\t\tconst htmlBlock = createBlock( 'core/html', {\r\n\t\t\t\t\tcontent: block.originalContent,\r\n\t\t\t\t} );\r\n\t\t\t\treturn replaceBlock( block.clientId, htmlBlock );\r\n\t\t\t},\r\n\t\t\ttoBlocks() {\r\n\t\t\t\tconst newBlocks = blockToBlocks( block );\r\n\t\t\t\treturn replaceBlock( block.clientId, newBlocks );\r\n\t\t\t},\r\n\t\t\ttoRecoveredBlock() {\r\n\t\t\t\tconst recoveredBlock = createBlock(\r\n\t\t\t\t\tblock.name,\r\n\t\t\t\t\tblock.attributes,\r\n\t\t\t\t\tblock.innerBlocks\r\n\t\t\t\t);\r\n\t\t\t\treturn replaceBlock( block.clientId, recoveredBlock );\r\n\t\t\t},\r\n\t\t} ),\r\n\t\t[ block, replaceBlock ]\r\n\t);\r\n\r\n\tconst secondaryActions = useMemo(\r\n\t\t() =>\r\n\t\t\t[\r\n\t\t\t\t{\r\n\t\t\t\t\t// translators: Button to fix block content\r\n\t\t\t\t\ttitle: _x( 'Resolve', 'imperative verb' ),\r\n\t\t\t\t\tonClick: () => setCompare( true ),\r\n\t\t\t\t},\r\n\t\t\t\tcanInsertHTMLBlock && {\r\n\t\t\t\t\ttitle: __( 'Convert to HTML' ),\r\n\t\t\t\t\tonClick: convert.toHTML,\r\n\t\t\t\t},\r\n\t\t\t\tcanInsertClassicBlock && {\r\n\t\t\t\t\ttitle: __( 'Convert to Classic Block' ),\r\n\t\t\t\t\tonClick: convert.toClassic,\r\n\t\t\t\t},\r\n\t\t\t].filter( Boolean ),\r\n\t\t[ canInsertHTMLBlock, canInsertClassicBlock, convert ]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Warning\r\n\t\t\t\tactions={ [\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\tkey=\"recover\"\r\n\t\t\t\t\t\tonClick={ convert.toRecoveredBlock }\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ __( 'Attempt recovery' ) }\r\n\t\t\t\t\t</Button>,\r\n\t\t\t\t] }\r\n\t\t\t\tsecondaryActions={ secondaryActions }\r\n\t\t\t>\r\n\t\t\t\t{ __( 'Block contains unexpected or invalid content.' ) }\r\n\t\t\t</Warning>\r\n\t\t\t{ compare && (\r\n\t\t\t\t<Modal\r\n\t\t\t\t\ttitle={\r\n\t\t\t\t\t\t// translators: Dialog title to fix block content\r\n\t\t\t\t\t\t__( 'Resolve Block' )\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonRequestClose={ onCompareClose }\r\n\t\t\t\t\tclassName=\"block-editor-block-compare\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<BlockCompare\r\n\t\t\t\t\t\tblock={ block }\r\n\t\t\t\t\t\tonKeep={ convert.toHTML }\r\n\t\t\t\t\t\tonConvert={ convert.toBlocks }\r\n\t\t\t\t\t\tconvertor={ blockToBlocks }\r\n\t\t\t\t\t\tconvertButtonText={ __( 'Convert to Blocks' ) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Modal>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}