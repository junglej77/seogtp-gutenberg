{"version":3,"names":["createContext","useContext","orderBy","DEFAULT_BLOCK_LIST_CONTEXT","scrollRef","blocksLayouts","current","findBlockLayoutByClientId","getBlockLayoutsOrderedByYCoord","findBlockLayoutByPosition","updateBlocksLayouts","Context","Provider","Consumer","data","position","Object","values","find","block","x","width","y","height","clientId","entries","reduce","acc","entry","item","innerBlocks","keys","length","deleteBlockLayoutByClientId","key","blockData","rootClientId","shouldRemove","layoutProps","BlockListProvider","BlockListConsumer","useBlockListContext"],"sources":["@wordpress/block-editor/src/components/block-list/block-list-context.native.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createContext, useContext } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { orderBy } from '../../utils/sorting';\r\n\r\nexport const DEFAULT_BLOCK_LIST_CONTEXT = {\r\n\tscrollRef: null,\r\n\tblocksLayouts: { current: {} },\r\n\tfindBlockLayoutByClientId,\r\n\tgetBlockLayoutsOrderedByYCoord,\r\n\tfindBlockLayoutByPosition,\r\n\tupdateBlocksLayouts,\r\n};\r\n\r\nconst Context = createContext( DEFAULT_BLOCK_LIST_CONTEXT );\r\nconst { Provider, Consumer } = Context;\r\n\r\n/**\r\n * Finds a block's layout data by position.\r\n *\r\n * @param {Object} data       Blocks layouts object.\r\n * @param {Object} position   Position to use for finding the block.\r\n * @param {number} position.x X coordinate.\r\n * @param {number} position.y Y coordinate.\r\n *\r\n * @return {Object|undefined} Found block layout data that matches the provided position. If none is found, `undefined` will be returned.\r\n */\r\nfunction findBlockLayoutByPosition( data, position ) {\r\n\t// Only enabled for root level blocks\r\n\treturn Object.values( data ).find( ( block ) => {\r\n\t\treturn (\r\n\t\t\tposition.x >= block.x &&\r\n\t\t\tposition.x <= block.x + block.width &&\r\n\t\t\tposition.y >= block.y &&\r\n\t\t\tposition.y <= block.y + block.height\r\n\t\t);\r\n\t} );\r\n}\r\n\r\n/**\r\n * Finds a block's layout data by its client Id.\r\n *\r\n * @param {Object} data     Blocks layouts object.\r\n * @param {string} clientId Block's clientId.\r\n *\r\n * @return {Object} Found block layout data.\r\n */\r\nfunction findBlockLayoutByClientId( data, clientId ) {\r\n\treturn Object.entries( data ).reduce( ( acc, entry ) => {\r\n\t\tconst item = entry[ 1 ];\r\n\t\tif ( acc ) {\r\n\t\t\treturn acc;\r\n\t\t}\r\n\t\tif ( item?.clientId === clientId ) {\r\n\t\t\treturn item;\r\n\t\t}\r\n\t\tif ( item?.innerBlocks && Object.keys( item.innerBlocks ).length > 0 ) {\r\n\t\t\treturn findBlockLayoutByClientId( item.innerBlocks, clientId );\r\n\t\t}\r\n\t\treturn null;\r\n\t}, null );\r\n}\r\n\r\n/**\r\n * Deletes the layout data of a block by its client Id.\r\n *\r\n * @param {Object} data     Blocks layouts object.\r\n * @param {string} clientId Block's clientsId.\r\n *\r\n * @return {Object} Updated data object.\r\n */\r\nexport function deleteBlockLayoutByClientId( data, clientId ) {\r\n\treturn Object.keys( data ).reduce( ( acc, key ) => {\r\n\t\tif ( key !== clientId ) {\r\n\t\t\tacc[ key ] = data[ key ];\r\n\t\t}\r\n\t\tif (\r\n\t\t\tdata[ key ]?.innerBlocks &&\r\n\t\t\tObject.keys( data[ key ].innerBlocks ).length > 0\r\n\t\t) {\r\n\t\t\tif ( acc[ key ] ) {\r\n\t\t\t\tacc[ key ].innerBlocks = deleteBlockLayoutByClientId(\r\n\t\t\t\t\tdata[ key ].innerBlocks,\r\n\t\t\t\t\tclientId\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn acc;\r\n\t}, {} );\r\n}\r\n\r\n/**\r\n * Orders the block's layout data by its Y coordinate.\r\n *\r\n * @param {Object} data Blocks layouts object.\r\n *\r\n * @return {Object} Blocks layouts object ordered by its Y coordinate.\r\n */\r\nfunction getBlockLayoutsOrderedByYCoord( data ) {\r\n\t// Only enabled for root level blocks.\r\n\treturn orderBy( Object.values( data ), 'y' );\r\n}\r\n\r\n/**\r\n * Updates or deletes a block's layout data in the blocksLayouts object,\r\n * in case of deletion, the layout data is not required.\r\n *\r\n * @param {Object}   blocksLayouts          Blocks layouts object.\r\n * @param {Object}   blockData              Block's layout data to add or remove to/from the blockLayouts object.\r\n * @param {string}   blockData.clientId     Block's clientId.\r\n * @param {?string}  blockData.rootClientId Optional. Block's rootClientId.\r\n * @param {?boolean} blockData.shouldRemove Optional. Flag to remove it from the blocksLayout list.\r\n * @param {number}   blockData.width        Block's width.\r\n * @param {number}   blockData.height       Block's height.\r\n * @param {number}   blockData.x            Block's x coordinate (relative to the parent).\r\n * @param {number}   blockData.y            Block's y coordinate (relative to the parent).\r\n */\r\n\r\nfunction updateBlocksLayouts( blocksLayouts, blockData ) {\r\n\tconst { clientId, rootClientId, shouldRemove, ...layoutProps } = blockData;\r\n\r\n\tif ( clientId && shouldRemove ) {\r\n\t\tblocksLayouts.current = deleteBlockLayoutByClientId(\r\n\t\t\tblocksLayouts.current,\r\n\t\t\tclientId\r\n\t\t);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif ( clientId && ! rootClientId ) {\r\n\t\tblocksLayouts.current[ clientId ] = {\r\n\t\t\tclientId,\r\n\t\t\trootClientId,\r\n\t\t\t...layoutProps,\r\n\t\t\tinnerBlocks: {\r\n\t\t\t\t...blocksLayouts.current[ clientId ]?.innerBlocks,\r\n\t\t\t},\r\n\t\t};\r\n\t} else if ( clientId && rootClientId ) {\r\n\t\tconst block = findBlockLayoutByClientId(\r\n\t\t\tblocksLayouts.current,\r\n\t\t\trootClientId\r\n\t\t);\r\n\r\n\t\tif ( block ) {\r\n\t\t\tblock.innerBlocks[ clientId ] = {\r\n\t\t\t\tclientId,\r\n\t\t\t\trootClientId,\r\n\t\t\t\t...layoutProps,\r\n\t\t\t\tinnerBlocks: {\r\n\t\t\t\t\t...block.innerBlocks[ clientId ]?.innerBlocks,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport { Provider as BlockListProvider, Consumer as BlockListConsumer };\r\n\r\n/**\r\n * Hook that returns the block list context.\r\n *\r\n * @return {Object} Block list context\r\n */\r\nexport const useBlockListContext = () => {\r\n\treturn useContext( Context );\r\n};\r\n"],"mappings":"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","ignoreList":[]}