{"version":3,"names":["useEffect","useRef","focus","isFormElement","isTextField","placeCaretAtHorizontalEdge","useSelect","isInsideRootBlock","store","blockEditorStore","useFocusFirstElement","clientId","initialPosition","ref","isBlockSelected","isMultiSelecting","__unstableGetEditorMode","undefined","current","ownerDocument","activeElement","textInputs","tabbable","find","filter","node","isReverse","target","length","defaultView","getSelection","removeAllRanges","getAttribute","focusElement","findNext"],"sources":["@wordpress/block-editor/src/components/block-list/use-block-props/use-focus-first-element.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useEffect, useRef } from '@wordpress/element';\r\nimport {\r\n\tfocus,\r\n\tisFormElement,\r\n\tisTextField,\r\n\tplaceCaretAtHorizontalEdge,\r\n} from '@wordpress/dom';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { isInsideRootBlock } from '../../../utils/dom';\r\nimport { store as blockEditorStore } from '../../../store';\r\n\r\n/** @typedef {import('@wordpress/element').RefObject} RefObject */\r\n\r\n/**\r\n * Transitions focus to the block or inner tabbable when the block becomes\r\n * selected and an initial position is set.\r\n *\r\n * @param {string} clientId Block client ID.\r\n *\r\n * @return {RefObject} React ref with the block element.\r\n */\r\nexport function useFocusFirstElement( { clientId, initialPosition } ) {\r\n\tconst ref = useRef();\r\n\tconst { isBlockSelected, isMultiSelecting, __unstableGetEditorMode } =\r\n\t\tuseSelect( blockEditorStore );\r\n\r\n\tuseEffect( () => {\r\n\t\t// Check if the block is still selected at the time this effect runs.\r\n\t\tif (\r\n\t\t\t! isBlockSelected( clientId ) ||\r\n\t\t\tisMultiSelecting() ||\r\n\t\t\t__unstableGetEditorMode() === 'zoom-out'\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( initialPosition === undefined || initialPosition === null ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( ! ref.current ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { ownerDocument } = ref.current;\r\n\r\n\t\t// Do not focus the block if it already contains the active element.\r\n\t\tif ( isInsideRootBlock( ref.current, ownerDocument.activeElement ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Find all tabbables within node.\r\n\t\tconst textInputs = focus.tabbable\r\n\t\t\t.find( ref.current )\r\n\t\t\t.filter( ( node ) => isTextField( node ) );\r\n\r\n\t\t// If reversed (e.g. merge via backspace), use the last in the set of\r\n\t\t// tabbables.\r\n\t\tconst isReverse = -1 === initialPosition;\r\n\t\tconst target =\r\n\t\t\ttextInputs[ isReverse ? textInputs.length - 1 : 0 ] || ref.current;\r\n\r\n\t\tif ( ! isInsideRootBlock( ref.current, target ) ) {\r\n\t\t\townerDocument.defaultView.getSelection().removeAllRanges();\r\n\t\t\tref.current.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Check to see if element is focussable before a generic caret insert.\r\n\t\tif ( ! ref.current.getAttribute( 'contenteditable' ) ) {\r\n\t\t\tconst focusElement = focus.tabbable.findNext( ref.current );\r\n\t\t\t// Make sure focusElement is valid, contained in the same block, and a form field.\r\n\t\t\tif (\r\n\t\t\t\tfocusElement &&\r\n\t\t\t\tisInsideRootBlock( ref.current, focusElement ) &&\r\n\t\t\t\tisFormElement( focusElement )\r\n\t\t\t) {\r\n\t\t\t\tfocusElement.focus();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tplaceCaretAtHorizontalEdge( target, isReverse );\r\n\t}, [ initialPosition, clientId ] );\r\n\r\n\treturn ref;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,EAAEC,MAAM,QAAQ,oBAAoB;AACtD,SACCC,KAAK,EACLC,aAAa,EACbC,WAAW,EACXC,0BAA0B,QACpB,gBAAgB;AACvB,SAASC,SAAS,QAAQ,iBAAiB;;AAE3C;AACA;AACA;AACA,SAASC,iBAAiB,QAAQ,oBAAoB;AACtD,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,gBAAgB;;AAE1D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,oBAAoBA,CAAE;EAAEC,QAAQ;EAAEC;AAAgB,CAAC,EAAG;EACrE,MAAMC,GAAG,GAAGZ,MAAM,CAAC,CAAC;EACpB,MAAM;IAAEa,eAAe;IAAEC,gBAAgB;IAAEC;EAAwB,CAAC,GACnEV,SAAS,CAAEG,gBAAiB,CAAC;EAE9BT,SAAS,CAAE,MAAM;IAChB;IACA,IACC,CAAEc,eAAe,CAAEH,QAAS,CAAC,IAC7BI,gBAAgB,CAAC,CAAC,IAClBC,uBAAuB,CAAC,CAAC,KAAK,UAAU,EACvC;MACD;IACD;IAEA,IAAKJ,eAAe,KAAKK,SAAS,IAAIL,eAAe,KAAK,IAAI,EAAG;MAChE;IACD;IAEA,IAAK,CAAEC,GAAG,CAACK,OAAO,EAAG;MACpB;IACD;IAEA,MAAM;MAAEC;IAAc,CAAC,GAAGN,GAAG,CAACK,OAAO;;IAErC;IACA,IAAKX,iBAAiB,CAAEM,GAAG,CAACK,OAAO,EAAEC,aAAa,CAACC,aAAc,CAAC,EAAG;MACpE;IACD;;IAEA;IACA,MAAMC,UAAU,GAAGnB,KAAK,CAACoB,QAAQ,CAC/BC,IAAI,CAAEV,GAAG,CAACK,OAAQ,CAAC,CACnBM,MAAM,CAAIC,IAAI,IAAMrB,WAAW,CAAEqB,IAAK,CAAE,CAAC;;IAE3C;IACA;IACA,MAAMC,SAAS,GAAG,CAAC,CAAC,KAAKd,eAAe;IACxC,MAAMe,MAAM,GACXN,UAAU,CAAEK,SAAS,GAAGL,UAAU,CAACO,MAAM,GAAG,CAAC,GAAG,CAAC,CAAE,IAAIf,GAAG,CAACK,OAAO;IAEnE,IAAK,CAAEX,iBAAiB,CAAEM,GAAG,CAACK,OAAO,EAAES,MAAO,CAAC,EAAG;MACjDR,aAAa,CAACU,WAAW,CAACC,YAAY,CAAC,CAAC,CAACC,eAAe,CAAC,CAAC;MAC1DlB,GAAG,CAACK,OAAO,CAAChB,KAAK,CAAC,CAAC;MACnB;IACD;;IAEA;IACA,IAAK,CAAEW,GAAG,CAACK,OAAO,CAACc,YAAY,CAAE,iBAAkB,CAAC,EAAG;MACtD,MAAMC,YAAY,GAAG/B,KAAK,CAACoB,QAAQ,CAACY,QAAQ,CAAErB,GAAG,CAACK,OAAQ,CAAC;MAC3D;MACA,IACCe,YAAY,IACZ1B,iBAAiB,CAAEM,GAAG,CAACK,OAAO,EAAEe,YAAa,CAAC,IAC9C9B,aAAa,CAAE8B,YAAa,CAAC,EAC5B;QACDA,YAAY,CAAC/B,KAAK,CAAC,CAAC;QACpB;MACD;IACD;IACAG,0BAA0B,CAAEsB,MAAM,EAAED,SAAU,CAAC;EAChD,CAAC,EAAE,CAAEd,eAAe,EAAED,QAAQ,CAAG,CAAC;EAElC,OAAOE,GAAG;AACX","ignoreList":[]}