{"version":3,"names":["useRefEffect","useSelect","useDispatch","useContext","isRTL","store","blockEditorStore","InsertionPointOpenRef","useInBetweenInserter","openRef","isInBetweenInserterDisabled","select","getSettings","isDistractionFree","__unstableGetEditorMode","getBlockListSettings","getBlockIndex","isMultiSelecting","getSelectedBlockClientIds","getTemplateLock","__unstableIsWithinBlockOverlay","getBlockEditingMode","getBlockName","getBlockAttributes","showInsertionPoint","hideInsertionPoint","node","onMouseMove","event","undefined","current","target","nodeType","TEXT_NODE","classList","contains","rootClientId","blockElement","getAttribute","closest","layout","isManualPlacement","blockListSettings","orientation","captureToolbars","__experimentalCaptureToolbars","offsetTop","clientY","offsetLeft","clientX","children","Array","from","element","find","blockEl","blockElRect","getBoundingClientRect","top","right","left","id","firstElementChild","clientId","slice","length","includes","hasFixedToolbar","elementRect","bottom","index","__unstableWithInserter","addEventListener","removeEventListener"],"sources":["@wordpress/block-editor/src/components/block-list/use-in-between-inserter.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useRefEffect } from '@wordpress/compose';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useContext } from '@wordpress/element';\r\nimport { isRTL } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../../store';\r\nimport { InsertionPointOpenRef } from '../block-tools/insertion-point';\r\n\r\nexport function useInBetweenInserter() {\r\n\tconst openRef = useContext( InsertionPointOpenRef );\r\n\tconst isInBetweenInserterDisabled = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( blockEditorStore ).getSettings().isDistractionFree ||\r\n\t\t\tselect( blockEditorStore ).__unstableGetEditorMode() === 'zoom-out',\r\n\t\t[]\r\n\t);\r\n\tconst {\r\n\t\tgetBlockListSettings,\r\n\t\tgetBlockIndex,\r\n\t\tisMultiSelecting,\r\n\t\tgetSelectedBlockClientIds,\r\n\t\tgetSettings,\r\n\t\tgetTemplateLock,\r\n\t\t__unstableIsWithinBlockOverlay,\r\n\t\tgetBlockEditingMode,\r\n\t\tgetBlockName,\r\n\t\tgetBlockAttributes,\r\n\t} = useSelect( blockEditorStore );\r\n\tconst { showInsertionPoint, hideInsertionPoint } =\r\n\t\tuseDispatch( blockEditorStore );\r\n\r\n\treturn useRefEffect(\r\n\t\t( node ) => {\r\n\t\t\tif ( isInBetweenInserterDisabled ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfunction onMouseMove( event ) {\r\n\t\t\t\t// openRef is the reference to the insertion point between blocks.\r\n\t\t\t\t// If the reference is not set or the insertion point is already open, return.\r\n\t\t\t\tif ( openRef === undefined || openRef.current ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Ignore text nodes sometimes detected in FireFox.\r\n\t\t\t\tif ( event.target.nodeType === event.target.TEXT_NODE ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( isMultiSelecting() ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t! event.target.classList.contains(\r\n\t\t\t\t\t\t'block-editor-block-list__layout'\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\thideInsertionPoint();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet rootClientId;\r\n\t\t\t\tif (\r\n\t\t\t\t\t! event.target.classList.contains( 'is-root-container' )\r\n\t\t\t\t) {\r\n\t\t\t\t\tconst blockElement = !! event.target.getAttribute(\r\n\t\t\t\t\t\t'data-block'\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\t? event.target\r\n\t\t\t\t\t\t: event.target.closest( '[data-block]' );\r\n\t\t\t\t\trootClientId = blockElement.getAttribute( 'data-block' );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tgetTemplateLock( rootClientId ) ||\r\n\t\t\t\t\tgetBlockEditingMode( rootClientId ) === 'disabled' ||\r\n\t\t\t\t\tgetBlockName( rootClientId ) === 'core/block' ||\r\n\t\t\t\t\t( rootClientId &&\r\n\t\t\t\t\t\tgetBlockAttributes( rootClientId ).layout\r\n\t\t\t\t\t\t\t?.isManualPlacement )\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst blockListSettings = getBlockListSettings( rootClientId );\r\n\t\t\t\tconst orientation =\r\n\t\t\t\t\tblockListSettings?.orientation || 'vertical';\r\n\t\t\t\tconst captureToolbars =\r\n\t\t\t\t\t!! blockListSettings?.__experimentalCaptureToolbars;\r\n\t\t\t\tconst offsetTop = event.clientY;\r\n\t\t\t\tconst offsetLeft = event.clientX;\r\n\r\n\t\t\t\tconst children = Array.from( event.target.children );\r\n\t\t\t\tlet element = children.find( ( blockEl ) => {\r\n\t\t\t\t\tconst blockElRect = blockEl.getBoundingClientRect();\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t( blockEl.classList.contains( 'wp-block' ) &&\r\n\t\t\t\t\t\t\torientation === 'vertical' &&\r\n\t\t\t\t\t\t\tblockElRect.top > offsetTop ) ||\r\n\t\t\t\t\t\t( blockEl.classList.contains( 'wp-block' ) &&\r\n\t\t\t\t\t\t\torientation === 'horizontal' &&\r\n\t\t\t\t\t\t\t( isRTL()\r\n\t\t\t\t\t\t\t\t? blockElRect.right < offsetLeft\r\n\t\t\t\t\t\t\t\t: blockElRect.left > offsetLeft ) )\r\n\t\t\t\t\t);\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tif ( ! element ) {\r\n\t\t\t\t\thideInsertionPoint();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// The block may be in an alignment wrapper, so check the first direct\r\n\t\t\t\t// child if the element has no ID.\r\n\t\t\t\tif ( ! element.id ) {\r\n\t\t\t\t\telement = element.firstElementChild;\r\n\r\n\t\t\t\t\tif ( ! element ) {\r\n\t\t\t\t\t\thideInsertionPoint();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Don't show the insertion point if a parent block has an \"overlay\"\r\n\t\t\t\t// See https://github.com/WordPress/gutenberg/pull/34012#pullrequestreview-727762337\r\n\t\t\t\tconst clientId = element.id.slice( 'block-'.length );\r\n\t\t\t\tif (\r\n\t\t\t\t\t! clientId ||\r\n\t\t\t\t\t__unstableIsWithinBlockOverlay( clientId )\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Don't show the inserter if the following conditions are met,\r\n\t\t\t\t// as it conflicts with the block toolbar:\r\n\t\t\t\t// 1. when hovering above or inside selected block(s)\r\n\t\t\t\t// 2. when the orientation is vertical\r\n\t\t\t\t// 3. when the __experimentalCaptureToolbars is not enabled\r\n\t\t\t\t// 4. when the Top Toolbar is not disabled\r\n\t\t\t\tif (\r\n\t\t\t\t\tgetSelectedBlockClientIds().includes( clientId ) &&\r\n\t\t\t\t\torientation === 'vertical' &&\r\n\t\t\t\t\t! captureToolbars &&\r\n\t\t\t\t\t! getSettings().hasFixedToolbar\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconst elementRect = element.getBoundingClientRect();\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t( orientation === 'horizontal' &&\r\n\t\t\t\t\t\t( event.clientY > elementRect.bottom ||\r\n\t\t\t\t\t\t\tevent.clientY < elementRect.top ) ) ||\r\n\t\t\t\t\t( orientation === 'vertical' &&\r\n\t\t\t\t\t\t( event.clientX > elementRect.right ||\r\n\t\t\t\t\t\t\tevent.clientX < elementRect.left ) )\r\n\t\t\t\t) {\r\n\t\t\t\t\thideInsertionPoint();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst index = getBlockIndex( clientId );\r\n\r\n\t\t\t\t// Don't show the in-between inserter before the first block in\r\n\t\t\t\t// the list (preserves the original behaviour).\r\n\t\t\t\tif ( index === 0 ) {\r\n\t\t\t\t\thideInsertionPoint();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tshowInsertionPoint( rootClientId, index, {\r\n\t\t\t\t\t__unstableWithInserter: true,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\tnode.addEventListener( 'mousemove', onMouseMove );\r\n\r\n\t\t\treturn () => {\r\n\t\t\t\tnode.removeEventListener( 'mousemove', onMouseMove );\r\n\t\t\t};\r\n\t\t},\r\n\t\t[\r\n\t\t\topenRef,\r\n\t\t\tgetBlockListSettings,\r\n\t\t\tgetBlockIndex,\r\n\t\t\tisMultiSelecting,\r\n\t\t\tshowInsertionPoint,\r\n\t\t\thideInsertionPoint,\r\n\t\t\tgetSelectedBlockClientIds,\r\n\t\t\tisInBetweenInserterDisabled,\r\n\t\t]\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}