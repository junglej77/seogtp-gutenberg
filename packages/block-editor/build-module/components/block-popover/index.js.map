{"version":3,"names":["clsx","useMergeRefs","Popover","forwardRef","useMemo","useReducer","useLayoutEffect","useBlockElement","usePopoverScroll","rectUnion","getVisibleElementBounds","jsx","_jsx","MAX_POPOVER_RECOMPUTE_COUNTER","Number","MAX_SAFE_INTEGER","BlockPopover","clientId","bottomClientId","children","__unstablePopoverSlot","__unstableContentRef","shift","props","ref","selectedElement","lastSelectedElement","mergedRefs","popoverDimensionsRecomputeCounter","forceRecomputePopoverDimensions","s","observer","window","MutationObserver","observe","attributes","disconnect","popoverAnchor","undefined","getBoundingClientRect","contextElement","animate","focusOnMount","anchor","__unstableSlotName","inline","placement","resize","flip","className","variant","PrivateBlockPopover","PublicBlockPopover"],"sources":["@wordpress/block-editor/src/components/block-popover/index.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useMergeRefs } from '@wordpress/compose';\r\nimport { Popover } from '@wordpress/components';\r\nimport {\r\n\tforwardRef,\r\n\tuseMemo,\r\n\tuseReducer,\r\n\tuseLayoutEffect,\r\n} from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { useBlockElement } from '../block-list/use-block-props/use-block-refs';\r\nimport usePopoverScroll from './use-popover-scroll';\r\nimport { rectUnion, getVisibleElementBounds } from '../../utils/dom';\r\n\r\nconst MAX_POPOVER_RECOMPUTE_COUNTER = Number.MAX_SAFE_INTEGER;\r\n\r\nfunction BlockPopover(\r\n\t{\r\n\t\tclientId,\r\n\t\tbottomClientId,\r\n\t\tchildren,\r\n\t\t__unstablePopoverSlot,\r\n\t\t__unstableContentRef,\r\n\t\tshift = true,\r\n\t\t...props\r\n\t},\r\n\tref\r\n) {\r\n\tconst selectedElement = useBlockElement( clientId );\r\n\tconst lastSelectedElement = useBlockElement( bottomClientId ?? clientId );\r\n\tconst mergedRefs = useMergeRefs( [\r\n\t\tref,\r\n\t\tusePopoverScroll( __unstableContentRef ),\r\n\t] );\r\n\r\n\tconst [\r\n\t\tpopoverDimensionsRecomputeCounter,\r\n\t\tforceRecomputePopoverDimensions,\r\n\t] = useReducer(\r\n\t\t// Module is there to make sure that the counter doesn't overflow.\r\n\t\t( s ) => ( s + 1 ) % MAX_POPOVER_RECOMPUTE_COUNTER,\r\n\t\t0\r\n\t);\r\n\r\n\t// When blocks are moved up/down, they are animated to their new position by\r\n\t// updating the `transform` property manually (i.e. without using CSS\r\n\t// transitions or animations). The animation, which can also scroll the block\r\n\t// editor, can sometimes cause the position of the Popover to get out of sync.\r\n\t// A MutationObserver is therefore used to make sure that changes to the\r\n\t// selectedElement's attribute (i.e. `transform`) can be tracked and used to\r\n\t// trigger the Popover to rerender.\r\n\tuseLayoutEffect( () => {\r\n\t\tif ( ! selectedElement ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst observer = new window.MutationObserver(\r\n\t\t\tforceRecomputePopoverDimensions\r\n\t\t);\r\n\t\tobserver.observe( selectedElement, { attributes: true } );\r\n\r\n\t\treturn () => {\r\n\t\t\tobserver.disconnect();\r\n\t\t};\r\n\t}, [ selectedElement ] );\r\n\r\n\tconst popoverAnchor = useMemo( () => {\r\n\t\tif (\r\n\t\t\t// popoverDimensionsRecomputeCounter is by definition always equal or greater\r\n\t\t\t// than 0. This check is only there to satisfy the correctness of the\r\n\t\t\t// exhaustive-deps rule for the `useMemo` hook.\r\n\t\t\tpopoverDimensionsRecomputeCounter < 0 ||\r\n\t\t\t! selectedElement ||\r\n\t\t\t( bottomClientId && ! lastSelectedElement )\r\n\t\t) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tgetBoundingClientRect() {\r\n\t\t\t\treturn lastSelectedElement\r\n\t\t\t\t\t? rectUnion(\r\n\t\t\t\t\t\t\tgetVisibleElementBounds( selectedElement ),\r\n\t\t\t\t\t\t\tgetVisibleElementBounds( lastSelectedElement )\r\n\t\t\t\t\t  )\r\n\t\t\t\t\t: getVisibleElementBounds( selectedElement );\r\n\t\t\t},\r\n\t\t\tcontextElement: selectedElement,\r\n\t\t};\r\n\t}, [\r\n\t\tbottomClientId,\r\n\t\tlastSelectedElement,\r\n\t\tselectedElement,\r\n\t\tpopoverDimensionsRecomputeCounter,\r\n\t] );\r\n\r\n\tif ( ! selectedElement || ( bottomClientId && ! lastSelectedElement ) ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Popover\r\n\t\t\tref={ mergedRefs }\r\n\t\t\tanimate={ false }\r\n\t\t\tfocusOnMount={ false }\r\n\t\t\tanchor={ popoverAnchor }\r\n\t\t\t// Render in the old slot if needed for backward compatibility,\r\n\t\t\t// otherwise render in place (not in the default popover slot).\r\n\t\t\t__unstableSlotName={ __unstablePopoverSlot }\r\n\t\t\tinline={ ! __unstablePopoverSlot }\r\n\t\t\tplacement=\"top-start\"\r\n\t\t\tresize={ false }\r\n\t\t\tflip={ false }\r\n\t\t\tshift={ shift }\r\n\t\t\t{ ...props }\r\n\t\t\tclassName={ clsx( 'block-editor-block-popover', props.className ) }\r\n\t\t\tvariant=\"unstyled\"\r\n\t\t>\r\n\t\t\t{ children }\r\n\t\t</Popover>\r\n\t);\r\n}\r\n\r\nexport const PrivateBlockPopover = forwardRef( BlockPopover );\r\n\r\nconst PublicBlockPopover = (\r\n\t{ clientId, bottomClientId, children, ...props },\r\n\tref\r\n) => (\r\n\t<PrivateBlockPopover\r\n\t\t{ ...props }\r\n\t\tbottomClientId={ bottomClientId }\r\n\t\tclientId={ clientId }\r\n\t\t__unstableContentRef={ undefined }\r\n\t\t__unstablePopoverSlot={ undefined }\r\n\t\tref={ ref }\r\n\t>\r\n\t\t{ children }\r\n\t</PrivateBlockPopover>\r\n);\r\n\r\n/**\r\n * @see https://github.com/WordPress/gutenberg/blob/HEAD/packages/block-editor/src/components/block-popover/README.md\r\n */\r\nexport default forwardRef( PublicBlockPopover );\r\n"],"mappings":"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","ignoreList":[]}