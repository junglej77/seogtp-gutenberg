{"version":3,"names":["useResizeObserver","useRefEffect","useSelect","memo","useMemo","Disabled","BlockList","Iframe","EditorStyles","store","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MemoizedBlockList","MAX_HEIGHT","EMPTY_ADDITIONAL_STYLES","ScaledBlockPreview","viewportWidth","containerWidth","minHeight","additionalStyles","contentResizeListener","height","contentHeight","styles","select","settings","getSettings","editorStyles","css","__unstableType","scale","aspectRatio","className","style","transform","maxHeight","undefined","children","contentRef","bodyElement","ownerDocument","documentElement","classList","add","position","width","boxSizing","tabIndex","pointerEvents","renderAppender","AutoBlockPreview","props","containerResizeListener"],"sources":["@wordpress/block-editor/src/components/block-preview/auto.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useResizeObserver, useRefEffect } from '@wordpress/compose';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { memo, useMemo } from '@wordpress/element';\r\nimport { Disabled } from '@wordpress/components';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport BlockList from '../block-list';\r\nimport Iframe from '../iframe';\r\nimport EditorStyles from '../editor-styles';\r\nimport { store } from '../../store';\r\n\r\n// This is used to avoid rendering the block list if the sizes change.\r\nlet MemoizedBlockList;\r\n\r\nconst MAX_HEIGHT = 2000;\r\nconst EMPTY_ADDITIONAL_STYLES = [];\r\n\r\nfunction ScaledBlockPreview( {\r\n\tviewportWidth,\r\n\tcontainerWidth,\r\n\tminHeight,\r\n\tadditionalStyles = EMPTY_ADDITIONAL_STYLES,\r\n} ) {\r\n\tif ( ! viewportWidth ) {\r\n\t\tviewportWidth = containerWidth;\r\n\t}\r\n\r\n\tconst [ contentResizeListener, { height: contentHeight } ] =\r\n\t\tuseResizeObserver();\r\n\tconst { styles } = useSelect( ( select ) => {\r\n\t\tconst settings = select( store ).getSettings();\r\n\t\treturn {\r\n\t\t\tstyles: settings.styles,\r\n\t\t};\r\n\t}, [] );\r\n\r\n\t// Avoid scrollbars for pattern previews.\r\n\tconst editorStyles = useMemo( () => {\r\n\t\tif ( styles ) {\r\n\t\t\treturn [\r\n\t\t\t\t...styles,\r\n\t\t\t\t{\r\n\t\t\t\t\tcss: 'body{height:auto;overflow:hidden;border:none;padding:0;}',\r\n\t\t\t\t\t__unstableType: 'presets',\r\n\t\t\t\t},\r\n\t\t\t\t...additionalStyles,\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\treturn styles;\r\n\t}, [ styles, additionalStyles ] );\r\n\r\n\t// Initialize on render instead of module top level, to avoid circular dependency issues.\r\n\tMemoizedBlockList = MemoizedBlockList || memo( BlockList );\r\n\r\n\tconst scale = containerWidth / viewportWidth;\r\n\tconst aspectRatio = contentHeight\r\n\t\t? containerWidth / ( contentHeight * scale )\r\n\t\t: 0;\r\n\treturn (\r\n\t\t<Disabled\r\n\t\t\tclassName=\"block-editor-block-preview__content\"\r\n\t\t\tstyle={ {\r\n\t\t\t\ttransform: `scale(${ scale })`,\r\n\t\t\t\t// Using width + aspect-ratio instead of height here triggers browsers' native\r\n\t\t\t\t// handling of scrollbar's visibility. It prevents the flickering issue seen\r\n\t\t\t\t// in https://github.com/WordPress/gutenberg/issues/52027.\r\n\t\t\t\t// See https://github.com/WordPress/gutenberg/pull/52921 for more info.\r\n\t\t\t\taspectRatio,\r\n\t\t\t\tmaxHeight:\r\n\t\t\t\t\tcontentHeight > MAX_HEIGHT ? MAX_HEIGHT * scale : undefined,\r\n\t\t\t\tminHeight,\r\n\t\t\t} }\r\n\t\t>\r\n\t\t\t<Iframe\r\n\t\t\t\tcontentRef={ useRefEffect( ( bodyElement ) => {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\townerDocument: { documentElement },\r\n\t\t\t\t\t} = bodyElement;\r\n\t\t\t\t\tdocumentElement.classList.add(\r\n\t\t\t\t\t\t'block-editor-block-preview__content-iframe'\r\n\t\t\t\t\t);\r\n\t\t\t\t\tdocumentElement.style.position = 'absolute';\r\n\t\t\t\t\tdocumentElement.style.width = '100%';\r\n\r\n\t\t\t\t\t// Necessary for contentResizeListener to work.\r\n\t\t\t\t\tbodyElement.style.boxSizing = 'border-box';\r\n\t\t\t\t\tbodyElement.style.position = 'absolute';\r\n\t\t\t\t\tbodyElement.style.width = '100%';\r\n\t\t\t\t}, [] ) }\r\n\t\t\t\taria-hidden\r\n\t\t\t\ttabIndex={ -1 }\r\n\t\t\t\tstyle={ {\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\twidth: viewportWidth,\r\n\t\t\t\t\theight: contentHeight,\r\n\t\t\t\t\tpointerEvents: 'none',\r\n\t\t\t\t\t// This is a catch-all max-height for patterns.\r\n\t\t\t\t\t// See: https://github.com/WordPress/gutenberg/pull/38175.\r\n\t\t\t\t\tmaxHeight: MAX_HEIGHT,\r\n\t\t\t\t\tminHeight:\r\n\t\t\t\t\t\tscale !== 0 && scale < 1 && minHeight\r\n\t\t\t\t\t\t\t? minHeight / scale\r\n\t\t\t\t\t\t\t: minHeight,\r\n\t\t\t\t} }\r\n\t\t\t>\r\n\t\t\t\t<EditorStyles styles={ editorStyles } />\r\n\t\t\t\t{ contentResizeListener }\r\n\t\t\t\t<MemoizedBlockList renderAppender={ false } />\r\n\t\t\t</Iframe>\r\n\t\t</Disabled>\r\n\t);\r\n}\r\n\r\nexport default function AutoBlockPreview( props ) {\r\n\tconst [ containerResizeListener, { width: containerWidth } ] =\r\n\t\tuseResizeObserver();\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div style={ { position: 'relative', width: '100%', height: 0 } }>\r\n\t\t\t\t{ containerResizeListener }\r\n\t\t\t</div>\r\n\t\t\t<div className=\"block-editor-block-preview__container\">\r\n\t\t\t\t{ !! containerWidth && (\r\n\t\t\t\t\t<ScaledBlockPreview\r\n\t\t\t\t\t\t{ ...props }\r\n\t\t\t\t\t\tcontainerWidth={ containerWidth }\r\n\t\t\t\t\t/>\r\n\t\t\t\t) }\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}