{"version":3,"names":["useMemo","cloneBlock","getMatchingBlockByName","getRetainedBlockAttributes","transformMatchingBlock","match","selectedBlock","retainedBlockAttributes","name","attributes","getPatternTransformedBlocks","selectedBlocks","patternBlocks","_patternBlocks","map","block","consumedBlocks","Set","isMatch","patternBlock","add","clientId","useTransformedPatterns","patterns","reduce","accumulator","_pattern","transformedBlocks","blocks","push"],"sources":["@wordpress/block-editor/src/components/block-switcher/use-transformed-patterns.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useMemo } from '@wordpress/element';\r\nimport { cloneBlock } from '@wordpress/blocks';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { getMatchingBlockByName, getRetainedBlockAttributes } from './utils';\r\n\r\n/**\r\n * Mutate the matched block's attributes by getting\r\n * which block type's attributes to retain and prioritize\r\n * them in the merging of the attributes.\r\n *\r\n * @param {WPBlock} match         The matched block.\r\n * @param {WPBlock} selectedBlock The selected block.\r\n * @return {void}\r\n */\r\nexport const transformMatchingBlock = ( match, selectedBlock ) => {\r\n\t// Get the block attributes to retain through the transformation.\r\n\tconst retainedBlockAttributes = getRetainedBlockAttributes(\r\n\t\tselectedBlock.name,\r\n\t\tselectedBlock.attributes\r\n\t);\r\n\tmatch.attributes = {\r\n\t\t...match.attributes,\r\n\t\t...retainedBlockAttributes,\r\n\t};\r\n};\r\n\r\n/**\r\n * By providing the selected blocks and pattern's blocks\r\n * find the matching blocks, transform them and return them.\r\n * If not all selected blocks are matched, return nothing.\r\n *\r\n * @param {WPBlock[]} selectedBlocks The selected blocks.\r\n * @param {WPBlock[]} patternBlocks  The pattern's blocks.\r\n * @return {WPBlock[]|void} The transformed pattern's blocks or undefined if not all selected blocks have been matched.\r\n */\r\nexport const getPatternTransformedBlocks = (\r\n\tselectedBlocks,\r\n\tpatternBlocks\r\n) => {\r\n\t// Clone Pattern's blocks to produce new clientIds and be able to mutate the matches.\r\n\tconst _patternBlocks = patternBlocks.map( ( block ) =>\r\n\t\tcloneBlock( block )\r\n\t);\r\n\t/**\r\n\t * Keep track of the consumed pattern blocks.\r\n\t * This is needed because we loop the selected blocks\r\n\t * and for example we may have selected two paragraphs and\r\n\t * the pattern's blocks could have more `paragraphs`.\r\n\t */\r\n\tconst consumedBlocks = new Set();\r\n\tfor ( const selectedBlock of selectedBlocks ) {\r\n\t\tlet isMatch = false;\r\n\t\tfor ( const patternBlock of _patternBlocks ) {\r\n\t\t\tconst match = getMatchingBlockByName(\r\n\t\t\t\tpatternBlock,\r\n\t\t\t\tselectedBlock.name,\r\n\t\t\t\tconsumedBlocks\r\n\t\t\t);\r\n\t\t\tif ( ! match ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tisMatch = true;\r\n\t\t\tconsumedBlocks.add( match.clientId );\r\n\t\t\t// We update (mutate) the matching pattern block.\r\n\t\t\ttransformMatchingBlock( match, selectedBlock );\r\n\t\t\t// No need to loop through other pattern's blocks.\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t// Bail eary if a selected block has not been matched.\r\n\t\tif ( ! isMatch ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\treturn _patternBlocks;\r\n};\r\n\r\n/**\r\n * @typedef {WPBlockPattern & {transformedBlocks: WPBlock[]}} TransformedBlockPattern\r\n */\r\n\r\n/**\r\n * Custom hook that accepts patterns from state and the selected\r\n * blocks and tries to match these with the pattern's blocks.\r\n * If all selected blocks are matched with a Pattern's block,\r\n * we transform them by retaining block's attributes with `role:content`.\r\n * The transformed pattern's blocks are set to a new pattern\r\n * property `transformedBlocks`.\r\n *\r\n * @param {WPBlockPattern[]} patterns       Patterns from state.\r\n * @param {WPBlock[]}        selectedBlocks The currently selected blocks.\r\n * @return {TransformedBlockPattern[]} Returns the eligible matched patterns with all the selected blocks.\r\n */\r\nconst useTransformedPatterns = ( patterns, selectedBlocks ) => {\r\n\treturn useMemo(\r\n\t\t() =>\r\n\t\t\tpatterns.reduce( ( accumulator, _pattern ) => {\r\n\t\t\t\tconst transformedBlocks = getPatternTransformedBlocks(\r\n\t\t\t\t\tselectedBlocks,\r\n\t\t\t\t\t_pattern.blocks\r\n\t\t\t\t);\r\n\t\t\t\tif ( transformedBlocks ) {\r\n\t\t\t\t\taccumulator.push( {\r\n\t\t\t\t\t\t..._pattern,\r\n\t\t\t\t\t\ttransformedBlocks,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}, [] ),\r\n\t\t[ patterns, selectedBlocks ]\r\n\t);\r\n};\r\n\r\nexport default useTransformedPatterns;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,OAAO,QAAQ,oBAAoB;AAC5C,SAASC,UAAU,QAAQ,mBAAmB;;AAE9C;AACA;AACA;AACA,SAASC,sBAAsB,EAAEC,0BAA0B,QAAQ,SAAS;;AAE5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,sBAAsB,GAAGA,CAAEC,KAAK,EAAEC,aAAa,KAAM;EACjE;EACA,MAAMC,uBAAuB,GAAGJ,0BAA0B,CACzDG,aAAa,CAACE,IAAI,EAClBF,aAAa,CAACG,UACf,CAAC;EACDJ,KAAK,CAACI,UAAU,GAAG;IAClB,GAAGJ,KAAK,CAACI,UAAU;IACnB,GAAGF;EACJ,CAAC;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMG,2BAA2B,GAAGA,CAC1CC,cAAc,EACdC,aAAa,KACT;EACJ;EACA,MAAMC,cAAc,GAAGD,aAAa,CAACE,GAAG,CAAIC,KAAK,IAChDd,UAAU,CAAEc,KAAM,CACnB,CAAC;EACD;AACD;AACA;AACA;AACA;AACA;EACC,MAAMC,cAAc,GAAG,IAAIC,GAAG,CAAC,CAAC;EAChC,KAAM,MAAMX,aAAa,IAAIK,cAAc,EAAG;IAC7C,IAAIO,OAAO,GAAG,KAAK;IACnB,KAAM,MAAMC,YAAY,IAAIN,cAAc,EAAG;MAC5C,MAAMR,KAAK,GAAGH,sBAAsB,CACnCiB,YAAY,EACZb,aAAa,CAACE,IAAI,EAClBQ,cACD,CAAC;MACD,IAAK,CAAEX,KAAK,EAAG;QACd;MACD;MACAa,OAAO,GAAG,IAAI;MACdF,cAAc,CAACI,GAAG,CAAEf,KAAK,CAACgB,QAAS,CAAC;MACpC;MACAjB,sBAAsB,CAAEC,KAAK,EAAEC,aAAc,CAAC;MAC9C;MACA;IACD;IACA;IACA,IAAK,CAAEY,OAAO,EAAG;MAChB;IACD;EACD;EACA,OAAOL,cAAc;AACtB,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMS,sBAAsB,GAAGA,CAAEC,QAAQ,EAAEZ,cAAc,KAAM;EAC9D,OAAOX,OAAO,CACb,MACCuB,QAAQ,CAACC,MAAM,CAAE,CAAEC,WAAW,EAAEC,QAAQ,KAAM;IAC7C,MAAMC,iBAAiB,GAAGjB,2BAA2B,CACpDC,cAAc,EACde,QAAQ,CAACE,MACV,CAAC;IACD,IAAKD,iBAAiB,EAAG;MACxBF,WAAW,CAACI,IAAI,CAAE;QACjB,GAAGH,QAAQ;QACXC;MACD,CAAE,CAAC;IACJ;IACA,OAAOF,WAAW;EACnB,CAAC,EAAE,EAAG,CAAC,EACR,CAAEF,QAAQ,EAAEZ,cAAc,CAC3B,CAAC;AACF,CAAC;AAED,eAAeW,sBAAsB","ignoreList":[]}