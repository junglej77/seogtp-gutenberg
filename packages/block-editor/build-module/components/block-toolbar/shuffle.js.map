{"version":3,"names":["shuffle","ToolbarButton","ToolbarGroup","__","useMemo","useSelect","useDispatch","store","blockEditorStore","jsx","_jsx","EMPTY_ARRAY","Container","props","children","Shuffle","clientId","as","categories","patterns","patternName","select","getBlockAttributes","getBlockRootClientId","__experimentalGetAllowedPatterns","attributes","_categories","metadata","_patternName","rootBlock","_patterns","length","replaceBlocks","sameCategoryPatternsWithSingleWrapper","filter","pattern","isCorePattern","source","startsWith","blocks","some","category","includes","syncStatus","id","getNextPattern","numberOfPatterns","patternIndex","findIndex","name","nextPatternIndex","ComponentToUse","label","icon","className","onClick","nextPattern"],"sources":["@wordpress/block-editor/src/components/block-toolbar/shuffle.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { shuffle } from '@wordpress/icons';\r\nimport { ToolbarButton, ToolbarGroup } from '@wordpress/components';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useMemo } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\nconst EMPTY_ARRAY = [];\r\n\r\nfunction Container( props ) {\r\n\treturn (\r\n\t\t<ToolbarGroup>\r\n\t\t\t<ToolbarButton { ...props } />\r\n\t\t</ToolbarGroup>\r\n\t);\r\n}\r\n\r\nexport default function Shuffle( { clientId, as = Container } ) {\r\n\tconst { categories, patterns, patternName } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst {\r\n\t\t\t\tgetBlockAttributes,\r\n\t\t\t\tgetBlockRootClientId,\r\n\t\t\t\t__experimentalGetAllowedPatterns,\r\n\t\t\t} = select( blockEditorStore );\r\n\t\t\tconst attributes = getBlockAttributes( clientId );\r\n\t\t\tconst _categories = attributes?.metadata?.categories || EMPTY_ARRAY;\r\n\t\t\tconst _patternName = attributes?.metadata?.patternName;\r\n\t\t\tconst rootBlock = getBlockRootClientId( clientId );\r\n\r\n\t\t\t// Calling `__experimentalGetAllowedPatterns` is expensive.\r\n\t\t\t// Checking if the block can be shuffled prevents unnecessary selector calls.\r\n\t\t\t// See: https://github.com/WordPress/gutenberg/pull/64736.\r\n\t\t\tconst _patterns =\r\n\t\t\t\t_categories.length > 0\r\n\t\t\t\t\t? __experimentalGetAllowedPatterns( rootBlock )\r\n\t\t\t\t\t: EMPTY_ARRAY;\r\n\t\t\treturn {\r\n\t\t\t\tcategories: _categories,\r\n\t\t\t\tpatterns: _patterns,\r\n\t\t\t\tpatternName: _patternName,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ clientId ]\r\n\t);\r\n\tconst { replaceBlocks } = useDispatch( blockEditorStore );\r\n\tconst sameCategoryPatternsWithSingleWrapper = useMemo( () => {\r\n\t\tif ( categories.length === 0 || ! patterns || patterns.length === 0 ) {\r\n\t\t\treturn EMPTY_ARRAY;\r\n\t\t}\r\n\t\treturn patterns.filter( ( pattern ) => {\r\n\t\t\tconst isCorePattern =\r\n\t\t\t\tpattern.source === 'core' ||\r\n\t\t\t\t( pattern.source?.startsWith( 'pattern-directory' ) &&\r\n\t\t\t\t\tpattern.source !== 'pattern-directory/theme' );\r\n\t\t\treturn (\r\n\t\t\t\t// Check if the pattern has only one top level block,\r\n\t\t\t\t// otherwise we may shuffle to pattern that will not allow to continue shuffling.\r\n\t\t\t\tpattern.blocks.length === 1 &&\r\n\t\t\t\t// We exclude the core patterns and pattern directory patterns that are not theme patterns.\r\n\t\t\t\t! isCorePattern &&\r\n\t\t\t\tpattern.categories?.some( ( category ) => {\r\n\t\t\t\t\treturn categories.includes( category );\r\n\t\t\t\t} ) &&\r\n\t\t\t\t// Check if the pattern is not a synced pattern.\r\n\t\t\t\t( pattern.syncStatus === 'unsynced' || ! pattern.id )\r\n\t\t\t);\r\n\t\t} );\r\n\t}, [ categories, patterns ] );\r\n\r\n\tif ( sameCategoryPatternsWithSingleWrapper.length < 2 ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction getNextPattern() {\r\n\t\tconst numberOfPatterns = sameCategoryPatternsWithSingleWrapper.length;\r\n\t\tconst patternIndex = sameCategoryPatternsWithSingleWrapper.findIndex(\r\n\t\t\t( { name } ) => name === patternName\r\n\t\t);\r\n\t\tconst nextPatternIndex =\r\n\t\t\tpatternIndex + 1 < numberOfPatterns ? patternIndex + 1 : 0;\r\n\t\treturn sameCategoryPatternsWithSingleWrapper[ nextPatternIndex ];\r\n\t}\r\n\r\n\tconst ComponentToUse = as;\r\n\treturn (\r\n\t\t<ComponentToUse\r\n\t\t\tlabel={ __( 'Shuffle' ) }\r\n\t\t\ticon={ shuffle }\r\n\t\t\tclassName=\"block-editor-block-toolbar-shuffle\"\r\n\t\t\tonClick={ () => {\r\n\t\t\t\tconst nextPattern = getNextPattern();\r\n\t\t\t\tnextPattern.blocks[ 0 ].attributes = {\r\n\t\t\t\t\t...nextPattern.blocks[ 0 ].attributes,\r\n\t\t\t\t\tmetadata: {\r\n\t\t\t\t\t\t...nextPattern.blocks[ 0 ].attributes.metadata,\r\n\t\t\t\t\t\tcategories,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t\treplaceBlocks( clientId, nextPattern.blocks );\r\n\t\t\t} }\r\n\t\t/>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}