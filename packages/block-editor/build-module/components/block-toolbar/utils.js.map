{"version":3,"names":["useSelect","useDispatch","useState","useRef","useEffect","store","blockEditorStore","clearTimeout","setTimeout","window","DEBOUNCE_TIMEOUT","useDebouncedShowGestures","ref","isFocused","highlightParent","debounceTimeout","getSelectedBlockClientId","getBlockRootClientId","toggleBlockHighlight","timeoutRef","isDistractionFree","select","getSettings","handleOnChange","nextIsFocused","selectedBlockClientId","clientId","getIsHovered","current","matches","shouldHideGestures","isHovered","clearTimeoutRef","timeout","debouncedShowGestures","event","stopPropagation","debouncedHideGestures","useShowHoveredOrFocusedGestures","setIsFocused","registerRef","isFocusedWithin","contains","ownerDocument","activeElement","node","handleOnFocus","handleOnBlur","addEventListener","removeEventListener","onMouseMove","onMouseLeave"],"sources":["@wordpress/block-editor/src/components/block-toolbar/utils.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useState, useRef, useEffect } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\nconst { clearTimeout, setTimeout } = window;\r\nconst DEBOUNCE_TIMEOUT = 200;\r\n\r\n/**\r\n * Hook that creates debounced callbacks when the node is hovered or focused.\r\n *\r\n * @param {Object}  props                       Component props.\r\n * @param {Object}  props.ref                   Element reference.\r\n * @param {boolean} props.isFocused             Whether the component has current focus.\r\n * @param {number}  props.highlightParent       Whether to highlight the parent block. It defaults in highlighting the selected block.\r\n * @param {number}  [props.debounceTimeout=250] Debounce timeout in milliseconds.\r\n */\r\nfunction useDebouncedShowGestures( {\r\n\tref,\r\n\tisFocused,\r\n\thighlightParent,\r\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\r\n} ) {\r\n\tconst { getSelectedBlockClientId, getBlockRootClientId } =\r\n\t\tuseSelect( blockEditorStore );\r\n\tconst { toggleBlockHighlight } = useDispatch( blockEditorStore );\r\n\tconst timeoutRef = useRef();\r\n\tconst isDistractionFree = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( blockEditorStore ).getSettings().isDistractionFree,\r\n\t\t[]\r\n\t);\r\n\tconst handleOnChange = ( nextIsFocused ) => {\r\n\t\tif ( nextIsFocused && isDistractionFree ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst selectedBlockClientId = getSelectedBlockClientId();\r\n\t\tconst clientId = highlightParent\r\n\t\t\t? getBlockRootClientId( selectedBlockClientId )\r\n\t\t\t: selectedBlockClientId;\r\n\t\ttoggleBlockHighlight( clientId, nextIsFocused );\r\n\t};\r\n\r\n\tconst getIsHovered = () => {\r\n\t\treturn ref?.current && ref.current.matches( ':hover' );\r\n\t};\r\n\r\n\tconst shouldHideGestures = () => {\r\n\t\tconst isHovered = getIsHovered();\r\n\t\treturn ! isFocused && ! isHovered;\r\n\t};\r\n\r\n\tconst clearTimeoutRef = () => {\r\n\t\tconst timeout = timeoutRef.current;\r\n\r\n\t\tif ( timeout && clearTimeout ) {\r\n\t\t\tclearTimeout( timeout );\r\n\t\t}\r\n\t};\r\n\r\n\tconst debouncedShowGestures = ( event ) => {\r\n\t\tif ( event ) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t}\r\n\r\n\t\tclearTimeoutRef();\r\n\t\thandleOnChange( true );\r\n\t};\r\n\r\n\tconst debouncedHideGestures = ( event ) => {\r\n\t\tif ( event ) {\r\n\t\t\tevent.stopPropagation();\r\n\t\t}\r\n\r\n\t\tclearTimeoutRef();\r\n\r\n\t\ttimeoutRef.current = setTimeout( () => {\r\n\t\t\tif ( shouldHideGestures() ) {\r\n\t\t\t\thandleOnChange( false );\r\n\t\t\t}\r\n\t\t}, debounceTimeout );\r\n\t};\r\n\r\n\tuseEffect(\r\n\t\t() => () => {\r\n\t\t\t/**\r\n\t\t\t * We need to call the change handler with `isFocused`\r\n\t\t\t * set to false on unmount because we also clear the\r\n\t\t\t * timeout that would handle that.\r\n\t\t\t */\r\n\t\t\thandleOnChange( false );\r\n\t\t\tclearTimeoutRef();\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\treturn {\r\n\t\tdebouncedShowGestures,\r\n\t\tdebouncedHideGestures,\r\n\t};\r\n}\r\n\r\n/**\r\n * Hook that provides gesture events for DOM elements\r\n * that interact with the isFocused state.\r\n *\r\n * @param {Object} props                         Component props.\r\n * @param {Object} props.ref                     Element reference.\r\n * @param {number} [props.highlightParent=false] Whether to highlight the parent block. It defaults to highlighting the selected block.\r\n * @param {number} [props.debounceTimeout=250]   Debounce timeout in milliseconds.\r\n */\r\nexport function useShowHoveredOrFocusedGestures( {\r\n\tref,\r\n\thighlightParent = false,\r\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\r\n} ) {\r\n\tconst [ isFocused, setIsFocused ] = useState( false );\r\n\tconst { debouncedShowGestures, debouncedHideGestures } =\r\n\t\tuseDebouncedShowGestures( {\r\n\t\t\tref,\r\n\t\t\tdebounceTimeout,\r\n\t\t\tisFocused,\r\n\t\t\thighlightParent,\r\n\t\t} );\r\n\r\n\tconst registerRef = useRef( false );\r\n\r\n\tconst isFocusedWithin = () => {\r\n\t\treturn (\r\n\t\t\tref?.current &&\r\n\t\t\tref.current.contains( ref.current.ownerDocument.activeElement )\r\n\t\t);\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tconst node = ref.current;\r\n\r\n\t\tconst handleOnFocus = () => {\r\n\t\t\tif ( isFocusedWithin() ) {\r\n\t\t\t\tsetIsFocused( true );\r\n\t\t\t\tdebouncedShowGestures();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst handleOnBlur = () => {\r\n\t\t\tif ( ! isFocusedWithin() ) {\r\n\t\t\t\tsetIsFocused( false );\r\n\t\t\t\tdebouncedHideGestures();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Events are added via DOM events (vs. React synthetic events),\r\n\t\t * as the child React components swallow mouse events.\r\n\t\t */\r\n\t\tif ( node && ! registerRef.current ) {\r\n\t\t\tnode.addEventListener( 'focus', handleOnFocus, true );\r\n\t\t\tnode.addEventListener( 'blur', handleOnBlur, true );\r\n\t\t\tregisterRef.current = true;\r\n\t\t}\r\n\r\n\t\treturn () => {\r\n\t\t\tif ( node ) {\r\n\t\t\t\tnode.removeEventListener( 'focus', handleOnFocus );\r\n\t\t\t\tnode.removeEventListener( 'blur', handleOnBlur );\r\n\t\t\t}\r\n\t\t};\r\n\t}, [\r\n\t\tref,\r\n\t\tregisterRef,\r\n\t\tsetIsFocused,\r\n\t\tdebouncedShowGestures,\r\n\t\tdebouncedHideGestures,\r\n\t] );\r\n\r\n\treturn {\r\n\t\tonMouseMove: debouncedShowGestures,\r\n\t\tonMouseLeave: debouncedHideGestures,\r\n\t};\r\n}\r\n"],"mappings":"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","ignoreList":[]}