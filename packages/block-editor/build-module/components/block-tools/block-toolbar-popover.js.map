{"version":3,"names":["clsx","useDispatch","useEffect","useRef","useShortcut","BlockPopover","useBlockToolbarPopoverProps","useSelectedBlockToolProps","store","blockEditorStore","PrivateBlockToolbar","jsx","_jsx","BlockToolbarPopover","clientId","isTyping","__unstableContentRef","capturingClientId","isInsertionPointVisible","lastClientId","initialToolbarItemIndexRef","current","undefined","stopTyping","isToolbarForcedRef","clientIdToPositionOver","popoverProps","contentElement","bottomClientId","className","resize","children","focusOnMount","__experimentalInitialIndex","__experimentalOnIndexChange","index","variant"],"sources":["@wordpress/block-editor/src/components/block-tools/block-toolbar-popover.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { useEffect, useRef } from '@wordpress/element';\r\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\r\n/**\r\n * Internal dependencies\r\n */\r\nimport BlockPopover from '../block-popover';\r\nimport useBlockToolbarPopoverProps from './use-block-toolbar-popover-props';\r\nimport useSelectedBlockToolProps from './use-selected-block-tool-props';\r\nimport { store as blockEditorStore } from '../../store';\r\nimport { PrivateBlockToolbar } from '../block-toolbar';\r\n\r\nexport default function BlockToolbarPopover( {\r\n\tclientId,\r\n\tisTyping,\r\n\t__unstableContentRef,\r\n} ) {\r\n\tconst { capturingClientId, isInsertionPointVisible, lastClientId } =\r\n\t\tuseSelectedBlockToolProps( clientId );\r\n\r\n\t// Stores the active toolbar item index so the block toolbar can return focus\r\n\t// to it when re-mounting.\r\n\tconst initialToolbarItemIndexRef = useRef();\r\n\r\n\tuseEffect( () => {\r\n\t\t// Resets the index whenever the active block changes so this is not\r\n\t\t// persisted. See https://github.com/WordPress/gutenberg/pull/25760#issuecomment-717906169\r\n\t\tinitialToolbarItemIndexRef.current = undefined;\r\n\t}, [ clientId ] );\r\n\r\n\tconst { stopTyping } = useDispatch( blockEditorStore );\r\n\tconst isToolbarForcedRef = useRef( false );\r\n\r\n\tuseShortcut( 'core/block-editor/focus-toolbar', () => {\r\n\t\tisToolbarForcedRef.current = true;\r\n\t\tstopTyping( true );\r\n\t} );\r\n\r\n\tuseEffect( () => {\r\n\t\tisToolbarForcedRef.current = false;\r\n\t} );\r\n\r\n\t// If the block has a parent with __experimentalCaptureToolbars enabled,\r\n\t// the toolbar should be positioned over the topmost capturing parent.\r\n\tconst clientIdToPositionOver = capturingClientId || clientId;\r\n\r\n\tconst popoverProps = useBlockToolbarPopoverProps( {\r\n\t\tcontentElement: __unstableContentRef?.current,\r\n\t\tclientId: clientIdToPositionOver,\r\n\t} );\r\n\r\n\treturn (\r\n\t\t! isTyping && (\r\n\t\t\t<BlockPopover\r\n\t\t\t\tclientId={ clientIdToPositionOver }\r\n\t\t\t\tbottomClientId={ lastClientId }\r\n\t\t\t\tclassName={ clsx( 'block-editor-block-list__block-popover', {\r\n\t\t\t\t\t'is-insertion-point-visible': isInsertionPointVisible,\r\n\t\t\t\t} ) }\r\n\t\t\t\tresize={ false }\r\n\t\t\t\t{ ...popoverProps }\r\n\t\t\t>\r\n\t\t\t\t<PrivateBlockToolbar\r\n\t\t\t\t\t// If the toolbar is being shown because of being forced\r\n\t\t\t\t\t// it should focus the toolbar right after the mount.\r\n\t\t\t\t\tfocusOnMount={ isToolbarForcedRef.current }\r\n\t\t\t\t\t__experimentalInitialIndex={\r\n\t\t\t\t\t\tinitialToolbarItemIndexRef.current\r\n\t\t\t\t\t}\r\n\t\t\t\t\t__experimentalOnIndexChange={ ( index ) => {\r\n\t\t\t\t\t\tinitialToolbarItemIndexRef.current = index;\r\n\t\t\t\t\t} }\r\n\t\t\t\t\tvariant=\"toolbar\"\r\n\t\t\t\t/>\r\n\t\t\t</BlockPopover>\r\n\t\t)\r\n\t);\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,IAAI,MAAM,MAAM;AACvB;AACA;AACA;AACA,SAASC,WAAW,QAAQ,iBAAiB;AAC7C,SAASC,SAAS,EAAEC,MAAM,QAAQ,oBAAoB;AACtD,SAASC,WAAW,QAAQ,+BAA+B;AAC3D;AACA;AACA;AACA,OAAOC,YAAY,MAAM,kBAAkB;AAC3C,OAAOC,2BAA2B,MAAM,mCAAmC;AAC3E,OAAOC,yBAAyB,MAAM,iCAAiC;AACvE,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,aAAa;AACvD,SAASC,mBAAmB,QAAQ,kBAAkB;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAEvD,eAAe,SAASC,mBAAmBA,CAAE;EAC5CC,QAAQ;EACRC,QAAQ;EACRC;AACD,CAAC,EAAG;EACH,MAAM;IAAEC,iBAAiB;IAAEC,uBAAuB;IAAEC;EAAa,CAAC,GACjEZ,yBAAyB,CAAEO,QAAS,CAAC;;EAEtC;EACA;EACA,MAAMM,0BAA0B,GAAGjB,MAAM,CAAC,CAAC;EAE3CD,SAAS,CAAE,MAAM;IAChB;IACA;IACAkB,0BAA0B,CAACC,OAAO,GAAGC,SAAS;EAC/C,CAAC,EAAE,CAAER,QAAQ,CAAG,CAAC;EAEjB,MAAM;IAAES;EAAW,CAAC,GAAGtB,WAAW,CAAEQ,gBAAiB,CAAC;EACtD,MAAMe,kBAAkB,GAAGrB,MAAM,CAAE,KAAM,CAAC;EAE1CC,WAAW,CAAE,iCAAiC,EAAE,MAAM;IACrDoB,kBAAkB,CAACH,OAAO,GAAG,IAAI;IACjCE,UAAU,CAAE,IAAK,CAAC;EACnB,CAAE,CAAC;EAEHrB,SAAS,CAAE,MAAM;IAChBsB,kBAAkB,CAACH,OAAO,GAAG,KAAK;EACnC,CAAE,CAAC;;EAEH;EACA;EACA,MAAMI,sBAAsB,GAAGR,iBAAiB,IAAIH,QAAQ;EAE5D,MAAMY,YAAY,GAAGpB,2BAA2B,CAAE;IACjDqB,cAAc,EAAEX,oBAAoB,EAAEK,OAAO;IAC7CP,QAAQ,EAAEW;EACX,CAAE,CAAC;EAEH,OACC,CAAEV,QAAQ,iBACTH,IAAA,CAACP,YAAY;IACZS,QAAQ,EAAGW,sBAAwB;IACnCG,cAAc,EAAGT,YAAc;IAC/BU,SAAS,EAAG7B,IAAI,CAAE,wCAAwC,EAAE;MAC3D,4BAA4B,EAAEkB;IAC/B,CAAE,CAAG;IACLY,MAAM,EAAG,KAAO;IAAA,GACXJ,YAAY;IAAAK,QAAA,eAEjBnB,IAAA,CAACF;IACA;IACA;IAAA;MACAsB,YAAY,EAAGR,kBAAkB,CAACH,OAAS;MAC3CY,0BAA0B,EACzBb,0BAA0B,CAACC,OAC3B;MACDa,2BAA2B,EAAKC,KAAK,IAAM;QAC1Cf,0BAA0B,CAACC,OAAO,GAAGc,KAAK;MAC3C,CAAG;MACHC,OAAO,EAAC;IAAS,CACjB;EAAC,CACW,CACd;AAEH","ignoreList":[]}