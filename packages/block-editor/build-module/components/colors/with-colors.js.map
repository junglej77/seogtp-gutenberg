{"version":3,"names":["useMemo","Component","compose","createHigherOrderComponent","privateApis","componentsPrivateApis","getColorClassName","getColorObjectByColorValue","getColorObjectByAttributeValues","getMostReadableColor","useSettings","unlock","jsx","_jsx","kebabCase","upperFirst","firstLetter","rest","toUpperCase","join","withCustomColorPalette","colorsArray","WrappedComponent","props","colors","withEditorColorPalette","userPalette","themePalette","defaultPalette","allColors","createColorHOC","colorTypes","withColorPalette","colorMap","reduce","colorObject","colorType","constructor","setters","createSetters","colorUtils","bind","state","colorValue","Object","keys","settersAccumulator","colorAttributeName","upperFirstColorAttributeName","customColorAttributeName","createSetColor","setAttributes","slug","undefined","getDerivedStateFromProps","attributes","previousState","entries","newState","colorContext","previousColorObject","previousColor","color","class","render","createCustomColorsHOC","withColors"],"sources":["@wordpress/block-editor/src/components/colors/with-colors.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useMemo, Component } from '@wordpress/element';\r\nimport { compose, createHigherOrderComponent } from '@wordpress/compose';\r\nimport { privateApis as componentsPrivateApis } from '@wordpress/components';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport {\r\n\tgetColorClassName,\r\n\tgetColorObjectByColorValue,\r\n\tgetColorObjectByAttributeValues,\r\n\tgetMostReadableColor,\r\n} from './utils';\r\nimport { useSettings } from '../use-settings';\r\nimport { unlock } from '../../lock-unlock';\r\n\r\nconst { kebabCase } = unlock( componentsPrivateApis );\r\n\r\n/**\r\n * Capitalizes the first letter in a string.\r\n *\r\n * @param {string} str The string whose first letter the function will capitalize.\r\n *\r\n * @return {string} Capitalized string.\r\n */\r\nconst upperFirst = ( [ firstLetter, ...rest ] ) =>\r\n\tfirstLetter.toUpperCase() + rest.join( '' );\r\n\r\n/**\r\n * Higher order component factory for injecting the `colorsArray` argument as\r\n * the colors prop in the `withCustomColors` HOC.\r\n *\r\n * @param {Array} colorsArray An array of color objects.\r\n *\r\n * @return {Function} The higher order component.\r\n */\r\nconst withCustomColorPalette = ( colorsArray ) =>\r\n\tcreateHigherOrderComponent(\r\n\t\t( WrappedComponent ) => ( props ) => (\r\n\t\t\t<WrappedComponent { ...props } colors={ colorsArray } />\r\n\t\t),\r\n\t\t'withCustomColorPalette'\r\n\t);\r\n\r\n/**\r\n * Higher order component factory for injecting the editor colors as the\r\n * `colors` prop in the `withColors` HOC.\r\n *\r\n * @return {Function} The higher order component.\r\n */\r\nconst withEditorColorPalette = () =>\r\n\tcreateHigherOrderComponent(\r\n\t\t( WrappedComponent ) => ( props ) => {\r\n\t\t\tconst [ userPalette, themePalette, defaultPalette ] = useSettings(\r\n\t\t\t\t'color.palette.custom',\r\n\t\t\t\t'color.palette.theme',\r\n\t\t\t\t'color.palette.default'\r\n\t\t\t);\r\n\t\t\tconst allColors = useMemo(\r\n\t\t\t\t() => [\r\n\t\t\t\t\t...( userPalette || [] ),\r\n\t\t\t\t\t...( themePalette || [] ),\r\n\t\t\t\t\t...( defaultPalette || [] ),\r\n\t\t\t\t],\r\n\t\t\t\t[ userPalette, themePalette, defaultPalette ]\r\n\t\t\t);\r\n\t\t\treturn <WrappedComponent { ...props } colors={ allColors } />;\r\n\t\t},\r\n\t\t'withEditorColorPalette'\r\n\t);\r\n\r\n/**\r\n * Helper function used with `createHigherOrderComponent` to create\r\n * higher order components for managing color logic.\r\n *\r\n * @param {Array}    colorTypes       An array of color types (e.g. 'backgroundColor, borderColor).\r\n * @param {Function} withColorPalette A HOC for injecting the 'colors' prop into the WrappedComponent.\r\n *\r\n * @return {Component} The component that can be used as a HOC.\r\n */\r\nfunction createColorHOC( colorTypes, withColorPalette ) {\r\n\tconst colorMap = colorTypes.reduce( ( colorObject, colorType ) => {\r\n\t\treturn {\r\n\t\t\t...colorObject,\r\n\t\t\t...( typeof colorType === 'string'\r\n\t\t\t\t? { [ colorType ]: kebabCase( colorType ) }\r\n\t\t\t\t: colorType ),\r\n\t\t};\r\n\t}, {} );\r\n\r\n\treturn compose( [\r\n\t\twithColorPalette,\r\n\t\t( WrappedComponent ) => {\r\n\t\t\treturn class extends Component {\r\n\t\t\t\tconstructor( props ) {\r\n\t\t\t\t\tsuper( props );\r\n\r\n\t\t\t\t\tthis.setters = this.createSetters();\r\n\t\t\t\t\tthis.colorUtils = {\r\n\t\t\t\t\t\tgetMostReadableColor:\r\n\t\t\t\t\t\t\tthis.getMostReadableColor.bind( this ),\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.state = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgetMostReadableColor( colorValue ) {\r\n\t\t\t\t\tconst { colors } = this.props;\r\n\t\t\t\t\treturn getMostReadableColor( colors, colorValue );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcreateSetters() {\r\n\t\t\t\t\treturn Object.keys( colorMap ).reduce(\r\n\t\t\t\t\t\t( settersAccumulator, colorAttributeName ) => {\r\n\t\t\t\t\t\t\tconst upperFirstColorAttributeName =\r\n\t\t\t\t\t\t\t\tupperFirst( colorAttributeName );\r\n\t\t\t\t\t\t\tconst customColorAttributeName = `custom${ upperFirstColorAttributeName }`;\r\n\t\t\t\t\t\t\tsettersAccumulator[\r\n\t\t\t\t\t\t\t\t`set${ upperFirstColorAttributeName }`\r\n\t\t\t\t\t\t\t] = this.createSetColor(\r\n\t\t\t\t\t\t\t\tcolorAttributeName,\r\n\t\t\t\t\t\t\t\tcustomColorAttributeName\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\treturn settersAccumulator;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcreateSetColor( colorAttributeName, customColorAttributeName ) {\r\n\t\t\t\t\treturn ( colorValue ) => {\r\n\t\t\t\t\t\tconst colorObject = getColorObjectByColorValue(\r\n\t\t\t\t\t\t\tthis.props.colors,\r\n\t\t\t\t\t\t\tcolorValue\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tthis.props.setAttributes( {\r\n\t\t\t\t\t\t\t[ colorAttributeName ]:\r\n\t\t\t\t\t\t\t\tcolorObject && colorObject.slug\r\n\t\t\t\t\t\t\t\t\t? colorObject.slug\r\n\t\t\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\t\t[ customColorAttributeName ]:\r\n\t\t\t\t\t\t\t\tcolorObject && colorObject.slug\r\n\t\t\t\t\t\t\t\t\t? undefined\r\n\t\t\t\t\t\t\t\t\t: colorValue,\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstatic getDerivedStateFromProps(\r\n\t\t\t\t\t{ attributes, colors },\r\n\t\t\t\t\tpreviousState\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn Object.entries( colorMap ).reduce(\r\n\t\t\t\t\t\t( newState, [ colorAttributeName, colorContext ] ) => {\r\n\t\t\t\t\t\t\tconst colorObject = getColorObjectByAttributeValues(\r\n\t\t\t\t\t\t\t\tcolors,\r\n\t\t\t\t\t\t\t\tattributes[ colorAttributeName ],\r\n\t\t\t\t\t\t\t\tattributes[\r\n\t\t\t\t\t\t\t\t\t`custom${ upperFirst(\r\n\t\t\t\t\t\t\t\t\t\tcolorAttributeName\r\n\t\t\t\t\t\t\t\t\t) }`\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tconst previousColorObject =\r\n\t\t\t\t\t\t\t\tpreviousState[ colorAttributeName ];\r\n\t\t\t\t\t\t\tconst previousColor = previousColorObject?.color;\r\n\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t * The \"and previousColorObject\" condition checks that a previous color object was already computed.\r\n\t\t\t\t\t\t\t * At the start previousColorObject and colorValue are both equal to undefined\r\n\t\t\t\t\t\t\t * bus as previousColorObject does not exist we should compute the object.\r\n\t\t\t\t\t\t\t */\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tpreviousColor === colorObject.color &&\r\n\t\t\t\t\t\t\t\tpreviousColorObject\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tnewState[ colorAttributeName ] =\r\n\t\t\t\t\t\t\t\t\tpreviousColorObject;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tnewState[ colorAttributeName ] = {\r\n\t\t\t\t\t\t\t\t\t...colorObject,\r\n\t\t\t\t\t\t\t\t\tclass: getColorClassName(\r\n\t\t\t\t\t\t\t\t\t\tcolorContext,\r\n\t\t\t\t\t\t\t\t\t\tcolorObject.slug\r\n\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn newState;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trender() {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<WrappedComponent\r\n\t\t\t\t\t\t\t{ ...{\r\n\t\t\t\t\t\t\t\t...this.props,\r\n\t\t\t\t\t\t\t\tcolors: undefined,\r\n\t\t\t\t\t\t\t\t...this.state,\r\n\t\t\t\t\t\t\t\t...this.setters,\r\n\t\t\t\t\t\t\t\tcolorUtils: this.colorUtils,\r\n\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t] );\r\n}\r\n\r\n/**\r\n * A higher-order component factory for creating a 'withCustomColors' HOC, which handles color logic\r\n * for class generation color value, retrieval and color attribute setting.\r\n *\r\n * Use this higher-order component to work with a custom set of colors.\r\n *\r\n * @example\r\n *\r\n * ```jsx\r\n * const CUSTOM_COLORS = [ { name: 'Red', slug: 'red', color: '#ff0000' }, { name: 'Blue', slug: 'blue', color: '#0000ff' } ];\r\n * const withCustomColors = createCustomColorsHOC( CUSTOM_COLORS );\r\n * // ...\r\n * export default compose(\r\n *     withCustomColors( 'backgroundColor', 'borderColor' ),\r\n *     MyColorfulComponent,\r\n * );\r\n * ```\r\n *\r\n * @param {Array} colorsArray The array of color objects (name, slug, color, etc... ).\r\n *\r\n * @return {Function} Higher-order component.\r\n */\r\nexport function createCustomColorsHOC( colorsArray ) {\r\n\treturn ( ...colorTypes ) => {\r\n\t\tconst withColorPalette = withCustomColorPalette( colorsArray );\r\n\t\treturn createHigherOrderComponent(\r\n\t\t\tcreateColorHOC( colorTypes, withColorPalette ),\r\n\t\t\t'withCustomColors'\r\n\t\t);\r\n\t};\r\n}\r\n\r\n/**\r\n * A higher-order component, which handles color logic for class generation color value, retrieval and color attribute setting.\r\n *\r\n * For use with the default editor/theme color palette.\r\n *\r\n * @example\r\n *\r\n * ```jsx\r\n * export default compose(\r\n *     withColors( 'backgroundColor', { textColor: 'color' } ),\r\n *     MyColorfulComponent,\r\n * );\r\n * ```\r\n *\r\n * @param {...(Object|string)} colorTypes The arguments can be strings or objects. If the argument is an object,\r\n *                                        it should contain the color attribute name as key and the color context as value.\r\n *                                        If the argument is a string the value should be the color attribute name,\r\n *                                        the color context is computed by applying a kebab case transform to the value.\r\n *                                        Color context represents the context/place where the color is going to be used.\r\n *                                        The class name of the color is generated using 'has' followed by the color name\r\n *                                        and ending with the color context all in kebab case e.g: has-green-background-color.\r\n *\r\n * @return {Function} Higher-order component.\r\n */\r\nexport default function withColors( ...colorTypes ) {\r\n\tconst withColorPalette = withEditorColorPalette();\r\n\treturn createHigherOrderComponent(\r\n\t\tcreateColorHOC( colorTypes, withColorPalette ),\r\n\t\t'withColors'\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}