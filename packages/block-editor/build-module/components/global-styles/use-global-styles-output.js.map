{"version":3,"names":["__EXPERIMENTAL_STYLE_PROPERTY","STYLE_PROPERTY","__EXPERIMENTAL_ELEMENTS","ELEMENTS","getBlockSupport","getBlockTypes","store","blocksStore","useSelect","useContext","useMemo","getCSSRules","getCSSValueFromRawStyle","privateApis","componentsPrivateApis","PRESET_METADATA","ROOT_BLOCK_SELECTOR","ROOT_CSS_PROPERTIES_SELECTOR","scopeSelector","scopeFeatureSelectors","appendToSelector","getBlockStyleVariationSelector","getResolvedValue","getBlockCSSSelector","getTypographyFontSizeValue","GlobalStylesContext","useGlobalSetting","getDuotoneFilter","getGapCSSValue","setBackgroundStyleDefaults","blockEditorStore","LAYOUT_DEFINITIONS","getValueFromObjectPath","setImmutably","unlock","ELEMENT_CLASS_NAMES","button","caption","BLOCK_SUPPORT_FEATURE_LEVEL_SELECTORS","__experimentalBorder","color","spacing","typography","kebabCase","getPresetsDeclarations","blockPresets","mergedSettings","reduce","declarations","path","valueKey","valueFunc","cssVarInfix","presetByOrigin","forEach","origin","value","push","slug","getPresetsClasses","blockSelector","classes","classSuffix","propertyName","classSelectorToUse","selectorToUse","split","map","selector","join","getPresetsSvgFilters","filter","metadata","at","flatMap","preset","colors","flattenTree","input","prefix","token","result","Object","keys","key","newKey","replace","newLeaf","newPrefix","concatFeatureVariationSelectorString","featureSelector","styleVariationSelector","featureSelectors","combinedSelectors","trim","getFeatureDeclarations","selectors","styles","entries","feature","isShorthand","subfeature","subfeatureSelector","subfeatureStyles","newDeclarations","getStylesDeclarations","root","featureStyles","blockStyles","useRootPaddingAlign","tree","disableRootPadding","isRoot","output","properties","useEngine","rootOnly","pathToValue","styleValue","entry","name","prop","cssProperty","startsWith","background","backgroundImage","id","extraRules","rule","ruleValue","size","settings","getLayoutStyles","layoutDefinitions","style","hasBlockGapSupport","hasFallbackGapSupport","fallbackGapValue","ruleset","gapValue","blockGap","values","className","spacingStyles","length","spacingStyle","rules","cssValue","combinedSelector","validDisplayModes","displayMode","baseStyles","includes","baseStyle","STYLE_KEYS","pickStyleKeys","treeToPickFrom","pickedEntries","clonedEntries","JSON","parse","stringify","fromEntries","getNodesWithStyles","blockSelectors","_tree$styles$blocks","nodes","skipSelectorWrapper","elements","blocks","blockName","node","_node$elements","variations","variationName","variation","_variation$elements","_variation$blocks","css","variationSelector","styleVariationSelectors","element","elementStyles","variationBlockName","variationBlockStyles","_variationBlockStyles","variationBlockSelector","variationDuotoneSelector","duotoneSelector","variationFeatureSelectors","variationBlockStyleNodes","hasLayoutSupport","variationBlockElement","variationBlockElementStyles","elementName","sel","elementSelectors","elementSelector","getNodesWithSettings","_tree$settings$blocks","pickPresets","presets","custom","blockCustom","toCustomProperties","customProps","toStyles","disableLayoutStyles","styleOptions","undefined","options","layoutStyles","marginReset","rootPadding","variationStyles","nodesWithStyles","nodesWithSettings","useRootPaddingAwareAlignments","contentSize","wideSize","layout","hasBodyStyles","featureDeclarations","cssSelector","duotoneStyles","duotoneDeclarations","styleDeclarations","generalSelector","processCSSNesting","styleVariationName","styleVariations","baseSelector","styleVariationDeclarations","pseudoSelectorStyles","pseudoKey","pseudoStyle","pseudoDeclarations","_selector","pseudoRule","toSvgFilters","getSelectorsConfig","blockType","rootSelector","config","featureKey","featureName","getBlockSelectors","blockTypes","getBlockStyles","variationInstanceId","duotoneSupport","supports","__experimentalLayout","__experimentalDefault","blockStyleVariations","variationSuffix","updateConfigWithSeparator","needsSeparatorStyleUpdate","text","border","processedCSS","parts","part","isRootCss","splittedPart","nestedSelector","matches","match","pseudoPart","withoutPseudoElement","useGlobalStylesOutputWithConfig","mergedConfig","select","getSettings","_updatedConfig$styles","updatedConfig","customProperties","globalStyles","svgs","isGlobalStyles","assets","__unstableType","useGlobalStylesOutput","merged"],"sources":["@wordpress/block-editor/src/components/global-styles/use-global-styles-output.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\t__EXPERIMENTAL_STYLE_PROPERTY as STYLE_PROPERTY,\r\n\t__EXPERIMENTAL_ELEMENTS as ELEMENTS,\r\n\tgetBlockSupport,\r\n\tgetBlockTypes,\r\n\tstore as blocksStore,\r\n} from '@wordpress/blocks';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useContext, useMemo } from '@wordpress/element';\r\nimport { getCSSRules, getCSSValueFromRawStyle } from '@wordpress/style-engine';\r\nimport { privateApis as componentsPrivateApis } from '@wordpress/components';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport {\r\n\tPRESET_METADATA,\r\n\tROOT_BLOCK_SELECTOR,\r\n\tROOT_CSS_PROPERTIES_SELECTOR,\r\n\tscopeSelector,\r\n\tscopeFeatureSelectors,\r\n\tappendToSelector,\r\n\tgetBlockStyleVariationSelector,\r\n\tgetResolvedValue,\r\n} from './utils';\r\nimport { getBlockCSSSelector } from './get-block-css-selector';\r\nimport { getTypographyFontSizeValue } from './typography-utils';\r\nimport { GlobalStylesContext } from './context';\r\nimport { useGlobalSetting } from './hooks';\r\nimport { getDuotoneFilter } from '../duotone/utils';\r\nimport { getGapCSSValue } from '../../hooks/gap';\r\nimport { setBackgroundStyleDefaults } from '../../hooks/background';\r\nimport { store as blockEditorStore } from '../../store';\r\nimport { LAYOUT_DEFINITIONS } from '../../layouts/definitions';\r\nimport { getValueFromObjectPath, setImmutably } from '../../utils/object';\r\nimport { unlock } from '../../lock-unlock';\r\n\r\n// Elements that rely on class names in their selectors.\r\nconst ELEMENT_CLASS_NAMES = {\r\n\tbutton: 'wp-element-button',\r\n\tcaption: 'wp-element-caption',\r\n};\r\n\r\n// List of block support features that can have their related styles\r\n// generated under their own feature level selector rather than the block's.\r\nconst BLOCK_SUPPORT_FEATURE_LEVEL_SELECTORS = {\r\n\t__experimentalBorder: 'border',\r\n\tcolor: 'color',\r\n\tspacing: 'spacing',\r\n\ttypography: 'typography',\r\n};\r\nconst { kebabCase } = unlock( componentsPrivateApis );\r\n\r\n/**\r\n * Transform given preset tree into a set of style declarations.\r\n *\r\n * @param {Object} blockPresets\r\n * @param {Object} mergedSettings Merged theme.json settings.\r\n *\r\n * @return {Array<Object>} An array of style declarations.\r\n */\r\nfunction getPresetsDeclarations( blockPresets = {}, mergedSettings ) {\r\n\treturn PRESET_METADATA.reduce(\r\n\t\t( declarations, { path, valueKey, valueFunc, cssVarInfix } ) => {\r\n\t\t\tconst presetByOrigin = getValueFromObjectPath(\r\n\t\t\t\tblockPresets,\r\n\t\t\t\tpath,\r\n\t\t\t\t[]\r\n\t\t\t);\r\n\t\t\t[ 'default', 'theme', 'custom' ].forEach( ( origin ) => {\r\n\t\t\t\tif ( presetByOrigin[ origin ] ) {\r\n\t\t\t\t\tpresetByOrigin[ origin ].forEach( ( value ) => {\r\n\t\t\t\t\t\tif ( valueKey && ! valueFunc ) {\r\n\t\t\t\t\t\t\tdeclarations.push(\r\n\t\t\t\t\t\t\t\t`--wp--preset--${ cssVarInfix }--${ kebabCase(\r\n\t\t\t\t\t\t\t\t\tvalue.slug\r\n\t\t\t\t\t\t\t\t) }: ${ value[ valueKey ] }`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\tvalueFunc &&\r\n\t\t\t\t\t\t\ttypeof valueFunc === 'function'\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tdeclarations.push(\r\n\t\t\t\t\t\t\t\t`--wp--preset--${ cssVarInfix }--${ kebabCase(\r\n\t\t\t\t\t\t\t\t\tvalue.slug\r\n\t\t\t\t\t\t\t\t) }: ${ valueFunc( value, mergedSettings ) }`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\r\n\t\t\treturn declarations;\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n}\r\n\r\n/**\r\n * Transform given preset tree into a set of preset class declarations.\r\n *\r\n * @param {?string} blockSelector\r\n * @param {Object}  blockPresets\r\n * @return {string} CSS declarations for the preset classes.\r\n */\r\nfunction getPresetsClasses( blockSelector = '*', blockPresets = {} ) {\r\n\treturn PRESET_METADATA.reduce(\r\n\t\t( declarations, { path, cssVarInfix, classes } ) => {\r\n\t\t\tif ( ! classes ) {\r\n\t\t\t\treturn declarations;\r\n\t\t\t}\r\n\r\n\t\t\tconst presetByOrigin = getValueFromObjectPath(\r\n\t\t\t\tblockPresets,\r\n\t\t\t\tpath,\r\n\t\t\t\t[]\r\n\t\t\t);\r\n\t\t\t[ 'default', 'theme', 'custom' ].forEach( ( origin ) => {\r\n\t\t\t\tif ( presetByOrigin[ origin ] ) {\r\n\t\t\t\t\tpresetByOrigin[ origin ].forEach( ( { slug } ) => {\r\n\t\t\t\t\t\tclasses.forEach( ( { classSuffix, propertyName } ) => {\r\n\t\t\t\t\t\t\tconst classSelectorToUse = `.has-${ kebabCase(\r\n\t\t\t\t\t\t\t\tslug\r\n\t\t\t\t\t\t\t) }-${ classSuffix }`;\r\n\t\t\t\t\t\t\tconst selectorToUse = blockSelector\r\n\t\t\t\t\t\t\t\t.split( ',' ) // Selector can be \"h1, h2, h3\"\r\n\t\t\t\t\t\t\t\t.map(\r\n\t\t\t\t\t\t\t\t\t( selector ) =>\r\n\t\t\t\t\t\t\t\t\t\t`${ selector }${ classSelectorToUse }`\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t.join( ',' );\r\n\t\t\t\t\t\t\tconst value = `var(--wp--preset--${ cssVarInfix }--${ kebabCase(\r\n\t\t\t\t\t\t\t\tslug\r\n\t\t\t\t\t\t\t) })`;\r\n\t\t\t\t\t\t\tdeclarations += `${ selectorToUse }{${ propertyName }: ${ value } !important;}`;\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t\treturn declarations;\r\n\t\t},\r\n\t\t''\r\n\t);\r\n}\r\n\r\nfunction getPresetsSvgFilters( blockPresets = {} ) {\r\n\treturn PRESET_METADATA.filter(\r\n\t\t// Duotone are the only type of filters for now.\r\n\t\t( metadata ) => metadata.path.at( -1 ) === 'duotone'\r\n\t).flatMap( ( metadata ) => {\r\n\t\tconst presetByOrigin = getValueFromObjectPath(\r\n\t\t\tblockPresets,\r\n\t\t\tmetadata.path,\r\n\t\t\t{}\r\n\t\t);\r\n\t\treturn [ 'default', 'theme' ]\r\n\t\t\t.filter( ( origin ) => presetByOrigin[ origin ] )\r\n\t\t\t.flatMap( ( origin ) =>\r\n\t\t\t\tpresetByOrigin[ origin ].map( ( preset ) =>\r\n\t\t\t\t\tgetDuotoneFilter(\r\n\t\t\t\t\t\t`wp-duotone-${ preset.slug }`,\r\n\t\t\t\t\t\tpreset.colors\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t.join( '' );\r\n\t} );\r\n}\r\n\r\nfunction flattenTree( input = {}, prefix, token ) {\r\n\tlet result = [];\r\n\tObject.keys( input ).forEach( ( key ) => {\r\n\t\tconst newKey = prefix + kebabCase( key.replace( '/', '-' ) );\r\n\t\tconst newLeaf = input[ key ];\r\n\r\n\t\tif ( newLeaf instanceof Object ) {\r\n\t\t\tconst newPrefix = newKey + token;\r\n\t\t\tresult = [ ...result, ...flattenTree( newLeaf, newPrefix, token ) ];\r\n\t\t} else {\r\n\t\t\tresult.push( `${ newKey }: ${ newLeaf }` );\r\n\t\t}\r\n\t} );\r\n\treturn result;\r\n}\r\n\r\n/**\r\n * Gets variation selector string from feature selector.\r\n *\r\n * @param {string} featureSelector        The feature selector.\r\n *\r\n * @param {string} styleVariationSelector The style variation selector.\r\n * @return {string} Combined selector string.\r\n */\r\nfunction concatFeatureVariationSelectorString(\r\n\tfeatureSelector,\r\n\tstyleVariationSelector\r\n) {\r\n\tconst featureSelectors = featureSelector.split( ',' );\r\n\tconst combinedSelectors = [];\r\n\tfeatureSelectors.forEach( ( selector ) => {\r\n\t\tcombinedSelectors.push(\r\n\t\t\t`${ styleVariationSelector.trim() }${ selector.trim() }`\r\n\t\t);\r\n\t} );\r\n\treturn combinedSelectors.join( ', ' );\r\n}\r\n\r\n/**\r\n * Generate style declarations for a block's custom feature and subfeature\r\n * selectors.\r\n *\r\n * NOTE: The passed `styles` object will be mutated by this function.\r\n *\r\n * @param {Object} selectors Custom selectors object for a block.\r\n * @param {Object} styles    A block's styles object.\r\n *\r\n * @return {Object} Style declarations.\r\n */\r\nconst getFeatureDeclarations = ( selectors, styles ) => {\r\n\tconst declarations = {};\r\n\r\n\tObject.entries( selectors ).forEach( ( [ feature, selector ] ) => {\r\n\t\t// We're only processing features/subfeatures that have styles.\r\n\t\tif ( feature === 'root' || ! styles?.[ feature ] ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst isShorthand = typeof selector === 'string';\r\n\r\n\t\t// If we have a selector object instead of shorthand process it.\r\n\t\tif ( ! isShorthand ) {\r\n\t\t\tObject.entries( selector ).forEach(\r\n\t\t\t\t( [ subfeature, subfeatureSelector ] ) => {\r\n\t\t\t\t\t// Don't process root feature selector yet or any\r\n\t\t\t\t\t// subfeature that doesn't have a style.\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tsubfeature === 'root' ||\r\n\t\t\t\t\t\t! styles?.[ feature ][ subfeature ]\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create a temporary styles object and build\r\n\t\t\t\t\t// declarations for subfeature.\r\n\t\t\t\t\tconst subfeatureStyles = {\r\n\t\t\t\t\t\t[ feature ]: {\r\n\t\t\t\t\t\t\t[ subfeature ]: styles[ feature ][ subfeature ],\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst newDeclarations =\r\n\t\t\t\t\t\tgetStylesDeclarations( subfeatureStyles );\r\n\r\n\t\t\t\t\t// Merge new declarations in with any others that\r\n\t\t\t\t\t// share the same selector.\r\n\t\t\t\t\tdeclarations[ subfeatureSelector ] = [\r\n\t\t\t\t\t\t...( declarations[ subfeatureSelector ] || [] ),\r\n\t\t\t\t\t\t...newDeclarations,\r\n\t\t\t\t\t];\r\n\r\n\t\t\t\t\t// Remove the subfeature's style now it will be\r\n\t\t\t\t\t// included under its own selector not the block's.\r\n\t\t\t\t\tdelete styles[ feature ][ subfeature ];\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Now subfeatures have been processed and removed, we can\r\n\t\t// process root, or shorthand, feature selectors.\r\n\t\tif ( isShorthand || selector.root ) {\r\n\t\t\tconst featureSelector = isShorthand ? selector : selector.root;\r\n\r\n\t\t\t// Create temporary style object and build declarations for feature.\r\n\t\t\tconst featureStyles = { [ feature ]: styles[ feature ] };\r\n\t\t\tconst newDeclarations = getStylesDeclarations( featureStyles );\r\n\r\n\t\t\t// Merge new declarations with any others that share the selector.\r\n\t\t\tdeclarations[ featureSelector ] = [\r\n\t\t\t\t...( declarations[ featureSelector ] || [] ),\r\n\t\t\t\t...newDeclarations,\r\n\t\t\t];\r\n\r\n\t\t\t// Remove the feature from the block's styles now as it will be\r\n\t\t\t// included under its own selector not the block's.\r\n\t\t\tdelete styles[ feature ];\r\n\t\t}\r\n\t} );\r\n\r\n\treturn declarations;\r\n};\r\n\r\n/**\r\n * Transform given style tree into a set of style declarations.\r\n *\r\n * @param {Object}  blockStyles         Block styles.\r\n *\r\n * @param {string}  selector            The selector these declarations should attach to.\r\n *\r\n * @param {boolean} useRootPaddingAlign Whether to use CSS custom properties in root selector.\r\n *\r\n * @param {Object}  tree                A theme.json tree containing layout definitions.\r\n *\r\n * @param {boolean} disableRootPadding  Whether to force disable the root padding styles.\r\n * @return {Array} An array of style declarations.\r\n */\r\nexport function getStylesDeclarations(\r\n\tblockStyles = {},\r\n\tselector = '',\r\n\tuseRootPaddingAlign,\r\n\ttree = {},\r\n\tdisableRootPadding = false\r\n) {\r\n\tconst isRoot = ROOT_BLOCK_SELECTOR === selector;\r\n\tconst output = Object.entries( STYLE_PROPERTY ).reduce(\r\n\t\t(\r\n\t\t\tdeclarations,\r\n\t\t\t[ key, { value, properties, useEngine, rootOnly } ]\r\n\t\t) => {\r\n\t\t\tif ( rootOnly && ! isRoot ) {\r\n\t\t\t\treturn declarations;\r\n\t\t\t}\r\n\t\t\tconst pathToValue = value;\r\n\t\t\tif ( pathToValue[ 0 ] === 'elements' || useEngine ) {\r\n\t\t\t\treturn declarations;\r\n\t\t\t}\r\n\r\n\t\t\tconst styleValue = getValueFromObjectPath(\r\n\t\t\t\tblockStyles,\r\n\t\t\t\tpathToValue\r\n\t\t\t);\r\n\r\n\t\t\t// Root-level padding styles don't currently support strings with CSS shorthand values.\r\n\t\t\t// This may change: https://github.com/WordPress/gutenberg/issues/40132.\r\n\t\t\tif (\r\n\t\t\t\tkey === '--wp--style--root--padding' &&\r\n\t\t\t\t( typeof styleValue === 'string' || ! useRootPaddingAlign )\r\n\t\t\t) {\r\n\t\t\t\treturn declarations;\r\n\t\t\t}\r\n\r\n\t\t\tif ( properties && typeof styleValue !== 'string' ) {\r\n\t\t\t\tObject.entries( properties ).forEach( ( entry ) => {\r\n\t\t\t\t\tconst [ name, prop ] = entry;\r\n\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t! getValueFromObjectPath( styleValue, [ prop ], false )\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\t// Do not create a declaration\r\n\t\t\t\t\t\t// for sub-properties that don't have any value.\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst cssProperty = name.startsWith( '--' )\r\n\t\t\t\t\t\t? name\r\n\t\t\t\t\t\t: kebabCase( name );\r\n\t\t\t\t\tdeclarations.push(\r\n\t\t\t\t\t\t`${ cssProperty }: ${ getCSSValueFromRawStyle(\r\n\t\t\t\t\t\t\tgetValueFromObjectPath( styleValue, [ prop ] )\r\n\t\t\t\t\t\t) }`\r\n\t\t\t\t\t);\r\n\t\t\t\t} );\r\n\t\t\t} else if (\r\n\t\t\t\tgetValueFromObjectPath( blockStyles, pathToValue, false )\r\n\t\t\t) {\r\n\t\t\t\tconst cssProperty = key.startsWith( '--' )\r\n\t\t\t\t\t? key\r\n\t\t\t\t\t: kebabCase( key );\r\n\t\t\t\tdeclarations.push(\r\n\t\t\t\t\t`${ cssProperty }: ${ getCSSValueFromRawStyle(\r\n\t\t\t\t\t\tgetValueFromObjectPath( blockStyles, pathToValue )\r\n\t\t\t\t\t) }`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn declarations;\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\t/*\r\n\t * Preprocess background image values.\r\n\t *\r\n\t * Note: As we absorb more and more styles into the engine, we could simplify this function.\r\n\t * A refactor is for the style engine to handle ref resolution (and possibly defaults)\r\n\t * via a public util used internally and externally. Theme.json tree and defaults could be passed\r\n\t * as options.\r\n\t */\r\n\tif ( !! blockStyles.background ) {\r\n\t\t/*\r\n\t\t * Resolve dynamic values before they are compiled by the style engine,\r\n\t\t * which doesn't (yet) resolve dynamic values.\r\n\t\t */\r\n\t\tif ( blockStyles.background?.backgroundImage ) {\r\n\t\t\tblockStyles.background.backgroundImage = getResolvedValue(\r\n\t\t\t\tblockStyles.background.backgroundImage,\r\n\t\t\t\ttree\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t * Set default values for block background styles.\r\n\t\t * Top-level styles are an exception as they are applied to the body.\r\n\t\t */\r\n\t\tif ( ! isRoot && !! blockStyles.background?.backgroundImage?.id ) {\r\n\t\t\tblockStyles = {\r\n\t\t\t\t...blockStyles,\r\n\t\t\t\tbackground: {\r\n\t\t\t\t\t...blockStyles.background,\r\n\t\t\t\t\t...setBackgroundStyleDefaults( blockStyles.background ),\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tconst extraRules = getCSSRules( blockStyles );\r\n\textraRules.forEach( ( rule ) => {\r\n\t\t// Don't output padding properties if padding variables are set or if we're not editing a full template.\r\n\t\tif (\r\n\t\t\tisRoot &&\r\n\t\t\t( useRootPaddingAlign || disableRootPadding ) &&\r\n\t\t\trule.key.startsWith( 'padding' )\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst cssProperty = rule.key.startsWith( '--' )\r\n\t\t\t? rule.key\r\n\t\t\t: kebabCase( rule.key );\r\n\r\n\t\tlet ruleValue = getResolvedValue( rule.value, tree, null );\r\n\r\n\t\t// Calculate fluid typography rules where available.\r\n\t\tif ( cssProperty === 'font-size' ) {\r\n\t\t\t/*\r\n\t\t\t * getTypographyFontSizeValue() will check\r\n\t\t\t * if fluid typography has been activated and also\r\n\t\t\t * whether the incoming value can be converted to a fluid value.\r\n\t\t\t * Values that already have a \"clamp()\" function will not pass the test,\r\n\t\t\t * and therefore the original $value will be returned.\r\n\t\t\t */\r\n\t\t\truleValue = getTypographyFontSizeValue(\r\n\t\t\t\t{ size: ruleValue },\r\n\t\t\t\ttree?.settings\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// For aspect ratio to work, other dimensions rules (and Cover block defaults) must be unset.\r\n\t\t// This ensures that a fixed height does not override the aspect ratio.\r\n\t\tif ( cssProperty === 'aspect-ratio' ) {\r\n\t\t\toutput.push( 'min-height: unset' );\r\n\t\t}\r\n\r\n\t\toutput.push( `${ cssProperty }: ${ ruleValue }` );\r\n\t} );\r\n\r\n\treturn output;\r\n}\r\n\r\n/**\r\n * Get generated CSS for layout styles by looking up layout definitions provided\r\n * in theme.json, and outputting common layout styles, and specific blockGap values.\r\n *\r\n * @param {Object}  props\r\n * @param {Object}  props.layoutDefinitions     Layout definitions, keyed by layout type.\r\n * @param {Object}  props.style                 A style object containing spacing values.\r\n * @param {string}  props.selector              Selector used to group together layout styling rules.\r\n * @param {boolean} props.hasBlockGapSupport    Whether or not the theme opts-in to blockGap support.\r\n * @param {boolean} props.hasFallbackGapSupport Whether or not the theme allows fallback gap styles.\r\n * @param {?string} props.fallbackGapValue      An optional fallback gap value if no real gap value is available.\r\n * @return {string} Generated CSS rules for the layout styles.\r\n */\r\nexport function getLayoutStyles( {\r\n\tlayoutDefinitions = LAYOUT_DEFINITIONS,\r\n\tstyle,\r\n\tselector,\r\n\thasBlockGapSupport,\r\n\thasFallbackGapSupport,\r\n\tfallbackGapValue,\r\n} ) {\r\n\tlet ruleset = '';\r\n\tlet gapValue = hasBlockGapSupport\r\n\t\t? getGapCSSValue( style?.spacing?.blockGap )\r\n\t\t: '';\r\n\r\n\t// Ensure a fallback gap value for the root layout definitions,\r\n\t// and use a fallback value if one is provided for the current block.\r\n\tif ( hasFallbackGapSupport ) {\r\n\t\tif ( selector === ROOT_BLOCK_SELECTOR ) {\r\n\t\t\tgapValue = ! gapValue ? '0.5em' : gapValue;\r\n\t\t} else if ( ! hasBlockGapSupport && fallbackGapValue ) {\r\n\t\t\tgapValue = fallbackGapValue;\r\n\t\t}\r\n\t}\r\n\r\n\tif ( gapValue && layoutDefinitions ) {\r\n\t\tObject.values( layoutDefinitions ).forEach(\r\n\t\t\t( { className, name, spacingStyles } ) => {\r\n\t\t\t\t// Allow outputting fallback gap styles for flex layout type when block gap support isn't available.\r\n\t\t\t\tif (\r\n\t\t\t\t\t! hasBlockGapSupport &&\r\n\t\t\t\t\t'flex' !== name &&\r\n\t\t\t\t\t'grid' !== name\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( spacingStyles?.length ) {\r\n\t\t\t\t\tspacingStyles.forEach( ( spacingStyle ) => {\r\n\t\t\t\t\t\tconst declarations = [];\r\n\r\n\t\t\t\t\t\tif ( spacingStyle.rules ) {\r\n\t\t\t\t\t\t\tObject.entries( spacingStyle.rules ).forEach(\r\n\t\t\t\t\t\t\t\t( [ cssProperty, cssValue ] ) => {\r\n\t\t\t\t\t\t\t\t\tdeclarations.push(\r\n\t\t\t\t\t\t\t\t\t\t`${ cssProperty }: ${\r\n\t\t\t\t\t\t\t\t\t\t\tcssValue ? cssValue : gapValue\r\n\t\t\t\t\t\t\t\t\t\t}`\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( declarations.length ) {\r\n\t\t\t\t\t\t\tlet combinedSelector = '';\r\n\r\n\t\t\t\t\t\t\tif ( ! hasBlockGapSupport ) {\r\n\t\t\t\t\t\t\t\t// For fallback gap styles, use lower specificity, to ensure styles do not unintentionally override theme styles.\r\n\t\t\t\t\t\t\t\tcombinedSelector =\r\n\t\t\t\t\t\t\t\t\tselector === ROOT_BLOCK_SELECTOR\r\n\t\t\t\t\t\t\t\t\t\t? `:where(.${ className }${\r\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\r\n\t\t\t\t\t\t\t\t\t\t  })`\r\n\t\t\t\t\t\t\t\t\t\t: `:where(${ selector }.${ className }${\r\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\r\n\t\t\t\t\t\t\t\t\t\t  })`;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcombinedSelector =\r\n\t\t\t\t\t\t\t\t\tselector === ROOT_BLOCK_SELECTOR\r\n\t\t\t\t\t\t\t\t\t\t? `:root :where(.${ className })${\r\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\r\n\t\t\t\t\t\t\t\t\t\t  }`\r\n\t\t\t\t\t\t\t\t\t\t: `:root :where(${ selector }-${ className })${\r\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\r\n\t\t\t\t\t\t\t\t\t\t  }`;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\truleset += `${ combinedSelector } { ${ declarations.join(\r\n\t\t\t\t\t\t\t\t'; '\r\n\t\t\t\t\t\t\t) }; }`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t\t// For backwards compatibility, ensure the legacy block gap CSS variable is still available.\r\n\t\tif ( selector === ROOT_BLOCK_SELECTOR && hasBlockGapSupport ) {\r\n\t\t\truleset += `${ ROOT_CSS_PROPERTIES_SELECTOR } { --wp--style--block-gap: ${ gapValue }; }`;\r\n\t\t}\r\n\t}\r\n\r\n\t// Output base styles\r\n\tif ( selector === ROOT_BLOCK_SELECTOR && layoutDefinitions ) {\r\n\t\tconst validDisplayModes = [ 'block', 'flex', 'grid' ];\r\n\t\tObject.values( layoutDefinitions ).forEach(\r\n\t\t\t( { className, displayMode, baseStyles } ) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tdisplayMode &&\r\n\t\t\t\t\tvalidDisplayModes.includes( displayMode )\r\n\t\t\t\t) {\r\n\t\t\t\t\truleset += `${ selector } .${ className } { display:${ displayMode }; }`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( baseStyles?.length ) {\r\n\t\t\t\t\tbaseStyles.forEach( ( baseStyle ) => {\r\n\t\t\t\t\t\tconst declarations = [];\r\n\r\n\t\t\t\t\t\tif ( baseStyle.rules ) {\r\n\t\t\t\t\t\t\tObject.entries( baseStyle.rules ).forEach(\r\n\t\t\t\t\t\t\t\t( [ cssProperty, cssValue ] ) => {\r\n\t\t\t\t\t\t\t\t\tdeclarations.push(\r\n\t\t\t\t\t\t\t\t\t\t`${ cssProperty }: ${ cssValue }`\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( declarations.length ) {\r\n\t\t\t\t\t\t\tconst combinedSelector = `.${ className }${\r\n\t\t\t\t\t\t\t\tbaseStyle?.selector || ''\r\n\t\t\t\t\t\t\t}`;\r\n\t\t\t\t\t\t\truleset += `${ combinedSelector } { ${ declarations.join(\r\n\t\t\t\t\t\t\t\t'; '\r\n\t\t\t\t\t\t\t) }; }`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\treturn ruleset;\r\n}\r\n\r\nconst STYLE_KEYS = [\r\n\t'border',\r\n\t'color',\r\n\t'dimensions',\r\n\t'spacing',\r\n\t'typography',\r\n\t'filter',\r\n\t'outline',\r\n\t'shadow',\r\n\t'background',\r\n];\r\n\r\nfunction pickStyleKeys( treeToPickFrom ) {\r\n\tif ( ! treeToPickFrom ) {\r\n\t\treturn {};\r\n\t}\r\n\tconst entries = Object.entries( treeToPickFrom );\r\n\tconst pickedEntries = entries.filter( ( [ key ] ) =>\r\n\t\tSTYLE_KEYS.includes( key )\r\n\t);\r\n\t// clone the style objects so that `getFeatureDeclarations` can remove consumed keys from it\r\n\tconst clonedEntries = pickedEntries.map( ( [ key, style ] ) => [\r\n\t\tkey,\r\n\t\tJSON.parse( JSON.stringify( style ) ),\r\n\t] );\r\n\treturn Object.fromEntries( clonedEntries );\r\n}\r\n\r\nexport const getNodesWithStyles = ( tree, blockSelectors ) => {\r\n\tconst nodes = [];\r\n\r\n\tif ( ! tree?.styles ) {\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\t// Top-level.\r\n\tconst styles = pickStyleKeys( tree.styles );\r\n\tif ( styles ) {\r\n\t\tnodes.push( {\r\n\t\t\tstyles,\r\n\t\t\tselector: ROOT_BLOCK_SELECTOR,\r\n\t\t\t// Root selector (body) styles should not be wrapped in `:root where()` to keep\r\n\t\t\t// specificity at (0,0,1) and maintain backwards compatibility.\r\n\t\t\tskipSelectorWrapper: true,\r\n\t\t} );\r\n\t}\r\n\r\n\tObject.entries( ELEMENTS ).forEach( ( [ name, selector ] ) => {\r\n\t\tif ( tree.styles?.elements?.[ name ] ) {\r\n\t\t\tnodes.push( {\r\n\t\t\t\tstyles: tree.styles?.elements?.[ name ],\r\n\t\t\t\tselector,\r\n\t\t\t\t// Top level elements that don't use a class name should not receive the\r\n\t\t\t\t// `:root :where()` wrapper to maintain backwards compatibility.\r\n\t\t\t\tskipSelectorWrapper: ! ELEMENT_CLASS_NAMES[ name ],\r\n\t\t\t} );\r\n\t\t}\r\n\t} );\r\n\r\n\t// Iterate over blocks: they can have styles & elements.\r\n\tObject.entries( tree.styles?.blocks ?? {} ).forEach(\r\n\t\t( [ blockName, node ] ) => {\r\n\t\t\tconst blockStyles = pickStyleKeys( node );\r\n\r\n\t\t\tif ( node?.variations ) {\r\n\t\t\t\tconst variations = {};\r\n\t\t\t\tObject.entries( node.variations ).forEach(\r\n\t\t\t\t\t( [ variationName, variation ] ) => {\r\n\t\t\t\t\t\tvariations[ variationName ] =\r\n\t\t\t\t\t\t\tpickStyleKeys( variation );\r\n\t\t\t\t\t\tif ( variation?.css ) {\r\n\t\t\t\t\t\t\tvariations[ variationName ].css = variation.css;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst variationSelector =\r\n\t\t\t\t\t\t\tblockSelectors[ blockName ]\r\n\t\t\t\t\t\t\t\t?.styleVariationSelectors?.[ variationName ];\r\n\r\n\t\t\t\t\t\t// Process the variation's inner element styles.\r\n\t\t\t\t\t\t// This comes before the inner block styles so the\r\n\t\t\t\t\t\t// element styles within the block type styles take\r\n\t\t\t\t\t\t// precedence over these.\r\n\t\t\t\t\t\tObject.entries( variation?.elements ?? {} ).forEach(\r\n\t\t\t\t\t\t\t( [ element, elementStyles ] ) => {\r\n\t\t\t\t\t\t\t\tif ( elementStyles && ELEMENTS[ element ] ) {\r\n\t\t\t\t\t\t\t\t\tnodes.push( {\r\n\t\t\t\t\t\t\t\t\t\tstyles: elementStyles,\r\n\t\t\t\t\t\t\t\t\t\tselector: scopeSelector(\r\n\t\t\t\t\t\t\t\t\t\t\tvariationSelector,\r\n\t\t\t\t\t\t\t\t\t\t\tELEMENTS[ element ]\r\n\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t// Process the variations inner block type styles.\r\n\t\t\t\t\t\tObject.entries( variation?.blocks ?? {} ).forEach(\r\n\t\t\t\t\t\t\t( [\r\n\t\t\t\t\t\t\t\tvariationBlockName,\r\n\t\t\t\t\t\t\t\tvariationBlockStyles,\r\n\t\t\t\t\t\t\t] ) => {\r\n\t\t\t\t\t\t\t\tconst variationBlockSelector = scopeSelector(\r\n\t\t\t\t\t\t\t\t\tvariationSelector,\r\n\t\t\t\t\t\t\t\t\tblockSelectors[ variationBlockName ]\r\n\t\t\t\t\t\t\t\t\t\t?.selector\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tconst variationDuotoneSelector = scopeSelector(\r\n\t\t\t\t\t\t\t\t\tvariationSelector,\r\n\t\t\t\t\t\t\t\t\tblockSelectors[ variationBlockName ]\r\n\t\t\t\t\t\t\t\t\t\t?.duotoneSelector\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tconst variationFeatureSelectors =\r\n\t\t\t\t\t\t\t\t\tscopeFeatureSelectors(\r\n\t\t\t\t\t\t\t\t\t\tvariationSelector,\r\n\t\t\t\t\t\t\t\t\t\tblockSelectors[ variationBlockName ]\r\n\t\t\t\t\t\t\t\t\t\t\t?.featureSelectors\r\n\t\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\tconst variationBlockStyleNodes =\r\n\t\t\t\t\t\t\t\t\tpickStyleKeys( variationBlockStyles );\r\n\r\n\t\t\t\t\t\t\t\tif ( variationBlockStyles?.css ) {\r\n\t\t\t\t\t\t\t\t\tvariationBlockStyleNodes.css =\r\n\t\t\t\t\t\t\t\t\t\tvariationBlockStyles.css;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tnodes.push( {\r\n\t\t\t\t\t\t\t\t\tselector: variationBlockSelector,\r\n\t\t\t\t\t\t\t\t\tduotoneSelector: variationDuotoneSelector,\r\n\t\t\t\t\t\t\t\t\tfeatureSelectors: variationFeatureSelectors,\r\n\t\t\t\t\t\t\t\t\tfallbackGapValue:\r\n\t\t\t\t\t\t\t\t\t\tblockSelectors[ variationBlockName ]\r\n\t\t\t\t\t\t\t\t\t\t\t?.fallbackGapValue,\r\n\t\t\t\t\t\t\t\t\thasLayoutSupport:\r\n\t\t\t\t\t\t\t\t\t\tblockSelectors[ variationBlockName ]\r\n\t\t\t\t\t\t\t\t\t\t\t?.hasLayoutSupport,\r\n\t\t\t\t\t\t\t\t\tstyles: variationBlockStyleNodes,\r\n\t\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t\t\t// Process element styles for the inner blocks\r\n\t\t\t\t\t\t\t\t// of the variation.\r\n\t\t\t\t\t\t\t\tObject.entries(\r\n\t\t\t\t\t\t\t\t\tvariationBlockStyles.elements ?? {}\r\n\t\t\t\t\t\t\t\t).forEach(\r\n\t\t\t\t\t\t\t\t\t( [\r\n\t\t\t\t\t\t\t\t\t\tvariationBlockElement,\r\n\t\t\t\t\t\t\t\t\t\tvariationBlockElementStyles,\r\n\t\t\t\t\t\t\t\t\t] ) => {\r\n\t\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\t\tvariationBlockElementStyles &&\r\n\t\t\t\t\t\t\t\t\t\t\tELEMENTS[ variationBlockElement ]\r\n\t\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\t\tnodes.push( {\r\n\t\t\t\t\t\t\t\t\t\t\t\tstyles: variationBlockElementStyles,\r\n\t\t\t\t\t\t\t\t\t\t\t\tselector: scopeSelector(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariationBlockSelector,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tELEMENTS[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariationBlockElement\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tblockStyles.variations = variations;\r\n\t\t\t}\r\n\r\n\t\t\tif ( blockSelectors?.[ blockName ]?.selector ) {\r\n\t\t\t\tnodes.push( {\r\n\t\t\t\t\tduotoneSelector:\r\n\t\t\t\t\t\tblockSelectors[ blockName ].duotoneSelector,\r\n\t\t\t\t\tfallbackGapValue:\r\n\t\t\t\t\t\tblockSelectors[ blockName ].fallbackGapValue,\r\n\t\t\t\t\thasLayoutSupport:\r\n\t\t\t\t\t\tblockSelectors[ blockName ].hasLayoutSupport,\r\n\t\t\t\t\tselector: blockSelectors[ blockName ].selector,\r\n\t\t\t\t\tstyles: blockStyles,\r\n\t\t\t\t\tfeatureSelectors:\r\n\t\t\t\t\t\tblockSelectors[ blockName ].featureSelectors,\r\n\t\t\t\t\tstyleVariationSelectors:\r\n\t\t\t\t\t\tblockSelectors[ blockName ].styleVariationSelectors,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\tObject.entries( node?.elements ?? {} ).forEach(\r\n\t\t\t\t( [ elementName, value ] ) => {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tvalue &&\r\n\t\t\t\t\t\tblockSelectors?.[ blockName ] &&\r\n\t\t\t\t\t\tELEMENTS[ elementName ]\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tnodes.push( {\r\n\t\t\t\t\t\t\tstyles: value,\r\n\t\t\t\t\t\t\tselector: blockSelectors[ blockName ]?.selector\r\n\t\t\t\t\t\t\t\t.split( ',' )\r\n\t\t\t\t\t\t\t\t.map( ( sel ) => {\r\n\t\t\t\t\t\t\t\t\tconst elementSelectors =\r\n\t\t\t\t\t\t\t\t\t\tELEMENTS[ elementName ].split( ',' );\r\n\t\t\t\t\t\t\t\t\treturn elementSelectors.map(\r\n\t\t\t\t\t\t\t\t\t\t( elementSelector ) =>\r\n\t\t\t\t\t\t\t\t\t\t\tsel + ' ' + elementSelector\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t} )\r\n\t\t\t\t\t\t\t\t.join( ',' ),\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t);\r\n\r\n\treturn nodes;\r\n};\r\n\r\nexport const getNodesWithSettings = ( tree, blockSelectors ) => {\r\n\tconst nodes = [];\r\n\r\n\tif ( ! tree?.settings ) {\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tconst pickPresets = ( treeToPickFrom ) => {\r\n\t\tlet presets = {};\r\n\t\tPRESET_METADATA.forEach( ( { path } ) => {\r\n\t\t\tconst value = getValueFromObjectPath( treeToPickFrom, path, false );\r\n\t\t\tif ( value !== false ) {\r\n\t\t\t\tpresets = setImmutably( presets, path, value );\r\n\t\t\t}\r\n\t\t} );\r\n\t\treturn presets;\r\n\t};\r\n\r\n\t// Top-level.\r\n\tconst presets = pickPresets( tree.settings );\r\n\tconst custom = tree.settings?.custom;\r\n\tif ( Object.keys( presets ).length > 0 || custom ) {\r\n\t\tnodes.push( {\r\n\t\t\tpresets,\r\n\t\t\tcustom,\r\n\t\t\tselector: ROOT_CSS_PROPERTIES_SELECTOR,\r\n\t\t} );\r\n\t}\r\n\r\n\t// Blocks.\r\n\tObject.entries( tree.settings?.blocks ?? {} ).forEach(\r\n\t\t( [ blockName, node ] ) => {\r\n\t\t\tconst blockPresets = pickPresets( node );\r\n\t\t\tconst blockCustom = node.custom;\r\n\t\t\tif ( Object.keys( blockPresets ).length > 0 || blockCustom ) {\r\n\t\t\t\tnodes.push( {\r\n\t\t\t\t\tpresets: blockPresets,\r\n\t\t\t\t\tcustom: blockCustom,\r\n\t\t\t\t\tselector: blockSelectors[ blockName ]?.selector,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\treturn nodes;\r\n};\r\n\r\nexport const toCustomProperties = ( tree, blockSelectors ) => {\r\n\tconst settings = getNodesWithSettings( tree, blockSelectors );\r\n\tlet ruleset = '';\r\n\tsettings.forEach( ( { presets, custom, selector } ) => {\r\n\t\tconst declarations = getPresetsDeclarations( presets, tree?.settings );\r\n\t\tconst customProps = flattenTree( custom, '--wp--custom--', '--' );\r\n\t\tif ( customProps.length > 0 ) {\r\n\t\t\tdeclarations.push( ...customProps );\r\n\t\t}\r\n\r\n\t\tif ( declarations.length > 0 ) {\r\n\t\t\truleset += `${ selector }{${ declarations.join( ';' ) };}`;\r\n\t\t}\r\n\t} );\r\n\r\n\treturn ruleset;\r\n};\r\n\r\nexport const toStyles = (\r\n\ttree,\r\n\tblockSelectors,\r\n\thasBlockGapSupport,\r\n\thasFallbackGapSupport,\r\n\tdisableLayoutStyles = false,\r\n\tdisableRootPadding = false,\r\n\tstyleOptions = undefined\r\n) => {\r\n\t// These allow opting out of certain sets of styles.\r\n\tconst options = {\r\n\t\tblockGap: true,\r\n\t\tblockStyles: true,\r\n\t\tlayoutStyles: true,\r\n\t\tmarginReset: true,\r\n\t\tpresets: true,\r\n\t\trootPadding: true,\r\n\t\tvariationStyles: false,\r\n\t\t...styleOptions,\r\n\t};\r\n\tconst nodesWithStyles = getNodesWithStyles( tree, blockSelectors );\r\n\tconst nodesWithSettings = getNodesWithSettings( tree, blockSelectors );\r\n\tconst useRootPaddingAlign = tree?.settings?.useRootPaddingAwareAlignments;\r\n\tconst { contentSize, wideSize } = tree?.settings?.layout || {};\r\n\tconst hasBodyStyles =\r\n\t\toptions.marginReset || options.rootPadding || options.layoutStyles;\r\n\r\n\tlet ruleset = '';\r\n\r\n\tif ( options.presets && ( contentSize || wideSize ) ) {\r\n\t\truleset += `${ ROOT_CSS_PROPERTIES_SELECTOR } {`;\r\n\t\truleset = contentSize\r\n\t\t\t? ruleset + ` --wp--style--global--content-size: ${ contentSize };`\r\n\t\t\t: ruleset;\r\n\t\truleset = wideSize\r\n\t\t\t? ruleset + ` --wp--style--global--wide-size: ${ wideSize };`\r\n\t\t\t: ruleset;\r\n\t\truleset += '}';\r\n\t}\r\n\r\n\tif ( hasBodyStyles ) {\r\n\t\t/*\r\n\t\t * Reset default browser margin on the body element.\r\n\t\t * This is set on the body selector **before** generating the ruleset\r\n\t\t * from the `theme.json`. This is to ensure that if the `theme.json` declares\r\n\t\t * `margin` in its `spacing` declaration for the `body` element then these\r\n\t\t * user-generated values take precedence in the CSS cascade.\r\n\t\t * @link https://github.com/WordPress/gutenberg/issues/36147.\r\n\t\t */\r\n\t\truleset += ':where(body) {margin: 0;';\r\n\r\n\t\t// Root padding styles should be output for full templates, patterns and template parts.\r\n\t\tif ( options.rootPadding && useRootPaddingAlign ) {\r\n\t\t\t/*\r\n\t\t\t * These rules reproduce the ones from https://github.com/WordPress/gutenberg/blob/79103f124925d1f457f627e154f52a56228ed5ad/lib/class-wp-theme-json-gutenberg.php#L2508\r\n\t\t\t * almost exactly, but for the selectors that target block wrappers in the front end. This code only runs in the editor, so it doesn't need those selectors.\r\n\t\t\t */\r\n\t\t\truleset += `padding-right: 0; padding-left: 0; padding-top: var(--wp--style--root--padding-top); padding-bottom: var(--wp--style--root--padding-bottom) }\r\n\t\t\t\t.has-global-padding { padding-right: var(--wp--style--root--padding-right); padding-left: var(--wp--style--root--padding-left); }\r\n\t\t\t\t.has-global-padding > .alignfull { margin-right: calc(var(--wp--style--root--padding-right) * -1); margin-left: calc(var(--wp--style--root--padding-left) * -1); }\r\n\t\t\t\t.has-global-padding :where(:not(.alignfull.is-layout-flow) > .has-global-padding:not(.wp-block-block, .alignfull)) { padding-right: 0; padding-left: 0; }\r\n\t\t\t\t.has-global-padding :where(:not(.alignfull.is-layout-flow) > .has-global-padding:not(.wp-block-block, .alignfull)) > .alignfull { margin-left: 0; margin-right: 0;\r\n\t\t\t\t`;\r\n\t\t}\r\n\r\n\t\truleset += '}';\r\n\t}\r\n\r\n\tif ( options.blockStyles ) {\r\n\t\tnodesWithStyles.forEach(\r\n\t\t\t( {\r\n\t\t\t\tselector,\r\n\t\t\t\tduotoneSelector,\r\n\t\t\t\tstyles,\r\n\t\t\t\tfallbackGapValue,\r\n\t\t\t\thasLayoutSupport,\r\n\t\t\t\tfeatureSelectors,\r\n\t\t\t\tstyleVariationSelectors,\r\n\t\t\t\tskipSelectorWrapper,\r\n\t\t\t} ) => {\r\n\t\t\t\t// Process styles for block support features with custom feature level\r\n\t\t\t\t// CSS selectors set.\r\n\t\t\t\tif ( featureSelectors ) {\r\n\t\t\t\t\tconst featureDeclarations = getFeatureDeclarations(\r\n\t\t\t\t\t\tfeatureSelectors,\r\n\t\t\t\t\t\tstyles\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tObject.entries( featureDeclarations ).forEach(\r\n\t\t\t\t\t\t( [ cssSelector, declarations ] ) => {\r\n\t\t\t\t\t\t\tif ( declarations.length ) {\r\n\t\t\t\t\t\t\t\tconst rules = declarations.join( ';' );\r\n\t\t\t\t\t\t\t\truleset += `:root :where(${ cssSelector }){${ rules };}`;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process duotone styles.\r\n\t\t\t\tif ( duotoneSelector ) {\r\n\t\t\t\t\tconst duotoneStyles = {};\r\n\t\t\t\t\tif ( styles?.filter ) {\r\n\t\t\t\t\t\tduotoneStyles.filter = styles.filter;\r\n\t\t\t\t\t\tdelete styles.filter;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst duotoneDeclarations =\r\n\t\t\t\t\t\tgetStylesDeclarations( duotoneStyles );\r\n\t\t\t\t\tif ( duotoneDeclarations.length ) {\r\n\t\t\t\t\t\truleset += `${ duotoneSelector }{${ duotoneDeclarations.join(\r\n\t\t\t\t\t\t\t';'\r\n\t\t\t\t\t\t) };}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process blockGap and layout styles.\r\n\t\t\t\tif (\r\n\t\t\t\t\t! disableLayoutStyles &&\r\n\t\t\t\t\t( ROOT_BLOCK_SELECTOR === selector || hasLayoutSupport )\r\n\t\t\t\t) {\r\n\t\t\t\t\truleset += getLayoutStyles( {\r\n\t\t\t\t\t\tstyle: styles,\r\n\t\t\t\t\t\tselector,\r\n\t\t\t\t\t\thasBlockGapSupport,\r\n\t\t\t\t\t\thasFallbackGapSupport,\r\n\t\t\t\t\t\tfallbackGapValue,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process the remaining block styles (they use either normal block class or __experimentalSelector).\r\n\t\t\t\tconst styleDeclarations = getStylesDeclarations(\r\n\t\t\t\t\tstyles,\r\n\t\t\t\t\tselector,\r\n\t\t\t\t\tuseRootPaddingAlign,\r\n\t\t\t\t\ttree,\r\n\t\t\t\t\tdisableRootPadding\r\n\t\t\t\t);\r\n\t\t\t\tif ( styleDeclarations?.length ) {\r\n\t\t\t\t\tconst generalSelector = skipSelectorWrapper\r\n\t\t\t\t\t\t? selector\r\n\t\t\t\t\t\t: `:root :where(${ selector })`;\r\n\t\t\t\t\truleset += `${ generalSelector }{${ styleDeclarations.join(\r\n\t\t\t\t\t\t';'\r\n\t\t\t\t\t) };}`;\r\n\t\t\t\t}\r\n\t\t\t\tif ( styles?.css ) {\r\n\t\t\t\t\truleset += processCSSNesting(\r\n\t\t\t\t\t\tstyles.css,\r\n\t\t\t\t\t\t`:root :where(${ selector })`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( options.variationStyles && styleVariationSelectors ) {\r\n\t\t\t\t\tObject.entries( styleVariationSelectors ).forEach(\r\n\t\t\t\t\t\t( [ styleVariationName, styleVariationSelector ] ) => {\r\n\t\t\t\t\t\t\tconst styleVariations =\r\n\t\t\t\t\t\t\t\tstyles?.variations?.[ styleVariationName ];\r\n\t\t\t\t\t\t\tif ( styleVariations ) {\r\n\t\t\t\t\t\t\t\t// If the block uses any custom selectors for block support, add those first.\r\n\t\t\t\t\t\t\t\tif ( featureSelectors ) {\r\n\t\t\t\t\t\t\t\t\tconst featureDeclarations =\r\n\t\t\t\t\t\t\t\t\t\tgetFeatureDeclarations(\r\n\t\t\t\t\t\t\t\t\t\t\tfeatureSelectors,\r\n\t\t\t\t\t\t\t\t\t\t\tstyleVariations\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\t\tObject.entries(\r\n\t\t\t\t\t\t\t\t\t\tfeatureDeclarations\r\n\t\t\t\t\t\t\t\t\t).forEach(\r\n\t\t\t\t\t\t\t\t\t\t( [ baseSelector, declarations ] ) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif ( declarations.length ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst cssSelector =\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconcatFeatureVariationSelectorString(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbaseSelector,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyleVariationSelector\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst rules =\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdeclarations.join( ';' );\r\n\t\t\t\t\t\t\t\t\t\t\t\truleset += `:root :where(${ cssSelector }){${ rules };}`;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Otherwise add regular selectors.\r\n\t\t\t\t\t\t\t\tconst styleVariationDeclarations =\r\n\t\t\t\t\t\t\t\t\tgetStylesDeclarations(\r\n\t\t\t\t\t\t\t\t\t\tstyleVariations,\r\n\t\t\t\t\t\t\t\t\t\tstyleVariationSelector,\r\n\t\t\t\t\t\t\t\t\t\tuseRootPaddingAlign,\r\n\t\t\t\t\t\t\t\t\t\ttree\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tif ( styleVariationDeclarations.length ) {\r\n\t\t\t\t\t\t\t\t\truleset += `:root :where(${ styleVariationSelector }){${ styleVariationDeclarations.join(\r\n\t\t\t\t\t\t\t\t\t\t';'\r\n\t\t\t\t\t\t\t\t\t) };}`;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif ( styleVariations?.css ) {\r\n\t\t\t\t\t\t\t\t\truleset += processCSSNesting(\r\n\t\t\t\t\t\t\t\t\t\tstyleVariations.css,\r\n\t\t\t\t\t\t\t\t\t\t`:root :where(${ styleVariationSelector })`\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check for pseudo selector in `styles` and handle separately.\r\n\t\t\t\tconst pseudoSelectorStyles = Object.entries( styles ).filter(\r\n\t\t\t\t\t( [ key ] ) => key.startsWith( ':' )\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif ( pseudoSelectorStyles?.length ) {\r\n\t\t\t\t\tpseudoSelectorStyles.forEach(\r\n\t\t\t\t\t\t( [ pseudoKey, pseudoStyle ] ) => {\r\n\t\t\t\t\t\t\tconst pseudoDeclarations =\r\n\t\t\t\t\t\t\t\tgetStylesDeclarations( pseudoStyle );\r\n\r\n\t\t\t\t\t\t\tif ( ! pseudoDeclarations?.length ) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// `selector` may be provided in a form\r\n\t\t\t\t\t\t\t// where block level selectors have sub element\r\n\t\t\t\t\t\t\t// selectors appended to them as a comma separated\r\n\t\t\t\t\t\t\t// string.\r\n\t\t\t\t\t\t\t// e.g. `h1 a,h2 a,h3 a,h4 a,h5 a,h6 a`;\r\n\t\t\t\t\t\t\t// Split and append pseudo selector to create\r\n\t\t\t\t\t\t\t// the proper rules to target the elements.\r\n\t\t\t\t\t\t\tconst _selector = selector\r\n\t\t\t\t\t\t\t\t.split( ',' )\r\n\t\t\t\t\t\t\t\t.map( ( sel ) => sel + pseudoKey )\r\n\t\t\t\t\t\t\t\t.join( ',' );\r\n\r\n\t\t\t\t\t\t\t// As pseudo classes such as :hover, :focus etc. have class-level\r\n\t\t\t\t\t\t\t// specificity, they must use the `:root :where()` wrapper. This.\r\n\t\t\t\t\t\t\t// caps the specificity at `0-1-0` to allow proper nesting of variations\r\n\t\t\t\t\t\t\t// and block type element styles.\r\n\t\t\t\t\t\t\tconst pseudoRule = `:root :where(${ _selector }){${ pseudoDeclarations.join(\r\n\t\t\t\t\t\t\t\t';'\r\n\t\t\t\t\t\t\t) };}`;\r\n\r\n\t\t\t\t\t\t\truleset += pseudoRule;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tif ( options.layoutStyles ) {\r\n\t\t/* Add alignment / layout styles */\r\n\t\truleset =\r\n\t\t\truleset +\r\n\t\t\t'.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }';\r\n\t\truleset =\r\n\t\t\truleset +\r\n\t\t\t'.wp-site-blocks > .alignright { float: right; margin-left: 2em; }';\r\n\t\truleset =\r\n\t\t\truleset +\r\n\t\t\t'.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }';\r\n\t}\r\n\r\n\tif ( options.blockGap && hasBlockGapSupport ) {\r\n\t\t// Use fallback of `0.5em` just in case, however if there is blockGap support, there should nearly always be a real value.\r\n\t\tconst gapValue =\r\n\t\t\tgetGapCSSValue( tree?.styles?.spacing?.blockGap ) || '0.5em';\r\n\t\truleset =\r\n\t\t\truleset +\r\n\t\t\t`:root :where(.wp-site-blocks) > * { margin-block-start: ${ gapValue }; margin-block-end: 0; }`;\r\n\t\truleset =\r\n\t\t\truleset +\r\n\t\t\t':root :where(.wp-site-blocks) > :first-child { margin-block-start: 0; }';\r\n\t\truleset =\r\n\t\t\truleset +\r\n\t\t\t':root :where(.wp-site-blocks) > :last-child { margin-block-end: 0; }';\r\n\t}\r\n\r\n\tif ( options.presets ) {\r\n\t\tnodesWithSettings.forEach( ( { selector, presets } ) => {\r\n\t\t\tif (\r\n\t\t\t\tROOT_BLOCK_SELECTOR === selector ||\r\n\t\t\t\tROOT_CSS_PROPERTIES_SELECTOR === selector\r\n\t\t\t) {\r\n\t\t\t\t// Do not add extra specificity for top-level classes.\r\n\t\t\t\tselector = '';\r\n\t\t\t}\r\n\r\n\t\t\tconst classes = getPresetsClasses( selector, presets );\r\n\t\t\tif ( classes.length > 0 ) {\r\n\t\t\t\truleset += classes;\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\treturn ruleset;\r\n};\r\n\r\nexport function toSvgFilters( tree, blockSelectors ) {\r\n\tconst nodesWithSettings = getNodesWithSettings( tree, blockSelectors );\r\n\treturn nodesWithSettings.flatMap( ( { presets } ) => {\r\n\t\treturn getPresetsSvgFilters( presets );\r\n\t} );\r\n}\r\n\r\nconst getSelectorsConfig = ( blockType, rootSelector ) => {\r\n\tif (\r\n\t\tblockType?.selectors &&\r\n\t\tObject.keys( blockType.selectors ).length > 0\r\n\t) {\r\n\t\treturn blockType.selectors;\r\n\t}\r\n\r\n\tconst config = { root: rootSelector };\r\n\tObject.entries( BLOCK_SUPPORT_FEATURE_LEVEL_SELECTORS ).forEach(\r\n\t\t( [ featureKey, featureName ] ) => {\r\n\t\t\tconst featureSelector = getBlockCSSSelector(\r\n\t\t\t\tblockType,\r\n\t\t\t\tfeatureKey\r\n\t\t\t);\r\n\r\n\t\t\tif ( featureSelector ) {\r\n\t\t\t\tconfig[ featureName ] = featureSelector;\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\treturn config;\r\n};\r\n\r\nexport const getBlockSelectors = (\r\n\tblockTypes,\r\n\tgetBlockStyles,\r\n\tvariationInstanceId\r\n) => {\r\n\tconst result = {};\r\n\tblockTypes.forEach( ( blockType ) => {\r\n\t\tconst name = blockType.name;\r\n\t\tconst selector = getBlockCSSSelector( blockType );\r\n\t\tlet duotoneSelector = getBlockCSSSelector(\r\n\t\t\tblockType,\r\n\t\t\t'filter.duotone'\r\n\t\t);\r\n\r\n\t\t// Keep backwards compatibility for support.color.__experimentalDuotone.\r\n\t\tif ( ! duotoneSelector ) {\r\n\t\t\tconst rootSelector = getBlockCSSSelector( blockType );\r\n\t\t\tconst duotoneSupport = getBlockSupport(\r\n\t\t\t\tblockType,\r\n\t\t\t\t'color.__experimentalDuotone',\r\n\t\t\t\tfalse\r\n\t\t\t);\r\n\t\t\tduotoneSelector =\r\n\t\t\t\tduotoneSupport && scopeSelector( rootSelector, duotoneSupport );\r\n\t\t}\r\n\r\n\t\tconst hasLayoutSupport =\r\n\t\t\t!! blockType?.supports?.layout ||\r\n\t\t\t!! blockType?.supports?.__experimentalLayout;\r\n\t\tconst fallbackGapValue =\r\n\t\t\tblockType?.supports?.spacing?.blockGap?.__experimentalDefault;\r\n\r\n\t\tconst blockStyleVariations = getBlockStyles( name );\r\n\t\tconst styleVariationSelectors = {};\r\n\t\tblockStyleVariations?.forEach( ( variation ) => {\r\n\t\t\tconst variationSuffix = variationInstanceId\r\n\t\t\t\t? `-${ variationInstanceId }`\r\n\t\t\t\t: '';\r\n\t\t\tconst variationName = `${ variation.name }${ variationSuffix }`;\r\n\t\t\tconst styleVariationSelector = getBlockStyleVariationSelector(\r\n\t\t\t\tvariationName,\r\n\t\t\t\tselector\r\n\t\t\t);\r\n\r\n\t\t\tstyleVariationSelectors[ variationName ] = styleVariationSelector;\r\n\t\t} );\r\n\r\n\t\t// For each block support feature add any custom selectors.\r\n\t\tconst featureSelectors = getSelectorsConfig( blockType, selector );\r\n\r\n\t\tresult[ name ] = {\r\n\t\t\tduotoneSelector,\r\n\t\t\tfallbackGapValue,\r\n\t\t\tfeatureSelectors: Object.keys( featureSelectors ).length\r\n\t\t\t\t? featureSelectors\r\n\t\t\t\t: undefined,\r\n\t\t\thasLayoutSupport,\r\n\t\t\tname,\r\n\t\t\tselector,\r\n\t\t\tstyleVariationSelectors: blockStyleVariations?.length\r\n\t\t\t\t? styleVariationSelectors\r\n\t\t\t\t: undefined,\r\n\t\t};\r\n\t} );\r\n\r\n\treturn result;\r\n};\r\n\r\n/**\r\n * If there is a separator block whose color is defined in theme.json via background,\r\n * update the separator color to the same value by using border color.\r\n *\r\n * @param {Object} config Theme.json configuration file object.\r\n * @return {Object} configTheme.json configuration file object updated.\r\n */\r\nfunction updateConfigWithSeparator( config ) {\r\n\tconst needsSeparatorStyleUpdate =\r\n\t\tconfig.styles?.blocks?.[ 'core/separator' ] &&\r\n\t\tconfig.styles?.blocks?.[ 'core/separator' ].color?.background &&\r\n\t\t! config.styles?.blocks?.[ 'core/separator' ].color?.text &&\r\n\t\t! config.styles?.blocks?.[ 'core/separator' ].border?.color;\r\n\tif ( needsSeparatorStyleUpdate ) {\r\n\t\treturn {\r\n\t\t\t...config,\r\n\t\t\tstyles: {\r\n\t\t\t\t...config.styles,\r\n\t\t\t\tblocks: {\r\n\t\t\t\t\t...config.styles.blocks,\r\n\t\t\t\t\t'core/separator': {\r\n\t\t\t\t\t\t...config.styles.blocks[ 'core/separator' ],\r\n\t\t\t\t\t\tcolor: {\r\n\t\t\t\t\t\t\t...config.styles.blocks[ 'core/separator' ].color,\r\n\t\t\t\t\t\t\ttext: config.styles?.blocks[ 'core/separator' ]\r\n\t\t\t\t\t\t\t\t.color.background,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\treturn config;\r\n}\r\n\r\nexport function processCSSNesting( css, blockSelector ) {\r\n\tlet processedCSS = '';\r\n\r\n\tif ( ! css || css.trim() === '' ) {\r\n\t\treturn processedCSS;\r\n\t}\r\n\r\n\t// Split CSS nested rules.\r\n\tconst parts = css.split( '&' );\r\n\tparts.forEach( ( part ) => {\r\n\t\tif ( ! part || part.trim() === '' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst isRootCss = ! part.includes( '{' );\r\n\t\tif ( isRootCss ) {\r\n\t\t\t// If the part doesn't contain braces, it applies to the root level.\r\n\t\t\tprocessedCSS += `:root :where(${ blockSelector }){${ part.trim() }}`;\r\n\t\t} else {\r\n\t\t\t// If the part contains braces, it's a nested CSS rule.\r\n\t\t\tconst splittedPart = part.replace( '}', '' ).split( '{' );\r\n\t\t\tif ( splittedPart.length !== 2 ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst [ nestedSelector, cssValue ] = splittedPart;\r\n\r\n\t\t\t// Handle pseudo elements such as ::before, ::after, etc. Regex will also\r\n\t\t\t// capture any leading combinator such as >, +, or ~, as well as spaces.\r\n\t\t\t// This allows pseudo elements as descendants e.g. `.parent ::before`.\r\n\t\t\tconst matches = nestedSelector.match( /([>+~\\s]*::[a-zA-Z-]+)/ );\r\n\t\t\tconst pseudoPart = matches ? matches[ 1 ] : '';\r\n\t\t\tconst withoutPseudoElement = matches\r\n\t\t\t\t? nestedSelector.replace( pseudoPart, '' ).trim()\r\n\t\t\t\t: nestedSelector.trim();\r\n\r\n\t\t\tlet combinedSelector;\r\n\t\t\tif ( withoutPseudoElement === '' ) {\r\n\t\t\t\t// Only contained a pseudo element to use the block selector to form\r\n\t\t\t\t// the final `:root :where()` selector.\r\n\t\t\t\tcombinedSelector = blockSelector;\r\n\t\t\t} else {\r\n\t\t\t\t// If the nested selector is a descendant of the block scope it with the\r\n\t\t\t\t// block selector. Otherwise append it to the block selector.\r\n\t\t\t\tcombinedSelector = nestedSelector.startsWith( ' ' )\r\n\t\t\t\t\t? scopeSelector( blockSelector, withoutPseudoElement )\r\n\t\t\t\t\t: appendToSelector( blockSelector, withoutPseudoElement );\r\n\t\t\t}\r\n\r\n\t\t\t// Build final rule, re-adding any pseudo element outside the `:where()`\r\n\t\t\t// to maintain valid CSS selector.\r\n\t\t\tprocessedCSS += `:root :where(${ combinedSelector })${ pseudoPart }{${ cssValue.trim() }}`;\r\n\t\t}\r\n\t} );\r\n\treturn processedCSS;\r\n}\r\n\r\n/**\r\n * Returns the global styles output using a global styles configuration.\r\n * If wishing to generate global styles and settings based on the\r\n * global styles config loaded in the editor context, use `useGlobalStylesOutput()`.\r\n * The use case for a custom config is to generate bespoke styles\r\n * and settings for previews, or other out-of-editor experiences.\r\n *\r\n * @param {Object}  mergedConfig       Global styles configuration.\r\n * @param {boolean} disableRootPadding Disable root padding styles.\r\n *\r\n * @return {Array} Array of stylesheets and settings.\r\n */\r\nexport function useGlobalStylesOutputWithConfig(\r\n\tmergedConfig = {},\r\n\tdisableRootPadding\r\n) {\r\n\tconst [ blockGap ] = useGlobalSetting( 'spacing.blockGap' );\r\n\tconst hasBlockGapSupport = blockGap !== null;\r\n\tconst hasFallbackGapSupport = ! hasBlockGapSupport; // This setting isn't useful yet: it exists as a placeholder for a future explicit fallback styles support.\r\n\tconst disableLayoutStyles = useSelect( ( select ) => {\r\n\t\tconst { getSettings } = select( blockEditorStore );\r\n\t\treturn !! getSettings().disableLayoutStyles;\r\n\t} );\r\n\r\n\tconst { getBlockStyles } = useSelect( blocksStore );\r\n\r\n\treturn useMemo( () => {\r\n\t\tif ( ! mergedConfig?.styles || ! mergedConfig?.settings ) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\tconst updatedConfig = updateConfigWithSeparator( mergedConfig );\r\n\r\n\t\tconst blockSelectors = getBlockSelectors(\r\n\t\t\tgetBlockTypes(),\r\n\t\t\tgetBlockStyles\r\n\t\t);\r\n\r\n\t\tconst customProperties = toCustomProperties(\r\n\t\t\tupdatedConfig,\r\n\t\t\tblockSelectors\r\n\t\t);\r\n\r\n\t\tconst globalStyles = toStyles(\r\n\t\t\tupdatedConfig,\r\n\t\t\tblockSelectors,\r\n\t\t\thasBlockGapSupport,\r\n\t\t\thasFallbackGapSupport,\r\n\t\t\tdisableLayoutStyles,\r\n\t\t\tdisableRootPadding\r\n\t\t);\r\n\t\tconst svgs = toSvgFilters( updatedConfig, blockSelectors );\r\n\r\n\t\tconst styles = [\r\n\t\t\t{\r\n\t\t\t\tcss: customProperties,\r\n\t\t\t\tisGlobalStyles: true,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcss: globalStyles,\r\n\t\t\t\tisGlobalStyles: true,\r\n\t\t\t},\r\n\t\t\t// Load custom CSS in own stylesheet so that any invalid CSS entered in the input won't break all the global styles in the editor.\r\n\t\t\t{\r\n\t\t\t\tcss: updatedConfig.styles.css ?? '',\r\n\t\t\t\tisGlobalStyles: true,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tassets: svgs,\r\n\t\t\t\t__unstableType: 'svg',\r\n\t\t\t\tisGlobalStyles: true,\r\n\t\t\t},\r\n\t\t];\r\n\r\n\t\t// Loop through the blocks to check if there are custom CSS values.\r\n\t\t// If there are, get the block selector and push the selector together with\r\n\t\t// the CSS value to the 'stylesheets' array.\r\n\t\tgetBlockTypes().forEach( ( blockType ) => {\r\n\t\t\tif ( updatedConfig.styles.blocks[ blockType.name ]?.css ) {\r\n\t\t\t\tconst selector = blockSelectors[ blockType.name ].selector;\r\n\t\t\t\tstyles.push( {\r\n\t\t\t\t\tcss: processCSSNesting(\r\n\t\t\t\t\t\tupdatedConfig.styles.blocks[ blockType.name ]?.css,\r\n\t\t\t\t\t\tselector\r\n\t\t\t\t\t),\r\n\t\t\t\t\tisGlobalStyles: true,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn [ styles, updatedConfig.settings ];\r\n\t}, [\r\n\t\thasBlockGapSupport,\r\n\t\thasFallbackGapSupport,\r\n\t\tmergedConfig,\r\n\t\tdisableLayoutStyles,\r\n\t\tdisableRootPadding,\r\n\t\tgetBlockStyles,\r\n\t] );\r\n}\r\n\r\n/**\r\n * Returns the global styles output based on the current state of global styles config loaded in the editor context.\r\n *\r\n * @param {boolean} disableRootPadding Disable root padding styles.\r\n *\r\n * @return {Array} Array of stylesheets and settings.\r\n */\r\nexport function useGlobalStylesOutput( disableRootPadding = false ) {\r\n\tconst { merged: mergedConfig } = useContext( GlobalStylesContext );\r\n\treturn useGlobalStylesOutputWithConfig( mergedConfig, disableRootPadding );\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SACCA,6BAA6B,IAAIC,cAAc,EAC/CC,uBAAuB,IAAIC,QAAQ,EACnCC,eAAe,EACfC,aAAa,EACbC,KAAK,IAAIC,WAAW,QACd,mBAAmB;AAC1B,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,UAAU,EAAEC,OAAO,QAAQ,oBAAoB;AACxD,SAASC,WAAW,EAAEC,uBAAuB,QAAQ,yBAAyB;AAC9E,SAASC,WAAW,IAAIC,qBAAqB,QAAQ,uBAAuB;;AAE5E;AACA;AACA;AACA,SACCC,eAAe,EACfC,mBAAmB,EACnBC,4BAA4B,EAC5BC,aAAa,EACbC,qBAAqB,EACrBC,gBAAgB,EAChBC,8BAA8B,EAC9BC,gBAAgB,QACV,SAAS;AAChB,SAASC,mBAAmB,QAAQ,0BAA0B;AAC9D,SAASC,0BAA0B,QAAQ,oBAAoB;AAC/D,SAASC,mBAAmB,QAAQ,WAAW;AAC/C,SAASC,gBAAgB,QAAQ,SAAS;AAC1C,SAASC,gBAAgB,QAAQ,kBAAkB;AACnD,SAASC,cAAc,QAAQ,iBAAiB;AAChD,SAASC,0BAA0B,QAAQ,wBAAwB;AACnE,SAASvB,KAAK,IAAIwB,gBAAgB,QAAQ,aAAa;AACvD,SAASC,kBAAkB,QAAQ,2BAA2B;AAC9D,SAASC,sBAAsB,EAAEC,YAAY,QAAQ,oBAAoB;AACzE,SAASC,MAAM,QAAQ,mBAAmB;;AAE1C;AACA,MAAMC,mBAAmB,GAAG;EAC3BC,MAAM,EAAE,mBAAmB;EAC3BC,OAAO,EAAE;AACV,CAAC;;AAED;AACA;AACA,MAAMC,qCAAqC,GAAG;EAC7CC,oBAAoB,EAAE,QAAQ;EAC9BC,KAAK,EAAE,OAAO;EACdC,OAAO,EAAE,SAAS;EAClBC,UAAU,EAAE;AACb,CAAC;AACD,MAAM;EAAEC;AAAU,CAAC,GAAGT,MAAM,CAAEpB,qBAAsB,CAAC;;AAErD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS8B,sBAAsBA,CAAEC,YAAY,GAAG,CAAC,CAAC,EAAEC,cAAc,EAAG;EACpE,OAAO/B,eAAe,CAACgC,MAAM,CAC5B,CAAEC,YAAY,EAAE;IAAEC,IAAI;IAAEC,QAAQ;IAAEC,SAAS;IAAEC;EAAY,CAAC,KAAM;IAC/D,MAAMC,cAAc,GAAGrB,sBAAsB,CAC5Ca,YAAY,EACZI,IAAI,EACJ,EACD,CAAC;IACD,CAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,CAAE,CAACK,OAAO,CAAIC,MAAM,IAAM;MACvD,IAAKF,cAAc,CAAEE,MAAM,CAAE,EAAG;QAC/BF,cAAc,CAAEE,MAAM,CAAE,CAACD,OAAO,CAAIE,KAAK,IAAM;UAC9C,IAAKN,QAAQ,IAAI,CAAEC,SAAS,EAAG;YAC9BH,YAAY,CAACS,IAAI,CACf,iBAAiBL,WAAa,KAAKT,SAAS,CAC5Ca,KAAK,CAACE,IACP,CAAG,KAAKF,KAAK,CAAEN,QAAQ,CAAI,EAC5B,CAAC;UACF,CAAC,MAAM,IACNC,SAAS,IACT,OAAOA,SAAS,KAAK,UAAU,EAC9B;YACDH,YAAY,CAACS,IAAI,CACf,iBAAiBL,WAAa,KAAKT,SAAS,CAC5Ca,KAAK,CAACE,IACP,CAAG,KAAKP,SAAS,CAAEK,KAAK,EAAEV,cAAe,CAAG,EAC7C,CAAC;UACF;QACD,CAAE,CAAC;MACJ;IACD,CAAE,CAAC;IAEH,OAAOE,YAAY;EACpB,CAAC,EACD,EACD,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASW,iBAAiBA,CAAEC,aAAa,GAAG,GAAG,EAAEf,YAAY,GAAG,CAAC,CAAC,EAAG;EACpE,OAAO9B,eAAe,CAACgC,MAAM,CAC5B,CAAEC,YAAY,EAAE;IAAEC,IAAI;IAAEG,WAAW;IAAES;EAAQ,CAAC,KAAM;IACnD,IAAK,CAAEA,OAAO,EAAG;MAChB,OAAOb,YAAY;IACpB;IAEA,MAAMK,cAAc,GAAGrB,sBAAsB,CAC5Ca,YAAY,EACZI,IAAI,EACJ,EACD,CAAC;IACD,CAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,CAAE,CAACK,OAAO,CAAIC,MAAM,IAAM;MACvD,IAAKF,cAAc,CAAEE,MAAM,CAAE,EAAG;QAC/BF,cAAc,CAAEE,MAAM,CAAE,CAACD,OAAO,CAAE,CAAE;UAAEI;QAAK,CAAC,KAAM;UACjDG,OAAO,CAACP,OAAO,CAAE,CAAE;YAAEQ,WAAW;YAAEC;UAAa,CAAC,KAAM;YACrD,MAAMC,kBAAkB,GAAI,QAAQrB,SAAS,CAC5Ce,IACD,CAAG,IAAII,WAAa,EAAC;YACrB,MAAMG,aAAa,GAAGL,aAAa,CACjCM,KAAK,CAAE,GAAI,CAAC,CAAC;YAAA,CACbC,GAAG,CACDC,QAAQ,IACR,GAAGA,QAAU,GAAGJ,kBAAoB,EACvC,CAAC,CACAK,IAAI,CAAE,GAAI,CAAC;YACb,MAAMb,KAAK,GAAI,qBAAqBJ,WAAa,KAAKT,SAAS,CAC9De,IACD,CAAG,GAAE;YACLV,YAAY,IAAK,GAAGiB,aAAe,IAAIF,YAAc,KAAKP,KAAO,eAAc;UAChF,CAAE,CAAC;QACJ,CAAE,CAAC;MACJ;IACD,CAAE,CAAC;IACH,OAAOR,YAAY;EACpB,CAAC,EACD,EACD,CAAC;AACF;AAEA,SAASsB,oBAAoBA,CAAEzB,YAAY,GAAG,CAAC,CAAC,EAAG;EAClD,OAAO9B,eAAe,CAACwD,MAAM;EAC5B;EACEC,QAAQ,IAAMA,QAAQ,CAACvB,IAAI,CAACwB,EAAE,CAAE,CAAC,CAAE,CAAC,KAAK,SAC5C,CAAC,CAACC,OAAO,CAAIF,QAAQ,IAAM;IAC1B,MAAMnB,cAAc,GAAGrB,sBAAsB,CAC5Ca,YAAY,EACZ2B,QAAQ,CAACvB,IAAI,EACb,CAAC,CACF,CAAC;IACD,OAAO,CAAE,SAAS,EAAE,OAAO,CAAE,CAC3BsB,MAAM,CAAIhB,MAAM,IAAMF,cAAc,CAAEE,MAAM,CAAG,CAAC,CAChDmB,OAAO,CAAInB,MAAM,IACjBF,cAAc,CAAEE,MAAM,CAAE,CAACY,GAAG,CAAIQ,MAAM,IACrChD,gBAAgB,CACd,cAAcgD,MAAM,CAACjB,IAAM,EAAC,EAC7BiB,MAAM,CAACC,MACR,CACD,CACD,CAAC,CACAP,IAAI,CAAE,EAAG,CAAC;EACb,CAAE,CAAC;AACJ;AAEA,SAASQ,WAAWA,CAAEC,KAAK,GAAG,CAAC,CAAC,EAAEC,MAAM,EAAEC,KAAK,EAAG;EACjD,IAAIC,MAAM,GAAG,EAAE;EACfC,MAAM,CAACC,IAAI,CAAEL,KAAM,CAAC,CAACxB,OAAO,CAAI8B,GAAG,IAAM;IACxC,MAAMC,MAAM,GAAGN,MAAM,GAAGpC,SAAS,CAAEyC,GAAG,CAACE,OAAO,CAAE,GAAG,EAAE,GAAI,CAAE,CAAC;IAC5D,MAAMC,OAAO,GAAGT,KAAK,CAAEM,GAAG,CAAE;IAE5B,IAAKG,OAAO,YAAYL,MAAM,EAAG;MAChC,MAAMM,SAAS,GAAGH,MAAM,GAAGL,KAAK;MAChCC,MAAM,GAAG,CAAE,GAAGA,MAAM,EAAE,GAAGJ,WAAW,CAAEU,OAAO,EAAEC,SAAS,EAAER,KAAM,CAAC,CAAE;IACpE,CAAC,MAAM;MACNC,MAAM,CAACxB,IAAI,CAAG,GAAG4B,MAAQ,KAAKE,OAAS,EAAE,CAAC;IAC3C;EACD,CAAE,CAAC;EACH,OAAON,MAAM;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASQ,oCAAoCA,CAC5CC,eAAe,EACfC,sBAAsB,EACrB;EACD,MAAMC,gBAAgB,GAAGF,eAAe,CAACxB,KAAK,CAAE,GAAI,CAAC;EACrD,MAAM2B,iBAAiB,GAAG,EAAE;EAC5BD,gBAAgB,CAACtC,OAAO,CAAIc,QAAQ,IAAM;IACzCyB,iBAAiB,CAACpC,IAAI,CACpB,GAAGkC,sBAAsB,CAACG,IAAI,CAAC,CAAG,GAAG1B,QAAQ,CAAC0B,IAAI,CAAC,CAAG,EACxD,CAAC;EACF,CAAE,CAAC;EACH,OAAOD,iBAAiB,CAACxB,IAAI,CAAE,IAAK,CAAC;AACtC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM0B,sBAAsB,GAAGA,CAAEC,SAAS,EAAEC,MAAM,KAAM;EACvD,MAAMjD,YAAY,GAAG,CAAC,CAAC;EAEvBkC,MAAM,CAACgB,OAAO,CAAEF,SAAU,CAAC,CAAC1C,OAAO,CAAE,CAAE,CAAE6C,OAAO,EAAE/B,QAAQ,CAAE,KAAM;IACjE;IACA,IAAK+B,OAAO,KAAK,MAAM,IAAI,CAAEF,MAAM,GAAIE,OAAO,CAAE,EAAG;MAClD;IACD;IAEA,MAAMC,WAAW,GAAG,OAAOhC,QAAQ,KAAK,QAAQ;;IAEhD;IACA,IAAK,CAAEgC,WAAW,EAAG;MACpBlB,MAAM,CAACgB,OAAO,CAAE9B,QAAS,CAAC,CAACd,OAAO,CACjC,CAAE,CAAE+C,UAAU,EAAEC,kBAAkB,CAAE,KAAM;QACzC;QACA;QACA,IACCD,UAAU,KAAK,MAAM,IACrB,CAAEJ,MAAM,GAAIE,OAAO,CAAE,CAAEE,UAAU,CAAE,EAClC;UACD;QACD;;QAEA;QACA;QACA,MAAME,gBAAgB,GAAG;UACxB,CAAEJ,OAAO,GAAI;YACZ,CAAEE,UAAU,GAAIJ,MAAM,CAAEE,OAAO,CAAE,CAAEE,UAAU;UAC9C;QACD,CAAC;QACD,MAAMG,eAAe,GACpBC,qBAAqB,CAAEF,gBAAiB,CAAC;;QAE1C;QACA;QACAvD,YAAY,CAAEsD,kBAAkB,CAAE,GAAG,CACpC,IAAKtD,YAAY,CAAEsD,kBAAkB,CAAE,IAAI,EAAE,CAAE,EAC/C,GAAGE,eAAe,CAClB;;QAED;QACA;QACA,OAAOP,MAAM,CAAEE,OAAO,CAAE,CAAEE,UAAU,CAAE;MACvC,CACD,CAAC;IACF;;IAEA;IACA;IACA,IAAKD,WAAW,IAAIhC,QAAQ,CAACsC,IAAI,EAAG;MACnC,MAAMhB,eAAe,GAAGU,WAAW,GAAGhC,QAAQ,GAAGA,QAAQ,CAACsC,IAAI;;MAE9D;MACA,MAAMC,aAAa,GAAG;QAAE,CAAER,OAAO,GAAIF,MAAM,CAAEE,OAAO;MAAG,CAAC;MACxD,MAAMK,eAAe,GAAGC,qBAAqB,CAAEE,aAAc,CAAC;;MAE9D;MACA3D,YAAY,CAAE0C,eAAe,CAAE,GAAG,CACjC,IAAK1C,YAAY,CAAE0C,eAAe,CAAE,IAAI,EAAE,CAAE,EAC5C,GAAGc,eAAe,CAClB;;MAED;MACA;MACA,OAAOP,MAAM,CAAEE,OAAO,CAAE;IACzB;EACD,CAAE,CAAC;EAEH,OAAOnD,YAAY;AACpB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASyD,qBAAqBA,CACpCG,WAAW,GAAG,CAAC,CAAC,EAChBxC,QAAQ,GAAG,EAAE,EACbyC,mBAAmB,EACnBC,IAAI,GAAG,CAAC,CAAC,EACTC,kBAAkB,GAAG,KAAK,EACzB;EACD,MAAMC,MAAM,GAAGhG,mBAAmB,KAAKoD,QAAQ;EAC/C,MAAM6C,MAAM,GAAG/B,MAAM,CAACgB,OAAO,CAAEjG,cAAe,CAAC,CAAC8C,MAAM,CACrD,CACCC,YAAY,EACZ,CAAEoC,GAAG,EAAE;IAAE5B,KAAK;IAAE0D,UAAU;IAAEC,SAAS;IAAEC;EAAS,CAAC,CAAE,KAC/C;IACJ,IAAKA,QAAQ,IAAI,CAAEJ,MAAM,EAAG;MAC3B,OAAOhE,YAAY;IACpB;IACA,MAAMqE,WAAW,GAAG7D,KAAK;IACzB,IAAK6D,WAAW,CAAE,CAAC,CAAE,KAAK,UAAU,IAAIF,SAAS,EAAG;MACnD,OAAOnE,YAAY;IACpB;IAEA,MAAMsE,UAAU,GAAGtF,sBAAsB,CACxC4E,WAAW,EACXS,WACD,CAAC;;IAED;IACA;IACA,IACCjC,GAAG,KAAK,4BAA4B,KAClC,OAAOkC,UAAU,KAAK,QAAQ,IAAI,CAAET,mBAAmB,CAAE,EAC1D;MACD,OAAO7D,YAAY;IACpB;IAEA,IAAKkE,UAAU,IAAI,OAAOI,UAAU,KAAK,QAAQ,EAAG;MACnDpC,MAAM,CAACgB,OAAO,CAAEgB,UAAW,CAAC,CAAC5D,OAAO,CAAIiE,KAAK,IAAM;QAClD,MAAM,CAAEC,IAAI,EAAEC,IAAI,CAAE,GAAGF,KAAK;QAE5B,IACC,CAAEvF,sBAAsB,CAAEsF,UAAU,EAAE,CAAEG,IAAI,CAAE,EAAE,KAAM,CAAC,EACtD;UACD;UACA;UACA;QACD;QAEA,MAAMC,WAAW,GAAGF,IAAI,CAACG,UAAU,CAAE,IAAK,CAAC,GACxCH,IAAI,GACJ7E,SAAS,CAAE6E,IAAK,CAAC;QACpBxE,YAAY,CAACS,IAAI,CACf,GAAGiE,WAAa,KAAK9G,uBAAuB,CAC5CoB,sBAAsB,CAAEsF,UAAU,EAAE,CAAEG,IAAI,CAAG,CAC9C,CAAG,EACJ,CAAC;MACF,CAAE,CAAC;IACJ,CAAC,MAAM,IACNzF,sBAAsB,CAAE4E,WAAW,EAAES,WAAW,EAAE,KAAM,CAAC,EACxD;MACD,MAAMK,WAAW,GAAGtC,GAAG,CAACuC,UAAU,CAAE,IAAK,CAAC,GACvCvC,GAAG,GACHzC,SAAS,CAAEyC,GAAI,CAAC;MACnBpC,YAAY,CAACS,IAAI,CACf,GAAGiE,WAAa,KAAK9G,uBAAuB,CAC5CoB,sBAAsB,CAAE4E,WAAW,EAAES,WAAY,CAClD,CAAG,EACJ,CAAC;IACF;IAEA,OAAOrE,YAAY;EACpB,CAAC,EACD,EACD,CAAC;;EAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACC,IAAK,CAAC,CAAE4D,WAAW,CAACgB,UAAU,EAAG;IAChC;AACF;AACA;AACA;IACE,IAAKhB,WAAW,CAACgB,UAAU,EAAEC,eAAe,EAAG;MAC9CjB,WAAW,CAACgB,UAAU,CAACC,eAAe,GAAGvG,gBAAgB,CACxDsF,WAAW,CAACgB,UAAU,CAACC,eAAe,EACtCf,IACD,CAAC;IACF;;IAEA;AACF;AACA;AACA;IACE,IAAK,CAAEE,MAAM,IAAI,CAAC,CAAEJ,WAAW,CAACgB,UAAU,EAAEC,eAAe,EAAEC,EAAE,EAAG;MACjElB,WAAW,GAAG;QACb,GAAGA,WAAW;QACdgB,UAAU,EAAE;UACX,GAAGhB,WAAW,CAACgB,UAAU;UACzB,GAAG/F,0BAA0B,CAAE+E,WAAW,CAACgB,UAAW;QACvD;MACD,CAAC;IACF;EACD;EAEA,MAAMG,UAAU,GAAGpH,WAAW,CAAEiG,WAAY,CAAC;EAC7CmB,UAAU,CAACzE,OAAO,CAAI0E,IAAI,IAAM;IAC/B;IACA,IACChB,MAAM,KACJH,mBAAmB,IAAIE,kBAAkB,CAAE,IAC7CiB,IAAI,CAAC5C,GAAG,CAACuC,UAAU,CAAE,SAAU,CAAC,EAC/B;MACD;IACD;IACA,MAAMD,WAAW,GAAGM,IAAI,CAAC5C,GAAG,CAACuC,UAAU,CAAE,IAAK,CAAC,GAC5CK,IAAI,CAAC5C,GAAG,GACRzC,SAAS,CAAEqF,IAAI,CAAC5C,GAAI,CAAC;IAExB,IAAI6C,SAAS,GAAG3G,gBAAgB,CAAE0G,IAAI,CAACxE,KAAK,EAAEsD,IAAI,EAAE,IAAK,CAAC;;IAE1D;IACA,IAAKY,WAAW,KAAK,WAAW,EAAG;MAClC;AACH;AACA;AACA;AACA;AACA;AACA;MACGO,SAAS,GAAGzG,0BAA0B,CACrC;QAAE0G,IAAI,EAAED;MAAU,CAAC,EACnBnB,IAAI,EAAEqB,QACP,CAAC;IACF;;IAEA;IACA;IACA,IAAKT,WAAW,KAAK,cAAc,EAAG;MACrCT,MAAM,CAACxD,IAAI,CAAE,mBAAoB,CAAC;IACnC;IAEAwD,MAAM,CAACxD,IAAI,CAAG,GAAGiE,WAAa,KAAKO,SAAW,EAAE,CAAC;EAClD,CAAE,CAAC;EAEH,OAAOhB,MAAM;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASmB,eAAeA,CAAE;EAChCC,iBAAiB,GAAGtG,kBAAkB;EACtCuG,KAAK;EACLlE,QAAQ;EACRmE,kBAAkB;EAClBC,qBAAqB;EACrBC;AACD,CAAC,EAAG;EACH,IAAIC,OAAO,GAAG,EAAE;EAChB,IAAIC,QAAQ,GAAGJ,kBAAkB,GAC9B3G,cAAc,CAAE0G,KAAK,EAAE7F,OAAO,EAAEmG,QAAS,CAAC,GAC1C,EAAE;;EAEL;EACA;EACA,IAAKJ,qBAAqB,EAAG;IAC5B,IAAKpE,QAAQ,KAAKpD,mBAAmB,EAAG;MACvC2H,QAAQ,GAAG,CAAEA,QAAQ,GAAG,OAAO,GAAGA,QAAQ;IAC3C,CAAC,MAAM,IAAK,CAAEJ,kBAAkB,IAAIE,gBAAgB,EAAG;MACtDE,QAAQ,GAAGF,gBAAgB;IAC5B;EACD;EAEA,IAAKE,QAAQ,IAAIN,iBAAiB,EAAG;IACpCnD,MAAM,CAAC2D,MAAM,CAAER,iBAAkB,CAAC,CAAC/E,OAAO,CACzC,CAAE;MAAEwF,SAAS;MAAEtB,IAAI;MAAEuB;IAAc,CAAC,KAAM;MACzC;MACA,IACC,CAAER,kBAAkB,IACpB,MAAM,KAAKf,IAAI,IACf,MAAM,KAAKA,IAAI,EACd;QACD;MACD;MAEA,IAAKuB,aAAa,EAAEC,MAAM,EAAG;QAC5BD,aAAa,CAACzF,OAAO,CAAI2F,YAAY,IAAM;UAC1C,MAAMjG,YAAY,GAAG,EAAE;UAEvB,IAAKiG,YAAY,CAACC,KAAK,EAAG;YACzBhE,MAAM,CAACgB,OAAO,CAAE+C,YAAY,CAACC,KAAM,CAAC,CAAC5F,OAAO,CAC3C,CAAE,CAAEoE,WAAW,EAAEyB,QAAQ,CAAE,KAAM;cAChCnG,YAAY,CAACS,IAAI,CACf,GAAGiE,WAAa,KAChByB,QAAQ,GAAGA,QAAQ,GAAGR,QACtB,EACF,CAAC;YACF,CACD,CAAC;UACF;UAEA,IAAK3F,YAAY,CAACgG,MAAM,EAAG;YAC1B,IAAII,gBAAgB,GAAG,EAAE;YAEzB,IAAK,CAAEb,kBAAkB,EAAG;cAC3B;cACAa,gBAAgB,GACfhF,QAAQ,KAAKpD,mBAAmB,GAC5B,WAAW8H,SAAW,GACvBG,YAAY,EAAE7E,QAAQ,IAAI,EACzB,GAAE,GACF,UAAUA,QAAU,IAAI0E,SAAW,GACpCG,YAAY,EAAE7E,QAAQ,IAAI,EACzB,GAAE;YACR,CAAC,MAAM;cACNgF,gBAAgB,GACfhF,QAAQ,KAAKpD,mBAAmB,GAC5B,iBAAiB8H,SAAW,IAC7BG,YAAY,EAAE7E,QAAQ,IAAI,EACzB,EAAC,GACD,gBAAgBA,QAAU,IAAI0E,SAAW,IAC1CG,YAAY,EAAE7E,QAAQ,IAAI,EACzB,EAAC;YACP;YACAsE,OAAO,IAAK,GAAGU,gBAAkB,MAAMpG,YAAY,CAACqB,IAAI,CACvD,IACD,CAAG,KAAI;UACR;QACD,CAAE,CAAC;MACJ;IACD,CACD,CAAC;IACD;IACA,IAAKD,QAAQ,KAAKpD,mBAAmB,IAAIuH,kBAAkB,EAAG;MAC7DG,OAAO,IAAK,GAAGzH,4BAA8B,8BAA8B0H,QAAU,KAAI;IAC1F;EACD;;EAEA;EACA,IAAKvE,QAAQ,KAAKpD,mBAAmB,IAAIqH,iBAAiB,EAAG;IAC5D,MAAMgB,iBAAiB,GAAG,CAAE,OAAO,EAAE,MAAM,EAAE,MAAM,CAAE;IACrDnE,MAAM,CAAC2D,MAAM,CAAER,iBAAkB,CAAC,CAAC/E,OAAO,CACzC,CAAE;MAAEwF,SAAS;MAAEQ,WAAW;MAAEC;IAAW,CAAC,KAAM;MAC7C,IACCD,WAAW,IACXD,iBAAiB,CAACG,QAAQ,CAAEF,WAAY,CAAC,EACxC;QACDZ,OAAO,IAAK,GAAGtE,QAAU,KAAK0E,SAAW,cAAcQ,WAAa,KAAI;MACzE;MAEA,IAAKC,UAAU,EAAEP,MAAM,EAAG;QACzBO,UAAU,CAACjG,OAAO,CAAImG,SAAS,IAAM;UACpC,MAAMzG,YAAY,GAAG,EAAE;UAEvB,IAAKyG,SAAS,CAACP,KAAK,EAAG;YACtBhE,MAAM,CAACgB,OAAO,CAAEuD,SAAS,CAACP,KAAM,CAAC,CAAC5F,OAAO,CACxC,CAAE,CAAEoE,WAAW,EAAEyB,QAAQ,CAAE,KAAM;cAChCnG,YAAY,CAACS,IAAI,CACf,GAAGiE,WAAa,KAAKyB,QAAU,EACjC,CAAC;YACF,CACD,CAAC;UACF;UAEA,IAAKnG,YAAY,CAACgG,MAAM,EAAG;YAC1B,MAAMI,gBAAgB,GAAI,IAAIN,SAAW,GACxCW,SAAS,EAAErF,QAAQ,IAAI,EACvB,EAAC;YACFsE,OAAO,IAAK,GAAGU,gBAAkB,MAAMpG,YAAY,CAACqB,IAAI,CACvD,IACD,CAAG,KAAI;UACR;QACD,CAAE,CAAC;MACJ;IACD,CACD,CAAC;EACF;EAEA,OAAOqE,OAAO;AACf;AAEA,MAAMgB,UAAU,GAAG,CAClB,QAAQ,EACR,OAAO,EACP,YAAY,EACZ,SAAS,EACT,YAAY,EACZ,QAAQ,EACR,SAAS,EACT,QAAQ,EACR,YAAY,CACZ;AAED,SAASC,aAAaA,CAAEC,cAAc,EAAG;EACxC,IAAK,CAAEA,cAAc,EAAG;IACvB,OAAO,CAAC,CAAC;EACV;EACA,MAAM1D,OAAO,GAAGhB,MAAM,CAACgB,OAAO,CAAE0D,cAAe,CAAC;EAChD,MAAMC,aAAa,GAAG3D,OAAO,CAAC3B,MAAM,CAAE,CAAE,CAAEa,GAAG,CAAE,KAC9CsE,UAAU,CAACF,QAAQ,CAAEpE,GAAI,CAC1B,CAAC;EACD;EACA,MAAM0E,aAAa,GAAGD,aAAa,CAAC1F,GAAG,CAAE,CAAE,CAAEiB,GAAG,EAAEkD,KAAK,CAAE,KAAM,CAC9DlD,GAAG,EACH2E,IAAI,CAACC,KAAK,CAAED,IAAI,CAACE,SAAS,CAAE3B,KAAM,CAAE,CAAC,CACpC,CAAC;EACH,OAAOpD,MAAM,CAACgF,WAAW,CAAEJ,aAAc,CAAC;AAC3C;AAEA,OAAO,MAAMK,kBAAkB,GAAGA,CAAErD,IAAI,EAAEsD,cAAc,KAAM;EAAA,IAAAC,mBAAA;EAC7D,MAAMC,KAAK,GAAG,EAAE;EAEhB,IAAK,CAAExD,IAAI,EAAEb,MAAM,EAAG;IACrB,OAAOqE,KAAK;EACb;;EAEA;EACA,MAAMrE,MAAM,GAAG0D,aAAa,CAAE7C,IAAI,CAACb,MAAO,CAAC;EAC3C,IAAKA,MAAM,EAAG;IACbqE,KAAK,CAAC7G,IAAI,CAAE;MACXwC,MAAM;MACN7B,QAAQ,EAAEpD,mBAAmB;MAC7B;MACA;MACAuJ,mBAAmB,EAAE;IACtB,CAAE,CAAC;EACJ;EAEArF,MAAM,CAACgB,OAAO,CAAE/F,QAAS,CAAC,CAACmD,OAAO,CAAE,CAAE,CAAEkE,IAAI,EAAEpD,QAAQ,CAAE,KAAM;IAC7D,IAAK0C,IAAI,CAACb,MAAM,EAAEuE,QAAQ,GAAIhD,IAAI,CAAE,EAAG;MACtC8C,KAAK,CAAC7G,IAAI,CAAE;QACXwC,MAAM,EAAEa,IAAI,CAACb,MAAM,EAAEuE,QAAQ,GAAIhD,IAAI,CAAE;QACvCpD,QAAQ;QACR;QACA;QACAmG,mBAAmB,EAAE,CAAEpI,mBAAmB,CAAEqF,IAAI;MACjD,CAAE,CAAC;IACJ;EACD,CAAE,CAAC;;EAEH;EACAtC,MAAM,CAACgB,OAAO,EAAAmE,mBAAA,GAAEvD,IAAI,CAACb,MAAM,EAAEwE,MAAM,cAAAJ,mBAAA,cAAAA,mBAAA,GAAI,CAAC,CAAE,CAAC,CAAC/G,OAAO,CAClD,CAAE,CAAEoH,SAAS,EAAEC,IAAI,CAAE,KAAM;IAAA,IAAAC,cAAA;IAC1B,MAAMhE,WAAW,GAAG+C,aAAa,CAAEgB,IAAK,CAAC;IAEzC,IAAKA,IAAI,EAAEE,UAAU,EAAG;MACvB,MAAMA,UAAU,GAAG,CAAC,CAAC;MACrB3F,MAAM,CAACgB,OAAO,CAAEyE,IAAI,CAACE,UAAW,CAAC,CAACvH,OAAO,CACxC,CAAE,CAAEwH,aAAa,EAAEC,SAAS,CAAE,KAAM;QAAA,IAAAC,mBAAA,EAAAC,iBAAA;QACnCJ,UAAU,CAAEC,aAAa,CAAE,GAC1BnB,aAAa,CAAEoB,SAAU,CAAC;QAC3B,IAAKA,SAAS,EAAEG,GAAG,EAAG;UACrBL,UAAU,CAAEC,aAAa,CAAE,CAACI,GAAG,GAAGH,SAAS,CAACG,GAAG;QAChD;QACA,MAAMC,iBAAiB,GACtBf,cAAc,CAAEM,SAAS,CAAE,EACxBU,uBAAuB,GAAIN,aAAa,CAAE;;QAE9C;QACA;QACA;QACA;QACA5F,MAAM,CAACgB,OAAO,EAAA8E,mBAAA,GAAED,SAAS,EAAEP,QAAQ,cAAAQ,mBAAA,cAAAA,mBAAA,GAAI,CAAC,CAAE,CAAC,CAAC1H,OAAO,CAClD,CAAE,CAAE+H,OAAO,EAAEC,aAAa,CAAE,KAAM;UACjC,IAAKA,aAAa,IAAInL,QAAQ,CAAEkL,OAAO,CAAE,EAAG;YAC3Cf,KAAK,CAAC7G,IAAI,CAAE;cACXwC,MAAM,EAAEqF,aAAa;cACrBlH,QAAQ,EAAElD,aAAa,CACtBiK,iBAAiB,EACjBhL,QAAQ,CAAEkL,OAAO,CAClB;YACD,CAAE,CAAC;UACJ;QACD,CACD,CAAC;;QAED;QACAnG,MAAM,CAACgB,OAAO,EAAA+E,iBAAA,GAAEF,SAAS,EAAEN,MAAM,cAAAQ,iBAAA,cAAAA,iBAAA,GAAI,CAAC,CAAE,CAAC,CAAC3H,OAAO,CAChD,CAAE,CACDiI,kBAAkB,EAClBC,oBAAoB,CACpB,KAAM;UAAA,IAAAC,qBAAA;UACN,MAAMC,sBAAsB,GAAGxK,aAAa,CAC3CiK,iBAAiB,EACjBf,cAAc,CAAEmB,kBAAkB,CAAE,EACjCnH,QACJ,CAAC;UACD,MAAMuH,wBAAwB,GAAGzK,aAAa,CAC7CiK,iBAAiB,EACjBf,cAAc,CAAEmB,kBAAkB,CAAE,EACjCK,eACJ,CAAC;UACD,MAAMC,yBAAyB,GAC9B1K,qBAAqB,CACpBgK,iBAAiB,EACjBf,cAAc,CAAEmB,kBAAkB,CAAE,EACjC3F,gBACJ,CAAC;UAEF,MAAMkG,wBAAwB,GAC7BnC,aAAa,CAAE6B,oBAAqB,CAAC;UAEtC,IAAKA,oBAAoB,EAAEN,GAAG,EAAG;YAChCY,wBAAwB,CAACZ,GAAG,GAC3BM,oBAAoB,CAACN,GAAG;UAC1B;UAEAZ,KAAK,CAAC7G,IAAI,CAAE;YACXW,QAAQ,EAAEsH,sBAAsB;YAChCE,eAAe,EAAED,wBAAwB;YACzC/F,gBAAgB,EAAEiG,yBAAyB;YAC3CpD,gBAAgB,EACf2B,cAAc,CAAEmB,kBAAkB,CAAE,EACjC9C,gBAAgB;YACpBsD,gBAAgB,EACf3B,cAAc,CAAEmB,kBAAkB,CAAE,EACjCQ,gBAAgB;YACpB9F,MAAM,EAAE6F;UACT,CAAE,CAAC;;UAEH;UACA;UACA5G,MAAM,CAACgB,OAAO,EAAAuF,qBAAA,GACbD,oBAAoB,CAAChB,QAAQ,cAAAiB,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CACnC,CAAC,CAACnI,OAAO,CACR,CAAE,CACD0I,qBAAqB,EACrBC,2BAA2B,CAC3B,KAAM;YACN,IACCA,2BAA2B,IAC3B9L,QAAQ,CAAE6L,qBAAqB,CAAE,EAChC;cACD1B,KAAK,CAAC7G,IAAI,CAAE;gBACXwC,MAAM,EAAEgG,2BAA2B;gBACnC7H,QAAQ,EAAElD,aAAa,CACtBwK,sBAAsB,EACtBvL,QAAQ,CACP6L,qBAAqB,CAEvB;cACD,CAAE,CAAC;YACJ;UACD,CACD,CAAC;QACF,CACD,CAAC;MACF,CACD,CAAC;MACDpF,WAAW,CAACiE,UAAU,GAAGA,UAAU;IACpC;IAEA,IAAKT,cAAc,GAAIM,SAAS,CAAE,EAAEtG,QAAQ,EAAG;MAC9CkG,KAAK,CAAC7G,IAAI,CAAE;QACXmI,eAAe,EACdxB,cAAc,CAAEM,SAAS,CAAE,CAACkB,eAAe;QAC5CnD,gBAAgB,EACf2B,cAAc,CAAEM,SAAS,CAAE,CAACjC,gBAAgB;QAC7CsD,gBAAgB,EACf3B,cAAc,CAAEM,SAAS,CAAE,CAACqB,gBAAgB;QAC7C3H,QAAQ,EAAEgG,cAAc,CAAEM,SAAS,CAAE,CAACtG,QAAQ;QAC9C6B,MAAM,EAAEW,WAAW;QACnBhB,gBAAgB,EACfwE,cAAc,CAAEM,SAAS,CAAE,CAAC9E,gBAAgB;QAC7CwF,uBAAuB,EACtBhB,cAAc,CAAEM,SAAS,CAAE,CAACU;MAC9B,CAAE,CAAC;IACJ;IAEAlG,MAAM,CAACgB,OAAO,EAAA0E,cAAA,GAAED,IAAI,EAAEH,QAAQ,cAAAI,cAAA,cAAAA,cAAA,GAAI,CAAC,CAAE,CAAC,CAACtH,OAAO,CAC7C,CAAE,CAAE4I,WAAW,EAAE1I,KAAK,CAAE,KAAM;MAC7B,IACCA,KAAK,IACL4G,cAAc,GAAIM,SAAS,CAAE,IAC7BvK,QAAQ,CAAE+L,WAAW,CAAE,EACtB;QACD5B,KAAK,CAAC7G,IAAI,CAAE;UACXwC,MAAM,EAAEzC,KAAK;UACbY,QAAQ,EAAEgG,cAAc,CAAEM,SAAS,CAAE,EAAEtG,QAAQ,CAC7CF,KAAK,CAAE,GAAI,CAAC,CACZC,GAAG,CAAIgI,GAAG,IAAM;YAChB,MAAMC,gBAAgB,GACrBjM,QAAQ,CAAE+L,WAAW,CAAE,CAAChI,KAAK,CAAE,GAAI,CAAC;YACrC,OAAOkI,gBAAgB,CAACjI,GAAG,CACxBkI,eAAe,IAChBF,GAAG,GAAG,GAAG,GAAGE,eACd,CAAC;UACF,CAAE,CAAC,CACFhI,IAAI,CAAE,GAAI;QACb,CAAE,CAAC;MACJ;IACD,CACD,CAAC;EACF,CACD,CAAC;EAED,OAAOiG,KAAK;AACb,CAAC;AAED,OAAO,MAAMgC,oBAAoB,GAAGA,CAAExF,IAAI,EAAEsD,cAAc,KAAM;EAAA,IAAAmC,qBAAA;EAC/D,MAAMjC,KAAK,GAAG,EAAE;EAEhB,IAAK,CAAExD,IAAI,EAAEqB,QAAQ,EAAG;IACvB,OAAOmC,KAAK;EACb;EAEA,MAAMkC,WAAW,GAAK5C,cAAc,IAAM;IACzC,IAAI6C,OAAO,GAAG,CAAC,CAAC;IAChB1L,eAAe,CAACuC,OAAO,CAAE,CAAE;MAAEL;IAAK,CAAC,KAAM;MACxC,MAAMO,KAAK,GAAGxB,sBAAsB,CAAE4H,cAAc,EAAE3G,IAAI,EAAE,KAAM,CAAC;MACnE,IAAKO,KAAK,KAAK,KAAK,EAAG;QACtBiJ,OAAO,GAAGxK,YAAY,CAAEwK,OAAO,EAAExJ,IAAI,EAAEO,KAAM,CAAC;MAC/C;IACD,CAAE,CAAC;IACH,OAAOiJ,OAAO;EACf,CAAC;;EAED;EACA,MAAMA,OAAO,GAAGD,WAAW,CAAE1F,IAAI,CAACqB,QAAS,CAAC;EAC5C,MAAMuE,MAAM,GAAG5F,IAAI,CAACqB,QAAQ,EAAEuE,MAAM;EACpC,IAAKxH,MAAM,CAACC,IAAI,CAAEsH,OAAQ,CAAC,CAACzD,MAAM,GAAG,CAAC,IAAI0D,MAAM,EAAG;IAClDpC,KAAK,CAAC7G,IAAI,CAAE;MACXgJ,OAAO;MACPC,MAAM;MACNtI,QAAQ,EAAEnD;IACX,CAAE,CAAC;EACJ;;EAEA;EACAiE,MAAM,CAACgB,OAAO,EAAAqG,qBAAA,GAAEzF,IAAI,CAACqB,QAAQ,EAAEsC,MAAM,cAAA8B,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAE,CAAC,CAACjJ,OAAO,CACpD,CAAE,CAAEoH,SAAS,EAAEC,IAAI,CAAE,KAAM;IAC1B,MAAM9H,YAAY,GAAG2J,WAAW,CAAE7B,IAAK,CAAC;IACxC,MAAMgC,WAAW,GAAGhC,IAAI,CAAC+B,MAAM;IAC/B,IAAKxH,MAAM,CAACC,IAAI,CAAEtC,YAAa,CAAC,CAACmG,MAAM,GAAG,CAAC,IAAI2D,WAAW,EAAG;MAC5DrC,KAAK,CAAC7G,IAAI,CAAE;QACXgJ,OAAO,EAAE5J,YAAY;QACrB6J,MAAM,EAAEC,WAAW;QACnBvI,QAAQ,EAAEgG,cAAc,CAAEM,SAAS,CAAE,EAAEtG;MACxC,CAAE,CAAC;IACJ;EACD,CACD,CAAC;EAED,OAAOkG,KAAK;AACb,CAAC;AAED,OAAO,MAAMsC,kBAAkB,GAAGA,CAAE9F,IAAI,EAAEsD,cAAc,KAAM;EAC7D,MAAMjC,QAAQ,GAAGmE,oBAAoB,CAAExF,IAAI,EAAEsD,cAAe,CAAC;EAC7D,IAAI1B,OAAO,GAAG,EAAE;EAChBP,QAAQ,CAAC7E,OAAO,CAAE,CAAE;IAAEmJ,OAAO;IAAEC,MAAM;IAAEtI;EAAS,CAAC,KAAM;IACtD,MAAMpB,YAAY,GAAGJ,sBAAsB,CAAE6J,OAAO,EAAE3F,IAAI,EAAEqB,QAAS,CAAC;IACtE,MAAM0E,WAAW,GAAGhI,WAAW,CAAE6H,MAAM,EAAE,gBAAgB,EAAE,IAAK,CAAC;IACjE,IAAKG,WAAW,CAAC7D,MAAM,GAAG,CAAC,EAAG;MAC7BhG,YAAY,CAACS,IAAI,CAAE,GAAGoJ,WAAY,CAAC;IACpC;IAEA,IAAK7J,YAAY,CAACgG,MAAM,GAAG,CAAC,EAAG;MAC9BN,OAAO,IAAK,GAAGtE,QAAU,IAAIpB,YAAY,CAACqB,IAAI,CAAE,GAAI,CAAG,IAAG;IAC3D;EACD,CAAE,CAAC;EAEH,OAAOqE,OAAO;AACf,CAAC;AAED,OAAO,MAAMoE,QAAQ,GAAGA,CACvBhG,IAAI,EACJsD,cAAc,EACd7B,kBAAkB,EAClBC,qBAAqB,EACrBuE,mBAAmB,GAAG,KAAK,EAC3BhG,kBAAkB,GAAG,KAAK,EAC1BiG,YAAY,GAAGC,SAAS,KACpB;EACJ;EACA,MAAMC,OAAO,GAAG;IACftE,QAAQ,EAAE,IAAI;IACdhC,WAAW,EAAE,IAAI;IACjBuG,YAAY,EAAE,IAAI;IAClBC,WAAW,EAAE,IAAI;IACjBX,OAAO,EAAE,IAAI;IACbY,WAAW,EAAE,IAAI;IACjBC,eAAe,EAAE,KAAK;IACtB,GAAGN;EACJ,CAAC;EACD,MAAMO,eAAe,GAAGpD,kBAAkB,CAAErD,IAAI,EAAEsD,cAAe,CAAC;EAClE,MAAMoD,iBAAiB,GAAGlB,oBAAoB,CAAExF,IAAI,EAAEsD,cAAe,CAAC;EACtE,MAAMvD,mBAAmB,GAAGC,IAAI,EAAEqB,QAAQ,EAAEsF,6BAA6B;EACzE,MAAM;IAAEC,WAAW;IAAEC;EAAS,CAAC,GAAG7G,IAAI,EAAEqB,QAAQ,EAAEyF,MAAM,IAAI,CAAC,CAAC;EAC9D,MAAMC,aAAa,GAClBX,OAAO,CAACE,WAAW,IAAIF,OAAO,CAACG,WAAW,IAAIH,OAAO,CAACC,YAAY;EAEnE,IAAIzE,OAAO,GAAG,EAAE;EAEhB,IAAKwE,OAAO,CAACT,OAAO,KAAMiB,WAAW,IAAIC,QAAQ,CAAE,EAAG;IACrDjF,OAAO,IAAK,GAAGzH,4BAA8B,IAAG;IAChDyH,OAAO,GAAGgF,WAAW,GAClBhF,OAAO,GAAI,uCAAuCgF,WAAa,GAAE,GACjEhF,OAAO;IACVA,OAAO,GAAGiF,QAAQ,GACfjF,OAAO,GAAI,oCAAoCiF,QAAU,GAAE,GAC3DjF,OAAO;IACVA,OAAO,IAAI,GAAG;EACf;EAEA,IAAKmF,aAAa,EAAG;IACpB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;IACEnF,OAAO,IAAI,0BAA0B;;IAErC;IACA,IAAKwE,OAAO,CAACG,WAAW,IAAIxG,mBAAmB,EAAG;MACjD;AACH;AACA;AACA;MACG6B,OAAO,IAAK;AACf;AACA;AACA;AACA;AACA,KAAK;IACH;IAEAA,OAAO,IAAI,GAAG;EACf;EAEA,IAAKwE,OAAO,CAACtG,WAAW,EAAG;IAC1B2G,eAAe,CAACjK,OAAO,CACtB,CAAE;MACDc,QAAQ;MACRwH,eAAe;MACf3F,MAAM;MACNwC,gBAAgB;MAChBsD,gBAAgB;MAChBnG,gBAAgB;MAChBwF,uBAAuB;MACvBb;IACD,CAAC,KAAM;MACN;MACA;MACA,IAAK3E,gBAAgB,EAAG;QACvB,MAAMkI,mBAAmB,GAAG/H,sBAAsB,CACjDH,gBAAgB,EAChBK,MACD,CAAC;QAEDf,MAAM,CAACgB,OAAO,CAAE4H,mBAAoB,CAAC,CAACxK,OAAO,CAC5C,CAAE,CAAEyK,WAAW,EAAE/K,YAAY,CAAE,KAAM;UACpC,IAAKA,YAAY,CAACgG,MAAM,EAAG;YAC1B,MAAME,KAAK,GAAGlG,YAAY,CAACqB,IAAI,CAAE,GAAI,CAAC;YACtCqE,OAAO,IAAK,gBAAgBqF,WAAa,KAAK7E,KAAO,IAAG;UACzD;QACD,CACD,CAAC;MACF;;MAEA;MACA,IAAK0C,eAAe,EAAG;QACtB,MAAMoC,aAAa,GAAG,CAAC,CAAC;QACxB,IAAK/H,MAAM,EAAE1B,MAAM,EAAG;UACrByJ,aAAa,CAACzJ,MAAM,GAAG0B,MAAM,CAAC1B,MAAM;UACpC,OAAO0B,MAAM,CAAC1B,MAAM;QACrB;QACA,MAAM0J,mBAAmB,GACxBxH,qBAAqB,CAAEuH,aAAc,CAAC;QACvC,IAAKC,mBAAmB,CAACjF,MAAM,EAAG;UACjCN,OAAO,IAAK,GAAGkD,eAAiB,IAAIqC,mBAAmB,CAAC5J,IAAI,CAC3D,GACD,CAAG,IAAG;QACP;MACD;;MAEA;MACA,IACC,CAAE0I,mBAAmB,KACnB/L,mBAAmB,KAAKoD,QAAQ,IAAI2H,gBAAgB,CAAE,EACvD;QACDrD,OAAO,IAAIN,eAAe,CAAE;UAC3BE,KAAK,EAAErC,MAAM;UACb7B,QAAQ;UACRmE,kBAAkB;UAClBC,qBAAqB;UACrBC;QACD,CAAE,CAAC;MACJ;;MAEA;MACA,MAAMyF,iBAAiB,GAAGzH,qBAAqB,CAC9CR,MAAM,EACN7B,QAAQ,EACRyC,mBAAmB,EACnBC,IAAI,EACJC,kBACD,CAAC;MACD,IAAKmH,iBAAiB,EAAElF,MAAM,EAAG;QAChC,MAAMmF,eAAe,GAAG5D,mBAAmB,GACxCnG,QAAQ,GACP,gBAAgBA,QAAU,GAAE;QAChCsE,OAAO,IAAK,GAAGyF,eAAiB,IAAID,iBAAiB,CAAC7J,IAAI,CACzD,GACD,CAAG,IAAG;MACP;MACA,IAAK4B,MAAM,EAAEiF,GAAG,EAAG;QAClBxC,OAAO,IAAI0F,iBAAiB,CAC3BnI,MAAM,CAACiF,GAAG,EACT,gBAAgB9G,QAAU,GAC5B,CAAC;MACF;MAEA,IAAK8I,OAAO,CAACI,eAAe,IAAIlC,uBAAuB,EAAG;QACzDlG,MAAM,CAACgB,OAAO,CAAEkF,uBAAwB,CAAC,CAAC9H,OAAO,CAChD,CAAE,CAAE+K,kBAAkB,EAAE1I,sBAAsB,CAAE,KAAM;UACrD,MAAM2I,eAAe,GACpBrI,MAAM,EAAE4E,UAAU,GAAIwD,kBAAkB,CAAE;UAC3C,IAAKC,eAAe,EAAG;YACtB;YACA,IAAK1I,gBAAgB,EAAG;cACvB,MAAMkI,mBAAmB,GACxB/H,sBAAsB,CACrBH,gBAAgB,EAChB0I,eACD,CAAC;cAEFpJ,MAAM,CAACgB,OAAO,CACb4H,mBACD,CAAC,CAACxK,OAAO,CACR,CAAE,CAAEiL,YAAY,EAAEvL,YAAY,CAAE,KAAM;gBACrC,IAAKA,YAAY,CAACgG,MAAM,EAAG;kBAC1B,MAAM+E,WAAW,GAChBtI,oCAAoC,CACnC8I,YAAY,EACZ5I,sBACD,CAAC;kBACF,MAAMuD,KAAK,GACVlG,YAAY,CAACqB,IAAI,CAAE,GAAI,CAAC;kBACzBqE,OAAO,IAAK,gBAAgBqF,WAAa,KAAK7E,KAAO,IAAG;gBACzD;cACD,CACD,CAAC;YACF;;YAEA;YACA,MAAMsF,0BAA0B,GAC/B/H,qBAAqB,CACpB6H,eAAe,EACf3I,sBAAsB,EACtBkB,mBAAmB,EACnBC,IACD,CAAC;YACF,IAAK0H,0BAA0B,CAACxF,MAAM,EAAG;cACxCN,OAAO,IAAK,gBAAgB/C,sBAAwB,KAAK6I,0BAA0B,CAACnK,IAAI,CACvF,GACD,CAAG,IAAG;YACP;YACA,IAAKiK,eAAe,EAAEpD,GAAG,EAAG;cAC3BxC,OAAO,IAAI0F,iBAAiB,CAC3BE,eAAe,CAACpD,GAAG,EAClB,gBAAgBvF,sBAAwB,GAC1C,CAAC;YACF;UACD;QACD,CACD,CAAC;MACF;;MAEA;MACA,MAAM8I,oBAAoB,GAAGvJ,MAAM,CAACgB,OAAO,CAAED,MAAO,CAAC,CAAC1B,MAAM,CAC3D,CAAE,CAAEa,GAAG,CAAE,KAAMA,GAAG,CAACuC,UAAU,CAAE,GAAI,CACpC,CAAC;MAED,IAAK8G,oBAAoB,EAAEzF,MAAM,EAAG;QACnCyF,oBAAoB,CAACnL,OAAO,CAC3B,CAAE,CAAEoL,SAAS,EAAEC,WAAW,CAAE,KAAM;UACjC,MAAMC,kBAAkB,GACvBnI,qBAAqB,CAAEkI,WAAY,CAAC;UAErC,IAAK,CAAEC,kBAAkB,EAAE5F,MAAM,EAAG;YACnC;UACD;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA,MAAM6F,SAAS,GAAGzK,QAAQ,CACxBF,KAAK,CAAE,GAAI,CAAC,CACZC,GAAG,CAAIgI,GAAG,IAAMA,GAAG,GAAGuC,SAAU,CAAC,CACjCrK,IAAI,CAAE,GAAI,CAAC;;UAEb;UACA;UACA;UACA;UACA,MAAMyK,UAAU,GAAI,gBAAgBD,SAAW,KAAKD,kBAAkB,CAACvK,IAAI,CAC1E,GACD,CAAG,IAAG;UAENqE,OAAO,IAAIoG,UAAU;QACtB,CACD,CAAC;MACF;IACD,CACD,CAAC;EACF;EAEA,IAAK5B,OAAO,CAACC,YAAY,EAAG;IAC3B;IACAzE,OAAO,GACNA,OAAO,GACP,kEAAkE;IACnEA,OAAO,GACNA,OAAO,GACP,mEAAmE;IACpEA,OAAO,GACNA,OAAO,GACP,oGAAoG;EACtG;EAEA,IAAKwE,OAAO,CAACtE,QAAQ,IAAIL,kBAAkB,EAAG;IAC7C;IACA,MAAMI,QAAQ,GACb/G,cAAc,CAAEkF,IAAI,EAAEb,MAAM,EAAExD,OAAO,EAAEmG,QAAS,CAAC,IAAI,OAAO;IAC7DF,OAAO,GACNA,OAAO,GACN,2DAA2DC,QAAU,0BAAyB;IAChGD,OAAO,GACNA,OAAO,GACP,yEAAyE;IAC1EA,OAAO,GACNA,OAAO,GACP,sEAAsE;EACxE;EAEA,IAAKwE,OAAO,CAACT,OAAO,EAAG;IACtBe,iBAAiB,CAAClK,OAAO,CAAE,CAAE;MAAEc,QAAQ;MAAEqI;IAAQ,CAAC,KAAM;MACvD,IACCzL,mBAAmB,KAAKoD,QAAQ,IAChCnD,4BAA4B,KAAKmD,QAAQ,EACxC;QACD;QACAA,QAAQ,GAAG,EAAE;MACd;MAEA,MAAMP,OAAO,GAAGF,iBAAiB,CAAES,QAAQ,EAAEqI,OAAQ,CAAC;MACtD,IAAK5I,OAAO,CAACmF,MAAM,GAAG,CAAC,EAAG;QACzBN,OAAO,IAAI7E,OAAO;MACnB;IACD,CAAE,CAAC;EACJ;EAEA,OAAO6E,OAAO;AACf,CAAC;AAED,OAAO,SAASqG,YAAYA,CAAEjI,IAAI,EAAEsD,cAAc,EAAG;EACpD,MAAMoD,iBAAiB,GAAGlB,oBAAoB,CAAExF,IAAI,EAAEsD,cAAe,CAAC;EACtE,OAAOoD,iBAAiB,CAAC9I,OAAO,CAAE,CAAE;IAAE+H;EAAQ,CAAC,KAAM;IACpD,OAAOnI,oBAAoB,CAAEmI,OAAQ,CAAC;EACvC,CAAE,CAAC;AACJ;AAEA,MAAMuC,kBAAkB,GAAGA,CAAEC,SAAS,EAAEC,YAAY,KAAM;EACzD,IACCD,SAAS,EAAEjJ,SAAS,IACpBd,MAAM,CAACC,IAAI,CAAE8J,SAAS,CAACjJ,SAAU,CAAC,CAACgD,MAAM,GAAG,CAAC,EAC5C;IACD,OAAOiG,SAAS,CAACjJ,SAAS;EAC3B;EAEA,MAAMmJ,MAAM,GAAG;IAAEzI,IAAI,EAAEwI;EAAa,CAAC;EACrChK,MAAM,CAACgB,OAAO,CAAE5D,qCAAsC,CAAC,CAACgB,OAAO,CAC9D,CAAE,CAAE8L,UAAU,EAAEC,WAAW,CAAE,KAAM;IAClC,MAAM3J,eAAe,GAAGnE,mBAAmB,CAC1C0N,SAAS,EACTG,UACD,CAAC;IAED,IAAK1J,eAAe,EAAG;MACtByJ,MAAM,CAAEE,WAAW,CAAE,GAAG3J,eAAe;IACxC;EACD,CACD,CAAC;EAED,OAAOyJ,MAAM;AACd,CAAC;AAED,OAAO,MAAMG,iBAAiB,GAAGA,CAChCC,UAAU,EACVC,cAAc,EACdC,mBAAmB,KACf;EACJ,MAAMxK,MAAM,GAAG,CAAC,CAAC;EACjBsK,UAAU,CAACjM,OAAO,CAAI2L,SAAS,IAAM;IACpC,MAAMzH,IAAI,GAAGyH,SAAS,CAACzH,IAAI;IAC3B,MAAMpD,QAAQ,GAAG7C,mBAAmB,CAAE0N,SAAU,CAAC;IACjD,IAAIrD,eAAe,GAAGrK,mBAAmB,CACxC0N,SAAS,EACT,gBACD,CAAC;;IAED;IACA,IAAK,CAAErD,eAAe,EAAG;MACxB,MAAMsD,YAAY,GAAG3N,mBAAmB,CAAE0N,SAAU,CAAC;MACrD,MAAMS,cAAc,GAAGtP,eAAe,CACrC6O,SAAS,EACT,6BAA6B,EAC7B,KACD,CAAC;MACDrD,eAAe,GACd8D,cAAc,IAAIxO,aAAa,CAAEgO,YAAY,EAAEQ,cAAe,CAAC;IACjE;IAEA,MAAM3D,gBAAgB,GACrB,CAAC,CAAEkD,SAAS,EAAEU,QAAQ,EAAE/B,MAAM,IAC9B,CAAC,CAAEqB,SAAS,EAAEU,QAAQ,EAAEC,oBAAoB;IAC7C,MAAMnH,gBAAgB,GACrBwG,SAAS,EAAEU,QAAQ,EAAElN,OAAO,EAAEmG,QAAQ,EAAEiH,qBAAqB;IAE9D,MAAMC,oBAAoB,GAAGN,cAAc,CAAEhI,IAAK,CAAC;IACnD,MAAM4D,uBAAuB,GAAG,CAAC,CAAC;IAClC0E,oBAAoB,EAAExM,OAAO,CAAIyH,SAAS,IAAM;MAC/C,MAAMgF,eAAe,GAAGN,mBAAmB,GACvC,IAAIA,mBAAqB,EAAC,GAC3B,EAAE;MACL,MAAM3E,aAAa,GAAI,GAAGC,SAAS,CAACvD,IAAM,GAAGuI,eAAiB,EAAC;MAC/D,MAAMpK,sBAAsB,GAAGtE,8BAA8B,CAC5DyJ,aAAa,EACb1G,QACD,CAAC;MAEDgH,uBAAuB,CAAEN,aAAa,CAAE,GAAGnF,sBAAsB;IAClE,CAAE,CAAC;;IAEH;IACA,MAAMC,gBAAgB,GAAGoJ,kBAAkB,CAAEC,SAAS,EAAE7K,QAAS,CAAC;IAElEa,MAAM,CAAEuC,IAAI,CAAE,GAAG;MAChBoE,eAAe;MACfnD,gBAAgB;MAChB7C,gBAAgB,EAAEV,MAAM,CAACC,IAAI,CAAES,gBAAiB,CAAC,CAACoD,MAAM,GACrDpD,gBAAgB,GAChBqH,SAAS;MACZlB,gBAAgB;MAChBvE,IAAI;MACJpD,QAAQ;MACRgH,uBAAuB,EAAE0E,oBAAoB,EAAE9G,MAAM,GAClDoC,uBAAuB,GACvB6B;IACJ,CAAC;EACF,CAAE,CAAC;EAEH,OAAOhI,MAAM;AACd,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS+K,yBAAyBA,CAAEb,MAAM,EAAG;EAC5C,MAAMc,yBAAyB,GAC9Bd,MAAM,CAAClJ,MAAM,EAAEwE,MAAM,GAAI,gBAAgB,CAAE,IAC3C0E,MAAM,CAAClJ,MAAM,EAAEwE,MAAM,GAAI,gBAAgB,CAAE,CAACjI,KAAK,EAAEoF,UAAU,IAC7D,CAAEuH,MAAM,CAAClJ,MAAM,EAAEwE,MAAM,GAAI,gBAAgB,CAAE,CAACjI,KAAK,EAAE0N,IAAI,IACzD,CAAEf,MAAM,CAAClJ,MAAM,EAAEwE,MAAM,GAAI,gBAAgB,CAAE,CAAC0F,MAAM,EAAE3N,KAAK;EAC5D,IAAKyN,yBAAyB,EAAG;IAChC,OAAO;MACN,GAAGd,MAAM;MACTlJ,MAAM,EAAE;QACP,GAAGkJ,MAAM,CAAClJ,MAAM;QAChBwE,MAAM,EAAE;UACP,GAAG0E,MAAM,CAAClJ,MAAM,CAACwE,MAAM;UACvB,gBAAgB,EAAE;YACjB,GAAG0E,MAAM,CAAClJ,MAAM,CAACwE,MAAM,CAAE,gBAAgB,CAAE;YAC3CjI,KAAK,EAAE;cACN,GAAG2M,MAAM,CAAClJ,MAAM,CAACwE,MAAM,CAAE,gBAAgB,CAAE,CAACjI,KAAK;cACjD0N,IAAI,EAAEf,MAAM,CAAClJ,MAAM,EAAEwE,MAAM,CAAE,gBAAgB,CAAE,CAC7CjI,KAAK,CAACoF;YACT;UACD;QACD;MACD;IACD,CAAC;EACF;EACA,OAAOuH,MAAM;AACd;AAEA,OAAO,SAASf,iBAAiBA,CAAElD,GAAG,EAAEtH,aAAa,EAAG;EACvD,IAAIwM,YAAY,GAAG,EAAE;EAErB,IAAK,CAAElF,GAAG,IAAIA,GAAG,CAACpF,IAAI,CAAC,CAAC,KAAK,EAAE,EAAG;IACjC,OAAOsK,YAAY;EACpB;;EAEA;EACA,MAAMC,KAAK,GAAGnF,GAAG,CAAChH,KAAK,CAAE,GAAI,CAAC;EAC9BmM,KAAK,CAAC/M,OAAO,CAAIgN,IAAI,IAAM;IAC1B,IAAK,CAAEA,IAAI,IAAIA,IAAI,CAACxK,IAAI,CAAC,CAAC,KAAK,EAAE,EAAG;MACnC;IACD;IAEA,MAAMyK,SAAS,GAAG,CAAED,IAAI,CAAC9G,QAAQ,CAAE,GAAI,CAAC;IACxC,IAAK+G,SAAS,EAAG;MAChB;MACAH,YAAY,IAAK,gBAAgBxM,aAAe,KAAK0M,IAAI,CAACxK,IAAI,CAAC,CAAG,GAAE;IACrE,CAAC,MAAM;MACN;MACA,MAAM0K,YAAY,GAAGF,IAAI,CAAChL,OAAO,CAAE,GAAG,EAAE,EAAG,CAAC,CAACpB,KAAK,CAAE,GAAI,CAAC;MACzD,IAAKsM,YAAY,CAACxH,MAAM,KAAK,CAAC,EAAG;QAChC;MACD;MAEA,MAAM,CAAEyH,cAAc,EAAEtH,QAAQ,CAAE,GAAGqH,YAAY;;MAEjD;MACA;MACA;MACA,MAAME,OAAO,GAAGD,cAAc,CAACE,KAAK,CAAE,wBAAyB,CAAC;MAChE,MAAMC,UAAU,GAAGF,OAAO,GAAGA,OAAO,CAAE,CAAC,CAAE,GAAG,EAAE;MAC9C,MAAMG,oBAAoB,GAAGH,OAAO,GACjCD,cAAc,CAACnL,OAAO,CAAEsL,UAAU,EAAE,EAAG,CAAC,CAAC9K,IAAI,CAAC,CAAC,GAC/C2K,cAAc,CAAC3K,IAAI,CAAC,CAAC;MAExB,IAAIsD,gBAAgB;MACpB,IAAKyH,oBAAoB,KAAK,EAAE,EAAG;QAClC;QACA;QACAzH,gBAAgB,GAAGxF,aAAa;MACjC,CAAC,MAAM;QACN;QACA;QACAwF,gBAAgB,GAAGqH,cAAc,CAAC9I,UAAU,CAAE,GAAI,CAAC,GAChDzG,aAAa,CAAE0C,aAAa,EAAEiN,oBAAqB,CAAC,GACpDzP,gBAAgB,CAAEwC,aAAa,EAAEiN,oBAAqB,CAAC;MAC3D;;MAEA;MACA;MACAT,YAAY,IAAK,gBAAgBhH,gBAAkB,IAAIwH,UAAY,IAAIzH,QAAQ,CAACrD,IAAI,CAAC,CAAG,GAAE;IAC3F;EACD,CAAE,CAAC;EACH,OAAOsK,YAAY;AACpB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASU,+BAA+BA,CAC9CC,YAAY,GAAG,CAAC,CAAC,EACjBhK,kBAAkB,EACjB;EACD,MAAM,CAAE6B,QAAQ,CAAE,GAAGlH,gBAAgB,CAAE,kBAAmB,CAAC;EAC3D,MAAM6G,kBAAkB,GAAGK,QAAQ,KAAK,IAAI;EAC5C,MAAMJ,qBAAqB,GAAG,CAAED,kBAAkB,CAAC,CAAC;EACpD,MAAMwE,mBAAmB,GAAGvM,SAAS,CAAIwQ,MAAM,IAAM;IACpD,MAAM;MAAEC;IAAY,CAAC,GAAGD,MAAM,CAAElP,gBAAiB,CAAC;IAClD,OAAO,CAAC,CAAEmP,WAAW,CAAC,CAAC,CAAClE,mBAAmB;EAC5C,CAAE,CAAC;EAEH,MAAM;IAAEyC;EAAe,CAAC,GAAGhP,SAAS,CAAED,WAAY,CAAC;EAEnD,OAAOG,OAAO,CAAE,MAAM;IAAA,IAAAwQ,qBAAA;IACrB,IAAK,CAAEH,YAAY,EAAE9K,MAAM,IAAI,CAAE8K,YAAY,EAAE5I,QAAQ,EAAG;MACzD,OAAO,EAAE;IACV;IACA,MAAMgJ,aAAa,GAAGnB,yBAAyB,CAAEe,YAAa,CAAC;IAE/D,MAAM3G,cAAc,GAAGkF,iBAAiB,CACvCjP,aAAa,CAAC,CAAC,EACfmP,cACD,CAAC;IAED,MAAM4B,gBAAgB,GAAGxE,kBAAkB,CAC1CuE,aAAa,EACb/G,cACD,CAAC;IAED,MAAMiH,YAAY,GAAGvE,QAAQ,CAC5BqE,aAAa,EACb/G,cAAc,EACd7B,kBAAkB,EAClBC,qBAAqB,EACrBuE,mBAAmB,EACnBhG,kBACD,CAAC;IACD,MAAMuK,IAAI,GAAGvC,YAAY,CAAEoC,aAAa,EAAE/G,cAAe,CAAC;IAE1D,MAAMnE,MAAM,GAAG,CACd;MACCiF,GAAG,EAAEkG,gBAAgB;MACrBG,cAAc,EAAE;IACjB,CAAC,EACD;MACCrG,GAAG,EAAEmG,YAAY;MACjBE,cAAc,EAAE;IACjB,CAAC;IACD;IACA;MACCrG,GAAG,GAAAgG,qBAAA,GAAEC,aAAa,CAAClL,MAAM,CAACiF,GAAG,cAAAgG,qBAAA,cAAAA,qBAAA,GAAI,EAAE;MACnCK,cAAc,EAAE;IACjB,CAAC,EACD;MACCC,MAAM,EAAEF,IAAI;MACZG,cAAc,EAAE,KAAK;MACrBF,cAAc,EAAE;IACjB,CAAC,CACD;;IAED;IACA;IACA;IACAlR,aAAa,CAAC,CAAC,CAACiD,OAAO,CAAI2L,SAAS,IAAM;MACzC,IAAKkC,aAAa,CAAClL,MAAM,CAACwE,MAAM,CAAEwE,SAAS,CAACzH,IAAI,CAAE,EAAE0D,GAAG,EAAG;QACzD,MAAM9G,QAAQ,GAAGgG,cAAc,CAAE6E,SAAS,CAACzH,IAAI,CAAE,CAACpD,QAAQ;QAC1D6B,MAAM,CAACxC,IAAI,CAAE;UACZyH,GAAG,EAAEkD,iBAAiB,CACrB+C,aAAa,CAAClL,MAAM,CAACwE,MAAM,CAAEwE,SAAS,CAACzH,IAAI,CAAE,EAAE0D,GAAG,EAClD9G,QACD,CAAC;UACDmN,cAAc,EAAE;QACjB,CAAE,CAAC;MACJ;IACD,CAAE,CAAC;IAEH,OAAO,CAAEtL,MAAM,EAAEkL,aAAa,CAAChJ,QAAQ,CAAE;EAC1C,CAAC,EAAE,CACFI,kBAAkB,EAClBC,qBAAqB,EACrBuI,YAAY,EACZhE,mBAAmB,EACnBhG,kBAAkB,EAClByI,cAAc,CACb,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASkC,qBAAqBA,CAAE3K,kBAAkB,GAAG,KAAK,EAAG;EACnE,MAAM;IAAE4K,MAAM,EAAEZ;EAAa,CAAC,GAAGtQ,UAAU,CAAEgB,mBAAoB,CAAC;EAClE,OAAOqP,+BAA+B,CAAEC,YAAY,EAAEhK,kBAAmB,CAAC;AAC3E","ignoreList":[]}