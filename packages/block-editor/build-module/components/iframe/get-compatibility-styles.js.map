{"version":3,"names":["compatibilityStyles","getCompatibilityStyles","Array","from","document","styleSheets","reduce","accumulator","styleSheet","cssRules","e","ownerNode","includes","id","matchFromRules","_cssRules","find","selectorText","conditionText","__cssRules","isInline","tagName","mainStylesCssId","replace","mainStylesElement","getElementById","push","cloneNode","inlineStylesCssId","inlineStylesElement"],"sources":["@wordpress/block-editor/src/components/iframe/get-compatibility-styles.js"],"sourcesContent":["let compatibilityStyles = null;\r\n\r\n/**\r\n * Returns a list of stylesheets that target the editor canvas. A stylesheet is\r\n * considered targetting the editor a canvas if it contains the\r\n * `editor-styles-wrapper`, `wp-block`, or `wp-block-*` class selectors.\r\n *\r\n * Ideally, this hook should be removed in the future and styles should be added\r\n * explicitly as editor styles.\r\n */\r\nexport function getCompatibilityStyles() {\r\n\tif ( compatibilityStyles ) {\r\n\t\treturn compatibilityStyles;\r\n\t}\r\n\r\n\t// Only memoize the result once on load, since these stylesheets should not\r\n\t// change.\r\n\tcompatibilityStyles = Array.from( document.styleSheets ).reduce(\r\n\t\t( accumulator, styleSheet ) => {\r\n\t\t\ttry {\r\n\t\t\t\t// May fail for external styles.\r\n\t\t\t\t// eslint-disable-next-line no-unused-expressions\r\n\t\t\t\tstyleSheet.cssRules;\r\n\t\t\t} catch ( e ) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\r\n\t\t\tconst { ownerNode, cssRules } = styleSheet;\r\n\r\n\t\t\t// Stylesheet is added by another stylesheet. See\r\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/StyleSheet/ownerNode#notes.\r\n\t\t\tif ( ownerNode === null ) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! cssRules ) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\r\n\t\t\t// Don't try to add the reset styles, which were removed as a dependency\r\n\t\t\t// from `edit-blocks` for the iframe since we don't need to reset admin\r\n\t\t\t// styles.\r\n\t\t\tif (\r\n\t\t\t\t[\r\n\t\t\t\t\t'wp-reset-editor-styles-css',\r\n\t\t\t\t\t'wp-reset-editor-styles-rtl-css',\r\n\t\t\t\t].includes( ownerNode.id )\r\n\t\t\t) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\r\n\t\t\t// Don't try to add styles without ID. Styles enqueued via the WP dependency system will always have IDs.\r\n\t\t\tif ( ! ownerNode.id ) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\r\n\t\t\tfunction matchFromRules( _cssRules ) {\r\n\t\t\t\treturn Array.from( _cssRules ).find(\r\n\t\t\t\t\t( {\r\n\t\t\t\t\t\tselectorText,\r\n\t\t\t\t\t\tconditionText,\r\n\t\t\t\t\t\tcssRules: __cssRules,\r\n\t\t\t\t\t} ) => {\r\n\t\t\t\t\t\t// If the rule is conditional then it will not have selector text.\r\n\t\t\t\t\t\t// Recurse into child CSS ruleset to determine selector eligibility.\r\n\t\t\t\t\t\tif ( conditionText ) {\r\n\t\t\t\t\t\t\treturn matchFromRules( __cssRules );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\tselectorText &&\r\n\t\t\t\t\t\t\t( selectorText.includes(\r\n\t\t\t\t\t\t\t\t'.editor-styles-wrapper'\r\n\t\t\t\t\t\t\t) ||\r\n\t\t\t\t\t\t\t\tselectorText.includes( '.wp-block' ) )\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif ( matchFromRules( cssRules ) ) {\r\n\t\t\t\tconst isInline = ownerNode.tagName === 'STYLE';\r\n\r\n\t\t\t\tif ( isInline ) {\r\n\t\t\t\t\t// If the current target is inline,\r\n\t\t\t\t\t// it could be a dependency of an existing stylesheet.\r\n\t\t\t\t\t// Look for that dependency and add it BEFORE the current target.\r\n\t\t\t\t\tconst mainStylesCssId = ownerNode.id.replace(\r\n\t\t\t\t\t\t'-inline-css',\r\n\t\t\t\t\t\t'-css'\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst mainStylesElement =\r\n\t\t\t\t\t\tdocument.getElementById( mainStylesCssId );\r\n\t\t\t\t\tif ( mainStylesElement ) {\r\n\t\t\t\t\t\taccumulator.push( mainStylesElement.cloneNode( true ) );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\taccumulator.push( ownerNode.cloneNode( true ) );\r\n\r\n\t\t\t\tif ( ! isInline ) {\r\n\t\t\t\t\t// If the current target is not inline,\r\n\t\t\t\t\t// we still look for inline styles that could be relevant for the current target.\r\n\t\t\t\t\t// If they exist, add them AFTER the current target.\r\n\t\t\t\t\tconst inlineStylesCssId = ownerNode.id.replace(\r\n\t\t\t\t\t\t'-css',\r\n\t\t\t\t\t\t'-inline-css'\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst inlineStylesElement =\r\n\t\t\t\t\t\tdocument.getElementById( inlineStylesCssId );\r\n\t\t\t\t\tif ( inlineStylesElement ) {\r\n\t\t\t\t\t\taccumulator.push(\r\n\t\t\t\t\t\t\tinlineStylesElement.cloneNode( true )\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn accumulator;\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\treturn compatibilityStyles;\r\n}\r\n"],"mappings":"AAAA,IAAIA,mBAAmB,GAAG,IAAI;;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,sBAAsBA,CAAA,EAAG;EACxC,IAAKD,mBAAmB,EAAG;IAC1B,OAAOA,mBAAmB;EAC3B;;EAEA;EACA;EACAA,mBAAmB,GAAGE,KAAK,CAACC,IAAI,CAAEC,QAAQ,CAACC,WAAY,CAAC,CAACC,MAAM,CAC9D,CAAEC,WAAW,EAAEC,UAAU,KAAM;IAC9B,IAAI;MACH;MACA;MACAA,UAAU,CAACC,QAAQ;IACpB,CAAC,CAAC,OAAQC,CAAC,EAAG;MACb,OAAOH,WAAW;IACnB;IAEA,MAAM;MAAEI,SAAS;MAAEF;IAAS,CAAC,GAAGD,UAAU;;IAE1C;IACA;IACA,IAAKG,SAAS,KAAK,IAAI,EAAG;MACzB,OAAOJ,WAAW;IACnB;IAEA,IAAK,CAAEE,QAAQ,EAAG;MACjB,OAAOF,WAAW;IACnB;;IAEA;IACA;IACA;IACA,IACC,CACC,4BAA4B,EAC5B,gCAAgC,CAChC,CAACK,QAAQ,CAAED,SAAS,CAACE,EAAG,CAAC,EACzB;MACD,OAAON,WAAW;IACnB;;IAEA;IACA,IAAK,CAAEI,SAAS,CAACE,EAAE,EAAG;MACrB,OAAON,WAAW;IACnB;IAEA,SAASO,cAAcA,CAAEC,SAAS,EAAG;MACpC,OAAOb,KAAK,CAACC,IAAI,CAAEY,SAAU,CAAC,CAACC,IAAI,CAClC,CAAE;QACDC,YAAY;QACZC,aAAa;QACbT,QAAQ,EAAEU;MACX,CAAC,KAAM;QACN;QACA;QACA,IAAKD,aAAa,EAAG;UACpB,OAAOJ,cAAc,CAAEK,UAAW,CAAC;QACpC;QAEA,OACCF,YAAY,KACVA,YAAY,CAACL,QAAQ,CACtB,wBACD,CAAC,IACAK,YAAY,CAACL,QAAQ,CAAE,WAAY,CAAC,CAAE;MAEzC,CACD,CAAC;IACF;IAEA,IAAKE,cAAc,CAAEL,QAAS,CAAC,EAAG;MACjC,MAAMW,QAAQ,GAAGT,SAAS,CAACU,OAAO,KAAK,OAAO;MAE9C,IAAKD,QAAQ,EAAG;QACf;QACA;QACA;QACA,MAAME,eAAe,GAAGX,SAAS,CAACE,EAAE,CAACU,OAAO,CAC3C,aAAa,EACb,MACD,CAAC;QACD,MAAMC,iBAAiB,GACtBpB,QAAQ,CAACqB,cAAc,CAAEH,eAAgB,CAAC;QAC3C,IAAKE,iBAAiB,EAAG;UACxBjB,WAAW,CAACmB,IAAI,CAAEF,iBAAiB,CAACG,SAAS,CAAE,IAAK,CAAE,CAAC;QACxD;MACD;MAEApB,WAAW,CAACmB,IAAI,CAAEf,SAAS,CAACgB,SAAS,CAAE,IAAK,CAAE,CAAC;MAE/C,IAAK,CAAEP,QAAQ,EAAG;QACjB;QACA;QACA;QACA,MAAMQ,iBAAiB,GAAGjB,SAAS,CAACE,EAAE,CAACU,OAAO,CAC7C,MAAM,EACN,aACD,CAAC;QACD,MAAMM,mBAAmB,GACxBzB,QAAQ,CAACqB,cAAc,CAAEG,iBAAkB,CAAC;QAC7C,IAAKC,mBAAmB,EAAG;UAC1BtB,WAAW,CAACmB,IAAI,CACfG,mBAAmB,CAACF,SAAS,CAAE,IAAK,CACrC,CAAC;QACF;MACD;IACD;IAEA,OAAOpB,WAAW;EACnB,CAAC,EACD,EACD,CAAC;EAED,OAAOP,mBAAmB;AAC3B","ignoreList":[]}