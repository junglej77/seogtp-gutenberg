{"version":3,"names":["apiFetch","useDispatch","useCallback","useMemo","useState","__","sprintf","store","noticesStore","__unstableStripHTML","stripHTML","useSaveImage","crop","rotation","url","id","onSaveImage","onFinishEditing","createErrorNotice","isInProgress","setIsInProgress","cancel","apply","modifiers","push","type","args","angle","width","height","left","x","top","y","path","method","data","src","then","response","source_url","catch","error","message","finally"],"sources":["@wordpress/block-editor/src/components/image-editor/use-save-image.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\n// Disable Reason: Needs to be refactored.\r\n// eslint-disable-next-line no-restricted-imports\r\nimport apiFetch from '@wordpress/api-fetch';\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { useCallback, useMemo, useState } from '@wordpress/element';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { __unstableStripHTML as stripHTML } from '@wordpress/dom';\r\n\r\nexport default function useSaveImage( {\r\n\tcrop,\r\n\trotation,\r\n\turl,\r\n\tid,\r\n\tonSaveImage,\r\n\tonFinishEditing,\r\n} ) {\r\n\tconst { createErrorNotice } = useDispatch( noticesStore );\r\n\tconst [ isInProgress, setIsInProgress ] = useState( false );\r\n\r\n\tconst cancel = useCallback( () => {\r\n\t\tsetIsInProgress( false );\r\n\t\tonFinishEditing();\r\n\t}, [ onFinishEditing ] );\r\n\r\n\tconst apply = useCallback( () => {\r\n\t\tsetIsInProgress( true );\r\n\r\n\t\tconst modifiers = [];\r\n\r\n\t\tif ( rotation > 0 ) {\r\n\t\t\tmodifiers.push( {\r\n\t\t\t\ttype: 'rotate',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tangle: rotation,\r\n\t\t\t\t},\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\t// The crop script may return some very small, sub-pixel values when the image was not cropped.\r\n\t\t// Crop only when the new size has changed by more than 0.1%.\r\n\t\tif ( crop.width < 99.9 || crop.height < 99.9 ) {\r\n\t\t\tmodifiers.push( {\r\n\t\t\t\ttype: 'crop',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tleft: crop.x,\r\n\t\t\t\t\ttop: crop.y,\r\n\t\t\t\t\twidth: crop.width,\r\n\t\t\t\t\theight: crop.height,\r\n\t\t\t\t},\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tapiFetch( {\r\n\t\t\tpath: `/wp/v2/media/${ id }/edit`,\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: { src: url, modifiers },\r\n\t\t} )\r\n\t\t\t.then( ( response ) => {\r\n\t\t\t\tonSaveImage( {\r\n\t\t\t\t\tid: response.id,\r\n\t\t\t\t\turl: response.source_url,\r\n\t\t\t\t} );\r\n\t\t\t} )\r\n\t\t\t.catch( ( error ) => {\r\n\t\t\t\tcreateErrorNotice(\r\n\t\t\t\t\tsprintf(\r\n\t\t\t\t\t\t/* translators: 1. Error message */\r\n\t\t\t\t\t\t__( 'Could not edit image. %s' ),\r\n\t\t\t\t\t\tstripHTML( error.message )\r\n\t\t\t\t\t),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: 'image-editing-error',\r\n\t\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} )\r\n\t\t\t.finally( () => {\r\n\t\t\t\tsetIsInProgress( false );\r\n\t\t\t\tonFinishEditing();\r\n\t\t\t} );\r\n\t}, [\r\n\t\tcrop,\r\n\t\trotation,\r\n\t\tid,\r\n\t\turl,\r\n\t\tonSaveImage,\r\n\t\tcreateErrorNotice,\r\n\t\tonFinishEditing,\r\n\t] );\r\n\r\n\treturn useMemo(\r\n\t\t() => ( {\r\n\t\t\tisInProgress,\r\n\t\t\tapply,\r\n\t\t\tcancel,\r\n\t\t} ),\r\n\t\t[ isInProgress, apply, cancel ]\r\n\t);\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAOA,QAAQ,MAAM,sBAAsB;AAC3C,SAASC,WAAW,QAAQ,iBAAiB;AAC7C,SAASC,WAAW,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,oBAAoB;AACnE,SAASC,EAAE,EAAEC,OAAO,QAAQ,iBAAiB;AAC7C,SAASC,KAAK,IAAIC,YAAY,QAAQ,oBAAoB;AAC1D,SAASC,mBAAmB,IAAIC,SAAS,QAAQ,gBAAgB;AAEjE,eAAe,SAASC,YAAYA,CAAE;EACrCC,IAAI;EACJC,QAAQ;EACRC,GAAG;EACHC,EAAE;EACFC,WAAW;EACXC;AACD,CAAC,EAAG;EACH,MAAM;IAAEC;EAAkB,CAAC,GAAGjB,WAAW,CAAEO,YAAa,CAAC;EACzD,MAAM,CAAEW,YAAY,EAAEC,eAAe,CAAE,GAAGhB,QAAQ,CAAE,KAAM,CAAC;EAE3D,MAAMiB,MAAM,GAAGnB,WAAW,CAAE,MAAM;IACjCkB,eAAe,CAAE,KAAM,CAAC;IACxBH,eAAe,CAAC,CAAC;EAClB,CAAC,EAAE,CAAEA,eAAe,CAAG,CAAC;EAExB,MAAMK,KAAK,GAAGpB,WAAW,CAAE,MAAM;IAChCkB,eAAe,CAAE,IAAK,CAAC;IAEvB,MAAMG,SAAS,GAAG,EAAE;IAEpB,IAAKV,QAAQ,GAAG,CAAC,EAAG;MACnBU,SAAS,CAACC,IAAI,CAAE;QACfC,IAAI,EAAE,QAAQ;QACdC,IAAI,EAAE;UACLC,KAAK,EAAEd;QACR;MACD,CAAE,CAAC;IACJ;;IAEA;IACA;IACA,IAAKD,IAAI,CAACgB,KAAK,GAAG,IAAI,IAAIhB,IAAI,CAACiB,MAAM,GAAG,IAAI,EAAG;MAC9CN,SAAS,CAACC,IAAI,CAAE;QACfC,IAAI,EAAE,MAAM;QACZC,IAAI,EAAE;UACLI,IAAI,EAAElB,IAAI,CAACmB,CAAC;UACZC,GAAG,EAAEpB,IAAI,CAACqB,CAAC;UACXL,KAAK,EAAEhB,IAAI,CAACgB,KAAK;UACjBC,MAAM,EAAEjB,IAAI,CAACiB;QACd;MACD,CAAE,CAAC;IACJ;IAEA7B,QAAQ,CAAE;MACTkC,IAAI,EAAG,gBAAgBnB,EAAI,OAAM;MACjCoB,MAAM,EAAE,MAAM;MACdC,IAAI,EAAE;QAAEC,GAAG,EAAEvB,GAAG;QAAES;MAAU;IAC7B,CAAE,CAAC,CACDe,IAAI,CAAIC,QAAQ,IAAM;MACtBvB,WAAW,CAAE;QACZD,EAAE,EAAEwB,QAAQ,CAACxB,EAAE;QACfD,GAAG,EAAEyB,QAAQ,CAACC;MACf,CAAE,CAAC;IACJ,CAAE,CAAC,CACFC,KAAK,CAAIC,KAAK,IAAM;MACpBxB,iBAAiB,CAChBZ,OAAO,EACN;MACAD,EAAE,CAAE,0BAA2B,CAAC,EAChCK,SAAS,CAAEgC,KAAK,CAACC,OAAQ,CAC1B,CAAC,EACD;QACC5B,EAAE,EAAE,qBAAqB;QACzBU,IAAI,EAAE;MACP,CACD,CAAC;IACF,CAAE,CAAC,CACFmB,OAAO,CAAE,MAAM;MACfxB,eAAe,CAAE,KAAM,CAAC;MACxBH,eAAe,CAAC,CAAC;IAClB,CAAE,CAAC;EACL,CAAC,EAAE,CACFL,IAAI,EACJC,QAAQ,EACRE,EAAE,EACFD,GAAG,EACHE,WAAW,EACXE,iBAAiB,EACjBD,eAAe,CACd,CAAC;EAEH,OAAOd,OAAO,CACb,OAAQ;IACPgB,YAAY;IACZG,KAAK;IACLD;EACD,CAAC,CAAE,EACH,CAAEF,YAAY,EAAEG,KAAK,EAAED,MAAM,CAC9B,CAAC;AACF","ignoreList":[]}