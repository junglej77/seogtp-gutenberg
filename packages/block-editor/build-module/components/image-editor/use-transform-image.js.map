{"version":3,"names":["useCallback","useMemo","useState","applyFilters","useTransformImage","url","naturalWidth","naturalHeight","editedUrl","setEditedUrl","crop","setCrop","position","setPosition","x","y","zoom","setZoom","rotation","setRotation","defaultAspect","aspect","setAspect","rotateClockwise","angle","naturalAspectRatio","prevPosition","editImage","event","canvas","document","createElement","translateX","translateY","width","target","height","context","getContext","translate","rotate","Math","PI","drawImage","toBlob","blob","URL","createObjectURL","el","window","Image","src","onload","imgCrossOrigin","undefined","crossOrigin"],"sources":["@wordpress/block-editor/src/components/image-editor/use-transform-image.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useCallback, useMemo, useState } from '@wordpress/element';\r\nimport { applyFilters } from '@wordpress/hooks';\r\n\r\nexport default function useTransformImage( {\r\n\turl,\r\n\tnaturalWidth,\r\n\tnaturalHeight,\r\n} ) {\r\n\tconst [ editedUrl, setEditedUrl ] = useState();\r\n\tconst [ crop, setCrop ] = useState();\r\n\tconst [ position, setPosition ] = useState( { x: 0, y: 0 } );\r\n\tconst [ zoom, setZoom ] = useState( 100 );\r\n\tconst [ rotation, setRotation ] = useState( 0 );\r\n\tconst defaultAspect = naturalWidth / naturalHeight;\r\n\tconst [ aspect, setAspect ] = useState( defaultAspect );\r\n\r\n\tconst rotateClockwise = useCallback( () => {\r\n\t\tconst angle = ( rotation + 90 ) % 360;\r\n\r\n\t\tlet naturalAspectRatio = defaultAspect;\r\n\r\n\t\tif ( rotation % 180 === 90 ) {\r\n\t\t\tnaturalAspectRatio = 1 / defaultAspect;\r\n\t\t}\r\n\r\n\t\tif ( angle === 0 ) {\r\n\t\t\tsetEditedUrl();\r\n\t\t\tsetRotation( angle );\r\n\t\t\tsetAspect( defaultAspect );\r\n\t\t\tsetPosition( ( prevPosition ) => ( {\r\n\t\t\t\tx: -( prevPosition.y * naturalAspectRatio ),\r\n\t\t\t\ty: prevPosition.x * naturalAspectRatio,\r\n\t\t\t} ) );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfunction editImage( event ) {\r\n\t\t\tconst canvas = document.createElement( 'canvas' );\r\n\r\n\t\t\tlet translateX = 0;\r\n\t\t\tlet translateY = 0;\r\n\r\n\t\t\tif ( angle % 180 ) {\r\n\t\t\t\tcanvas.width = event.target.height;\r\n\t\t\t\tcanvas.height = event.target.width;\r\n\t\t\t} else {\r\n\t\t\t\tcanvas.width = event.target.width;\r\n\t\t\t\tcanvas.height = event.target.height;\r\n\t\t\t}\r\n\r\n\t\t\tif ( angle === 90 || angle === 180 ) {\r\n\t\t\t\ttranslateX = canvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tif ( angle === 270 || angle === 180 ) {\r\n\t\t\t\ttranslateY = canvas.height;\r\n\t\t\t}\r\n\r\n\t\t\tconst context = canvas.getContext( '2d' );\r\n\r\n\t\t\tcontext.translate( translateX, translateY );\r\n\t\t\tcontext.rotate( ( angle * Math.PI ) / 180 );\r\n\t\t\tcontext.drawImage( event.target, 0, 0 );\r\n\r\n\t\t\tcanvas.toBlob( ( blob ) => {\r\n\t\t\t\tsetEditedUrl( URL.createObjectURL( blob ) );\r\n\t\t\t\tsetRotation( angle );\r\n\t\t\t\tsetAspect( canvas.width / canvas.height );\r\n\t\t\t\tsetPosition( ( prevPosition ) => ( {\r\n\t\t\t\t\tx: -( prevPosition.y * naturalAspectRatio ),\r\n\t\t\t\t\ty: prevPosition.x * naturalAspectRatio,\r\n\t\t\t\t} ) );\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tconst el = new window.Image();\r\n\t\tel.src = url;\r\n\t\tel.onload = editImage;\r\n\r\n\t\tconst imgCrossOrigin = applyFilters(\r\n\t\t\t'media.crossOrigin',\r\n\t\t\tundefined,\r\n\t\t\turl\r\n\t\t);\r\n\t\tif ( typeof imgCrossOrigin === 'string' ) {\r\n\t\t\tel.crossOrigin = imgCrossOrigin;\r\n\t\t}\r\n\t}, [ rotation, defaultAspect, url ] );\r\n\r\n\treturn useMemo(\r\n\t\t() => ( {\r\n\t\t\teditedUrl,\r\n\t\t\tsetEditedUrl,\r\n\t\t\tcrop,\r\n\t\t\tsetCrop,\r\n\t\t\tposition,\r\n\t\t\tsetPosition,\r\n\t\t\tzoom,\r\n\t\t\tsetZoom,\r\n\t\t\trotation,\r\n\t\t\tsetRotation,\r\n\t\t\trotateClockwise,\r\n\t\t\taspect,\r\n\t\t\tsetAspect,\r\n\t\t\tdefaultAspect,\r\n\t\t} ),\r\n\t\t[\r\n\t\t\teditedUrl,\r\n\t\t\tcrop,\r\n\t\t\tposition,\r\n\t\t\tzoom,\r\n\t\t\trotation,\r\n\t\t\trotateClockwise,\r\n\t\t\taspect,\r\n\t\t\tdefaultAspect,\r\n\t\t]\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}