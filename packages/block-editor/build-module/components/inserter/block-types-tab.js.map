{"version":3,"names":["__","_x","useMemo","useEffect","forwardRef","useAsyncList","BlockTypesList","InserterPanel","useBlockTypesState","InserterListbox","orderBy","InserterNoResults","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","getBlockNamespace","item","name","split","MAX_SUGGESTED_ITEMS","EMPTY_ARRAY","BlockTypesTabPanel","items","collections","categories","onSelectItem","onHover","showMostUsedBlocks","className","suggestedItems","slice","uncategorizedItems","filter","category","itemsPerCollection","result","Object","keys","forEach","namespace","length","currentlyRenderedCategories","didRenderAllCategories","collectionEntries","entries","currentlyRenderedCollections","children","title","onSelect","label","map","categoryItems","slug","icon","collection","collectionItems","BlockTypesTab","rootClientId","onInsert","ref","itemsForCurrentRoot","itemsRemaining","push"],"sources":["@wordpress/block-editor/src/components/inserter/block-types-tab.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, _x } from '@wordpress/i18n';\r\nimport { useMemo, useEffect, forwardRef } from '@wordpress/element';\r\nimport { useAsyncList } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport BlockTypesList from '../block-types-list';\r\nimport InserterPanel from './panel';\r\nimport useBlockTypesState from './hooks/use-block-types-state';\r\nimport InserterListbox from '../inserter-listbox';\r\nimport { orderBy } from '../../utils/sorting';\r\nimport InserterNoResults from './no-results';\r\n\r\nconst getBlockNamespace = ( item ) => item.name.split( '/' )[ 0 ];\r\n\r\nconst MAX_SUGGESTED_ITEMS = 6;\r\n\r\n/**\r\n * Shared reference to an empty array for cases where it is important to avoid\r\n * returning a new array reference on every invocation and rerendering the component.\r\n *\r\n * @type {Array}\r\n */\r\nconst EMPTY_ARRAY = [];\r\n\r\nexport function BlockTypesTabPanel( {\r\n\titems,\r\n\tcollections,\r\n\tcategories,\r\n\tonSelectItem,\r\n\tonHover,\r\n\tshowMostUsedBlocks,\r\n\tclassName,\r\n} ) {\r\n\tconst suggestedItems = useMemo( () => {\r\n\t\treturn orderBy( items, 'frecency', 'desc' ).slice(\r\n\t\t\t0,\r\n\t\t\tMAX_SUGGESTED_ITEMS\r\n\t\t);\r\n\t}, [ items ] );\r\n\r\n\tconst uncategorizedItems = useMemo( () => {\r\n\t\treturn items.filter( ( item ) => ! item.category );\r\n\t}, [ items ] );\r\n\r\n\tconst itemsPerCollection = useMemo( () => {\r\n\t\t// Create a new Object to avoid mutating collection.\r\n\t\tconst result = { ...collections };\r\n\t\tObject.keys( collections ).forEach( ( namespace ) => {\r\n\t\t\tresult[ namespace ] = items.filter(\r\n\t\t\t\t( item ) => getBlockNamespace( item ) === namespace\r\n\t\t\t);\r\n\t\t\tif ( result[ namespace ].length === 0 ) {\r\n\t\t\t\tdelete result[ namespace ];\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn result;\r\n\t}, [ items, collections ] );\r\n\r\n\t// Hide block preview on unmount.\r\n\tuseEffect( () => () => onHover( null ), [] );\r\n\r\n\t/**\r\n\t * The inserter contains a big number of blocks and opening it is a costful operation.\r\n\t * The rendering is the most costful part of it, in order to improve the responsiveness\r\n\t * of the \"opening\" action, these lazy lists allow us to render the inserter category per category,\r\n\t * once all the categories are rendered, we start rendering the collections and the uncategorized block types.\r\n\t */\r\n\tconst currentlyRenderedCategories = useAsyncList( categories );\r\n\tconst didRenderAllCategories =\r\n\t\tcategories.length === currentlyRenderedCategories.length;\r\n\r\n\t// Async List requires an array.\r\n\tconst collectionEntries = useMemo( () => {\r\n\t\treturn Object.entries( collections );\r\n\t}, [ collections ] );\r\n\tconst currentlyRenderedCollections = useAsyncList(\r\n\t\tdidRenderAllCategories ? collectionEntries : EMPTY_ARRAY\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div className={ className }>\r\n\t\t\t{ showMostUsedBlocks &&\r\n\t\t\t\t// Only show the most used blocks if the total amount of block\r\n\t\t\t\t// is larger than 1 row, otherwise it is not so useful.\r\n\t\t\t\titems.length > 3 &&\r\n\t\t\t\t!! suggestedItems.length && (\r\n\t\t\t\t\t<InserterPanel title={ _x( 'Most used', 'blocks' ) }>\r\n\t\t\t\t\t\t<BlockTypesList\r\n\t\t\t\t\t\t\titems={ suggestedItems }\r\n\t\t\t\t\t\t\tonSelect={ onSelectItem }\r\n\t\t\t\t\t\t\tonHover={ onHover }\r\n\t\t\t\t\t\t\tlabel={ _x( 'Most used', 'blocks' ) }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</InserterPanel>\r\n\t\t\t\t) }\r\n\r\n\t\t\t{ currentlyRenderedCategories.map( ( category ) => {\r\n\t\t\t\tconst categoryItems = items.filter(\r\n\t\t\t\t\t( item ) => item.category === category.slug\r\n\t\t\t\t);\r\n\t\t\t\tif ( ! categoryItems || ! categoryItems.length ) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<InserterPanel\r\n\t\t\t\t\t\tkey={ category.slug }\r\n\t\t\t\t\t\ttitle={ category.title }\r\n\t\t\t\t\t\ticon={ category.icon }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<BlockTypesList\r\n\t\t\t\t\t\t\titems={ categoryItems }\r\n\t\t\t\t\t\t\tonSelect={ onSelectItem }\r\n\t\t\t\t\t\t\tonHover={ onHover }\r\n\t\t\t\t\t\t\tlabel={ category.title }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</InserterPanel>\r\n\t\t\t\t);\r\n\t\t\t} ) }\r\n\r\n\t\t\t{ didRenderAllCategories && uncategorizedItems.length > 0 && (\r\n\t\t\t\t<InserterPanel\r\n\t\t\t\t\tclassName=\"block-editor-inserter__uncategorized-blocks-panel\"\r\n\t\t\t\t\ttitle={ __( 'Uncategorized' ) }\r\n\t\t\t\t>\r\n\t\t\t\t\t<BlockTypesList\r\n\t\t\t\t\t\titems={ uncategorizedItems }\r\n\t\t\t\t\t\tonSelect={ onSelectItem }\r\n\t\t\t\t\t\tonHover={ onHover }\r\n\t\t\t\t\t\tlabel={ __( 'Uncategorized' ) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</InserterPanel>\r\n\t\t\t) }\r\n\r\n\t\t\t{ currentlyRenderedCollections.map(\r\n\t\t\t\t( [ namespace, collection ] ) => {\r\n\t\t\t\t\tconst collectionItems = itemsPerCollection[ namespace ];\r\n\t\t\t\t\tif ( ! collectionItems || ! collectionItems.length ) {\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<InserterPanel\r\n\t\t\t\t\t\t\tkey={ namespace }\r\n\t\t\t\t\t\t\ttitle={ collection.title }\r\n\t\t\t\t\t\t\ticon={ collection.icon }\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<BlockTypesList\r\n\t\t\t\t\t\t\t\titems={ collectionItems }\r\n\t\t\t\t\t\t\t\tonSelect={ onSelectItem }\r\n\t\t\t\t\t\t\t\tonHover={ onHover }\r\n\t\t\t\t\t\t\t\tlabel={ collection.title }\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</InserterPanel>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t) }\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport function BlockTypesTab(\r\n\t{ rootClientId, onInsert, onHover, showMostUsedBlocks },\r\n\tref\r\n) {\r\n\tconst [ items, categories, collections, onSelectItem ] = useBlockTypesState(\r\n\t\trootClientId,\r\n\t\tonInsert\r\n\t);\r\n\r\n\tif ( ! items.length ) {\r\n\t\treturn <InserterNoResults />;\r\n\t}\r\n\r\n\tconst itemsForCurrentRoot = [];\r\n\tconst itemsRemaining = [];\r\n\r\n\tfor ( const item of items ) {\r\n\t\t// Skip reusable blocks, they moved to the patterns tab.\r\n\t\tif ( item.category === 'reusable' ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif ( rootClientId && item.rootClientId === rootClientId ) {\r\n\t\t\titemsForCurrentRoot.push( item );\r\n\t\t} else {\r\n\t\t\titemsRemaining.push( item );\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<InserterListbox>\r\n\t\t\t<div ref={ ref }>\r\n\t\t\t\t{ !! itemsForCurrentRoot.length && (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<BlockTypesTabPanel\r\n\t\t\t\t\t\t\titems={ itemsForCurrentRoot }\r\n\t\t\t\t\t\t\tcategories={ categories }\r\n\t\t\t\t\t\t\tcollections={ collections }\r\n\t\t\t\t\t\t\tonSelectItem={ onSelectItem }\r\n\t\t\t\t\t\t\tonHover={ onHover }\r\n\t\t\t\t\t\t\tshowMostUsedBlocks={ showMostUsedBlocks }\r\n\t\t\t\t\t\t\tclassName=\"block-editor-inserter__insertable-blocks-at-selection\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</>\r\n\t\t\t\t) }\r\n\t\t\t\t<BlockTypesTabPanel\r\n\t\t\t\t\titems={ itemsRemaining }\r\n\t\t\t\t\tcategories={ categories }\r\n\t\t\t\t\tcollections={ collections }\r\n\t\t\t\t\tonSelectItem={ onSelectItem }\r\n\t\t\t\t\tonHover={ onHover }\r\n\t\t\t\t\tshowMostUsedBlocks={ showMostUsedBlocks }\r\n\t\t\t\t\tclassName=\"block-editor-inserter__all-blocks\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</InserterListbox>\r\n\t);\r\n}\r\n\r\nexport default forwardRef( BlockTypesTab );\r\n"],"mappings":"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","ignoreList":[]}