{"version":3,"names":["useMemo","useEffect","__","_n","sprintf","VisuallyHidden","useDebounce","useAsyncList","speak","useSelect","BlockTypesList","BlockPatternsList","__unstableInserterMenuExtension","InserterPanel","InserterNoResults","useInsertionPoint","usePatternsState","useBlockTypesState","searchBlockItems","searchItems","InserterListbox","orderBy","orderInserterBlockItems","store","blockEditorStore","jsx","_jsx","jsxs","_jsxs","INITIAL_INSERTER_RESULTS","EMPTY_ARRAY","InserterSearchResults","filterValue","onSelect","onHover","onHoverPattern","rootClientId","clientId","isAppender","__experimentalInsertionIndex","maxBlockPatterns","maxBlockTypes","showBlockDirectory","isDraggable","shouldFocusBlock","prioritizePatterns","selectBlockOnInsert","isQuick","debouncedSpeak","prioritizedBlocks","select","blockListSettings","getBlockListSettings","prioritizedInserterBlocks","destinationRootClientId","onInsertBlocks","insertionIndex","blockTypes","blockTypeCategories","blockTypeCollections","onSelectBlockType","patterns","onClickPattern","filteredBlockPatterns","results","undefined","slice","maxBlockTypesToShow","length","filteredBlockTypes","nonPatternBlockTypes","filter","blockType","name","orderedItems","count","resultsFoundMessage","currentShownBlockTypes","step","currentShownPatterns","hasItems","blocksUI","title","children","items","label","patternsUI","className","shownPatterns","blockPatterns","Slot","fillProps","fills"],"sources":["@wordpress/block-editor/src/components/inserter/search-results.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useMemo, useEffect } from '@wordpress/element';\r\nimport { __, _n, sprintf } from '@wordpress/i18n';\r\nimport { VisuallyHidden } from '@wordpress/components';\r\nimport { useDebounce, useAsyncList } from '@wordpress/compose';\r\nimport { speak } from '@wordpress/a11y';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport BlockTypesList from '../block-types-list';\r\nimport BlockPatternsList from '../block-patterns-list';\r\nimport __unstableInserterMenuExtension from '../inserter-menu-extension';\r\nimport InserterPanel from './panel';\r\nimport InserterNoResults from './no-results';\r\nimport useInsertionPoint from './hooks/use-insertion-point';\r\nimport usePatternsState from './hooks/use-patterns-state';\r\nimport useBlockTypesState from './hooks/use-block-types-state';\r\nimport { searchBlockItems, searchItems } from './search-items';\r\nimport InserterListbox from '../inserter-listbox';\r\nimport { orderBy } from '../../utils/sorting';\r\nimport { orderInserterBlockItems } from '../../utils/order-inserter-block-items';\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\nconst INITIAL_INSERTER_RESULTS = 9;\r\n/**\r\n * Shared reference to an empty array for cases where it is important to avoid\r\n * returning a new array reference on every invocation and rerendering the component.\r\n *\r\n * @type {Array}\r\n */\r\nconst EMPTY_ARRAY = [];\r\n\r\nfunction InserterSearchResults( {\r\n\tfilterValue,\r\n\tonSelect,\r\n\tonHover,\r\n\tonHoverPattern,\r\n\trootClientId,\r\n\tclientId,\r\n\tisAppender,\r\n\t__experimentalInsertionIndex,\r\n\tmaxBlockPatterns,\r\n\tmaxBlockTypes,\r\n\tshowBlockDirectory = false,\r\n\tisDraggable = true,\r\n\tshouldFocusBlock = true,\r\n\tprioritizePatterns,\r\n\tselectBlockOnInsert,\r\n\tisQuick,\r\n} ) {\r\n\tconst debouncedSpeak = useDebounce( speak, 500 );\r\n\r\n\tconst { prioritizedBlocks } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst blockListSettings =\r\n\t\t\t\tselect( blockEditorStore ).getBlockListSettings( rootClientId );\r\n\r\n\t\t\treturn {\r\n\t\t\t\tprioritizedBlocks:\r\n\t\t\t\t\tblockListSettings?.prioritizedInserterBlocks || EMPTY_ARRAY,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ rootClientId ]\r\n\t);\r\n\r\n\tconst [ destinationRootClientId, onInsertBlocks ] = useInsertionPoint( {\r\n\t\tonSelect,\r\n\t\trootClientId,\r\n\t\tclientId,\r\n\t\tisAppender,\r\n\t\tinsertionIndex: __experimentalInsertionIndex,\r\n\t\tshouldFocusBlock,\r\n\t\tselectBlockOnInsert,\r\n\t} );\r\n\tconst [\r\n\t\tblockTypes,\r\n\t\tblockTypeCategories,\r\n\t\tblockTypeCollections,\r\n\t\tonSelectBlockType,\r\n\t] = useBlockTypesState( destinationRootClientId, onInsertBlocks, isQuick );\r\n\tconst [ patterns, , onClickPattern ] = usePatternsState(\r\n\t\tonInsertBlocks,\r\n\t\tdestinationRootClientId\r\n\t);\r\n\r\n\tconst filteredBlockPatterns = useMemo( () => {\r\n\t\tif ( maxBlockPatterns === 0 ) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\tconst results = searchItems( patterns, filterValue );\r\n\t\treturn maxBlockPatterns !== undefined\r\n\t\t\t? results.slice( 0, maxBlockPatterns )\r\n\t\t\t: results;\r\n\t}, [ filterValue, patterns, maxBlockPatterns ] );\r\n\r\n\tlet maxBlockTypesToShow = maxBlockTypes;\r\n\tif ( prioritizePatterns && filteredBlockPatterns.length > 2 ) {\r\n\t\tmaxBlockTypesToShow = 0;\r\n\t}\r\n\r\n\tconst filteredBlockTypes = useMemo( () => {\r\n\t\tif ( maxBlockTypesToShow === 0 ) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\tconst nonPatternBlockTypes = blockTypes.filter(\r\n\t\t\t( blockType ) => blockType.name !== 'core/block'\r\n\t\t);\r\n\t\tlet orderedItems = orderBy( nonPatternBlockTypes, 'frecency', 'desc' );\r\n\r\n\t\tif ( ! filterValue && prioritizedBlocks.length ) {\r\n\t\t\torderedItems = orderInserterBlockItems(\r\n\t\t\t\torderedItems,\r\n\t\t\t\tprioritizedBlocks\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst results = searchBlockItems(\r\n\t\t\torderedItems,\r\n\t\t\tblockTypeCategories,\r\n\t\t\tblockTypeCollections,\r\n\t\t\tfilterValue\r\n\t\t);\r\n\r\n\t\treturn maxBlockTypesToShow !== undefined\r\n\t\t\t? results.slice( 0, maxBlockTypesToShow )\r\n\t\t\t: results;\r\n\t}, [\r\n\t\tfilterValue,\r\n\t\tblockTypes,\r\n\t\tblockTypeCategories,\r\n\t\tblockTypeCollections,\r\n\t\tmaxBlockTypesToShow,\r\n\t\tprioritizedBlocks,\r\n\t] );\r\n\r\n\t// Announce search results on change.\r\n\tuseEffect( () => {\r\n\t\tif ( ! filterValue ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst count = filteredBlockTypes.length + filteredBlockPatterns.length;\r\n\t\tconst resultsFoundMessage = sprintf(\r\n\t\t\t/* translators: %d: number of results. */\r\n\t\t\t_n( '%d result found.', '%d results found.', count ),\r\n\t\t\tcount\r\n\t\t);\r\n\t\tdebouncedSpeak( resultsFoundMessage );\r\n\t}, [\r\n\t\tfilterValue,\r\n\t\tdebouncedSpeak,\r\n\t\tfilteredBlockTypes,\r\n\t\tfilteredBlockPatterns,\r\n\t] );\r\n\r\n\tconst currentShownBlockTypes = useAsyncList( filteredBlockTypes, {\r\n\t\tstep: INITIAL_INSERTER_RESULTS,\r\n\t} );\r\n\tconst currentShownPatterns = useAsyncList(\r\n\t\tcurrentShownBlockTypes.length === filteredBlockTypes.length\r\n\t\t\t? filteredBlockPatterns\r\n\t\t\t: EMPTY_ARRAY\r\n\t);\r\n\r\n\tconst hasItems =\r\n\t\tfilteredBlockTypes.length > 0 || filteredBlockPatterns.length > 0;\r\n\r\n\tconst blocksUI = !! filteredBlockTypes.length && (\r\n\t\t<InserterPanel\r\n\t\t\ttitle={ <VisuallyHidden>{ __( 'Blocks' ) }</VisuallyHidden> }\r\n\t\t>\r\n\t\t\t<BlockTypesList\r\n\t\t\t\titems={ currentShownBlockTypes }\r\n\t\t\t\tonSelect={ onSelectBlockType }\r\n\t\t\t\tonHover={ onHover }\r\n\t\t\t\tlabel={ __( 'Blocks' ) }\r\n\t\t\t\tisDraggable={ isDraggable }\r\n\t\t\t/>\r\n\t\t</InserterPanel>\r\n\t);\r\n\r\n\tconst patternsUI = !! filteredBlockPatterns.length && (\r\n\t\t<InserterPanel\r\n\t\t\ttitle={\r\n\t\t\t\t<VisuallyHidden>{ __( 'Block patterns' ) }</VisuallyHidden>\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t<div className=\"block-editor-inserter__quick-inserter-patterns\">\r\n\t\t\t\t<BlockPatternsList\r\n\t\t\t\t\tshownPatterns={ currentShownPatterns }\r\n\t\t\t\t\tblockPatterns={ filteredBlockPatterns }\r\n\t\t\t\t\tonClickPattern={ onClickPattern }\r\n\t\t\t\t\tonHover={ onHoverPattern }\r\n\t\t\t\t\tisDraggable={ isDraggable }\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</InserterPanel>\r\n\t);\r\n\r\n\treturn (\r\n\t\t<InserterListbox>\r\n\t\t\t{ ! showBlockDirectory && ! hasItems && <InserterNoResults /> }\r\n\r\n\t\t\t{ prioritizePatterns ? patternsUI : blocksUI }\r\n\r\n\t\t\t{ !! filteredBlockTypes.length &&\r\n\t\t\t\t!! filteredBlockPatterns.length && (\r\n\t\t\t\t\t<div className=\"block-editor-inserter__quick-inserter-separator\" />\r\n\t\t\t\t) }\r\n\r\n\t\t\t{ prioritizePatterns ? blocksUI : patternsUI }\r\n\r\n\t\t\t{ showBlockDirectory && (\r\n\t\t\t\t<__unstableInserterMenuExtension.Slot\r\n\t\t\t\t\tfillProps={ {\r\n\t\t\t\t\t\tonSelect: onSelectBlockType,\r\n\t\t\t\t\t\tonHover,\r\n\t\t\t\t\t\tfilterValue,\r\n\t\t\t\t\t\thasItems,\r\n\t\t\t\t\t\trootClientId: destinationRootClientId,\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ ( fills ) => {\r\n\t\t\t\t\t\tif ( fills.length ) {\r\n\t\t\t\t\t\t\treturn fills;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( ! hasItems ) {\r\n\t\t\t\t\t\t\treturn <InserterNoResults />;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t} }\r\n\t\t\t\t</__unstableInserterMenuExtension.Slot>\r\n\t\t\t) }\r\n\t\t</InserterListbox>\r\n\t);\r\n}\r\n\r\nexport default InserterSearchResults;\r\n"],"mappings":"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","ignoreList":[]}