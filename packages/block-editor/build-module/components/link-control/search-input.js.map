{"version":3,"names":["useInstanceId","forwardRef","useState","__","URLInput","LinkControlSearchResults","CREATE_TYPE","useSearchHandler","jsx","_jsx","jsxs","_jsxs","noopSearchHandler","Promise","resolve","noop","LinkControlSearchInput","value","children","currentLink","className","placeholder","withCreateSuggestion","onCreateSuggestion","onChange","onSelect","showSuggestions","renderSuggestions","props","fetchSuggestions","allowDirectEntry","showInitialSuggestions","suggestionsQuery","withURLSuggestion","createSuggestionButtonText","hideLabelFromVision","ref","genericSearchHandler","searchHandler","instanceId","focusedSuggestion","setFocusedSuggestion","onInputChange","selection","suggestion","handleRenderSuggestions","handleSuggestionClick","onSuggestionSelected","selectedSuggestion","type","title","url","e","Object","keys","length","id","restLinkProps","disableSuggestions","label","__experimentalRenderSuggestions","__experimentalFetchLinkSuggestions","__experimentalHandleURLSuggestions","__experimentalShowInitialSuggestions","onSubmit","event","hasSuggestion","trim","preventDefault"],"sources":["@wordpress/block-editor/src/components/link-control/search-input.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useInstanceId } from '@wordpress/compose';\r\nimport { forwardRef, useState } from '@wordpress/element';\r\nimport { __ } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { URLInput } from '../';\r\nimport LinkControlSearchResults from './search-results';\r\nimport { CREATE_TYPE } from './constants';\r\nimport useSearchHandler from './use-search-handler';\r\n\r\n// Must be a function as otherwise URLInput will default\r\n// to the fetchLinkSuggestions passed in block editor settings\r\n// which will cause an unintended http request.\r\nconst noopSearchHandler = () => Promise.resolve( [] );\r\n\r\nconst noop = () => {};\r\n\r\nconst LinkControlSearchInput = forwardRef(\r\n\t(\r\n\t\t{\r\n\t\t\tvalue,\r\n\t\t\tchildren,\r\n\t\t\tcurrentLink = {},\r\n\t\t\tclassName = null,\r\n\t\t\tplaceholder = null,\r\n\t\t\twithCreateSuggestion = false,\r\n\t\t\tonCreateSuggestion = noop,\r\n\t\t\tonChange = noop,\r\n\t\t\tonSelect = noop,\r\n\t\t\tshowSuggestions = true,\r\n\t\t\trenderSuggestions = ( props ) => (\r\n\t\t\t\t<LinkControlSearchResults { ...props } />\r\n\t\t\t),\r\n\t\t\tfetchSuggestions = null,\r\n\t\t\tallowDirectEntry = true,\r\n\t\t\tshowInitialSuggestions = false,\r\n\t\t\tsuggestionsQuery = {},\r\n\t\t\twithURLSuggestion = true,\r\n\t\t\tcreateSuggestionButtonText,\r\n\t\t\thideLabelFromVision = false,\r\n\t\t},\r\n\t\tref\r\n\t) => {\r\n\t\tconst genericSearchHandler = useSearchHandler(\r\n\t\t\tsuggestionsQuery,\r\n\t\t\tallowDirectEntry,\r\n\t\t\twithCreateSuggestion,\r\n\t\t\twithURLSuggestion\r\n\t\t);\r\n\r\n\t\tconst searchHandler = showSuggestions\r\n\t\t\t? fetchSuggestions || genericSearchHandler\r\n\t\t\t: noopSearchHandler;\r\n\r\n\t\tconst instanceId = useInstanceId( LinkControlSearchInput );\r\n\t\tconst [ focusedSuggestion, setFocusedSuggestion ] = useState();\r\n\r\n\t\t/**\r\n\t\t * Handles the user moving between different suggestions. Does not handle\r\n\t\t * choosing an individual item.\r\n\t\t *\r\n\t\t * @param {string} selection  the url of the selected suggestion.\r\n\t\t * @param {Object} suggestion the suggestion object.\r\n\t\t */\r\n\t\tconst onInputChange = ( selection, suggestion ) => {\r\n\t\t\tonChange( selection );\r\n\t\t\tsetFocusedSuggestion( suggestion );\r\n\t\t};\r\n\r\n\t\tconst handleRenderSuggestions = ( props ) =>\r\n\t\t\trenderSuggestions( {\r\n\t\t\t\t...props,\r\n\t\t\t\tinstanceId,\r\n\t\t\t\twithCreateSuggestion,\r\n\t\t\t\tcreateSuggestionButtonText,\r\n\t\t\t\tsuggestionsQuery,\r\n\t\t\t\thandleSuggestionClick: ( suggestion ) => {\r\n\t\t\t\t\tif ( props.handleSuggestionClick ) {\r\n\t\t\t\t\t\tprops.handleSuggestionClick( suggestion );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonSuggestionSelected( suggestion );\r\n\t\t\t\t},\r\n\t\t\t} );\r\n\r\n\t\tconst onSuggestionSelected = async ( selectedSuggestion ) => {\r\n\t\t\tlet suggestion = selectedSuggestion;\r\n\t\t\tif ( CREATE_TYPE === selectedSuggestion.type ) {\r\n\t\t\t\t// Create a new page and call onSelect with the output from the onCreateSuggestion callback.\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsuggestion = await onCreateSuggestion(\r\n\t\t\t\t\t\tselectedSuggestion.title\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif ( suggestion?.url ) {\r\n\t\t\t\t\t\tonSelect( suggestion );\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch ( e ) {}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tallowDirectEntry ||\r\n\t\t\t\t( suggestion && Object.keys( suggestion ).length >= 1 )\r\n\t\t\t) {\r\n\t\t\t\tconst { id, url, ...restLinkProps } = currentLink ?? {};\r\n\t\t\t\tonSelect(\r\n\t\t\t\t\t// Some direct entries don't have types or IDs, and we still need to clear the previous ones.\r\n\t\t\t\t\t{ ...restLinkProps, ...suggestion },\r\n\t\t\t\t\tsuggestion\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"block-editor-link-control__search-input-container\">\r\n\t\t\t\t<URLInput\r\n\t\t\t\t\tdisableSuggestions={ currentLink?.url === value }\r\n\t\t\t\t\tlabel={ __( 'Link' ) }\r\n\t\t\t\t\thideLabelFromVision={ hideLabelFromVision }\r\n\t\t\t\t\tclassName={ className }\r\n\t\t\t\t\tvalue={ value }\r\n\t\t\t\t\tonChange={ onInputChange }\r\n\t\t\t\t\tplaceholder={ placeholder ?? __( 'Search or type URL' ) }\r\n\t\t\t\t\t__experimentalRenderSuggestions={\r\n\t\t\t\t\t\tshowSuggestions ? handleRenderSuggestions : null\r\n\t\t\t\t\t}\r\n\t\t\t\t\t__experimentalFetchLinkSuggestions={ searchHandler }\r\n\t\t\t\t\t__experimentalHandleURLSuggestions\r\n\t\t\t\t\t__experimentalShowInitialSuggestions={\r\n\t\t\t\t\t\tshowInitialSuggestions\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonSubmit={ ( suggestion, event ) => {\r\n\t\t\t\t\t\tconst hasSuggestion = suggestion || focusedSuggestion;\r\n\r\n\t\t\t\t\t\t// If there is no suggestion and the value (ie: any manually entered URL) is empty\r\n\t\t\t\t\t\t// then don't allow submission otherwise we get empty links.\r\n\t\t\t\t\t\tif ( ! hasSuggestion && ! value?.trim()?.length ) {\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tonSuggestionSelected(\r\n\t\t\t\t\t\t\t\thasSuggestion || { url: value }\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} }\r\n\t\t\t\t\tref={ ref }\r\n\t\t\t\t/>\r\n\t\t\t\t{ children }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n);\r\n\r\nexport default LinkControlSearchInput;\r\n"],"mappings":"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","ignoreList":[]}