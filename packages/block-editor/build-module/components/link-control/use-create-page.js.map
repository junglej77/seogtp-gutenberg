{"version":3,"names":["__","useEffect","useState","useRef","useCreatePage","handleCreatePage","cancelableCreateSuggestion","isCreatingPage","setIsCreatingPage","errorMessage","setErrorMessage","createPage","suggestionTitle","current","makeCancelable","Promise","resolve","promise","error","isCanceled","message","cancel","hasCanceled_","wrappedPromise","reject","then","val"],"sources":["@wordpress/block-editor/src/components/link-control/use-create-page.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useEffect, useState, useRef } from '@wordpress/element';\r\n\r\nexport default function useCreatePage( handleCreatePage ) {\r\n\tconst cancelableCreateSuggestion = useRef();\r\n\tconst [ isCreatingPage, setIsCreatingPage ] = useState( false );\r\n\tconst [ errorMessage, setErrorMessage ] = useState( null );\r\n\r\n\tconst createPage = async function ( suggestionTitle ) {\r\n\t\tsetIsCreatingPage( true );\r\n\t\tsetErrorMessage( null );\r\n\r\n\t\ttry {\r\n\t\t\t// Make cancellable in order that we can avoid setting State\r\n\t\t\t// if the component unmounts during the call to `createSuggestion`\r\n\t\t\tcancelableCreateSuggestion.current = makeCancelable(\r\n\t\t\t\t// Using Promise.resolve to allow createSuggestion to return a\r\n\t\t\t\t// non-Promise based value.\r\n\t\t\t\tPromise.resolve( handleCreatePage( suggestionTitle ) )\r\n\t\t\t);\r\n\r\n\t\t\treturn await cancelableCreateSuggestion.current.promise;\r\n\t\t} catch ( error ) {\r\n\t\t\tif ( error && error.isCanceled ) {\r\n\t\t\t\treturn; // bail if canceled to avoid setting state\r\n\t\t\t}\r\n\r\n\t\t\tsetErrorMessage(\r\n\t\t\t\terror.message ||\r\n\t\t\t\t\t__(\r\n\t\t\t\t\t\t'An unknown error occurred during creation. Please try again.'\r\n\t\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tthrow error;\r\n\t\t} finally {\r\n\t\t\tsetIsCreatingPage( false );\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Handles cancelling any pending Promises that have been made cancelable.\r\n\t */\r\n\tuseEffect( () => {\r\n\t\treturn () => {\r\n\t\t\t// componentDidUnmount\r\n\t\t\tif ( cancelableCreateSuggestion.current ) {\r\n\t\t\t\tcancelableCreateSuggestion.current.cancel();\r\n\t\t\t}\r\n\t\t};\r\n\t}, [] );\r\n\r\n\treturn {\r\n\t\tcreatePage,\r\n\t\tisCreatingPage,\r\n\t\terrorMessage,\r\n\t};\r\n}\r\n\r\n/**\r\n * Creates a wrapper around a promise which allows it to be programmatically\r\n * cancelled.\r\n * See: https://reactjs.org/blog/2015/12/16/ismounted-antipattern.html\r\n *\r\n * @param {Promise} promise the Promise to make cancelable\r\n */\r\nconst makeCancelable = ( promise ) => {\r\n\tlet hasCanceled_ = false;\r\n\r\n\tconst wrappedPromise = new Promise( ( resolve, reject ) => {\r\n\t\tpromise.then(\r\n\t\t\t( val ) =>\r\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : resolve( val ),\r\n\t\t\t( error ) =>\r\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : reject( error )\r\n\t\t);\r\n\t} );\r\n\r\n\treturn {\r\n\t\tpromise: wrappedPromise,\r\n\t\tcancel() {\r\n\t\t\thasCanceled_ = true;\r\n\t\t},\r\n\t};\r\n};\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAE,QAAQ,iBAAiB;AACpC,SAASC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,QAAQ,oBAAoB;AAEhE,eAAe,SAASC,aAAaA,CAAEC,gBAAgB,EAAG;EACzD,MAAMC,0BAA0B,GAAGH,MAAM,CAAC,CAAC;EAC3C,MAAM,CAAEI,cAAc,EAAEC,iBAAiB,CAAE,GAAGN,QAAQ,CAAE,KAAM,CAAC;EAC/D,MAAM,CAAEO,YAAY,EAAEC,eAAe,CAAE,GAAGR,QAAQ,CAAE,IAAK,CAAC;EAE1D,MAAMS,UAAU,GAAG,eAAAA,CAAiBC,eAAe,EAAG;IACrDJ,iBAAiB,CAAE,IAAK,CAAC;IACzBE,eAAe,CAAE,IAAK,CAAC;IAEvB,IAAI;MACH;MACA;MACAJ,0BAA0B,CAACO,OAAO,GAAGC,cAAc;MAClD;MACA;MACAC,OAAO,CAACC,OAAO,CAAEX,gBAAgB,CAAEO,eAAgB,CAAE,CACtD,CAAC;MAED,OAAO,MAAMN,0BAA0B,CAACO,OAAO,CAACI,OAAO;IACxD,CAAC,CAAC,OAAQC,KAAK,EAAG;MACjB,IAAKA,KAAK,IAAIA,KAAK,CAACC,UAAU,EAAG;QAChC,OAAO,CAAC;MACT;MAEAT,eAAe,CACdQ,KAAK,CAACE,OAAO,IACZpB,EAAE,CACD,8DACD,CACF,CAAC;MACD,MAAMkB,KAAK;IACZ,CAAC,SAAS;MACTV,iBAAiB,CAAE,KAAM,CAAC;IAC3B;EACD,CAAC;;EAED;AACD;AACA;EACCP,SAAS,CAAE,MAAM;IAChB,OAAO,MAAM;MACZ;MACA,IAAKK,0BAA0B,CAACO,OAAO,EAAG;QACzCP,0BAA0B,CAACO,OAAO,CAACQ,MAAM,CAAC,CAAC;MAC5C;IACD,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,OAAO;IACNV,UAAU;IACVJ,cAAc;IACdE;EACD,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMK,cAAc,GAAKG,OAAO,IAAM;EACrC,IAAIK,YAAY,GAAG,KAAK;EAExB,MAAMC,cAAc,GAAG,IAAIR,OAAO,CAAE,CAAEC,OAAO,EAAEQ,MAAM,KAAM;IAC1DP,OAAO,CAACQ,IAAI,CACTC,GAAG,IACJJ,YAAY,GAAGE,MAAM,CAAE;MAAEL,UAAU,EAAE;IAAK,CAAE,CAAC,GAAGH,OAAO,CAAEU,GAAI,CAAC,EAC7DR,KAAK,IACNI,YAAY,GAAGE,MAAM,CAAE;MAAEL,UAAU,EAAE;IAAK,CAAE,CAAC,GAAGK,MAAM,CAAEN,KAAM,CAChE,CAAC;EACF,CAAE,CAAC;EAEH,OAAO;IACND,OAAO,EAAEM,cAAc;IACvBF,MAAMA,CAAA,EAAG;MACRC,YAAY,GAAG,IAAI;IACpB;EACD,CAAC;AACF,CAAC","ignoreList":[]}