{"version":3,"names":["store","blockEditorStore","useSelect","useEffect","useReducer","reducer","state","action","type","isFetching","richData","Error","useRemoteUrlData","url","dispatch","fetchRichUrlData","select","getSettings","__experimentalFetchRichUrlData","length","AbortController","controller","window","signal","then","urlData","catch","aborted","abort"],"sources":["@wordpress/block-editor/src/components/link-control/use-rich-url-data.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useEffect, useReducer } from '@wordpress/element';\r\n\r\nfunction reducer( state, action ) {\r\n\tswitch ( action.type ) {\r\n\t\tcase 'RESOLVED':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tisFetching: false,\r\n\t\t\t\trichData: action.richData,\r\n\t\t\t};\r\n\t\tcase 'ERROR':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tisFetching: false,\r\n\t\t\t\trichData: null,\r\n\t\t\t};\r\n\t\tcase 'LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tisFetching: true,\r\n\t\t\t};\r\n\t\tdefault:\r\n\t\t\tthrow new Error( `Unexpected action type ${ action.type }` );\r\n\t}\r\n}\r\n\r\nfunction useRemoteUrlData( url ) {\r\n\tconst [ state, dispatch ] = useReducer( reducer, {\r\n\t\trichData: null,\r\n\t\tisFetching: false,\r\n\t} );\r\n\r\n\tconst { fetchRichUrlData } = useSelect( ( select ) => {\r\n\t\tconst { getSettings } = select( blockEditorStore );\r\n\t\treturn {\r\n\t\t\tfetchRichUrlData: getSettings().__experimentalFetchRichUrlData,\r\n\t\t};\r\n\t}, [] );\r\n\r\n\tuseEffect( () => {\r\n\t\t// Only make the request if we have an actual URL\r\n\t\t// and the fetching util is available. In some editors\r\n\t\t// there may not be such a util.\r\n\t\tif (\r\n\t\t\turl?.length &&\r\n\t\t\tfetchRichUrlData &&\r\n\t\t\ttypeof AbortController !== 'undefined'\r\n\t\t) {\r\n\t\t\tdispatch( {\r\n\t\t\t\ttype: 'LOADING',\r\n\t\t\t} );\r\n\r\n\t\t\tconst controller = new window.AbortController();\r\n\r\n\t\t\tconst signal = controller.signal;\r\n\r\n\t\t\tfetchRichUrlData( url, {\r\n\t\t\t\tsignal,\r\n\t\t\t} )\r\n\t\t\t\t.then( ( urlData ) => {\r\n\t\t\t\t\tdispatch( {\r\n\t\t\t\t\t\ttype: 'RESOLVED',\r\n\t\t\t\t\t\trichData: urlData,\r\n\t\t\t\t\t} );\r\n\t\t\t\t} )\r\n\t\t\t\t.catch( () => {\r\n\t\t\t\t\t// Avoid setting state on unmounted component\r\n\t\t\t\t\tif ( ! signal.aborted ) {\r\n\t\t\t\t\t\tdispatch( {\r\n\t\t\t\t\t\t\ttype: 'ERROR',\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\t\t\t// Cleanup: when the URL changes the abort the current request.\r\n\t\t\treturn () => {\r\n\t\t\t\tcontroller.abort();\r\n\t\t\t};\r\n\t\t}\r\n\t}, [ url ] );\r\n\r\n\treturn state;\r\n}\r\n\r\nexport default useRemoteUrlData;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,KAAK,IAAIC,gBAAgB,QAAQ,aAAa;;AAEvD;AACA;AACA;AACA,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,SAAS,EAAEC,UAAU,QAAQ,oBAAoB;AAE1D,SAASC,OAAOA,CAAEC,KAAK,EAAEC,MAAM,EAAG;EACjC,QAASA,MAAM,CAACC,IAAI;IACnB,KAAK,UAAU;MACd,OAAO;QACN,GAAGF,KAAK;QACRG,UAAU,EAAE,KAAK;QACjBC,QAAQ,EAAEH,MAAM,CAACG;MAClB,CAAC;IACF,KAAK,OAAO;MACX,OAAO;QACN,GAAGJ,KAAK;QACRG,UAAU,EAAE,KAAK;QACjBC,QAAQ,EAAE;MACX,CAAC;IACF,KAAK,SAAS;MACb,OAAO;QACN,GAAGJ,KAAK;QACRG,UAAU,EAAE;MACb,CAAC;IACF;MACC,MAAM,IAAIE,KAAK,CAAG,0BAA0BJ,MAAM,CAACC,IAAM,EAAE,CAAC;EAC9D;AACD;AAEA,SAASI,gBAAgBA,CAAEC,GAAG,EAAG;EAChC,MAAM,CAAEP,KAAK,EAAEQ,QAAQ,CAAE,GAAGV,UAAU,CAAEC,OAAO,EAAE;IAChDK,QAAQ,EAAE,IAAI;IACdD,UAAU,EAAE;EACb,CAAE,CAAC;EAEH,MAAM;IAAEM;EAAiB,CAAC,GAAGb,SAAS,CAAIc,MAAM,IAAM;IACrD,MAAM;MAAEC;IAAY,CAAC,GAAGD,MAAM,CAAEf,gBAAiB,CAAC;IAClD,OAAO;MACNc,gBAAgB,EAAEE,WAAW,CAAC,CAAC,CAACC;IACjC,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEPf,SAAS,CAAE,MAAM;IAChB;IACA;IACA;IACA,IACCU,GAAG,EAAEM,MAAM,IACXJ,gBAAgB,IAChB,OAAOK,eAAe,KAAK,WAAW,EACrC;MACDN,QAAQ,CAAE;QACTN,IAAI,EAAE;MACP,CAAE,CAAC;MAEH,MAAMa,UAAU,GAAG,IAAIC,MAAM,CAACF,eAAe,CAAC,CAAC;MAE/C,MAAMG,MAAM,GAAGF,UAAU,CAACE,MAAM;MAEhCR,gBAAgB,CAAEF,GAAG,EAAE;QACtBU;MACD,CAAE,CAAC,CACDC,IAAI,CAAIC,OAAO,IAAM;QACrBX,QAAQ,CAAE;UACTN,IAAI,EAAE,UAAU;UAChBE,QAAQ,EAAEe;QACX,CAAE,CAAC;MACJ,CAAE,CAAC,CACFC,KAAK,CAAE,MAAM;QACb;QACA,IAAK,CAAEH,MAAM,CAACI,OAAO,EAAG;UACvBb,QAAQ,CAAE;YACTN,IAAI,EAAE;UACP,CAAE,CAAC;QACJ;MACD,CAAE,CAAC;MACJ;MACA,OAAO,MAAM;QACZa,UAAU,CAACO,KAAK,CAAC,CAAC;MACnB,CAAC;IACF;EACD,CAAC,EAAE,CAAEf,GAAG,CAAG,CAAC;EAEZ,OAAOP,KAAK;AACb;AAEA,eAAeM,gBAAgB","ignoreList":[]}