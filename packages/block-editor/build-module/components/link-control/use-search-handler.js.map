{"version":3,"names":["getProtocol","prependHTTP","useCallback","useSelect","isURLLike","CREATE_TYPE","TEL_TYPE","MAILTO_TYPE","INTERNAL_TYPE","URL_TYPE","store","blockEditorStore","handleNoop","Promise","resolve","handleDirectEntry","val","type","protocol","includes","startsWith","id","title","url","handleEntitySearch","suggestionsQuery","fetchSearchSuggestions","withCreateSuggestion","pageOnFront","pageForPosts","isInitialSuggestions","results","map","result","Number","isFrontPage","isBlogHome","concat","useSearchHandler","allowDirectEntry","select","getSettings","__experimentalFetchLinkSuggestions","directEntryHandler"],"sources":["@wordpress/block-editor/src/components/link-control/use-search-handler.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { getProtocol, prependHTTP } from '@wordpress/url';\r\nimport { useCallback } from '@wordpress/element';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport isURLLike from './is-url-like';\r\nimport {\r\n\tCREATE_TYPE,\r\n\tTEL_TYPE,\r\n\tMAILTO_TYPE,\r\n\tINTERNAL_TYPE,\r\n\tURL_TYPE,\r\n} from './constants';\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\nexport const handleNoop = () => Promise.resolve( [] );\r\n\r\nexport const handleDirectEntry = ( val ) => {\r\n\tlet type = URL_TYPE;\r\n\r\n\tconst protocol = getProtocol( val ) || '';\r\n\r\n\tif ( protocol.includes( 'mailto' ) ) {\r\n\t\ttype = MAILTO_TYPE;\r\n\t}\r\n\r\n\tif ( protocol.includes( 'tel' ) ) {\r\n\t\ttype = TEL_TYPE;\r\n\t}\r\n\r\n\tif ( val?.startsWith( '#' ) ) {\r\n\t\ttype = INTERNAL_TYPE;\r\n\t}\r\n\r\n\treturn Promise.resolve( [\r\n\t\t{\r\n\t\t\tid: val,\r\n\t\t\ttitle: val,\r\n\t\t\turl: type === 'URL' ? prependHTTP( val ) : val,\r\n\t\t\ttype,\r\n\t\t},\r\n\t] );\r\n};\r\n\r\nconst handleEntitySearch = async (\r\n\tval,\r\n\tsuggestionsQuery,\r\n\tfetchSearchSuggestions,\r\n\twithCreateSuggestion,\r\n\tpageOnFront,\r\n\tpageForPosts\r\n) => {\r\n\tconst { isInitialSuggestions } = suggestionsQuery;\r\n\r\n\tconst results = await fetchSearchSuggestions( val, suggestionsQuery );\r\n\r\n\t// Identify front page and update type to match.\r\n\tresults.map( ( result ) => {\r\n\t\tif ( Number( result.id ) === pageOnFront ) {\r\n\t\t\tresult.isFrontPage = true;\r\n\t\t\treturn result;\r\n\t\t} else if ( Number( result.id ) === pageForPosts ) {\r\n\t\t\tresult.isBlogHome = true;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t} );\r\n\r\n\t// If displaying initial suggestions just return plain results.\r\n\tif ( isInitialSuggestions ) {\r\n\t\treturn results;\r\n\t}\r\n\r\n\t// Here we append a faux suggestion to represent a \"CREATE\" option. This\r\n\t// is detected in the rendering of the search results and handled as a\r\n\t// special case. This is currently necessary because the suggestions\r\n\t// dropdown will only appear if there are valid suggestions and\r\n\t// therefore unless the create option is a suggestion it will not\r\n\t// display in scenarios where there are no results returned from the\r\n\t// API. In addition promoting CREATE to a first class suggestion affords\r\n\t// the a11y benefits afforded by `URLInput` to all suggestions (eg:\r\n\t// keyboard handling, ARIA roles...etc).\r\n\t//\r\n\t// Note also that the value of the `title` and `url` properties must correspond\r\n\t// to the text value of the `<input>`. This is because `title` is used\r\n\t// when creating the suggestion. Similarly `url` is used when using keyboard to select\r\n\t// the suggestion (the <form> `onSubmit` handler falls-back to `url`).\r\n\treturn isURLLike( val ) || ! withCreateSuggestion\r\n\t\t? results\r\n\t\t: results.concat( {\r\n\t\t\t\t// the `id` prop is intentionally ommitted here because it\r\n\t\t\t\t// is never exposed as part of the component's public API.\r\n\t\t\t\t// see: https://github.com/WordPress/gutenberg/pull/19775#discussion_r378931316.\r\n\t\t\t\ttitle: val, // Must match the existing `<input>`s text value.\r\n\t\t\t\turl: val, // Must match the existing `<input>`s text value.\r\n\t\t\t\ttype: CREATE_TYPE,\r\n\t\t  } );\r\n};\r\n\r\nexport default function useSearchHandler(\r\n\tsuggestionsQuery,\r\n\tallowDirectEntry,\r\n\twithCreateSuggestion\r\n) {\r\n\tconst { fetchSearchSuggestions, pageOnFront, pageForPosts } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getSettings } = select( blockEditorStore );\r\n\r\n\t\t\treturn {\r\n\t\t\t\tpageOnFront: getSettings().pageOnFront,\r\n\t\t\t\tpageForPosts: getSettings().pageForPosts,\r\n\t\t\t\tfetchSearchSuggestions:\r\n\t\t\t\t\tgetSettings().__experimentalFetchLinkSuggestions,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\tconst directEntryHandler = allowDirectEntry\r\n\t\t? handleDirectEntry\r\n\t\t: handleNoop;\r\n\r\n\treturn useCallback(\r\n\t\t( val, { isInitialSuggestions } ) => {\r\n\t\t\treturn isURLLike( val )\r\n\t\t\t\t? directEntryHandler( val, { isInitialSuggestions } )\r\n\t\t\t\t: handleEntitySearch(\r\n\t\t\t\t\t\tval,\r\n\t\t\t\t\t\t{ ...suggestionsQuery, isInitialSuggestions },\r\n\t\t\t\t\t\tfetchSearchSuggestions,\r\n\t\t\t\t\t\twithCreateSuggestion,\r\n\t\t\t\t\t\tpageOnFront,\r\n\t\t\t\t\t\tpageForPosts\r\n\t\t\t\t  );\r\n\t\t},\r\n\t\t[\r\n\t\t\tdirectEntryHandler,\r\n\t\t\tfetchSearchSuggestions,\r\n\t\t\tpageOnFront,\r\n\t\t\tpageForPosts,\r\n\t\t\tsuggestionsQuery,\r\n\t\t\twithCreateSuggestion,\r\n\t\t]\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}