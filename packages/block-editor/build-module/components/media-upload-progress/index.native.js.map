{"version":3,"names":["View","Component","Spinner","__","subscribeMediaUpload","requestImageUploadCancel","styles","MEDIA_UPLOAD_STATE_IDLE","MEDIA_UPLOAD_STATE_UPLOADING","MEDIA_UPLOAD_STATE_SUCCEEDED","MEDIA_UPLOAD_STATE_FAILED","MEDIA_UPLOAD_STATE_RESET","MEDIA_UPLOAD_STATE_PAUSED","jsx","_jsx","jsxs","_jsxs","MediaUploadProgress","constructor","props","state","uploadState","progress","isUploadInProgress","isUploadFailed","mediaUpload","bind","getRetryMessage","componentDidMount","addMediaUploadListener","componentWillUnmount","mediaId","removeMediaUploadListener","payload","mediaUrl","updateMediaThumbnail","updateMediaProgress","finishMediaUploadWithSuccess","finishMediaUploadWithPause","finishMediaUploadWithFailure","mediaUploadStateReset","setState","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","enablePausedUploads","onFinishMediaUploadWithFailure","onMediaUploadStateReset","subscriptionParentMediaUpload","remove","render","renderContent","showSpinner","retryMessage","progressBarStyle","progressBar","progressBarHidden","style","mediaUploadProgress","containerStyle","pointerEvents","children","spinnerStyle","testID","isUploadPaused"],"sources":["@wordpress/block-editor/src/components/media-upload-progress/index.native.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport { View } from 'react-native';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { Component } from '@wordpress/element';\r\nimport { Spinner } from '@wordpress/components';\r\nimport { __ } from '@wordpress/i18n';\r\nimport {\r\n\tsubscribeMediaUpload,\r\n\trequestImageUploadCancel,\r\n} from '@wordpress/react-native-bridge';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport styles from './styles.scss';\r\nimport {\r\n\tMEDIA_UPLOAD_STATE_IDLE,\r\n\tMEDIA_UPLOAD_STATE_UPLOADING,\r\n\tMEDIA_UPLOAD_STATE_SUCCEEDED,\r\n\tMEDIA_UPLOAD_STATE_FAILED,\r\n\tMEDIA_UPLOAD_STATE_RESET,\r\n\tMEDIA_UPLOAD_STATE_PAUSED,\r\n} from './constants';\r\n\r\nexport class MediaUploadProgress extends Component {\r\n\tconstructor( props ) {\r\n\t\tsuper( props );\r\n\r\n\t\tthis.state = {\r\n\t\t\tuploadState: MEDIA_UPLOAD_STATE_IDLE,\r\n\t\t\tprogress: 0,\r\n\t\t\tisUploadInProgress: false,\r\n\t\t\tisUploadFailed: false,\r\n\t\t};\r\n\r\n\t\tthis.mediaUpload = this.mediaUpload.bind( this );\r\n\t\tthis.getRetryMessage = this.getRetryMessage.bind( this );\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.addMediaUploadListener();\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tconst { isUploadInProgress, isUploadFailed } = this.state;\r\n\t\tconst { mediaId } = this.props;\r\n\r\n\t\tif ( isUploadInProgress || isUploadFailed ) {\r\n\t\t\trequestImageUploadCancel( mediaId );\r\n\t\t}\r\n\t\tthis.removeMediaUploadListener();\r\n\t}\r\n\r\n\tmediaUpload( payload ) {\r\n\t\tconst { mediaId } = this.props;\r\n\t\tif (\r\n\t\t\tpayload.mediaId !== mediaId ||\r\n\t\t\t( payload.state === this.state.uploadState &&\r\n\t\t\t\tpayload.progress === this.state.progress )\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( payload?.mediaUrl && ! payload.state ) {\r\n\t\t\tthis.updateMediaThumbnail( payload );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tswitch ( payload.state ) {\r\n\t\t\tcase MEDIA_UPLOAD_STATE_UPLOADING:\r\n\t\t\t\tthis.updateMediaProgress( payload );\r\n\t\t\t\tbreak;\r\n\t\t\tcase MEDIA_UPLOAD_STATE_SUCCEEDED:\r\n\t\t\t\tthis.finishMediaUploadWithSuccess( payload );\r\n\t\t\t\tbreak;\r\n\t\t\tcase MEDIA_UPLOAD_STATE_PAUSED:\r\n\t\t\t\tthis.finishMediaUploadWithPause( payload );\r\n\t\t\t\tbreak;\r\n\t\t\tcase MEDIA_UPLOAD_STATE_FAILED:\r\n\t\t\t\tthis.finishMediaUploadWithFailure( payload );\r\n\t\t\t\tbreak;\r\n\t\t\tcase MEDIA_UPLOAD_STATE_RESET:\r\n\t\t\t\tthis.mediaUploadStateReset( payload );\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateMediaProgress( payload ) {\r\n\t\tthis.setState( {\r\n\t\t\tprogress: payload.progress,\r\n\t\t\tuploadState: payload.state,\r\n\t\t\tisUploadInProgress: true,\r\n\t\t\tisUploadFailed: false,\r\n\t\t} );\r\n\t\tif ( this.props.onUpdateMediaProgress ) {\r\n\t\t\tthis.props.onUpdateMediaProgress( payload );\r\n\t\t}\r\n\t}\r\n\r\n\tupdateMediaThumbnail( payload ) {\r\n\t\tconst { onUpdateMediaProgress } = this.props;\r\n\t\tif ( onUpdateMediaProgress ) {\r\n\t\t\tonUpdateMediaProgress( payload );\r\n\t\t}\r\n\t}\r\n\r\n\tfinishMediaUploadWithSuccess( payload ) {\r\n\t\tthis.setState( {\r\n\t\t\tuploadState: payload.state,\r\n\t\t\tisUploadInProgress: false,\r\n\t\t} );\r\n\t\tif ( this.props.onFinishMediaUploadWithSuccess ) {\r\n\t\t\tthis.props.onFinishMediaUploadWithSuccess( payload );\r\n\t\t}\r\n\t}\r\n\r\n\tfinishMediaUploadWithPause( payload ) {\r\n\t\tif ( ! this.props.enablePausedUploads ) {\r\n\t\t\tthis.finishMediaUploadWithFailure( payload );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setState( {\r\n\t\t\tuploadState: payload.state,\r\n\t\t\tisUploadInProgress: true,\r\n\t\t\tisUploadFailed: false,\r\n\t\t} );\r\n\t\tif ( this.props.onFinishMediaUploadWithFailure ) {\r\n\t\t\tthis.props.onFinishMediaUploadWithFailure( payload );\r\n\t\t}\r\n\t}\r\n\r\n\tfinishMediaUploadWithFailure( payload ) {\r\n\t\tthis.setState( {\r\n\t\t\tuploadState: payload.state,\r\n\t\t\tisUploadInProgress: false,\r\n\t\t\tisUploadFailed: true,\r\n\t\t} );\r\n\t\tif ( this.props.onFinishMediaUploadWithFailure ) {\r\n\t\t\tthis.props.onFinishMediaUploadWithFailure( payload );\r\n\t\t}\r\n\t}\r\n\r\n\tmediaUploadStateReset( payload ) {\r\n\t\tthis.setState( {\r\n\t\t\tuploadState: payload.state,\r\n\t\t\tisUploadInProgress: false,\r\n\t\t\tisUploadFailed: false,\r\n\t\t} );\r\n\t\tif ( this.props.onMediaUploadStateReset ) {\r\n\t\t\tthis.props.onMediaUploadStateReset( payload );\r\n\t\t}\r\n\t}\r\n\r\n\taddMediaUploadListener() {\r\n\t\t// If we already have a subscription not worth doing it again.\r\n\t\tif ( this.subscriptionParentMediaUpload ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.subscriptionParentMediaUpload = subscribeMediaUpload(\r\n\t\t\t( payload ) => {\r\n\t\t\t\tthis.mediaUpload( payload );\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tremoveMediaUploadListener() {\r\n\t\tif ( this.subscriptionParentMediaUpload ) {\r\n\t\t\tthis.subscriptionParentMediaUpload.remove();\r\n\t\t}\r\n\t}\r\n\r\n\tgetRetryMessage() {\r\n\t\tif (\r\n\t\t\tthis.state.uploadState === MEDIA_UPLOAD_STATE_PAUSED &&\r\n\t\t\tthis.props.enablePausedUploads\r\n\t\t) {\r\n\t\t\treturn __( 'Waiting for connection' );\r\n\t\t}\r\n\r\n\t\t// eslint-disable-next-line @wordpress/i18n-no-collapsible-whitespace\r\n\t\treturn __( 'Failed to insert media.\\nTap for more info.' );\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { renderContent = () => null } = this.props;\r\n\t\tconst { isUploadInProgress, isUploadFailed, uploadState } = this.state;\r\n\t\tconst showSpinner = this.state.isUploadInProgress;\r\n\t\tconst progress = this.state.progress * 100;\r\n\t\tconst retryMessage = this.getRetryMessage();\r\n\r\n\t\tconst progressBarStyle = [\r\n\t\t\tstyles.progressBar,\r\n\t\t\tshowSpinner || styles.progressBarHidden,\r\n\t\t\tthis.props.progressBarStyle,\r\n\t\t];\r\n\r\n\t\treturn (\r\n\t\t\t<View\r\n\t\t\t\tstyle={ [\r\n\t\t\t\t\tstyles.mediaUploadProgress,\r\n\t\t\t\t\tthis.props.containerStyle,\r\n\t\t\t\t] }\r\n\t\t\t\tpointerEvents=\"box-none\"\r\n\t\t\t>\r\n\t\t\t\t<View style={ progressBarStyle }>\r\n\t\t\t\t\t{ showSpinner && (\r\n\t\t\t\t\t\t<Spinner\r\n\t\t\t\t\t\t\tprogress={ progress }\r\n\t\t\t\t\t\t\tstyle={ this.props.spinnerStyle }\r\n\t\t\t\t\t\t\ttestID=\"spinner\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</View>\r\n\t\t\t\t{ renderContent( {\r\n\t\t\t\t\tisUploadPaused:\r\n\t\t\t\t\t\tuploadState === MEDIA_UPLOAD_STATE_PAUSED &&\r\n\t\t\t\t\t\tthis.props.enablePausedUploads,\r\n\t\t\t\t\tisUploadInProgress,\r\n\t\t\t\t\tisUploadFailed,\r\n\t\t\t\t\tretryMessage,\r\n\t\t\t\t} ) }\r\n\t\t\t</View>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default MediaUploadProgress;\r\n"],"mappings":"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","ignoreList":[]}