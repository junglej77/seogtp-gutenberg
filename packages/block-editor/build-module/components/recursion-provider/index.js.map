{"version":3,"names":["createContext","useContext","useMemo","deprecated","useBlockEditContext","jsx","_jsx","RenderedRefsContext","addToBlockType","renderedBlocks","blockName","uniqueId","result","Set","add","RecursionProvider","children","previouslyRenderedBlocks","name","newRenderedBlocks","Provider","value","useHasRecursion","Boolean","has","DeprecatedExperimentalRecursionProvider","props","since","alternative","DeprecatedExperimentalUseHasRecursion","args"],"sources":["@wordpress/block-editor/src/components/recursion-provider/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createContext, useContext, useMemo } from '@wordpress/element';\r\nimport deprecated from '@wordpress/deprecated';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { useBlockEditContext } from '../block-edit/context';\r\n\r\nconst RenderedRefsContext = createContext( {} );\r\n\r\n/**\r\n * Immutably adds an unique identifier to a set scoped for a given block type.\r\n *\r\n * @param {Object} renderedBlocks Rendered blocks grouped by block name\r\n * @param {string} blockName      Name of the block.\r\n * @param {*}      uniqueId       Any value that acts as a unique identifier for a block instance.\r\n *\r\n * @return {Object} The list of rendered blocks grouped by block name.\r\n */\r\nfunction addToBlockType( renderedBlocks, blockName, uniqueId ) {\r\n\tconst result = {\r\n\t\t...renderedBlocks,\r\n\t\t[ blockName ]: renderedBlocks[ blockName ]\r\n\t\t\t? new Set( renderedBlocks[ blockName ] )\r\n\t\t\t: new Set(),\r\n\t};\r\n\tresult[ blockName ].add( uniqueId );\r\n\r\n\treturn result;\r\n}\r\n\r\n/**\r\n * A React context provider for use with the `useHasRecursion` hook to prevent recursive\r\n * renders.\r\n *\r\n * Wrap block content with this provider and provide the same `uniqueId` prop as used\r\n * with `useHasRecursion`.\r\n *\r\n * @param {Object}      props\r\n * @param {*}           props.uniqueId  Any value that acts as a unique identifier for a block instance.\r\n * @param {string}      props.blockName Optional block name.\r\n * @param {JSX.Element} props.children  React children.\r\n *\r\n * @return {JSX.Element} A React element.\r\n */\r\nexport function RecursionProvider( { children, uniqueId, blockName = '' } ) {\r\n\tconst previouslyRenderedBlocks = useContext( RenderedRefsContext );\r\n\tconst { name } = useBlockEditContext();\r\n\r\n\tblockName = blockName || name;\r\n\r\n\tconst newRenderedBlocks = useMemo(\r\n\t\t() => addToBlockType( previouslyRenderedBlocks, blockName, uniqueId ),\r\n\t\t[ previouslyRenderedBlocks, blockName, uniqueId ]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<RenderedRefsContext.Provider value={ newRenderedBlocks }>\r\n\t\t\t{ children }\r\n\t\t</RenderedRefsContext.Provider>\r\n\t);\r\n}\r\n\r\n/**\r\n * A React hook for keeping track of blocks previously rendered up in the block\r\n * tree. Blocks susceptible to recursion can use this hook in their `Edit`\r\n * function to prevent said recursion.\r\n *\r\n * Use this with the `RecursionProvider` component, using the same `uniqueId` value\r\n * for both the hook and the provider.\r\n *\r\n * @param {*}      uniqueId  Any value that acts as a unique identifier for a block instance.\r\n * @param {string} blockName Optional block name.\r\n *\r\n * @return {boolean} A boolean describing whether the provided id has already been rendered.\r\n */\r\nexport function useHasRecursion( uniqueId, blockName = '' ) {\r\n\tconst previouslyRenderedBlocks = useContext( RenderedRefsContext );\r\n\tconst { name } = useBlockEditContext();\r\n\tblockName = blockName || name;\r\n\treturn Boolean( previouslyRenderedBlocks[ blockName ]?.has( uniqueId ) );\r\n}\r\n\r\nexport const DeprecatedExperimentalRecursionProvider = ( props ) => {\r\n\tdeprecated( 'wp.blockEditor.__experimentalRecursionProvider', {\r\n\t\tsince: '6.5',\r\n\t\talternative: 'wp.blockEditor.RecursionProvider',\r\n\t} );\r\n\treturn <RecursionProvider { ...props } />;\r\n};\r\n\r\nexport const DeprecatedExperimentalUseHasRecursion = ( ...args ) => {\r\n\tdeprecated( 'wp.blockEditor.__experimentalUseHasRecursion', {\r\n\t\tsince: '6.5',\r\n\t\talternative: 'wp.blockEditor.useHasRecursion',\r\n\t} );\r\n\treturn useHasRecursion( ...args );\r\n};\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,aAAa,EAAEC,UAAU,EAAEC,OAAO,QAAQ,oBAAoB;AACvE,OAAOC,UAAU,MAAM,uBAAuB;;AAE9C;AACA;AACA;AACA,SAASC,mBAAmB,QAAQ,uBAAuB;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAE5D,MAAMC,mBAAmB,GAAGP,aAAa,CAAE,CAAC,CAAE,CAAC;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASQ,cAAcA,CAAEC,cAAc,EAAEC,SAAS,EAAEC,QAAQ,EAAG;EAC9D,MAAMC,MAAM,GAAG;IACd,GAAGH,cAAc;IACjB,CAAEC,SAAS,GAAID,cAAc,CAAEC,SAAS,CAAE,GACvC,IAAIG,GAAG,CAAEJ,cAAc,CAAEC,SAAS,CAAG,CAAC,GACtC,IAAIG,GAAG,CAAC;EACZ,CAAC;EACDD,MAAM,CAAEF,SAAS,CAAE,CAACI,GAAG,CAAEH,QAAS,CAAC;EAEnC,OAAOC,MAAM;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASG,iBAAiBA,CAAE;EAAEC,QAAQ;EAAEL,QAAQ;EAAED,SAAS,GAAG;AAAG,CAAC,EAAG;EAC3E,MAAMO,wBAAwB,GAAGhB,UAAU,CAAEM,mBAAoB,CAAC;EAClE,MAAM;IAAEW;EAAK,CAAC,GAAGd,mBAAmB,CAAC,CAAC;EAEtCM,SAAS,GAAGA,SAAS,IAAIQ,IAAI;EAE7B,MAAMC,iBAAiB,GAAGjB,OAAO,CAChC,MAAMM,cAAc,CAAES,wBAAwB,EAAEP,SAAS,EAAEC,QAAS,CAAC,EACrE,CAAEM,wBAAwB,EAAEP,SAAS,EAAEC,QAAQ,CAChD,CAAC;EAED,oBACCL,IAAA,CAACC,mBAAmB,CAACa,QAAQ;IAACC,KAAK,EAAGF,iBAAmB;IAAAH,QAAA,EACtDA;EAAQ,CACmB,CAAC;AAEjC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASM,eAAeA,CAAEX,QAAQ,EAAED,SAAS,GAAG,EAAE,EAAG;EAC3D,MAAMO,wBAAwB,GAAGhB,UAAU,CAAEM,mBAAoB,CAAC;EAClE,MAAM;IAAEW;EAAK,CAAC,GAAGd,mBAAmB,CAAC,CAAC;EACtCM,SAAS,GAAGA,SAAS,IAAIQ,IAAI;EAC7B,OAAOK,OAAO,CAAEN,wBAAwB,CAAEP,SAAS,CAAE,EAAEc,GAAG,CAAEb,QAAS,CAAE,CAAC;AACzE;AAEA,OAAO,MAAMc,uCAAuC,GAAKC,KAAK,IAAM;EACnEvB,UAAU,CAAE,gDAAgD,EAAE;IAC7DwB,KAAK,EAAE,KAAK;IACZC,WAAW,EAAE;EACd,CAAE,CAAC;EACH,oBAAOtB,IAAA,CAACS,iBAAiB;IAAA,GAAMW;EAAK,CAAI,CAAC;AAC1C,CAAC;AAED,OAAO,MAAMG,qCAAqC,GAAGA,CAAE,GAAGC,IAAI,KAAM;EACnE3B,UAAU,CAAE,8CAA8C,EAAE;IAC3DwB,KAAK,EAAE,KAAK;IACZC,WAAW,EAAE;EACd,CAAE,CAAC;EACH,OAAON,eAAe,CAAE,GAAGQ,IAAK,CAAC;AAClC,CAAC","ignoreList":[]}