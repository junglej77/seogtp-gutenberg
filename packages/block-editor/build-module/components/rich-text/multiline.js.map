{"version":3,"names":["forwardRef","deprecated","useDispatch","useSelect","ENTER","create","split","toHTMLString","RichTextWrapper","store","blockEditorStore","useBlockEditContext","getMultilineTag","jsx","_jsx","RichTextMultiline","children","identifier","tagName","TagName","value","onChange","multiline","props","forwardedRef","since","version","alternative","link","clientId","getSelectionStart","getSelectionEnd","selectionChange","multilineTagName","padded","values","shift","pop","_onChange","newValues","join","ref","map","_value","index","newValue","slice","isSelected","undefined","onKeyDown","event","keyCode","preventDefault","offset","start","end","richTextValue","html","array","v","splice","onMerge","forward","length"],"sources":["@wordpress/block-editor/src/components/rich-text/multiline.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { forwardRef } from '@wordpress/element';\r\nimport deprecated from '@wordpress/deprecated';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { ENTER } from '@wordpress/keycodes';\r\nimport { create, split, toHTMLString } from '@wordpress/rich-text';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { RichTextWrapper } from './';\r\nimport { store as blockEditorStore } from '../../store';\r\nimport { useBlockEditContext } from '../block-edit';\r\nimport { getMultilineTag } from './utils';\r\n\r\nfunction RichTextMultiline(\r\n\t{\r\n\t\tchildren,\r\n\t\tidentifier,\r\n\t\ttagName: TagName = 'div',\r\n\t\tvalue = '',\r\n\t\tonChange,\r\n\t\tmultiline,\r\n\t\t...props\r\n\t},\r\n\tforwardedRef\r\n) {\r\n\tdeprecated( 'wp.blockEditor.RichText multiline prop', {\r\n\t\tsince: '6.1',\r\n\t\tversion: '6.3',\r\n\t\talternative: 'nested blocks (InnerBlocks)',\r\n\t\tlink: 'https://developer.wordpress.org/block-editor/how-to-guides/block-tutorial/nested-blocks-inner-blocks/',\r\n\t} );\r\n\r\n\tconst { clientId } = useBlockEditContext();\r\n\tconst { getSelectionStart, getSelectionEnd } =\r\n\t\tuseSelect( blockEditorStore );\r\n\tconst { selectionChange } = useDispatch( blockEditorStore );\r\n\r\n\tconst multilineTagName = getMultilineTag( multiline );\r\n\tvalue = value || `<${ multilineTagName }></${ multilineTagName }>`;\r\n\tconst padded = `</${ multilineTagName }>${ value }<${ multilineTagName }>`;\r\n\tconst values = padded.split(\r\n\t\t`</${ multilineTagName }><${ multilineTagName }>`\r\n\t);\r\n\r\n\tvalues.shift();\r\n\tvalues.pop();\r\n\r\n\tfunction _onChange( newValues ) {\r\n\t\tonChange(\r\n\t\t\t`<${ multilineTagName }>${ newValues.join(\r\n\t\t\t\t`</${ multilineTagName }><${ multilineTagName }>`\r\n\t\t\t) }</${ multilineTagName }>`\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<TagName ref={ forwardedRef }>\r\n\t\t\t{ values.map( ( _value, index ) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<RichTextWrapper\r\n\t\t\t\t\t\tkey={ index }\r\n\t\t\t\t\t\tidentifier={ `${ identifier }-${ index }` }\r\n\t\t\t\t\t\ttagName={ multilineTagName }\r\n\t\t\t\t\t\tvalue={ _value }\r\n\t\t\t\t\t\tonChange={ ( newValue ) => {\r\n\t\t\t\t\t\t\tconst newValues = values.slice();\r\n\t\t\t\t\t\t\tnewValues[ index ] = newValue;\r\n\t\t\t\t\t\t\t_onChange( newValues );\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tisSelected={ undefined }\r\n\t\t\t\t\t\tonKeyDown={ ( event ) => {\r\n\t\t\t\t\t\t\tif ( event.keyCode !== ENTER ) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\t\t\t\tconst { offset: start } = getSelectionStart();\r\n\t\t\t\t\t\t\tconst { offset: end } = getSelectionEnd();\r\n\r\n\t\t\t\t\t\t\t// Cannot split if there is no selection.\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\ttypeof start !== 'number' ||\r\n\t\t\t\t\t\t\t\ttypeof end !== 'number'\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst richTextValue = create( { html: _value } );\r\n\t\t\t\t\t\t\trichTextValue.start = start;\r\n\t\t\t\t\t\t\trichTextValue.end = end;\r\n\r\n\t\t\t\t\t\t\tconst array = split( richTextValue ).map( ( v ) =>\r\n\t\t\t\t\t\t\t\ttoHTMLString( { value: v } )\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tconst newValues = values.slice();\r\n\t\t\t\t\t\t\tnewValues.splice( index, 1, ...array );\r\n\t\t\t\t\t\t\t_onChange( newValues );\r\n\t\t\t\t\t\t\tselectionChange(\r\n\t\t\t\t\t\t\t\tclientId,\r\n\t\t\t\t\t\t\t\t`${ identifier }-${ index + 1 }`,\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\t0\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tonMerge={ ( forward ) => {\r\n\t\t\t\t\t\t\tconst newValues = values.slice();\r\n\t\t\t\t\t\t\tlet offset = 0;\r\n\t\t\t\t\t\t\tif ( forward ) {\r\n\t\t\t\t\t\t\t\tif ( ! newValues[ index + 1 ] ) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tnewValues.splice(\r\n\t\t\t\t\t\t\t\t\tindex,\r\n\t\t\t\t\t\t\t\t\t2,\r\n\t\t\t\t\t\t\t\t\tnewValues[ index ] + newValues[ index + 1 ]\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\toffset = newValues[ index ].length - 1;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif ( ! newValues[ index - 1 ] ) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tnewValues.splice(\r\n\t\t\t\t\t\t\t\t\tindex - 1,\r\n\t\t\t\t\t\t\t\t\t2,\r\n\t\t\t\t\t\t\t\t\tnewValues[ index - 1 ] + newValues[ index ]\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\toffset = newValues[ index - 1 ].length - 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_onChange( newValues );\r\n\t\t\t\t\t\t\tselectionChange(\r\n\t\t\t\t\t\t\t\tclientId,\r\n\t\t\t\t\t\t\t\t`${ identifier }-${\r\n\t\t\t\t\t\t\t\t\tindex - ( forward ? 0 : 1 )\r\n\t\t\t\t\t\t\t\t}`,\r\n\t\t\t\t\t\t\t\toffset,\r\n\t\t\t\t\t\t\t\toffset\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t{ ...props }\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t} ) }\r\n\t\t</TagName>\r\n\t);\r\n}\r\n\r\nexport default forwardRef( RichTextMultiline );\r\n"],"mappings":"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","ignoreList":[]}