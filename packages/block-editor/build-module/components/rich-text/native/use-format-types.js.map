{"version":3,"names":["useMemo","useSelect","useDispatch","store","richTextStore","formatTypesSelector","select","getFormatTypes","interactiveContentTags","Set","useFormatTypes","clientId","identifier","withoutInteractiveFormatting","allowedFormats","allFormatTypes","formatTypes","filter","name","tagName","includes","has","keyedSelected","reduce","accumulator","type","__experimentalGetPropsForEditableTreePreparation","richTextIdentifier","blockClientId","dispatch","prepareHandlers","valueHandlers","changeHandlers","dependencies","forEach","__experimentalCreatePrepareEditableTree","selected","handler","__experimentalCreateOnChangeEditableValue","push","key","dispatchers","__experimentalGetPropsForEditableTreeChangeHandler"],"sources":["@wordpress/block-editor/src/components/rich-text/native/use-format-types.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useMemo } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { store as richTextStore } from '@wordpress/rich-text';\r\n\r\nfunction formatTypesSelector( select ) {\r\n\treturn select( richTextStore ).getFormatTypes();\r\n}\r\n\r\n/**\r\n * Set of all interactive content tags.\r\n *\r\n * @see https://html.spec.whatwg.org/multipage/dom.html#interactive-content\r\n */\r\nconst interactiveContentTags = new Set( [\r\n\t'a',\r\n\t'audio',\r\n\t'button',\r\n\t'details',\r\n\t'embed',\r\n\t'iframe',\r\n\t'input',\r\n\t'label',\r\n\t'select',\r\n\t'textarea',\r\n\t'video',\r\n] );\r\n\r\n/**\r\n * This hook provides RichText with the `formatTypes` and its derived props from\r\n * experimental format type settings.\r\n *\r\n * @param {Object}  $0                              Options\r\n * @param {string}  $0.clientId                     Block client ID.\r\n * @param {string}  $0.identifier                   Block attribute.\r\n * @param {boolean} $0.withoutInteractiveFormatting Whether to clean the interactive formattings or not.\r\n * @param {Array}   $0.allowedFormats               Allowed formats\r\n */\r\nexport function useFormatTypes( {\r\n\tclientId,\r\n\tidentifier,\r\n\twithoutInteractiveFormatting,\r\n\tallowedFormats,\r\n} ) {\r\n\tconst allFormatTypes = useSelect( formatTypesSelector, [] );\r\n\tconst formatTypes = useMemo( () => {\r\n\t\treturn allFormatTypes.filter( ( { name, tagName } ) => {\r\n\t\t\tif ( allowedFormats && ! allowedFormats.includes( name ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\twithoutInteractiveFormatting &&\r\n\t\t\t\tinteractiveContentTags.has( tagName )\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t} );\r\n\t}, [ allFormatTypes, allowedFormats, interactiveContentTags ] );\r\n\tconst keyedSelected = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tformatTypes.reduce( ( accumulator, type ) => {\r\n\t\t\t\tif ( type.__experimentalGetPropsForEditableTreePreparation ) {\r\n\t\t\t\t\taccumulator[ type.name ] =\r\n\t\t\t\t\t\ttype.__experimentalGetPropsForEditableTreePreparation(\r\n\t\t\t\t\t\t\tselect,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\trichTextIdentifier: identifier,\r\n\t\t\t\t\t\t\t\tblockClientId: clientId,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}, {} ),\r\n\t\t[ formatTypes, clientId, identifier ]\r\n\t);\r\n\tconst dispatch = useDispatch();\r\n\tconst prepareHandlers = [];\r\n\tconst valueHandlers = [];\r\n\tconst changeHandlers = [];\r\n\tconst dependencies = [];\r\n\r\n\tformatTypes.forEach( ( type ) => {\r\n\t\tif ( type.__experimentalCreatePrepareEditableTree ) {\r\n\t\t\tconst selected = keyedSelected[ type.name ];\r\n\t\t\tconst handler = type.__experimentalCreatePrepareEditableTree(\r\n\t\t\t\tselected,\r\n\t\t\t\t{\r\n\t\t\t\t\trichTextIdentifier: identifier,\r\n\t\t\t\t\tblockClientId: clientId,\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tif ( type.__experimentalCreateOnChangeEditableValue ) {\r\n\t\t\t\tvalueHandlers.push( handler );\r\n\t\t\t} else {\r\n\t\t\t\tprepareHandlers.push( handler );\r\n\t\t\t}\r\n\r\n\t\t\tfor ( const key in selected ) {\r\n\t\t\t\tdependencies.push( selected[ key ] );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( type.__experimentalCreateOnChangeEditableValue ) {\r\n\t\t\tlet dispatchers = {};\r\n\r\n\t\t\tif ( type.__experimentalGetPropsForEditableTreeChangeHandler ) {\r\n\t\t\t\tdispatchers =\r\n\t\t\t\t\ttype.__experimentalGetPropsForEditableTreeChangeHandler(\r\n\t\t\t\t\t\tdispatch,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\trichTextIdentifier: identifier,\r\n\t\t\t\t\t\t\tblockClientId: clientId,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tchangeHandlers.push(\r\n\t\t\t\ttype.__experimentalCreateOnChangeEditableValue(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t...( keyedSelected[ type.name ] || {} ),\r\n\t\t\t\t\t\t...dispatchers,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trichTextIdentifier: identifier,\r\n\t\t\t\t\t\tblockClientId: clientId,\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t} );\r\n\r\n\treturn {\r\n\t\tformatTypes,\r\n\t\tprepareHandlers,\r\n\t\tvalueHandlers,\r\n\t\tchangeHandlers,\r\n\t\tdependencies,\r\n\t};\r\n}\r\n"],"mappings":"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","ignoreList":[]}