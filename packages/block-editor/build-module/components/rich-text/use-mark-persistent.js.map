{"version":3,"names":["useLayoutEffect","useRef","useDispatch","store","blockEditorStore","useMarkPersistent","html","value","previousTextRef","hasActiveFormats","activeFormats","length","__unstableMarkLastChangeAsPersistent","current","text","timeout","window","setTimeout","clearTimeout"],"sources":["@wordpress/block-editor/src/components/rich-text/use-mark-persistent.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useLayoutEffect, useRef } from '@wordpress/element';\r\nimport { useDispatch } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\nexport function useMarkPersistent( { html, value } ) {\r\n\tconst previousTextRef = useRef();\r\n\tconst hasActiveFormats = !! value.activeFormats?.length;\r\n\tconst { __unstableMarkLastChangeAsPersistent } =\r\n\t\tuseDispatch( blockEditorStore );\r\n\r\n\t// Must be set synchronously to make sure it applies to the last change.\r\n\tuseLayoutEffect( () => {\r\n\t\t// Ignore mount.\r\n\t\tif ( ! previousTextRef.current ) {\r\n\t\t\tpreviousTextRef.current = value.text;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Text input, so don't create an undo level for every character.\r\n\t\t// Create an undo level after 1 second of no input.\r\n\t\tif ( previousTextRef.current !== value.text ) {\r\n\t\t\tconst timeout = window.setTimeout( () => {\r\n\t\t\t\t__unstableMarkLastChangeAsPersistent();\r\n\t\t\t}, 1000 );\r\n\t\t\tpreviousTextRef.current = value.text;\r\n\t\t\treturn () => {\r\n\t\t\t\twindow.clearTimeout( timeout );\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t__unstableMarkLastChangeAsPersistent();\r\n\t}, [ html, hasActiveFormats ] );\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,eAAe,EAAEC,MAAM,QAAQ,oBAAoB;AAC5D,SAASC,WAAW,QAAQ,iBAAiB;;AAE7C;AACA;AACA;AACA,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,aAAa;AAEvD,OAAO,SAASC,iBAAiBA,CAAE;EAAEC,IAAI;EAAEC;AAAM,CAAC,EAAG;EACpD,MAAMC,eAAe,GAAGP,MAAM,CAAC,CAAC;EAChC,MAAMQ,gBAAgB,GAAG,CAAC,CAAEF,KAAK,CAACG,aAAa,EAAEC,MAAM;EACvD,MAAM;IAAEC;EAAqC,CAAC,GAC7CV,WAAW,CAAEE,gBAAiB,CAAC;;EAEhC;EACAJ,eAAe,CAAE,MAAM;IACtB;IACA,IAAK,CAAEQ,eAAe,CAACK,OAAO,EAAG;MAChCL,eAAe,CAACK,OAAO,GAAGN,KAAK,CAACO,IAAI;MACpC;IACD;;IAEA;IACA;IACA,IAAKN,eAAe,CAACK,OAAO,KAAKN,KAAK,CAACO,IAAI,EAAG;MAC7C,MAAMC,OAAO,GAAGC,MAAM,CAACC,UAAU,CAAE,MAAM;QACxCL,oCAAoC,CAAC,CAAC;MACvC,CAAC,EAAE,IAAK,CAAC;MACTJ,eAAe,CAACK,OAAO,GAAGN,KAAK,CAACO,IAAI;MACpC,OAAO,MAAM;QACZE,MAAM,CAACE,YAAY,CAAEH,OAAQ,CAAC;MAC/B,CAAC;IACF;IAEAH,oCAAoC,CAAC,CAAC;EACvC,CAAC,EAAE,CAAEN,IAAI,EAAEG,gBAAgB,CAAG,CAAC;AAChC","ignoreList":[]}