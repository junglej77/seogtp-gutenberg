{"version":3,"names":["useRefEffect","useSelect","store","blockEditorStore","selector","select","isMultiSelecting","getMultiSelectedBlockClientIds","hasMultiSelection","getSelectedBlockClientId","getSelectedBlocksInitialCaretPosition","__unstableIsFullySelected","multiSelectedBlockClientIds","selectedBlockClientId","initialPosition","isFullSelection","useMultiSelection","node","ownerDocument","defaultView","undefined","length","contentEditable","focus","getSelection","removeAllRanges"],"sources":["@wordpress/block-editor/src/components/writing-flow/use-multi-selection.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useRefEffect } from '@wordpress/compose';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../../store';\r\n\r\nfunction selector( select ) {\r\n\tconst {\r\n\t\tisMultiSelecting,\r\n\t\tgetMultiSelectedBlockClientIds,\r\n\t\thasMultiSelection,\r\n\t\tgetSelectedBlockClientId,\r\n\t\tgetSelectedBlocksInitialCaretPosition,\r\n\t\t__unstableIsFullySelected,\r\n\t} = select( blockEditorStore );\r\n\r\n\treturn {\r\n\t\tisMultiSelecting: isMultiSelecting(),\r\n\t\tmultiSelectedBlockClientIds: getMultiSelectedBlockClientIds(),\r\n\t\thasMultiSelection: hasMultiSelection(),\r\n\t\tselectedBlockClientId: getSelectedBlockClientId(),\r\n\t\tinitialPosition: getSelectedBlocksInitialCaretPosition(),\r\n\t\tisFullSelection: __unstableIsFullySelected(),\r\n\t};\r\n}\r\n\r\nexport default function useMultiSelection() {\r\n\tconst {\r\n\t\tinitialPosition,\r\n\t\tisMultiSelecting,\r\n\t\tmultiSelectedBlockClientIds,\r\n\t\thasMultiSelection,\r\n\t\tselectedBlockClientId,\r\n\t\tisFullSelection,\r\n\t} = useSelect( selector, [] );\r\n\r\n\t/**\r\n\t * When the component updates, and there is multi selection, we need to\r\n\t * select the entire block contents.\r\n\t */\r\n\treturn useRefEffect(\r\n\t\t( node ) => {\r\n\t\t\tconst { ownerDocument } = node;\r\n\t\t\tconst { defaultView } = ownerDocument;\r\n\r\n\t\t\t// Allow initialPosition to bypass focus behavior. This is useful\r\n\t\t\t// for the list view or other areas where we don't want to transfer\r\n\t\t\t// focus to the editor canvas.\r\n\t\t\tif ( initialPosition === undefined || initialPosition === null ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! hasMultiSelection || isMultiSelecting ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst { length } = multiSelectedBlockClientIds;\r\n\r\n\t\t\tif ( length < 2 ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! isFullSelection ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Allow cross contentEditable selection by temporarily making\r\n\t\t\t// all content editable. We can't rely on using the store and\r\n\t\t\t// React because re-rending happens too slowly. We need to be\r\n\t\t\t// able to select across instances immediately.\r\n\t\t\tnode.contentEditable = true;\r\n\r\n\t\t\t// For some browsers, like Safari, it is important that focus\r\n\t\t\t// happens BEFORE selection removal.\r\n\t\t\tnode.focus();\r\n\r\n\t\t\tdefaultView.getSelection().removeAllRanges();\r\n\t\t},\r\n\t\t[\r\n\t\t\thasMultiSelection,\r\n\t\t\tisMultiSelecting,\r\n\t\t\tmultiSelectedBlockClientIds,\r\n\t\t\tselectedBlockClientId,\r\n\t\t\tinitialPosition,\r\n\t\t\tisFullSelection,\r\n\t\t]\r\n\t);\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,YAAY,QAAQ,oBAAoB;AACjD,SAASC,SAAS,QAAQ,iBAAiB;;AAE3C;AACA;AACA;AACA,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,aAAa;AAEvD,SAASC,QAAQA,CAAEC,MAAM,EAAG;EAC3B,MAAM;IACLC,gBAAgB;IAChBC,8BAA8B;IAC9BC,iBAAiB;IACjBC,wBAAwB;IACxBC,qCAAqC;IACrCC;EACD,CAAC,GAAGN,MAAM,CAAEF,gBAAiB,CAAC;EAE9B,OAAO;IACNG,gBAAgB,EAAEA,gBAAgB,CAAC,CAAC;IACpCM,2BAA2B,EAAEL,8BAA8B,CAAC,CAAC;IAC7DC,iBAAiB,EAAEA,iBAAiB,CAAC,CAAC;IACtCK,qBAAqB,EAAEJ,wBAAwB,CAAC,CAAC;IACjDK,eAAe,EAAEJ,qCAAqC,CAAC,CAAC;IACxDK,eAAe,EAAEJ,yBAAyB,CAAC;EAC5C,CAAC;AACF;AAEA,eAAe,SAASK,iBAAiBA,CAAA,EAAG;EAC3C,MAAM;IACLF,eAAe;IACfR,gBAAgB;IAChBM,2BAA2B;IAC3BJ,iBAAiB;IACjBK,qBAAqB;IACrBE;EACD,CAAC,GAAGd,SAAS,CAAEG,QAAQ,EAAE,EAAG,CAAC;;EAE7B;AACD;AACA;AACA;EACC,OAAOJ,YAAY,CAChBiB,IAAI,IAAM;IACX,MAAM;MAAEC;IAAc,CAAC,GAAGD,IAAI;IAC9B,MAAM;MAAEE;IAAY,CAAC,GAAGD,aAAa;;IAErC;IACA;IACA;IACA,IAAKJ,eAAe,KAAKM,SAAS,IAAIN,eAAe,KAAK,IAAI,EAAG;MAChE;IACD;IAEA,IAAK,CAAEN,iBAAiB,IAAIF,gBAAgB,EAAG;MAC9C;IACD;IAEA,MAAM;MAAEe;IAAO,CAAC,GAAGT,2BAA2B;IAE9C,IAAKS,MAAM,GAAG,CAAC,EAAG;MACjB;IACD;IAEA,IAAK,CAAEN,eAAe,EAAG;MACxB;IACD;;IAEA;IACA;IACA;IACA;IACAE,IAAI,CAACK,eAAe,GAAG,IAAI;;IAE3B;IACA;IACAL,IAAI,CAACM,KAAK,CAAC,CAAC;IAEZJ,WAAW,CAACK,YAAY,CAAC,CAAC,CAACC,eAAe,CAAC,CAAC;EAC7C,CAAC,EACD,CACCjB,iBAAiB,EACjBF,gBAAgB,EAChBM,2BAA2B,EAC3BC,qBAAqB,EACrBC,eAAe,EACfC,eAAe,CAEjB,CAAC;AACF","ignoreList":[]}