{"version":3,"names":["getBlockSupport","useSelect","useCallback","InspectorControls","cleanEmptyObject","store","blockEditorStore","default","StylesBackgroundPanel","useHasBackgroundPanel","hasBackgroundImageValue","globalStylesDataKey","jsx","_jsx","BACKGROUND_SUPPORT_KEY","BACKGROUND_BLOCK_DEFAULT_VALUES","backgroundSize","backgroundPosition","hasBackgroundSupport","blockName","feature","support","backgroundImage","backgroundRepeat","setBackgroundStyleDefaults","backgroundStyle","url","backgroundStylesWithDefaults","useBlockProps","name","style","background","backgroundStyles","getBackgroundImageClasses","BackgroundInspectorControl","children","resetAllFilter","attributes","undefined","group","BackgroundImagePanel","clientId","setAttributes","settings","inheritedValue","select","getBlockAttributes","getSettings","_settings","blocks","onChange","newStyle","updatedSettings","as","panelId","defaultValues","value","attributeKeys","hasSupport"],"sources":["@wordpress/block-editor/src/hooks/background.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { getBlockSupport } from '@wordpress/blocks';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useCallback } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport InspectorControls from '../components/inspector-controls';\r\nimport { cleanEmptyObject } from './utils';\r\nimport { store as blockEditorStore } from '../store';\r\nimport {\r\n\tdefault as StylesBackgroundPanel,\r\n\tuseHasBackgroundPanel,\r\n\thasBackgroundImageValue,\r\n} from '../components/global-styles/background-panel';\r\nimport { globalStylesDataKey } from '../store/private-keys';\r\n\r\nexport const BACKGROUND_SUPPORT_KEY = 'background';\r\n\r\n// Initial control values.\r\nexport const BACKGROUND_BLOCK_DEFAULT_VALUES = {\r\n\tbackgroundSize: 'cover',\r\n\tbackgroundPosition: '50% 50%', // used only when backgroundSize is 'contain'.\r\n};\r\n\r\n/**\r\n * Determine whether there is block support for background.\r\n *\r\n * @param {string} blockName Block name.\r\n * @param {string} feature   Background image feature to check for.\r\n *\r\n * @return {boolean} Whether there is support.\r\n */\r\nexport function hasBackgroundSupport( blockName, feature = 'any' ) {\r\n\tconst support = getBlockSupport( blockName, BACKGROUND_SUPPORT_KEY );\r\n\r\n\tif ( support === true ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tif ( feature === 'any' ) {\r\n\t\treturn (\r\n\t\t\t!! support?.backgroundImage ||\r\n\t\t\t!! support?.backgroundSize ||\r\n\t\t\t!! support?.backgroundRepeat\r\n\t\t);\r\n\t}\r\n\r\n\treturn !! support?.[ feature ];\r\n}\r\n\r\nexport function setBackgroundStyleDefaults( backgroundStyle ) {\r\n\tif ( ! backgroundStyle || ! backgroundStyle?.backgroundImage?.url ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet backgroundStylesWithDefaults;\r\n\r\n\t// Set block background defaults.\r\n\tif ( ! backgroundStyle?.backgroundSize ) {\r\n\t\tbackgroundStylesWithDefaults = {\r\n\t\t\tbackgroundSize: BACKGROUND_BLOCK_DEFAULT_VALUES.backgroundSize,\r\n\t\t};\r\n\t}\r\n\r\n\tif (\r\n\t\t'contain' === backgroundStyle?.backgroundSize &&\r\n\t\t! backgroundStyle?.backgroundPosition\r\n\t) {\r\n\t\tbackgroundStylesWithDefaults = {\r\n\t\t\tbackgroundPosition:\r\n\t\t\t\tBACKGROUND_BLOCK_DEFAULT_VALUES.backgroundPosition,\r\n\t\t};\r\n\t}\r\n\treturn backgroundStylesWithDefaults;\r\n}\r\n\r\nfunction useBlockProps( { name, style } ) {\r\n\tif (\r\n\t\t! hasBackgroundSupport( name ) ||\r\n\t\t! style?.background?.backgroundImage\r\n\t) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst backgroundStyles = setBackgroundStyleDefaults( style?.background );\r\n\r\n\tif ( ! backgroundStyles ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\treturn {\r\n\t\tstyle: {\r\n\t\t\t...backgroundStyles,\r\n\t\t},\r\n\t};\r\n}\r\n\r\n/**\r\n * Generates a CSS class name if an background image is set.\r\n *\r\n * @param {Object} style A block's style attribute.\r\n *\r\n * @return {string} CSS class name.\r\n */\r\nexport function getBackgroundImageClasses( style ) {\r\n\treturn hasBackgroundImageValue( style ) ? 'has-background' : '';\r\n}\r\n\r\nfunction BackgroundInspectorControl( { children } ) {\r\n\tconst resetAllFilter = useCallback( ( attributes ) => {\r\n\t\treturn {\r\n\t\t\t...attributes,\r\n\t\t\tstyle: {\r\n\t\t\t\t...attributes.style,\r\n\t\t\t\tbackground: undefined,\r\n\t\t\t},\r\n\t\t};\r\n\t}, [] );\r\n\treturn (\r\n\t\t<InspectorControls group=\"background\" resetAllFilter={ resetAllFilter }>\r\n\t\t\t{ children }\r\n\t\t</InspectorControls>\r\n\t);\r\n}\r\n\r\nexport function BackgroundImagePanel( {\r\n\tclientId,\r\n\tname,\r\n\tsetAttributes,\r\n\tsettings,\r\n} ) {\r\n\tconst { style, inheritedValue } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getBlockAttributes, getSettings } =\r\n\t\t\t\tselect( blockEditorStore );\r\n\t\t\tconst _settings = getSettings();\r\n\t\t\treturn {\r\n\t\t\t\tstyle: getBlockAttributes( clientId )?.style,\r\n\t\t\t\t/*\r\n\t\t\t\t * To ensure we pass down the right inherited values:\r\n\t\t\t\t * @TODO 1. Pass inherited value down to all block style controls,\r\n\t\t\t\t *   See: packages/block-editor/src/hooks/style.js\r\n\t\t\t\t * @TODO 2. Add support for block style variations,\r\n\t\t\t\t *   See implementation: packages/block-editor/src/hooks/block-style-variation.js\r\n\t\t\t\t */\r\n\t\t\t\tinheritedValue:\r\n\t\t\t\t\t_settings[ globalStylesDataKey ]?.blocks?.[ name ],\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ clientId, name ]\r\n\t);\r\n\r\n\tif (\r\n\t\t! useHasBackgroundPanel( settings ) ||\r\n\t\t! hasBackgroundSupport( name, 'backgroundImage' )\r\n\t) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst onChange = ( newStyle ) => {\r\n\t\tsetAttributes( {\r\n\t\t\tstyle: cleanEmptyObject( newStyle ),\r\n\t\t} );\r\n\t};\r\n\r\n\tconst updatedSettings = {\r\n\t\t...settings,\r\n\t\tbackground: {\r\n\t\t\t...settings.background,\r\n\t\t\tbackgroundSize:\r\n\t\t\t\tsettings?.background?.backgroundSize &&\r\n\t\t\t\thasBackgroundSupport( name, 'backgroundSize' ),\r\n\t\t},\r\n\t};\r\n\r\n\treturn (\r\n\t\t<StylesBackgroundPanel\r\n\t\t\tinheritedValue={ inheritedValue }\r\n\t\t\tas={ BackgroundInspectorControl }\r\n\t\t\tpanelId={ clientId }\r\n\t\t\tdefaultValues={ BACKGROUND_BLOCK_DEFAULT_VALUES }\r\n\t\t\tsettings={ updatedSettings }\r\n\t\t\tonChange={ onChange }\r\n\t\t\tvalue={ style }\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nexport default {\r\n\tuseBlockProps,\r\n\tattributeKeys: [ 'style' ],\r\n\thasSupport: hasBackgroundSupport,\r\n};\r\n"],"mappings":"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","ignoreList":[]}