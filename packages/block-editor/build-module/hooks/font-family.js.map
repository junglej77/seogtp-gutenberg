{"version":3,"names":["addFilter","hasBlockSupport","TokenList","privateApis","componentsPrivateApis","shouldSkipSerialization","TYPOGRAPHY_SUPPORT_KEY","unlock","FONT_FAMILY_SUPPORT_KEY","kebabCase","addAttributes","settings","attributes","fontFamily","Object","assign","type","addSaveProps","props","blockType","classes","className","add","newClassName","value","undefined","useBlockProps","name","attributeKeys","hasSupport","resetFontFamily","setAttributes"],"sources":["@wordpress/block-editor/src/hooks/font-family.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { addFilter } from '@wordpress/hooks';\r\nimport { hasBlockSupport } from '@wordpress/blocks';\r\nimport TokenList from '@wordpress/token-list';\r\nimport { privateApis as componentsPrivateApis } from '@wordpress/components';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { shouldSkipSerialization } from './utils';\r\nimport { TYPOGRAPHY_SUPPORT_KEY } from './typography';\r\nimport { unlock } from '../lock-unlock';\r\n\r\nexport const FONT_FAMILY_SUPPORT_KEY = 'typography.__experimentalFontFamily';\r\nconst { kebabCase } = unlock( componentsPrivateApis );\r\n\r\n/**\r\n * Filters registered block settings, extending attributes to include\r\n * the `fontFamily` attribute.\r\n *\r\n * @param {Object} settings Original block settings\r\n * @return {Object}         Filtered block settings\r\n */\r\nfunction addAttributes( settings ) {\r\n\tif ( ! hasBlockSupport( settings, FONT_FAMILY_SUPPORT_KEY ) ) {\r\n\t\treturn settings;\r\n\t}\r\n\r\n\t// Allow blocks to specify a default value if needed.\r\n\tif ( ! settings.attributes.fontFamily ) {\r\n\t\tObject.assign( settings.attributes, {\r\n\t\t\tfontFamily: {\r\n\t\t\t\ttype: 'string',\r\n\t\t\t},\r\n\t\t} );\r\n\t}\r\n\r\n\treturn settings;\r\n}\r\n\r\n/**\r\n * Override props assigned to save component to inject font family.\r\n *\r\n * @param {Object} props      Additional props applied to save element\r\n * @param {Object} blockType  Block type\r\n * @param {Object} attributes Block attributes\r\n * @return {Object}           Filtered props applied to save element\r\n */\r\nfunction addSaveProps( props, blockType, attributes ) {\r\n\tif ( ! hasBlockSupport( blockType, FONT_FAMILY_SUPPORT_KEY ) ) {\r\n\t\treturn props;\r\n\t}\r\n\r\n\tif (\r\n\t\tshouldSkipSerialization(\r\n\t\t\tblockType,\r\n\t\t\tTYPOGRAPHY_SUPPORT_KEY,\r\n\t\t\t'fontFamily'\r\n\t\t)\r\n\t) {\r\n\t\treturn props;\r\n\t}\r\n\r\n\tif ( ! attributes?.fontFamily ) {\r\n\t\treturn props;\r\n\t}\r\n\r\n\t// Use TokenList to dedupe classes.\r\n\tconst classes = new TokenList( props.className );\r\n\tclasses.add( `has-${ kebabCase( attributes?.fontFamily ) }-font-family` );\r\n\tconst newClassName = classes.value;\r\n\tprops.className = newClassName ? newClassName : undefined;\r\n\r\n\treturn props;\r\n}\r\n\r\nfunction useBlockProps( { name, fontFamily } ) {\r\n\treturn addSaveProps( {}, name, { fontFamily } );\r\n}\r\n\r\nexport default {\r\n\tuseBlockProps,\r\n\taddSaveProps,\r\n\tattributeKeys: [ 'fontFamily' ],\r\n\thasSupport( name ) {\r\n\t\treturn hasBlockSupport( name, FONT_FAMILY_SUPPORT_KEY );\r\n\t},\r\n};\r\n\r\n/**\r\n * Resets the font family block support attribute. This can be used when\r\n * disabling the font family support controls for a block via a progressive\r\n * discovery panel.\r\n *\r\n * @param {Object} props               Block props.\r\n * @param {Object} props.setAttributes Function to set block's attributes.\r\n */\r\nexport function resetFontFamily( { setAttributes } ) {\r\n\tsetAttributes( { fontFamily: undefined } );\r\n}\r\n\r\naddFilter(\r\n\t'blocks.registerBlockType',\r\n\t'core/fontFamily/addAttribute',\r\n\taddAttributes\r\n);\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,QAAQ,kBAAkB;AAC5C,SAASC,eAAe,QAAQ,mBAAmB;AACnD,OAAOC,SAAS,MAAM,uBAAuB;AAC7C,SAASC,WAAW,IAAIC,qBAAqB,QAAQ,uBAAuB;;AAE5E;AACA;AACA;AACA,SAASC,uBAAuB,QAAQ,SAAS;AACjD,SAASC,sBAAsB,QAAQ,cAAc;AACrD,SAASC,MAAM,QAAQ,gBAAgB;AAEvC,OAAO,MAAMC,uBAAuB,GAAG,qCAAqC;AAC5E,MAAM;EAAEC;AAAU,CAAC,GAAGF,MAAM,CAAEH,qBAAsB,CAAC;;AAErD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASM,aAAaA,CAAEC,QAAQ,EAAG;EAClC,IAAK,CAAEV,eAAe,CAAEU,QAAQ,EAAEH,uBAAwB,CAAC,EAAG;IAC7D,OAAOG,QAAQ;EAChB;;EAEA;EACA,IAAK,CAAEA,QAAQ,CAACC,UAAU,CAACC,UAAU,EAAG;IACvCC,MAAM,CAACC,MAAM,CAAEJ,QAAQ,CAACC,UAAU,EAAE;MACnCC,UAAU,EAAE;QACXG,IAAI,EAAE;MACP;IACD,CAAE,CAAC;EACJ;EAEA,OAAOL,QAAQ;AAChB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASM,YAAYA,CAAEC,KAAK,EAAEC,SAAS,EAAEP,UAAU,EAAG;EACrD,IAAK,CAAEX,eAAe,CAAEkB,SAAS,EAAEX,uBAAwB,CAAC,EAAG;IAC9D,OAAOU,KAAK;EACb;EAEA,IACCb,uBAAuB,CACtBc,SAAS,EACTb,sBAAsB,EACtB,YACD,CAAC,EACA;IACD,OAAOY,KAAK;EACb;EAEA,IAAK,CAAEN,UAAU,EAAEC,UAAU,EAAG;IAC/B,OAAOK,KAAK;EACb;;EAEA;EACA,MAAME,OAAO,GAAG,IAAIlB,SAAS,CAAEgB,KAAK,CAACG,SAAU,CAAC;EAChDD,OAAO,CAACE,GAAG,CAAG,OAAOb,SAAS,CAAEG,UAAU,EAAEC,UAAW,CAAG,cAAc,CAAC;EACzE,MAAMU,YAAY,GAAGH,OAAO,CAACI,KAAK;EAClCN,KAAK,CAACG,SAAS,GAAGE,YAAY,GAAGA,YAAY,GAAGE,SAAS;EAEzD,OAAOP,KAAK;AACb;AAEA,SAASQ,aAAaA,CAAE;EAAEC,IAAI;EAAEd;AAAW,CAAC,EAAG;EAC9C,OAAOI,YAAY,CAAE,CAAC,CAAC,EAAEU,IAAI,EAAE;IAAEd;EAAW,CAAE,CAAC;AAChD;AAEA,eAAe;EACda,aAAa;EACbT,YAAY;EACZW,aAAa,EAAE,CAAE,YAAY,CAAE;EAC/BC,UAAUA,CAAEF,IAAI,EAAG;IAClB,OAAO1B,eAAe,CAAE0B,IAAI,EAAEnB,uBAAwB,CAAC;EACxD;AACD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASsB,eAAeA,CAAE;EAAEC;AAAc,CAAC,EAAG;EACpDA,aAAa,CAAE;IAAElB,UAAU,EAAEY;EAAU,CAAE,CAAC;AAC3C;AAEAzB,SAAS,CACR,0BAA0B,EAC1B,8BAA8B,EAC9BU,aACD,CAAC","ignoreList":[]}