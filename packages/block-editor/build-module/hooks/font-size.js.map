{"version":3,"names":["addFilter","hasBlockSupport","TokenList","getFontSize","getFontSizeClass","getFontSizeObjectByValue","FontSizePicker","TYPOGRAPHY_SUPPORT_KEY","cleanEmptyObject","transformStyles","shouldSkipSerialization","useSettings","getTypographyFontSizeValue","jsx","_jsx","FONT_SIZE_SUPPORT_KEY","addAttributes","settings","attributes","fontSize","Object","assign","type","addSaveProps","props","blockNameOrType","classes","className","add","newClassName","value","undefined","FontSizeEdit","style","setAttributes","fontSizes","onChange","fontSizeSlug","slug","typography","fontSizeObject","fontSizeValue","size","withReset","withSlider","useIsFontSizeDisabled","name","blockName","hasFontSizes","length","useBlockProps","fluidTypographySettings","layoutSettings","fluid","layout","attributeKeys","hasSupport","MIGRATION_PATHS","addTransforms","result","source","index","results","destinationBlockType","activeSupports"],"sources":["@wordpress/block-editor/src/hooks/font-size.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { addFilter } from '@wordpress/hooks';\r\nimport { hasBlockSupport } from '@wordpress/blocks';\r\nimport TokenList from '@wordpress/token-list';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport {\r\n\tgetFontSize,\r\n\tgetFontSizeClass,\r\n\tgetFontSizeObjectByValue,\r\n\tFontSizePicker,\r\n} from '../components/font-sizes';\r\nimport { TYPOGRAPHY_SUPPORT_KEY } from './typography';\r\nimport {\r\n\tcleanEmptyObject,\r\n\ttransformStyles,\r\n\tshouldSkipSerialization,\r\n} from './utils';\r\nimport { useSettings } from '../components/use-settings';\r\nimport { getTypographyFontSizeValue } from '../components/global-styles/typography-utils';\r\n\r\nexport const FONT_SIZE_SUPPORT_KEY = 'typography.fontSize';\r\n\r\n/**\r\n * Filters registered block settings, extending attributes to include\r\n * `fontSize` and `fontWeight` attributes.\r\n *\r\n * @param {Object} settings Original block settings.\r\n *\r\n * @return {Object} Filtered block settings.\r\n */\r\nfunction addAttributes( settings ) {\r\n\tif ( ! hasBlockSupport( settings, FONT_SIZE_SUPPORT_KEY ) ) {\r\n\t\treturn settings;\r\n\t}\r\n\r\n\t// Allow blocks to specify a default value if needed.\r\n\tif ( ! settings.attributes.fontSize ) {\r\n\t\tObject.assign( settings.attributes, {\r\n\t\t\tfontSize: {\r\n\t\t\t\ttype: 'string',\r\n\t\t\t},\r\n\t\t} );\r\n\t}\r\n\r\n\treturn settings;\r\n}\r\n\r\n/**\r\n * Override props assigned to save component to inject font size.\r\n *\r\n * @param {Object} props           Additional props applied to save element.\r\n * @param {Object} blockNameOrType Block type.\r\n * @param {Object} attributes      Block attributes.\r\n *\r\n * @return {Object} Filtered props applied to save element.\r\n */\r\nfunction addSaveProps( props, blockNameOrType, attributes ) {\r\n\tif ( ! hasBlockSupport( blockNameOrType, FONT_SIZE_SUPPORT_KEY ) ) {\r\n\t\treturn props;\r\n\t}\r\n\r\n\tif (\r\n\t\tshouldSkipSerialization(\r\n\t\t\tblockNameOrType,\r\n\t\t\tTYPOGRAPHY_SUPPORT_KEY,\r\n\t\t\t'fontSize'\r\n\t\t)\r\n\t) {\r\n\t\treturn props;\r\n\t}\r\n\r\n\t// Use TokenList to dedupe classes.\r\n\tconst classes = new TokenList( props.className );\r\n\tclasses.add( getFontSizeClass( attributes.fontSize ) );\r\n\tconst newClassName = classes.value;\r\n\tprops.className = newClassName ? newClassName : undefined;\r\n\r\n\treturn props;\r\n}\r\n\r\n/**\r\n * Inspector control panel containing the font size related configuration\r\n *\r\n * @param {Object} props\r\n *\r\n * @return {Element} Font size edit element.\r\n */\r\nexport function FontSizeEdit( props ) {\r\n\tconst {\r\n\t\tattributes: { fontSize, style },\r\n\t\tsetAttributes,\r\n\t} = props;\r\n\tconst [ fontSizes ] = useSettings( 'typography.fontSizes' );\r\n\r\n\tconst onChange = ( value ) => {\r\n\t\tconst fontSizeSlug = getFontSizeObjectByValue( fontSizes, value ).slug;\r\n\r\n\t\tsetAttributes( {\r\n\t\t\tstyle: cleanEmptyObject( {\r\n\t\t\t\t...style,\r\n\t\t\t\ttypography: {\r\n\t\t\t\t\t...style?.typography,\r\n\t\t\t\t\tfontSize: fontSizeSlug ? undefined : value,\r\n\t\t\t\t},\r\n\t\t\t} ),\r\n\t\t\tfontSize: fontSizeSlug,\r\n\t\t} );\r\n\t};\r\n\r\n\tconst fontSizeObject = getFontSize(\r\n\t\tfontSizes,\r\n\t\tfontSize,\r\n\t\tstyle?.typography?.fontSize\r\n\t);\r\n\r\n\tconst fontSizeValue =\r\n\t\tfontSizeObject?.size || style?.typography?.fontSize || fontSize;\r\n\r\n\treturn (\r\n\t\t<FontSizePicker\r\n\t\t\tonChange={ onChange }\r\n\t\t\tvalue={ fontSizeValue }\r\n\t\t\twithReset={ false }\r\n\t\t\twithSlider\r\n\t\t\tsize=\"__unstable-large\"\r\n\t\t/>\r\n\t);\r\n}\r\n\r\n/**\r\n * Custom hook that checks if font-size settings have been disabled.\r\n *\r\n * @param {string} name The name of the block.\r\n * @return {boolean} Whether setting is disabled.\r\n */\r\nexport function useIsFontSizeDisabled( { name: blockName } = {} ) {\r\n\tconst [ fontSizes ] = useSettings( 'typography.fontSizes' );\r\n\tconst hasFontSizes = !! fontSizes?.length;\r\n\r\n\treturn (\r\n\t\t! hasBlockSupport( blockName, FONT_SIZE_SUPPORT_KEY ) || ! hasFontSizes\r\n\t);\r\n}\r\n\r\nfunction useBlockProps( { name, fontSize, style } ) {\r\n\tconst [ fontSizes, fluidTypographySettings, layoutSettings ] = useSettings(\r\n\t\t'typography.fontSizes',\r\n\t\t'typography.fluid',\r\n\t\t'layout'\r\n\t);\r\n\r\n\t/*\r\n\t * Only add inline styles if the block supports font sizes,\r\n\t * doesn't skip serialization of font sizes,\r\n\t * and has either a custom font size or a preset font size.\r\n\t */\r\n\tif (\r\n\t\t! hasBlockSupport( name, FONT_SIZE_SUPPORT_KEY ) ||\r\n\t\tshouldSkipSerialization( name, TYPOGRAPHY_SUPPORT_KEY, 'fontSize' ) ||\r\n\t\t( ! fontSize && ! style?.typography?.fontSize )\r\n\t) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet props;\r\n\r\n\tif ( style?.typography?.fontSize ) {\r\n\t\tprops = {\r\n\t\t\tstyle: {\r\n\t\t\t\tfontSize: getTypographyFontSizeValue(\r\n\t\t\t\t\t{ size: style.typography.fontSize },\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttypography: {\r\n\t\t\t\t\t\t\tfluid: fluidTypographySettings,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tlayout: layoutSettings,\r\n\t\t\t\t\t}\r\n\t\t\t\t),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tif ( fontSize ) {\r\n\t\tprops = {\r\n\t\t\tstyle: {\r\n\t\t\t\tfontSize: getFontSize(\r\n\t\t\t\t\tfontSizes,\r\n\t\t\t\t\tfontSize,\r\n\t\t\t\t\tstyle?.typography?.fontSize\r\n\t\t\t\t).size,\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tif ( ! props ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\treturn addSaveProps( props, name, { fontSize } );\r\n}\r\n\r\nexport default {\r\n\tuseBlockProps,\r\n\taddSaveProps,\r\n\tattributeKeys: [ 'fontSize', 'style' ],\r\n\thasSupport( name ) {\r\n\t\treturn hasBlockSupport( name, FONT_SIZE_SUPPORT_KEY );\r\n\t},\r\n};\r\n\r\nconst MIGRATION_PATHS = {\r\n\tfontSize: [ [ 'fontSize' ], [ 'style', 'typography', 'fontSize' ] ],\r\n};\r\n\r\nfunction addTransforms( result, source, index, results ) {\r\n\tconst destinationBlockType = result.name;\r\n\tconst activeSupports = {\r\n\t\tfontSize: hasBlockSupport(\r\n\t\t\tdestinationBlockType,\r\n\t\t\tFONT_SIZE_SUPPORT_KEY\r\n\t\t),\r\n\t};\r\n\treturn transformStyles(\r\n\t\tactiveSupports,\r\n\t\tMIGRATION_PATHS,\r\n\t\tresult,\r\n\t\tsource,\r\n\t\tindex,\r\n\t\tresults\r\n\t);\r\n}\r\n\r\naddFilter(\r\n\t'blocks.registerBlockType',\r\n\t'core/font/addAttribute',\r\n\taddAttributes\r\n);\r\n\r\naddFilter(\r\n\t'blocks.switchToBlockType.transformedBlock',\r\n\t'core/font-size/addTransforms',\r\n\taddTransforms\r\n);\r\n"],"mappings":"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","ignoreList":[]}