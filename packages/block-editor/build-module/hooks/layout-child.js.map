{"version":3,"names":["useInstanceId","useSelect","useState","store","blockEditorStore","useStyleOverride","useLayout","GridVisualizer","GridItemResizer","GridItemMovers","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","useBlockPropsChildLayoutStyles","style","_style$layout","shouldRenderChildLayoutStyles","select","getSettings","disableLayoutStyles","layout","selfStretch","flexSize","columnStart","rowStart","columnSpan","rowSpan","parentLayout","columnCount","minimumColumnWidth","id","selector","process","env","NODE_ENV","Error","css","parentColumnValue","parseFloat","isNaN","parentColumnUnit","replace","includes","numColsToBreakAt","defaultGapValue","containerQueryValue","minimumContainerQueryValue","gridColumnValue","Math","max","className","ChildLayoutControlsPure","clientId","setAttributes","type","parentLayoutType","allowSizingOnChildren","isManualPlacement","rootClientId","getBlockRootClientId","resizerBounds","setResizerBounds","updateLayout","children","contentRef","bounds","onChange","window","__experimentalEnableGridInteractivity","gridClientId","blockClientId","useBlockProps","edit","attributeKeys","hasSupport"],"sources":["@wordpress/block-editor/src/hooks/layout-child.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useInstanceId } from '@wordpress/compose';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useState } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../store';\r\nimport { useStyleOverride } from './utils';\r\nimport { useLayout } from '../components/block-list/layout';\r\nimport {\r\n\tGridVisualizer,\r\n\tGridItemResizer,\r\n\tGridItemMovers,\r\n} from '../components/grid';\r\n\r\nfunction useBlockPropsChildLayoutStyles( { style } ) {\r\n\tconst shouldRenderChildLayoutStyles = useSelect( ( select ) => {\r\n\t\treturn ! select( blockEditorStore ).getSettings().disableLayoutStyles;\r\n\t} );\r\n\tconst layout = style?.layout ?? {};\r\n\tconst {\r\n\t\tselfStretch,\r\n\t\tflexSize,\r\n\t\tcolumnStart,\r\n\t\trowStart,\r\n\t\tcolumnSpan,\r\n\t\trowSpan,\r\n\t} = layout;\r\n\tconst parentLayout = useLayout() || {};\r\n\tconst { columnCount, minimumColumnWidth } = parentLayout;\r\n\tconst id = useInstanceId( useBlockPropsChildLayoutStyles );\r\n\tconst selector = `.wp-container-content-${ id }`;\r\n\r\n\t// Check that the grid layout attributes are of the correct type, so that we don't accidentally\r\n\t// write code that stores a string attribute instead of a number.\r\n\tif ( process.env.NODE_ENV === 'development' ) {\r\n\t\tif ( columnStart && typeof columnStart !== 'number' ) {\r\n\t\t\tthrow new Error( 'columnStart must be a number' );\r\n\t\t}\r\n\t\tif ( rowStart && typeof rowStart !== 'number' ) {\r\n\t\t\tthrow new Error( 'rowStart must be a number' );\r\n\t\t}\r\n\t\tif ( columnSpan && typeof columnSpan !== 'number' ) {\r\n\t\t\tthrow new Error( 'columnSpan must be a number' );\r\n\t\t}\r\n\t\tif ( rowSpan && typeof rowSpan !== 'number' ) {\r\n\t\t\tthrow new Error( 'rowSpan must be a number' );\r\n\t\t}\r\n\t}\r\n\r\n\tlet css = '';\r\n\tif ( shouldRenderChildLayoutStyles ) {\r\n\t\tif ( selfStretch === 'fixed' && flexSize ) {\r\n\t\t\tcss = `${ selector } {\r\n\t\t\t\tflex-basis: ${ flexSize };\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t}`;\r\n\t\t} else if ( selfStretch === 'fill' ) {\r\n\t\t\tcss = `${ selector } {\r\n\t\t\t\tflex-grow: 1;\r\n\t\t\t}`;\r\n\t\t} else if ( columnStart && columnSpan ) {\r\n\t\t\tcss = `${ selector } {\r\n\t\t\t\tgrid-column: ${ columnStart } / span ${ columnSpan };\r\n\t\t\t}`;\r\n\t\t} else if ( columnStart ) {\r\n\t\t\tcss = `${ selector } {\r\n\t\t\t\tgrid-column: ${ columnStart };\r\n\t\t\t}`;\r\n\t\t} else if ( columnSpan ) {\r\n\t\t\tcss = `${ selector } {\r\n\t\t\t\tgrid-column: span ${ columnSpan };\r\n\t\t\t}`;\r\n\t\t}\r\n\t\tif ( rowStart && rowSpan ) {\r\n\t\t\tcss += `${ selector } {\r\n\t\t\t\tgrid-row: ${ rowStart } / span ${ rowSpan };\r\n\t\t\t}`;\r\n\t\t} else if ( rowStart ) {\r\n\t\t\tcss += `${ selector } {\r\n\t\t\t\tgrid-row: ${ rowStart };\r\n\t\t\t}`;\r\n\t\t} else if ( rowSpan ) {\r\n\t\t\tcss += `${ selector } {\r\n\t\t\t\tgrid-row: span ${ rowSpan };\r\n\t\t\t}`;\r\n\t\t}\r\n\t\t/**\r\n\t\t * If minimumColumnWidth is set on the parent, or if no\r\n\t\t * columnCount is set, the grid is responsive so a\r\n\t\t * container query is needed for the span to resize.\r\n\t\t */\r\n\t\tif (\r\n\t\t\t( columnSpan || columnStart ) &&\r\n\t\t\t( minimumColumnWidth || ! columnCount )\r\n\t\t) {\r\n\t\t\tlet parentColumnValue = parseFloat( minimumColumnWidth );\r\n\t\t\t/**\r\n\t\t\t * 12rem is the default minimumColumnWidth value.\r\n\t\t\t * If parentColumnValue is not a number, default to 12.\r\n\t\t\t */\r\n\t\t\tif ( isNaN( parentColumnValue ) ) {\r\n\t\t\t\tparentColumnValue = 12;\r\n\t\t\t}\r\n\r\n\t\t\tlet parentColumnUnit = minimumColumnWidth?.replace(\r\n\t\t\t\tparentColumnValue,\r\n\t\t\t\t''\r\n\t\t\t);\r\n\t\t\t/**\r\n\t\t\t * Check that parent column unit is either 'px', 'rem' or 'em'.\r\n\t\t\t * If not, default to 'rem'.\r\n\t\t\t */\r\n\t\t\tif ( ! [ 'px', 'rem', 'em' ].includes( parentColumnUnit ) ) {\r\n\t\t\t\tparentColumnUnit = 'rem';\r\n\t\t\t}\r\n\r\n\t\t\tlet numColsToBreakAt = 2;\r\n\r\n\t\t\tif ( columnSpan && columnStart ) {\r\n\t\t\t\tnumColsToBreakAt = columnSpan + columnStart - 1;\r\n\t\t\t} else if ( columnSpan ) {\r\n\t\t\t\tnumColsToBreakAt = columnSpan;\r\n\t\t\t} else {\r\n\t\t\t\tnumColsToBreakAt = columnStart;\r\n\t\t\t}\r\n\r\n\t\t\tconst defaultGapValue = parentColumnUnit === 'px' ? 24 : 1.5;\r\n\t\t\tconst containerQueryValue =\r\n\t\t\t\tnumColsToBreakAt * parentColumnValue +\r\n\t\t\t\t( numColsToBreakAt - 1 ) * defaultGapValue;\r\n\t\t\t// For blocks that only span one column, we want to remove any rowStart values as\r\n\t\t\t// the container reduces in size, so that blocks are still arranged in markup order.\r\n\t\t\tconst minimumContainerQueryValue =\r\n\t\t\t\tparentColumnValue * 2 + defaultGapValue - 1;\r\n\t\t\t// If a span is set we want to preserve it as long as possible, otherwise we just reset the value.\r\n\t\t\tconst gridColumnValue =\r\n\t\t\t\tcolumnSpan && columnSpan > 1 ? '1/-1' : 'auto';\r\n\r\n\t\t\tcss += `@container (max-width: ${ Math.max(\r\n\t\t\t\tcontainerQueryValue,\r\n\t\t\t\tminimumContainerQueryValue\r\n\t\t\t) }${ parentColumnUnit }) {\r\n\t\t\t\t${ selector } {\r\n\t\t\t\t\tgrid-column: ${ gridColumnValue };\r\n\t\t\t\t\tgrid-row: auto;\r\n\t\t\t\t}\r\n\t\t\t}`;\r\n\t\t}\r\n\t}\r\n\r\n\tuseStyleOverride( { css } );\r\n\r\n\t// Only attach a container class if there is generated CSS to be attached.\r\n\tif ( ! css ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Attach a `wp-container-content` id-based classname.\r\n\treturn { className: `wp-container-content-${ id }` };\r\n}\r\n\r\nfunction ChildLayoutControlsPure( { clientId, style, setAttributes } ) {\r\n\tconst parentLayout = useLayout() || {};\r\n\tconst {\r\n\t\ttype: parentLayoutType = 'default',\r\n\t\tallowSizingOnChildren = false,\r\n\t\tisManualPlacement,\r\n\t} = parentLayout;\r\n\r\n\tconst rootClientId = useSelect(\r\n\t\t( select ) => {\r\n\t\t\treturn select( blockEditorStore ).getBlockRootClientId( clientId );\r\n\t\t},\r\n\t\t[ clientId ]\r\n\t);\r\n\r\n\t// Use useState() instead of useRef() so that GridItemResizer updates when ref is set.\r\n\tconst [ resizerBounds, setResizerBounds ] = useState();\r\n\r\n\tif ( parentLayoutType !== 'grid' ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction updateLayout( layout ) {\r\n\t\tsetAttributes( {\r\n\t\t\tstyle: {\r\n\t\t\t\t...style,\r\n\t\t\t\tlayout: {\r\n\t\t\t\t\t...style?.layout,\r\n\t\t\t\t\t...layout,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t} );\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<GridVisualizer\r\n\t\t\t\tclientId={ rootClientId }\r\n\t\t\t\tcontentRef={ setResizerBounds }\r\n\t\t\t\tparentLayout={ parentLayout }\r\n\t\t\t/>\r\n\t\t\t{ allowSizingOnChildren && (\r\n\t\t\t\t<GridItemResizer\r\n\t\t\t\t\tclientId={ clientId }\r\n\t\t\t\t\t// Don't allow resizing beyond the grid visualizer.\r\n\t\t\t\t\tbounds={ resizerBounds }\r\n\t\t\t\t\tonChange={ updateLayout }\r\n\t\t\t\t\tparentLayout={ parentLayout }\r\n\t\t\t\t/>\r\n\t\t\t) }\r\n\t\t\t{ isManualPlacement &&\r\n\t\t\t\twindow.__experimentalEnableGridInteractivity && (\r\n\t\t\t\t\t<GridItemMovers\r\n\t\t\t\t\t\tlayout={ style?.layout }\r\n\t\t\t\t\t\tparentLayout={ parentLayout }\r\n\t\t\t\t\t\tonChange={ updateLayout }\r\n\t\t\t\t\t\tgridClientId={ rootClientId }\r\n\t\t\t\t\t\tblockClientId={ clientId }\r\n\t\t\t\t\t/>\r\n\t\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default {\r\n\tuseBlockProps: useBlockPropsChildLayoutStyles,\r\n\tedit: ChildLayoutControlsPure,\r\n\tattributeKeys: [ 'style' ],\r\n\thasSupport() {\r\n\t\treturn true;\r\n\t},\r\n};\r\n"],"mappings":"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","ignoreList":[]}