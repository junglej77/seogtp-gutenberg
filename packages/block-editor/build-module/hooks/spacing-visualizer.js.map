{"version":3,"names":["useState","useRef","useLayoutEffect","useEffect","useReducer","isShallowEqual","BlockPopoverCover","useBlockElement","jsx","_jsx","SpacingVisualizer","clientId","value","computeStyle","forceShow","blockElement","style","updateStyle","window","requestAnimationFrame","previousValueRef","isActive","setIsActive","current","timeout","setTimeout","clearTimeout","__unstablePopoverSlot","children","className","getComputedCSS","element","property","ownerDocument","defaultView","getComputedStyle","getPropertyValue","MarginVisualizer","spacing","margin","top","right","bottom","left","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","PaddingVisualizer","padding"],"sources":["@wordpress/block-editor/src/hooks/spacing-visualizer.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tuseState,\r\n\tuseRef,\r\n\tuseLayoutEffect,\r\n\tuseEffect,\r\n\tuseReducer,\r\n} from '@wordpress/element';\r\nimport isShallowEqual from '@wordpress/is-shallow-equal';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport BlockPopoverCover from '../components/block-popover/cover';\r\nimport { useBlockElement } from '../components/block-list/use-block-props/use-block-refs';\r\n\r\nfunction SpacingVisualizer( { clientId, value, computeStyle, forceShow } ) {\r\n\tconst blockElement = useBlockElement( clientId );\r\n\tconst [ style, updateStyle ] = useReducer( () =>\r\n\t\tcomputeStyle( blockElement )\r\n\t);\r\n\r\n\tuseLayoutEffect( () => {\r\n\t\tif ( ! blockElement ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// It's not sufficient to read the computed spacing value when value.spacing changes as\r\n\t\t// useEffect may run before the browser recomputes CSS. We therefore combine\r\n\t\t// useLayoutEffect and two rAF calls to ensure that we read the spacing after the current\r\n\t\t// paint but before the next paint.\r\n\t\t// See https://github.com/WordPress/gutenberg/pull/59227.\r\n\t\twindow.requestAnimationFrame( () =>\r\n\t\t\twindow.requestAnimationFrame( updateStyle )\r\n\t\t);\r\n\t}, [ blockElement, value ] );\r\n\r\n\tconst previousValueRef = useRef( value );\r\n\tconst [ isActive, setIsActive ] = useState( false );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isShallowEqual( value, previousValueRef.current ) || forceShow ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsActive( true );\r\n\t\tpreviousValueRef.current = value;\r\n\r\n\t\tconst timeout = setTimeout( () => {\r\n\t\t\tsetIsActive( false );\r\n\t\t}, 400 );\r\n\r\n\t\treturn () => {\r\n\t\t\tsetIsActive( false );\r\n\t\t\tclearTimeout( timeout );\r\n\t\t};\r\n\t}, [ value, forceShow ] );\r\n\r\n\tif ( ! isActive && ! forceShow ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<BlockPopoverCover\r\n\t\t\tclientId={ clientId }\r\n\t\t\t__unstablePopoverSlot=\"block-toolbar\"\r\n\t\t>\r\n\t\t\t<div className=\"block-editor__spacing-visualizer\" style={ style } />\r\n\t\t</BlockPopoverCover>\r\n\t);\r\n}\r\n\r\nfunction getComputedCSS( element, property ) {\r\n\treturn element.ownerDocument.defaultView\r\n\t\t.getComputedStyle( element )\r\n\t\t.getPropertyValue( property );\r\n}\r\n\r\nexport function MarginVisualizer( { clientId, value, forceShow } ) {\r\n\treturn (\r\n\t\t<SpacingVisualizer\r\n\t\t\tclientId={ clientId }\r\n\t\t\tvalue={ value?.spacing?.margin }\r\n\t\t\tcomputeStyle={ ( blockElement ) => {\r\n\t\t\t\tconst top = getComputedCSS( blockElement, 'margin-top' );\r\n\t\t\t\tconst right = getComputedCSS( blockElement, 'margin-right' );\r\n\t\t\t\tconst bottom = getComputedCSS( blockElement, 'margin-bottom' );\r\n\t\t\t\tconst left = getComputedCSS( blockElement, 'margin-left' );\r\n\t\t\t\treturn {\r\n\t\t\t\t\tborderTopWidth: top,\r\n\t\t\t\t\tborderRightWidth: right,\r\n\t\t\t\t\tborderBottomWidth: bottom,\r\n\t\t\t\t\tborderLeftWidth: left,\r\n\t\t\t\t\ttop: top ? `-${ top }` : 0,\r\n\t\t\t\t\tright: right ? `-${ right }` : 0,\r\n\t\t\t\t\tbottom: bottom ? `-${ bottom }` : 0,\r\n\t\t\t\t\tleft: left ? `-${ left }` : 0,\r\n\t\t\t\t};\r\n\t\t\t} }\r\n\t\t\tforceShow={ forceShow }\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nexport function PaddingVisualizer( { clientId, value, forceShow } ) {\r\n\treturn (\r\n\t\t<SpacingVisualizer\r\n\t\t\tclientId={ clientId }\r\n\t\t\tvalue={ value?.spacing?.padding }\r\n\t\t\tcomputeStyle={ ( blockElement ) => ( {\r\n\t\t\t\tborderTopWidth: getComputedCSS( blockElement, 'padding-top' ),\r\n\t\t\t\tborderRightWidth: getComputedCSS(\r\n\t\t\t\t\tblockElement,\r\n\t\t\t\t\t'padding-right'\r\n\t\t\t\t),\r\n\t\t\t\tborderBottomWidth: getComputedCSS(\r\n\t\t\t\t\tblockElement,\r\n\t\t\t\t\t'padding-bottom'\r\n\t\t\t\t),\r\n\t\t\t\tborderLeftWidth: getComputedCSS( blockElement, 'padding-left' ),\r\n\t\t\t} ) }\r\n\t\t\tforceShow={ forceShow }\r\n\t\t/>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}