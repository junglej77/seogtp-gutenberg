{"version":3,"names":["__EXPERIMENTAL_PATHS_WITH_OVERRIDE","PATHS_WITH_OVERRIDE","hasBlockSupport","applyFilters","getValueFromObjectPath","getBlockName","getSettings","getBlockAttributes","blockedPaths","deprecatedFlags","settings","colors","gradients","disableCustomColors","undefined","disableCustomGradients","fontSizes","disableCustomFontSizes","enableCustomLineHeight","enableCustomUnits","enableCustomSpacing","prefixedFlags","removeCustomPrefixes","path","getBlockSettings","state","clientId","paths","blockName","candidates","id","name","push","blocks","parents","get","map","includes","console","warn","result","normalizedPath","candidateClientId","_getValueFromObjectPa","candidateAtts","__experimentalFeatures","_ref","_result$custom","custom","theme","default","deprecatedSettingsValue"],"sources":["@wordpress/block-editor/src/store/get-block-settings.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\t__EXPERIMENTAL_PATHS_WITH_OVERRIDE as PATHS_WITH_OVERRIDE,\r\n\thasBlockSupport,\r\n} from '@wordpress/blocks';\r\nimport { applyFilters } from '@wordpress/hooks';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { getValueFromObjectPath } from '../utils/object';\r\nimport { getBlockName, getSettings, getBlockAttributes } from './selectors';\r\n\r\nconst blockedPaths = [\r\n\t'color',\r\n\t'border',\r\n\t'dimensions',\r\n\t'typography',\r\n\t'spacing',\r\n];\r\n\r\nconst deprecatedFlags = {\r\n\t'color.palette': ( settings ) => settings.colors,\r\n\t'color.gradients': ( settings ) => settings.gradients,\r\n\t'color.custom': ( settings ) =>\r\n\t\tsettings.disableCustomColors === undefined\r\n\t\t\t? undefined\r\n\t\t\t: ! settings.disableCustomColors,\r\n\t'color.customGradient': ( settings ) =>\r\n\t\tsettings.disableCustomGradients === undefined\r\n\t\t\t? undefined\r\n\t\t\t: ! settings.disableCustomGradients,\r\n\t'typography.fontSizes': ( settings ) => settings.fontSizes,\r\n\t'typography.customFontSize': ( settings ) =>\r\n\t\tsettings.disableCustomFontSizes === undefined\r\n\t\t\t? undefined\r\n\t\t\t: ! settings.disableCustomFontSizes,\r\n\t'typography.lineHeight': ( settings ) => settings.enableCustomLineHeight,\r\n\t'spacing.units': ( settings ) => {\r\n\t\tif ( settings.enableCustomUnits === undefined ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( settings.enableCustomUnits === true ) {\r\n\t\t\treturn [ 'px', 'em', 'rem', 'vh', 'vw', '%' ];\r\n\t\t}\r\n\r\n\t\treturn settings.enableCustomUnits;\r\n\t},\r\n\t'spacing.padding': ( settings ) => settings.enableCustomSpacing,\r\n};\r\n\r\nconst prefixedFlags = {\r\n\t/*\r\n\t * These were only available in the plugin\r\n\t * and can be removed when the minimum WordPress version\r\n\t * for the plugin is 5.9.\r\n\t */\r\n\t'border.customColor': 'border.color',\r\n\t'border.customStyle': 'border.style',\r\n\t'border.customWidth': 'border.width',\r\n\t'typography.customFontStyle': 'typography.fontStyle',\r\n\t'typography.customFontWeight': 'typography.fontWeight',\r\n\t'typography.customLetterSpacing': 'typography.letterSpacing',\r\n\t'typography.customTextDecorations': 'typography.textDecoration',\r\n\t'typography.customTextTransforms': 'typography.textTransform',\r\n\t/*\r\n\t * These were part of WordPress 5.8 and we need to keep them.\r\n\t */\r\n\t'border.customRadius': 'border.radius',\r\n\t'spacing.customMargin': 'spacing.margin',\r\n\t'spacing.customPadding': 'spacing.padding',\r\n\t'typography.customLineHeight': 'typography.lineHeight',\r\n};\r\n\r\n/**\r\n * Remove `custom` prefixes for flags that did not land in 5.8.\r\n *\r\n * This provides continued support for `custom` prefixed properties. It will\r\n * be removed once third party devs have had sufficient time to update themes,\r\n * plugins, etc.\r\n *\r\n * @see https://github.com/WordPress/gutenberg/pull/34485\r\n *\r\n * @param {string} path Path to desired value in settings.\r\n * @return {string}     The value for defined setting.\r\n */\r\nconst removeCustomPrefixes = ( path ) => {\r\n\treturn prefixedFlags[ path ] || path;\r\n};\r\n\r\nexport function getBlockSettings( state, clientId, ...paths ) {\r\n\tconst blockName = getBlockName( state, clientId );\r\n\tconst candidates = [];\r\n\r\n\tif ( clientId ) {\r\n\t\tlet id = clientId;\r\n\t\tdo {\r\n\t\t\tconst name = getBlockName( state, id );\r\n\t\t\tif ( hasBlockSupport( name, '__experimentalSettings', false ) ) {\r\n\t\t\t\tcandidates.push( id );\r\n\t\t\t}\r\n\t\t} while ( ( id = state.blocks.parents.get( id ) ) );\r\n\t}\r\n\r\n\treturn paths.map( ( path ) => {\r\n\t\tif ( blockedPaths.includes( path ) ) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(\r\n\t\t\t\t'Top level useSetting paths are disabled. Please use a subpath to query the information needed.'\r\n\t\t\t);\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\t// 0. Allow third parties to filter the block's settings at runtime.\r\n\t\tlet result = applyFilters(\r\n\t\t\t'blockEditor.useSetting.before',\r\n\t\t\tundefined,\r\n\t\t\tpath,\r\n\t\t\tclientId,\r\n\t\t\tblockName\r\n\t\t);\r\n\r\n\t\tif ( undefined !== result ) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tconst normalizedPath = removeCustomPrefixes( path );\r\n\r\n\t\t// 1. Take settings from the block instance or its ancestors.\r\n\t\t// Start from the current block and work our way up the ancestors.\r\n\t\tfor ( const candidateClientId of candidates ) {\r\n\t\t\tconst candidateAtts = getBlockAttributes(\r\n\t\t\t\tstate,\r\n\t\t\t\tcandidateClientId\r\n\t\t\t);\r\n\t\t\tresult =\r\n\t\t\t\tgetValueFromObjectPath(\r\n\t\t\t\t\tcandidateAtts.settings?.blocks?.[ blockName ],\r\n\t\t\t\t\tnormalizedPath\r\n\t\t\t\t) ??\r\n\t\t\t\tgetValueFromObjectPath(\r\n\t\t\t\t\tcandidateAtts.settings,\r\n\t\t\t\t\tnormalizedPath\r\n\t\t\t\t);\r\n\t\t\tif ( result !== undefined ) {\r\n\t\t\t\t// Stop the search for more distant ancestors and move on.\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 2. Fall back to the settings from the block editor store (__experimentalFeatures).\r\n\t\tconst settings = getSettings( state );\r\n\t\tif ( result === undefined && blockName ) {\r\n\t\t\tresult = getValueFromObjectPath(\r\n\t\t\t\tsettings.__experimentalFeatures?.blocks?.[ blockName ],\r\n\t\t\t\tnormalizedPath\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ( result === undefined ) {\r\n\t\t\tresult = getValueFromObjectPath(\r\n\t\t\t\tsettings.__experimentalFeatures,\r\n\t\t\t\tnormalizedPath\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Return if the setting was found in either the block instance or the store.\r\n\t\tif ( result !== undefined ) {\r\n\t\t\tif ( PATHS_WITH_OVERRIDE[ normalizedPath ] ) {\r\n\t\t\t\treturn result.custom ?? result.theme ?? result.default;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// 3. Otherwise, use deprecated settings.\r\n\t\tconst deprecatedSettingsValue =\r\n\t\t\tdeprecatedFlags[ normalizedPath ]?.( settings );\r\n\t\tif ( deprecatedSettingsValue !== undefined ) {\r\n\t\t\treturn deprecatedSettingsValue;\r\n\t\t}\r\n\r\n\t\t// 4. Fallback for typography.dropCap:\r\n\t\t// This is only necessary to support typography.dropCap.\r\n\t\t// when __experimentalFeatures are not present (core without plugin).\r\n\t\t// To remove when __experimentalFeatures are ported to core.\r\n\t\treturn normalizedPath === 'typography.dropCap' ? true : undefined;\r\n\t} );\r\n}\r\n"],"mappings":"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","ignoreList":[]}