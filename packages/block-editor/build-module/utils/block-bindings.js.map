{"version":3,"names":["useDispatch","useRegistry","store","blockEditorStore","useBlockEditContext","isObjectEmpty","object","Object","keys","length","useBlockBindingsUtils","clientId","updateBlockAttributes","getBlockAttributes","select","updateBlockBindings","bindings","metadata","currentBindings","newBindings","entries","forEach","attribute","binding","newMetadata","undefined","removeAllBlockBindings"],"sources":["@wordpress/block-editor/src/utils/block-bindings.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useDispatch, useRegistry } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as blockEditorStore } from '../store';\r\nimport { useBlockEditContext } from '../components/block-edit';\r\n\r\nfunction isObjectEmpty( object ) {\r\n\treturn ! object || Object.keys( object ).length === 0;\r\n}\r\n\r\nexport function useBlockBindingsUtils() {\r\n\tconst { clientId } = useBlockEditContext();\r\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\r\n\tconst { getBlockAttributes } = useRegistry().select( blockEditorStore );\r\n\r\n\t/**\r\n\t * Updates the value of the bindings connected to block attributes.\r\n\t * It removes the binding when the new value is `undefined`.\r\n\t *\r\n\t * @param {Object} bindings        Bindings including the attributes to update and the new object.\r\n\t * @param {string} bindings.source The source name to connect to.\r\n\t * @param {Object} [bindings.args] Object containing the arguments needed by the source.\r\n\t *\r\n\t * @example\r\n\t * ```js\r\n\t * import { useBlockBindingsUtils } from '@wordpress/block-editor'\r\n\t *\r\n\t * const { updateBlockBindings } = useBlockBindingsUtils();\r\n\t * updateBlockBindings( {\r\n\t *     url: {\r\n\t *         source: 'core/post-meta',\r\n\t *         args: {\r\n\t *             key: 'url_custom_field',\r\n\t *         },\r\n\t * \t   },\r\n\t *     alt: {\r\n\t *         source: 'core/post-meta',\r\n\t *         args: {\r\n\t *             key: 'text_custom_field',\r\n\t *         },\r\n\t * \t   }\r\n\t * } );\r\n\t * ```\r\n\t */\r\n\tconst updateBlockBindings = ( bindings ) => {\r\n\t\tconst { metadata: { bindings: currentBindings, ...metadata } = {} } =\r\n\t\t\tgetBlockAttributes( clientId );\r\n\t\tconst newBindings = { ...currentBindings };\r\n\r\n\t\tObject.entries( bindings ).forEach( ( [ attribute, binding ] ) => {\r\n\t\t\tif ( ! binding && newBindings[ attribute ] ) {\r\n\t\t\t\tdelete newBindings[ attribute ];\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tnewBindings[ attribute ] = binding;\r\n\t\t} );\r\n\r\n\t\tconst newMetadata = {\r\n\t\t\t...metadata,\r\n\t\t\tbindings: newBindings,\r\n\t\t};\r\n\r\n\t\tif ( isObjectEmpty( newMetadata.bindings ) ) {\r\n\t\t\tdelete newMetadata.bindings;\r\n\t\t}\r\n\r\n\t\tupdateBlockAttributes( clientId, {\r\n\t\t\tmetadata: isObjectEmpty( newMetadata ) ? undefined : newMetadata,\r\n\t\t} );\r\n\t};\r\n\r\n\t/**\r\n\t * Removes the bindings property of the `metadata` attribute.\r\n\t *\r\n\t * @example\r\n\t * ```js\r\n\t * import { useBlockBindingsUtils } from '@wordpress/block-editor'\r\n\t *\r\n\t * const { removeAllBlockBindings } = useBlockBindingsUtils();\r\n\t * removeAllBlockBindings();\r\n\t * ```\r\n\t */\r\n\tconst removeAllBlockBindings = () => {\r\n\t\tconst { metadata: { bindings, ...metadata } = {} } =\r\n\t\t\tgetBlockAttributes( clientId );\r\n\t\tupdateBlockAttributes( clientId, {\r\n\t\t\tmetadata: isObjectEmpty( metadata ) ? undefined : metadata,\r\n\t\t} );\r\n\t};\r\n\r\n\treturn { updateBlockBindings, removeAllBlockBindings };\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,WAAW,EAAEC,WAAW,QAAQ,iBAAiB;;AAE1D;AACA;AACA;AACA,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,UAAU;AACpD,SAASC,mBAAmB,QAAQ,0BAA0B;AAE9D,SAASC,aAAaA,CAAEC,MAAM,EAAG;EAChC,OAAO,CAAEA,MAAM,IAAIC,MAAM,CAACC,IAAI,CAAEF,MAAO,CAAC,CAACG,MAAM,KAAK,CAAC;AACtD;AAEA,OAAO,SAASC,qBAAqBA,CAAA,EAAG;EACvC,MAAM;IAAEC;EAAS,CAAC,GAAGP,mBAAmB,CAAC,CAAC;EAC1C,MAAM;IAAEQ;EAAsB,CAAC,GAAGZ,WAAW,CAAEG,gBAAiB,CAAC;EACjE,MAAM;IAAEU;EAAmB,CAAC,GAAGZ,WAAW,CAAC,CAAC,CAACa,MAAM,CAAEX,gBAAiB,CAAC;;EAEvE;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,MAAMY,mBAAmB,GAAKC,QAAQ,IAAM;IAC3C,MAAM;MAAEC,QAAQ,EAAE;QAAED,QAAQ,EAAEE,eAAe;QAAE,GAAGD;MAAS,CAAC,GAAG,CAAC;IAAE,CAAC,GAClEJ,kBAAkB,CAAEF,QAAS,CAAC;IAC/B,MAAMQ,WAAW,GAAG;MAAE,GAAGD;IAAgB,CAAC;IAE1CX,MAAM,CAACa,OAAO,CAAEJ,QAAS,CAAC,CAACK,OAAO,CAAE,CAAE,CAAEC,SAAS,EAAEC,OAAO,CAAE,KAAM;MACjE,IAAK,CAAEA,OAAO,IAAIJ,WAAW,CAAEG,SAAS,CAAE,EAAG;QAC5C,OAAOH,WAAW,CAAEG,SAAS,CAAE;QAC/B;MACD;MACAH,WAAW,CAAEG,SAAS,CAAE,GAAGC,OAAO;IACnC,CAAE,CAAC;IAEH,MAAMC,WAAW,GAAG;MACnB,GAAGP,QAAQ;MACXD,QAAQ,EAAEG;IACX,CAAC;IAED,IAAKd,aAAa,CAAEmB,WAAW,CAACR,QAAS,CAAC,EAAG;MAC5C,OAAOQ,WAAW,CAACR,QAAQ;IAC5B;IAEAJ,qBAAqB,CAAED,QAAQ,EAAE;MAChCM,QAAQ,EAAEZ,aAAa,CAAEmB,WAAY,CAAC,GAAGC,SAAS,GAAGD;IACtD,CAAE,CAAC;EACJ,CAAC;;EAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,MAAME,sBAAsB,GAAGA,CAAA,KAAM;IACpC,MAAM;MAAET,QAAQ,EAAE;QAAED,QAAQ;QAAE,GAAGC;MAAS,CAAC,GAAG,CAAC;IAAE,CAAC,GACjDJ,kBAAkB,CAAEF,QAAS,CAAC;IAC/BC,qBAAqB,CAAED,QAAQ,EAAE;MAChCM,QAAQ,EAAEZ,aAAa,CAAEY,QAAS,CAAC,GAAGQ,SAAS,GAAGR;IACnD,CAAE,CAAC;EACJ,CAAC;EAED,OAAO;IAAEF,mBAAmB;IAAEW;EAAuB,CAAC;AACvD","ignoreList":[]}