{"version":3,"names":["clsx","isBlobURL","Disabled","PanelBody","SelectControl","Spinner","ToggleControl","BlockControls","BlockIcon","InspectorControls","MediaPlaceholder","MediaReplaceFlow","useBlockProps","__","_x","useDispatch","audio","icon","store","noticesStore","useState","createUpgradedEmbedBlock","useUploadMediaFromBlobURL","Caption","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ALLOWED_MEDIA_TYPES","AudioEdit","attributes","className","setAttributes","onReplace","isSelected","isSingleSelected","insertBlocksAfter","id","autoplay","loop","preload","src","temporaryURL","setTemporaryURL","blob","url","allowedTypes","onChange","onSelectAudio","onError","onUploadError","toggleAttribute","attribute","newValue","onSelectURL","newSrc","embedBlock","undefined","createErrorNotice","message","type","getAutoplayHelp","checked","media","caption","classes","blockProps","children","onSelect","accept","value","group","mediaId","mediaURL","onReset","title","__nextHasNoMarginBottom","label","help","__next40pxDefaultSize","options","isDisabled","controls","showToolbarButton"],"sources":["@wordpress/block-library/src/audio/edit.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { isBlobURL } from '@wordpress/blob';\r\nimport {\r\n\tDisabled,\r\n\tPanelBody,\r\n\tSelectControl,\r\n\tSpinner,\r\n\tToggleControl,\r\n} from '@wordpress/components';\r\nimport {\r\n\tBlockControls,\r\n\tBlockIcon,\r\n\tInspectorControls,\r\n\tMediaPlaceholder,\r\n\tMediaReplaceFlow,\r\n\tuseBlockProps,\r\n} from '@wordpress/block-editor';\r\nimport { __, _x } from '@wordpress/i18n';\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { audio as icon } from '@wordpress/icons';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { useState } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { createUpgradedEmbedBlock } from '../embed/util';\r\nimport { useUploadMediaFromBlobURL } from '../utils/hooks';\r\nimport { Caption } from '../utils/caption';\r\n\r\nconst ALLOWED_MEDIA_TYPES = [ 'audio' ];\r\n\r\nfunction AudioEdit( {\r\n\tattributes,\r\n\tclassName,\r\n\tsetAttributes,\r\n\tonReplace,\r\n\tisSelected: isSingleSelected,\r\n\tinsertBlocksAfter,\r\n} ) {\r\n\tconst { id, autoplay, loop, preload, src } = attributes;\r\n\tconst [ temporaryURL, setTemporaryURL ] = useState( attributes.blob );\r\n\r\n\tuseUploadMediaFromBlobURL( {\r\n\t\turl: temporaryURL,\r\n\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\r\n\t\tonChange: onSelectAudio,\r\n\t\tonError: onUploadError,\r\n\t} );\r\n\r\n\tfunction toggleAttribute( attribute ) {\r\n\t\treturn ( newValue ) => {\r\n\t\t\tsetAttributes( { [ attribute ]: newValue } );\r\n\t\t};\r\n\t}\r\n\r\n\tfunction onSelectURL( newSrc ) {\r\n\t\t// Set the block's src from the edit component's state, and switch off\r\n\t\t// the editing UI.\r\n\t\tif ( newSrc !== src ) {\r\n\t\t\t// Check if there's an embed block that handles this URL.\r\n\t\t\tconst embedBlock = createUpgradedEmbedBlock( {\r\n\t\t\t\tattributes: { url: newSrc },\r\n\t\t\t} );\r\n\t\t\tif ( undefined !== embedBlock && onReplace ) {\r\n\t\t\t\tonReplace( embedBlock );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsetAttributes( { src: newSrc, id: undefined, blob: undefined } );\r\n\t\t\tsetTemporaryURL();\r\n\t\t}\r\n\t}\r\n\r\n\tconst { createErrorNotice } = useDispatch( noticesStore );\r\n\tfunction onUploadError( message ) {\r\n\t\tcreateErrorNotice( message, { type: 'snackbar' } );\r\n\t}\r\n\r\n\tfunction getAutoplayHelp( checked ) {\r\n\t\treturn checked\r\n\t\t\t? __( 'Autoplay may cause usability issues for some users.' )\r\n\t\t\t: null;\r\n\t}\r\n\r\n\tfunction onSelectAudio( media ) {\r\n\t\tif ( ! media || ! media.url ) {\r\n\t\t\t// In this case there was an error and we should continue in the editing state\r\n\t\t\t// previous attributes should be removed because they may be temporary blob urls.\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tsrc: undefined,\r\n\t\t\t\tid: undefined,\r\n\t\t\t\tcaption: undefined,\r\n\t\t\t\tblob: undefined,\r\n\t\t\t} );\r\n\t\t\tsetTemporaryURL();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( isBlobURL( media.url ) ) {\r\n\t\t\tsetTemporaryURL( media.url );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Sets the block's attribute and updates the edit component from the\r\n\t\t// selected media, then switches off the editing UI.\r\n\t\tsetAttributes( {\r\n\t\t\tblob: undefined,\r\n\t\t\tsrc: media.url,\r\n\t\t\tid: media.id,\r\n\t\t\tcaption: media.caption,\r\n\t\t} );\r\n\t\tsetTemporaryURL();\r\n\t}\r\n\r\n\tconst classes = clsx( className, {\r\n\t\t'is-transient': !! temporaryURL,\r\n\t} );\r\n\r\n\tconst blockProps = useBlockProps( {\r\n\t\tclassName: classes,\r\n\t} );\r\n\r\n\tif ( ! src && ! temporaryURL ) {\r\n\t\treturn (\r\n\t\t\t<div { ...blockProps }>\r\n\t\t\t\t<MediaPlaceholder\r\n\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\r\n\t\t\t\t\tonSelect={ onSelectAudio }\r\n\t\t\t\t\tonSelectURL={ onSelectURL }\r\n\t\t\t\t\taccept=\"audio/*\"\r\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\r\n\t\t\t\t\tvalue={ attributes }\r\n\t\t\t\t\tonError={ onUploadError }\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ isSingleSelected && (\r\n\t\t\t\t<BlockControls group=\"other\">\r\n\t\t\t\t\t<MediaReplaceFlow\r\n\t\t\t\t\t\tmediaId={ id }\r\n\t\t\t\t\t\tmediaURL={ src }\r\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\r\n\t\t\t\t\t\taccept=\"audio/*\"\r\n\t\t\t\t\t\tonSelect={ onSelectAudio }\r\n\t\t\t\t\t\tonSelectURL={ onSelectURL }\r\n\t\t\t\t\t\tonError={ onUploadError }\r\n\t\t\t\t\t\tonReset={ () => onSelectAudio( undefined ) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</BlockControls>\r\n\t\t\t) }\r\n\t\t\t<InspectorControls>\r\n\t\t\t\t<PanelBody title={ __( 'Settings' ) }>\r\n\t\t\t\t\t<ToggleControl\r\n\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\tlabel={ __( 'Autoplay' ) }\r\n\t\t\t\t\t\tonChange={ toggleAttribute( 'autoplay' ) }\r\n\t\t\t\t\t\tchecked={ autoplay }\r\n\t\t\t\t\t\thelp={ getAutoplayHelp }\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<ToggleControl\r\n\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\tlabel={ __( 'Loop' ) }\r\n\t\t\t\t\t\tonChange={ toggleAttribute( 'loop' ) }\r\n\t\t\t\t\t\tchecked={ loop }\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<SelectControl\r\n\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\tlabel={ _x( 'Preload', 'noun; Audio block parameter' ) }\r\n\t\t\t\t\t\tvalue={ preload || '' }\r\n\t\t\t\t\t\t// `undefined` is required for the preload attribute to be unset.\r\n\t\t\t\t\t\tonChange={ ( value ) =>\r\n\t\t\t\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t\t\t\tpreload: value || undefined,\r\n\t\t\t\t\t\t\t} )\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\toptions={ [\r\n\t\t\t\t\t\t\t{ value: '', label: __( 'Browser default' ) },\r\n\t\t\t\t\t\t\t{ value: 'auto', label: __( 'Auto' ) },\r\n\t\t\t\t\t\t\t{ value: 'metadata', label: __( 'Metadata' ) },\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: 'none',\r\n\t\t\t\t\t\t\t\tlabel: _x( 'None', 'Preload value' ),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t] }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</PanelBody>\r\n\t\t\t</InspectorControls>\r\n\t\t\t<figure { ...blockProps }>\r\n\t\t\t\t{ /*\r\n\t\t\t\tDisable the audio tag if the block is not selected\r\n\t\t\t\tso the user clicking on it won't play the\r\n\t\t\t\tfile or change the position slider when the controls are enabled.\r\n\t\t\t\t*/ }\r\n\t\t\t\t<Disabled isDisabled={ ! isSingleSelected }>\r\n\t\t\t\t\t<audio controls=\"controls\" src={ src ?? temporaryURL } />\r\n\t\t\t\t</Disabled>\r\n\t\t\t\t{ !! temporaryURL && <Spinner /> }\r\n\t\t\t\t<Caption\r\n\t\t\t\t\tattributes={ attributes }\r\n\t\t\t\t\tsetAttributes={ setAttributes }\r\n\t\t\t\t\tisSelected={ isSingleSelected }\r\n\t\t\t\t\tinsertBlocksAfter={ insertBlocksAfter }\r\n\t\t\t\t\tlabel={ __( 'Audio caption text' ) }\r\n\t\t\t\t\tshowToolbarButton={ isSingleSelected }\r\n\t\t\t\t/>\r\n\t\t\t</figure>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default AudioEdit;\r\n"],"mappings":"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","ignoreList":[]}