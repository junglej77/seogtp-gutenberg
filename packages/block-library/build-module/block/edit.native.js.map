{"version":3,"names":["ActivityIndicator","Platform","Text","TouchableWithoutFeedback","View","useState","useCallback","useEntityBlockEditor","useEntityProp","store","coreStore","BottomSheet","Icon","Disabled","TextControl","useSelect","useDispatch","__","sprintf","RecursionProvider","useHasRecursion","InnerBlocks","Warning","blockEditorStore","usePreferredColorSchemeStyle","help","reusableBlocksStore","editorStore","noticesStore","styles","EditTitle","jsx","_jsx","jsxs","_jsxs","ReusableBlockEdit","attributes","ref","clientId","isSelected","hasAlreadyRendered","showHelp","setShowHelp","infoTextStyle","infoText","infoTextDark","infoTitleStyle","infoTitle","infoTitleDark","infoSheetIconStyle","infoSheetIcon","infoSheetIconDark","infoDescriptionStyle","infoDescription","infoDescriptionDark","actionButtonStyle","actionButton","actionButtonDark","spinnerStyle","spinner","spinnerDark","hasResolved","isEditing","isMissing","select","persistedBlock","getEntityRecord","hasResolvedBlock","hasFinishedResolution","getBlockCount","__experimentalIsEditingReusableBlock","innerBlockCount","hostAppNamespace","getEditorSettings","createSuccessNotice","__experimentalConvertBlockToStatic","convertBlockToStatic","clearSelectedBlock","blocks","onInput","onChange","id","title","openSheet","closeSheet","onConvertToRegularBlocks","successNotice","setImmediate","renderSheet","OS","isVisible","hideHeader","onClose","children","style","infoContainer","icon","color","size","label","separatorType","onPress","labelStyle","message","animating","element","value","uniqueId","disabled","accessibilityLabel","accessibilityRole","accessibilityHint"],"sources":["@wordpress/block-library/src/block/edit.native.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport {\r\n\tActivityIndicator,\r\n\tPlatform,\r\n\tText,\r\n\tTouchableWithoutFeedback,\r\n\tView,\r\n} from 'react-native';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useState, useCallback } from '@wordpress/element';\r\nimport {\r\n\tuseEntityBlockEditor,\r\n\tuseEntityProp,\r\n\tstore as coreStore,\r\n} from '@wordpress/core-data';\r\nimport {\r\n\tBottomSheet,\r\n\tIcon,\r\n\tDisabled,\r\n\tTextControl,\r\n} from '@wordpress/components';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport {\r\n\tRecursionProvider,\r\n\tuseHasRecursion,\r\n\tInnerBlocks,\r\n\tWarning,\r\n\tstore as blockEditorStore,\r\n} from '@wordpress/block-editor';\r\nimport { usePreferredColorSchemeStyle } from '@wordpress/compose';\r\nimport { help } from '@wordpress/icons';\r\nimport { store as reusableBlocksStore } from '@wordpress/reusable-blocks';\r\nimport { store as editorStore } from '@wordpress/editor';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport styles from './editor.scss';\r\nimport EditTitle from './edit-title';\r\n\r\nexport default function ReusableBlockEdit( {\r\n\tattributes: { ref },\r\n\tclientId,\r\n\tisSelected,\r\n} ) {\r\n\tconst hasAlreadyRendered = useHasRecursion( ref );\r\n\r\n\tconst [ showHelp, setShowHelp ] = useState( false );\r\n\tconst infoTextStyle = usePreferredColorSchemeStyle(\r\n\t\tstyles.infoText,\r\n\t\tstyles.infoTextDark\r\n\t);\r\n\tconst infoTitleStyle = usePreferredColorSchemeStyle(\r\n\t\tstyles.infoTitle,\r\n\t\tstyles.infoTitleDark\r\n\t);\r\n\tconst infoSheetIconStyle = usePreferredColorSchemeStyle(\r\n\t\tstyles.infoSheetIcon,\r\n\t\tstyles.infoSheetIconDark\r\n\t);\r\n\tconst infoDescriptionStyle = usePreferredColorSchemeStyle(\r\n\t\tstyles.infoDescription,\r\n\t\tstyles.infoDescriptionDark\r\n\t);\r\n\tconst actionButtonStyle = usePreferredColorSchemeStyle(\r\n\t\tstyles.actionButton,\r\n\t\tstyles.actionButtonDark\r\n\t);\r\n\tconst spinnerStyle = usePreferredColorSchemeStyle(\r\n\t\tstyles.spinner,\r\n\t\tstyles.spinnerDark\r\n\t);\r\n\r\n\tconst { hasResolved, isEditing, isMissing } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst persistedBlock = select( coreStore ).getEntityRecord(\r\n\t\t\t\t'postType',\r\n\t\t\t\t'wp_block',\r\n\t\t\t\tref\r\n\t\t\t);\r\n\t\t\tconst hasResolvedBlock = select( coreStore ).hasFinishedResolution(\r\n\t\t\t\t'getEntityRecord',\r\n\t\t\t\t[ 'postType', 'wp_block', ref ]\r\n\t\t\t);\r\n\r\n\t\t\tconst { getBlockCount } = select( blockEditorStore );\r\n\r\n\t\t\treturn {\r\n\t\t\t\thasResolved: hasResolvedBlock,\r\n\t\t\t\tisEditing:\r\n\t\t\t\t\tselect(\r\n\t\t\t\t\t\treusableBlocksStore\r\n\t\t\t\t\t).__experimentalIsEditingReusableBlock( clientId ),\r\n\t\t\t\tisMissing: hasResolvedBlock && ! persistedBlock,\r\n\t\t\t\tinnerBlockCount: getBlockCount( clientId ),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ ref, clientId ]\r\n\t);\r\n\tconst hostAppNamespace = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( editorStore ).getEditorSettings().hostAppNamespace,\r\n\t\t[]\r\n\t);\r\n\r\n\tconst { createSuccessNotice } = useDispatch( noticesStore );\r\n\tconst { __experimentalConvertBlockToStatic: convertBlockToStatic } =\r\n\t\tuseDispatch( reusableBlocksStore );\r\n\tconst { clearSelectedBlock } = useDispatch( blockEditorStore );\r\n\r\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\r\n\t\t'postType',\r\n\t\t'wp_block',\r\n\t\t{ id: ref }\r\n\t);\r\n\r\n\tconst [ title ] = useEntityProp( 'postType', 'wp_block', 'title', ref );\r\n\r\n\tfunction openSheet() {\r\n\t\tsetShowHelp( true );\r\n\t}\r\n\r\n\tfunction closeSheet() {\r\n\t\tsetShowHelp( false );\r\n\t}\r\n\r\n\tconst onConvertToRegularBlocks = useCallback( () => {\r\n\t\t/* translators: %s: name of the synced block */\r\n\t\tconst successNotice = __( '%s detached' );\r\n\t\tcreateSuccessNotice( sprintf( successNotice, title ) );\r\n\r\n\t\tclearSelectedBlock();\r\n\t\t// Convert action is executed at the end of the current JavaScript execution block\r\n\t\t// to prevent issues related to undo/redo actions.\r\n\t\tsetImmediate( () => convertBlockToStatic( clientId ) );\r\n\t}, [ title, clientId ] );\r\n\r\n\tfunction renderSheet() {\r\n\t\tconst infoTitle =\r\n\t\t\tPlatform.OS === 'android'\r\n\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t/* translators: %s: name of the host app (e.g. WordPress) */\r\n\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t'Editing synced patterns is not yet supported on %s for Android'\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\thostAppNamespace\r\n\t\t\t\t  )\r\n\t\t\t\t: sprintf(\r\n\t\t\t\t\t\t/* translators: %s: name of the host app (e.g. WordPress) */\r\n\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t'Editing synced patterns is not yet supported on %s for iOS'\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\thostAppNamespace\r\n\t\t\t\t  );\r\n\r\n\t\treturn (\r\n\t\t\t<BottomSheet\r\n\t\t\t\tisVisible={ showHelp }\r\n\t\t\t\thideHeader\r\n\t\t\t\tonClose={ closeSheet }\r\n\t\t\t>\r\n\t\t\t\t<View style={ styles.infoContainer }>\r\n\t\t\t\t\t<Icon\r\n\t\t\t\t\t\ticon={ help }\r\n\t\t\t\t\t\tcolor={ infoSheetIconStyle.color }\r\n\t\t\t\t\t\tsize={ styles.infoSheetIcon.size }\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Text style={ [ infoTextStyle, infoTitleStyle ] }>\r\n\t\t\t\t\t\t{ infoTitle }\r\n\t\t\t\t\t</Text>\r\n\t\t\t\t\t<Text style={ [ infoTextStyle, infoDescriptionStyle ] }>\r\n\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t'Alternatively, you can detach and edit this block separately by tapping “Detach”.'\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t</Text>\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\tlabel={ __( 'Detach' ) }\r\n\t\t\t\t\t\tseparatorType=\"topFullWidth\"\r\n\t\t\t\t\t\tonPress={ onConvertToRegularBlocks }\r\n\t\t\t\t\t\tlabelStyle={ actionButtonStyle }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</View>\r\n\t\t\t</BottomSheet>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( hasAlreadyRendered ) {\r\n\t\treturn (\r\n\t\t\t<Warning\r\n\t\t\t\tmessage={ __( 'Block cannot be rendered inside itself.' ) }\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( isMissing ) {\r\n\t\treturn (\r\n\t\t\t<Warning\r\n\t\t\t\tmessage={ __( 'Block has been deleted or is unavailable.' ) }\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( ! hasResolved ) {\r\n\t\treturn (\r\n\t\t\t<View style={ spinnerStyle }>\r\n\t\t\t\t<ActivityIndicator animating />\r\n\t\t\t</View>\r\n\t\t);\r\n\t}\r\n\r\n\tlet element = (\r\n\t\t<InnerBlocks\r\n\t\t\tvalue={ blocks }\r\n\t\t\tonChange={ onChange }\r\n\t\t\tonInput={ onInput }\r\n\t\t/>\r\n\t);\r\n\r\n\tif ( ! isEditing ) {\r\n\t\telement = <Disabled>{ element }</Disabled>;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<RecursionProvider uniqueId={ ref }>\r\n\t\t\t<TouchableWithoutFeedback\r\n\t\t\t\tdisabled={ ! isSelected }\r\n\t\t\t\taccessibilityLabel={ __( 'Help button' ) }\r\n\t\t\t\taccessibilityRole=\"button\"\r\n\t\t\t\taccessibilityHint={ __( 'Tap here to show help' ) }\r\n\t\t\t\tonPress={ openSheet }\r\n\t\t\t>\r\n\t\t\t\t<View>\r\n\t\t\t\t\t{ isSelected && <EditTitle title={ title } /> }\r\n\t\t\t\t\t{ element }\r\n\t\t\t\t\t{ renderSheet() }\r\n\t\t\t\t</View>\r\n\t\t\t</TouchableWithoutFeedback>\r\n\t\t</RecursionProvider>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}