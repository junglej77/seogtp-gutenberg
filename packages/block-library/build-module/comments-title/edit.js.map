{"version":3,"names":["clsx","AlignmentControl","BlockControls","useBlockProps","InspectorControls","store","blockEditorStore","HeadingLevelDropdown","__","_n","sprintf","useEntityProp","PanelBody","ToggleControl","useState","useEffect","useSelect","apiFetch","addQueryArgs","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Edit","attributes","textAlign","showPostTitle","showCommentsCount","level","levelOptions","setAttributes","context","postType","postId","TagName","commentsCount","setCommentsCount","rawTitle","isSiteEditor","blockProps","className","threadCommentsDepth","threadComments","commentsPerPage","pageComments","select","getSettings","__experimentalDiscussionSettings","nestedCommentsNumber","Math","min","topLevelCommentsNumber","commentsNumber","parseInt","currentPostId","path","post","_fields","method","parse","then","res","headers","get","catch","blockControls","group","children","value","onChange","newAlign","options","newLevel","inspectorControls","title","__nextHasNoMarginBottom","label","checked","postTitle","placeholder","undefined"],"sources":["@wordpress/block-library/src/comments-title/edit.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tAlignmentControl,\r\n\tBlockControls,\r\n\tuseBlockProps,\r\n\tInspectorControls,\r\n\tstore as blockEditorStore,\r\n\tHeadingLevelDropdown,\r\n} from '@wordpress/block-editor';\r\nimport { __, _n, sprintf } from '@wordpress/i18n';\r\nimport { useEntityProp } from '@wordpress/core-data';\r\nimport { PanelBody, ToggleControl } from '@wordpress/components';\r\nimport { useState, useEffect } from '@wordpress/element';\r\nimport { useSelect } from '@wordpress/data';\r\nimport apiFetch from '@wordpress/api-fetch';\r\nimport { addQueryArgs } from '@wordpress/url';\r\n\r\nexport default function Edit( {\r\n\tattributes: {\r\n\t\ttextAlign,\r\n\t\tshowPostTitle,\r\n\t\tshowCommentsCount,\r\n\t\tlevel,\r\n\t\tlevelOptions,\r\n\t},\r\n\tsetAttributes,\r\n\tcontext: { postType, postId },\r\n} ) {\r\n\tconst TagName = 'h' + level;\r\n\tconst [ commentsCount, setCommentsCount ] = useState();\r\n\tconst [ rawTitle ] = useEntityProp( 'postType', postType, 'title', postId );\r\n\tconst isSiteEditor = typeof postId === 'undefined';\r\n\tconst blockProps = useBlockProps( {\r\n\t\tclassName: clsx( {\r\n\t\t\t[ `has-text-align-${ textAlign }` ]: textAlign,\r\n\t\t} ),\r\n\t} );\r\n\r\n\tconst {\r\n\t\tthreadCommentsDepth,\r\n\t\tthreadComments,\r\n\t\tcommentsPerPage,\r\n\t\tpageComments,\r\n\t} = useSelect( ( select ) => {\r\n\t\tconst { getSettings } = select( blockEditorStore );\r\n\t\treturn getSettings().__experimentalDiscussionSettings;\r\n\t} );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( isSiteEditor ) {\r\n\t\t\t// Match the number of comments that will be shown in the comment-template/edit.js placeholder\r\n\r\n\t\t\tconst nestedCommentsNumber = threadComments\r\n\t\t\t\t? Math.min( threadCommentsDepth, 3 ) - 1\r\n\t\t\t\t: 0;\r\n\t\t\tconst topLevelCommentsNumber = pageComments ? commentsPerPage : 3;\r\n\r\n\t\t\tconst commentsNumber =\r\n\t\t\t\tparseInt( nestedCommentsNumber ) +\r\n\t\t\t\tparseInt( topLevelCommentsNumber );\r\n\r\n\t\t\tsetCommentsCount( Math.min( commentsNumber, 3 ) );\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst currentPostId = postId;\r\n\t\tapiFetch( {\r\n\t\t\tpath: addQueryArgs( '/wp/v2/comments', {\r\n\t\t\t\tpost: postId,\r\n\t\t\t\t_fields: 'id',\r\n\t\t\t} ),\r\n\t\t\tmethod: 'HEAD',\r\n\t\t\tparse: false,\r\n\t\t} )\r\n\t\t\t.then( ( res ) => {\r\n\t\t\t\t// Stale requests will have the `currentPostId` of an older closure.\r\n\t\t\t\tif ( currentPostId === postId ) {\r\n\t\t\t\t\tsetCommentsCount(\r\n\t\t\t\t\t\tparseInt( res.headers.get( 'X-WP-Total' ) )\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} )\r\n\t\t\t.catch( () => {\r\n\t\t\t\tsetCommentsCount( 0 );\r\n\t\t\t} );\r\n\t}, [ postId ] );\r\n\r\n\tconst blockControls = (\r\n\t\t<BlockControls group=\"block\">\r\n\t\t\t<AlignmentControl\r\n\t\t\t\tvalue={ textAlign }\r\n\t\t\t\tonChange={ ( newAlign ) =>\r\n\t\t\t\t\tsetAttributes( { textAlign: newAlign } )\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t\t<HeadingLevelDropdown\r\n\t\t\t\tvalue={ level }\r\n\t\t\t\toptions={ levelOptions }\r\n\t\t\t\tonChange={ ( newLevel ) =>\r\n\t\t\t\t\tsetAttributes( { level: newLevel } )\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t</BlockControls>\r\n\t);\r\n\r\n\tconst inspectorControls = (\r\n\t\t<InspectorControls>\r\n\t\t\t<PanelBody title={ __( 'Settings' ) }>\r\n\t\t\t\t<ToggleControl\r\n\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\tlabel={ __( 'Show post title' ) }\r\n\t\t\t\t\tchecked={ showPostTitle }\r\n\t\t\t\t\tonChange={ ( value ) =>\r\n\t\t\t\t\t\tsetAttributes( { showPostTitle: value } )\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t\t<ToggleControl\r\n\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\tlabel={ __( 'Show comments count' ) }\r\n\t\t\t\t\tchecked={ showCommentsCount }\r\n\t\t\t\t\tonChange={ ( value ) =>\r\n\t\t\t\t\t\tsetAttributes( { showCommentsCount: value } )\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t</PanelBody>\r\n\t\t</InspectorControls>\r\n\t);\r\n\r\n\tconst postTitle = isSiteEditor ? __( '“Post Title”' ) : `\"${ rawTitle }\"`;\r\n\r\n\tlet placeholder;\r\n\tif ( showCommentsCount && commentsCount !== undefined ) {\r\n\t\tif ( showPostTitle ) {\r\n\t\t\tif ( commentsCount === 1 ) {\r\n\t\t\t\t/* translators: %s: Post title. */\r\n\t\t\t\tplaceholder = sprintf( __( 'One response to %s' ), postTitle );\r\n\t\t\t} else {\r\n\t\t\t\tplaceholder = sprintf(\r\n\t\t\t\t\t/* translators: 1: Number of comments, 2: Post title. */\r\n\t\t\t\t\t_n(\r\n\t\t\t\t\t\t'%1$s response to %2$s',\r\n\t\t\t\t\t\t'%1$s responses to %2$s',\r\n\t\t\t\t\t\tcommentsCount\r\n\t\t\t\t\t),\r\n\t\t\t\t\tcommentsCount,\r\n\t\t\t\t\tpostTitle\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else if ( commentsCount === 1 ) {\r\n\t\t\tplaceholder = __( 'One response' );\r\n\t\t} else {\r\n\t\t\tplaceholder = sprintf(\r\n\t\t\t\t/* translators: %s: Number of comments. */\r\n\t\t\t\t_n( '%s response', '%s responses', commentsCount ),\r\n\t\t\t\tcommentsCount\r\n\t\t\t);\r\n\t\t}\r\n\t} else if ( showPostTitle ) {\r\n\t\tif ( commentsCount === 1 ) {\r\n\t\t\t/* translators: %s: Post title. */\r\n\t\t\tplaceholder = sprintf( __( 'Response to %s' ), postTitle );\r\n\t\t} else {\r\n\t\t\t/* translators: %s: Post title. */\r\n\t\t\tplaceholder = sprintf( __( 'Responses to %s' ), postTitle );\r\n\t\t}\r\n\t} else if ( commentsCount === 1 ) {\r\n\t\tplaceholder = __( 'Response' );\r\n\t} else {\r\n\t\tplaceholder = __( 'Responses' );\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ blockControls }\r\n\t\t\t{ inspectorControls }\r\n\t\t\t<TagName { ...blockProps }>{ placeholder }</TagName>\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}