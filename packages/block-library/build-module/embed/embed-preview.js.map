{"version":3,"names":["getPhotoHtml","clsx","__","sprintf","Placeholder","SandBox","BlockIcon","Component","getAuthority","WpEmbedPreview","Caption","jsx","_jsx","jsxs","_jsxs","EmbedPreview","constructor","arguments","hideOverlay","bind","state","interactive","getDerivedStateFromProps","nextProps","isSelected","setState","render","preview","previewable","url","type","className","icon","label","insertBlocksAfter","attributes","setAttributes","props","scripts","html","embedSourceUrl","iframeTitle","sandboxClassnames","embedWrapper","children","title","onFocus","onMouseUp","showColors","href","showToolbarButton"],"sources":["@wordpress/block-library/src/embed/embed-preview.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport { getPhotoHtml } from './util';\r\n\r\n/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { Placeholder, SandBox } from '@wordpress/components';\r\nimport { BlockIcon } from '@wordpress/block-editor';\r\nimport { Component } from '@wordpress/element';\r\nimport { getAuthority } from '@wordpress/url';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport WpEmbedPreview from './wp-embed-preview';\r\nimport { Caption } from '../utils/caption';\r\n\r\nclass EmbedPreview extends Component {\r\n\tconstructor() {\r\n\t\tsuper( ...arguments );\r\n\t\tthis.hideOverlay = this.hideOverlay.bind( this );\r\n\t\tthis.state = {\r\n\t\t\tinteractive: false,\r\n\t\t};\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps( nextProps, state ) {\r\n\t\tif ( ! nextProps.isSelected && state.interactive ) {\r\n\t\t\t// We only want to change this when the block is not selected, because changing it when\r\n\t\t\t// the block becomes selected makes the overlap disappear too early. Hiding the overlay\r\n\t\t\t// happens on mouseup when the overlay is clicked.\r\n\t\t\treturn { interactive: false };\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\thideOverlay() {\r\n\t\t// This is called onMouseUp on the overlay. We can't respond to the `isSelected` prop\r\n\t\t// changing, because that happens on mouse down, and the overlay immediately disappears,\r\n\t\t// and the mouse event can end up in the preview content. We can't use onClick on\r\n\t\t// the overlay to hide it either, because then the editor misses the mouseup event, and\r\n\t\t// thinks we're multi-selecting blocks.\r\n\t\tthis.setState( { interactive: true } );\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tpreview,\r\n\t\t\tpreviewable,\r\n\t\t\turl,\r\n\t\t\ttype,\r\n\t\t\tclassName,\r\n\t\t\ticon,\r\n\t\t\tlabel,\r\n\t\t\tinsertBlocksAfter,\r\n\t\t\tattributes,\r\n\t\t\tsetAttributes,\r\n\t\t\tisSelected,\r\n\t\t} = this.props;\r\n\t\tconst { scripts } = preview;\r\n\t\tconst { interactive } = this.state;\r\n\r\n\t\tconst html = 'photo' === type ? getPhotoHtml( preview ) : preview.html;\r\n\t\tconst embedSourceUrl = getAuthority( url );\r\n\t\tconst iframeTitle = sprintf(\r\n\t\t\t// translators: %s: host providing embed content e.g: www.youtube.com\r\n\t\t\t__( 'Embedded content from %s' ),\r\n\t\t\tembedSourceUrl\r\n\t\t);\r\n\t\tconst sandboxClassnames = clsx(\r\n\t\t\ttype,\r\n\t\t\tclassName,\r\n\t\t\t'wp-block-embed__wrapper'\r\n\t\t);\r\n\r\n\t\t// Disabled because the overlay div doesn't actually have a role or functionality\r\n\t\t// as far as the user is concerned. We're just catching the first click so that\r\n\t\t// the block can be selected without interacting with the embed preview that the overlay covers.\r\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\r\n\t\tconst embedWrapper =\r\n\t\t\t'wp-embed' === type ? (\r\n\t\t\t\t<WpEmbedPreview html={ html } />\r\n\t\t\t) : (\r\n\t\t\t\t<div className=\"wp-block-embed__wrapper\">\r\n\t\t\t\t\t<SandBox\r\n\t\t\t\t\t\thtml={ html }\r\n\t\t\t\t\t\tscripts={ scripts }\r\n\t\t\t\t\t\ttitle={ iframeTitle }\r\n\t\t\t\t\t\ttype={ sandboxClassnames }\r\n\t\t\t\t\t\tonFocus={ this.hideOverlay }\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{ ! interactive && (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName=\"block-library-embed__interactive-overlay\"\r\n\t\t\t\t\t\t\tonMouseUp={ this.hideOverlay }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\r\n\r\n\t\treturn (\r\n\t\t\t<figure\r\n\t\t\t\tclassName={ clsx( className, 'wp-block-embed', {\r\n\t\t\t\t\t'is-type-video': 'video' === type,\r\n\t\t\t\t} ) }\r\n\t\t\t>\r\n\t\t\t\t{ previewable ? (\r\n\t\t\t\t\tembedWrapper\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<Placeholder\r\n\t\t\t\t\t\ticon={ <BlockIcon icon={ icon } showColors /> }\r\n\t\t\t\t\t\tlabel={ label }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<p className=\"components-placeholder__error\">\r\n\t\t\t\t\t\t\t<a href={ url }>{ url }</a>\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t<p className=\"components-placeholder__error\">\r\n\t\t\t\t\t\t\t{ sprintf(\r\n\t\t\t\t\t\t\t\t/* translators: %s: host providing embed content e.g: www.youtube.com */\r\n\t\t\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t\t\t\"Embedded content from %s can't be previewed in the editor.\"\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\tembedSourceUrl\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</Placeholder>\r\n\t\t\t\t) }\r\n\t\t\t\t<Caption\r\n\t\t\t\t\tattributes={ attributes }\r\n\t\t\t\t\tsetAttributes={ setAttributes }\r\n\t\t\t\t\tisSelected={ isSelected }\r\n\t\t\t\t\tinsertBlocksAfter={ insertBlocksAfter }\r\n\t\t\t\t\tlabel={ __( 'Embed caption text' ) }\r\n\t\t\t\t\tshowToolbarButton={ isSelected }\r\n\t\t\t\t/>\r\n\t\t\t</figure>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default EmbedPreview;\r\n"],"mappings":"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","ignoreList":[]}