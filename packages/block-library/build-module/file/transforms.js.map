{"version":3,"names":["createBlobURL","createBlock","select","store","coreStore","getFilename","transforms","from","type","isMatch","files","length","priority","transform","blocks","forEach","file","blobURL","push","blob","fileName","name","attributes","href","src","caption","textLinkHref","id","anchor","url","to","getMedia","media","mime_type","includes"],"sources":["@wordpress/block-library/src/file/transforms.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createBlobURL } from '@wordpress/blob';\r\nimport { createBlock } from '@wordpress/blocks';\r\nimport { select } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { getFilename } from '@wordpress/url';\r\n\r\nconst transforms = {\r\n\tfrom: [\r\n\t\t{\r\n\t\t\ttype: 'files',\r\n\t\t\tisMatch( files ) {\r\n\t\t\t\treturn files.length > 0;\r\n\t\t\t},\r\n\t\t\t// We define a lower priorty (higher number) than the default of 10. This\r\n\t\t\t// ensures that the File block is only created as a fallback.\r\n\t\t\tpriority: 15,\r\n\t\t\ttransform: ( files ) => {\r\n\t\t\t\tconst blocks = [];\r\n\r\n\t\t\t\tfiles.forEach( ( file ) => {\r\n\t\t\t\t\tconst blobURL = createBlobURL( file );\r\n\r\n\t\t\t\t\t// File will be uploaded in componentDidMount()\r\n\t\t\t\t\tblocks.push(\r\n\t\t\t\t\t\tcreateBlock( 'core/file', {\r\n\t\t\t\t\t\t\tblob: blobURL,\r\n\t\t\t\t\t\t\tfileName: file.name,\r\n\t\t\t\t\t\t} )\r\n\t\t\t\t\t);\r\n\t\t\t\t} );\r\n\r\n\t\t\t\treturn blocks;\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'block',\r\n\t\t\tblocks: [ 'core/audio' ],\r\n\t\t\ttransform: ( attributes ) => {\r\n\t\t\t\treturn createBlock( 'core/file', {\r\n\t\t\t\t\thref: attributes.src,\r\n\t\t\t\t\tfileName: attributes.caption,\r\n\t\t\t\t\ttextLinkHref: attributes.src,\r\n\t\t\t\t\tid: attributes.id,\r\n\t\t\t\t\tanchor: attributes.anchor,\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'block',\r\n\t\t\tblocks: [ 'core/video' ],\r\n\t\t\ttransform: ( attributes ) => {\r\n\t\t\t\treturn createBlock( 'core/file', {\r\n\t\t\t\t\thref: attributes.src,\r\n\t\t\t\t\tfileName: attributes.caption,\r\n\t\t\t\t\ttextLinkHref: attributes.src,\r\n\t\t\t\t\tid: attributes.id,\r\n\t\t\t\t\tanchor: attributes.anchor,\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'block',\r\n\t\t\tblocks: [ 'core/image' ],\r\n\t\t\ttransform: ( attributes ) => {\r\n\t\t\t\treturn createBlock( 'core/file', {\r\n\t\t\t\t\thref: attributes.url,\r\n\t\t\t\t\tfileName:\r\n\t\t\t\t\t\tattributes.caption || getFilename( attributes.url ),\r\n\t\t\t\t\ttextLinkHref: attributes.url,\r\n\t\t\t\t\tid: attributes.id,\r\n\t\t\t\t\tanchor: attributes.anchor,\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t},\r\n\t],\r\n\tto: [\r\n\t\t{\r\n\t\t\ttype: 'block',\r\n\t\t\tblocks: [ 'core/audio' ],\r\n\t\t\tisMatch: ( { id } ) => {\r\n\t\t\t\tif ( ! id ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tconst { getMedia } = select( coreStore );\r\n\t\t\t\tconst media = getMedia( id );\r\n\t\t\t\treturn !! media && media.mime_type.includes( 'audio' );\r\n\t\t\t},\r\n\t\t\ttransform: ( attributes ) => {\r\n\t\t\t\treturn createBlock( 'core/audio', {\r\n\t\t\t\t\tsrc: attributes.href,\r\n\t\t\t\t\tcaption: attributes.fileName,\r\n\t\t\t\t\tid: attributes.id,\r\n\t\t\t\t\tanchor: attributes.anchor,\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'block',\r\n\t\t\tblocks: [ 'core/video' ],\r\n\t\t\tisMatch: ( { id } ) => {\r\n\t\t\t\tif ( ! id ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tconst { getMedia } = select( coreStore );\r\n\t\t\t\tconst media = getMedia( id );\r\n\t\t\t\treturn !! media && media.mime_type.includes( 'video' );\r\n\t\t\t},\r\n\t\t\ttransform: ( attributes ) => {\r\n\t\t\t\treturn createBlock( 'core/video', {\r\n\t\t\t\t\tsrc: attributes.href,\r\n\t\t\t\t\tcaption: attributes.fileName,\r\n\t\t\t\t\tid: attributes.id,\r\n\t\t\t\t\tanchor: attributes.anchor,\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'block',\r\n\t\t\tblocks: [ 'core/image' ],\r\n\t\t\tisMatch: ( { id } ) => {\r\n\t\t\t\tif ( ! id ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tconst { getMedia } = select( coreStore );\r\n\t\t\t\tconst media = getMedia( id );\r\n\t\t\t\treturn !! media && media.mime_type.includes( 'image' );\r\n\t\t\t},\r\n\t\t\ttransform: ( attributes ) => {\r\n\t\t\t\treturn createBlock( 'core/image', {\r\n\t\t\t\t\turl: attributes.href,\r\n\t\t\t\t\tcaption: attributes.fileName,\r\n\t\t\t\t\tid: attributes.id,\r\n\t\t\t\t\tanchor: attributes.anchor,\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t},\r\n\t],\r\n};\r\n\r\nexport default transforms;\r\n"],"mappings":"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","ignoreList":[]}