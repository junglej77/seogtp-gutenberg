{"version":3,"names":["clsx","__","useEffect","Platform","useDispatch","useSelect","createBlock","getDefaultBlockName","AlignmentControl","BlockControls","RichText","useBlockProps","store","blockEditorStore","HeadingLevelDropdown","generateAnchor","setAnchor","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","HeadingEdit","attributes","setAttributes","mergeBlocks","onReplace","style","clientId","textAlign","content","level","placeholder","anchor","tagName","blockProps","className","canGenerateAnchors","select","getGlobalBlockCount","getSettings","settings","generateAnchors","__unstableMarkNextChangeAsNotPersistent","onContentChange","value","newAttrs","children","group","onChange","newLevel","nextAlign","identifier","onMerge","onSplit","isOriginal","block","_getDefaultBlockName","onRemove","isNative","deleteEnter"],"sources":["@wordpress/block-library/src/heading/edit.native.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useEffect, Platform } from '@wordpress/element';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\r\nimport {\r\n\tAlignmentControl,\r\n\tBlockControls,\r\n\tRichText,\r\n\tuseBlockProps,\r\n\tstore as blockEditorStore,\r\n\tHeadingLevelDropdown,\r\n} from '@wordpress/block-editor';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { generateAnchor, setAnchor } from './autogenerate-anchors';\r\n\r\nfunction HeadingEdit( {\r\n\tattributes,\r\n\tsetAttributes,\r\n\tmergeBlocks,\r\n\tonReplace,\r\n\tstyle,\r\n\tclientId,\r\n} ) {\r\n\tconst { textAlign, content, level, placeholder, anchor } = attributes;\r\n\tconst tagName = 'h' + level;\r\n\tconst blockProps = useBlockProps( {\r\n\t\tclassName: clsx( {\r\n\t\t\t[ `has-text-align-${ textAlign }` ]: textAlign,\r\n\t\t} ),\r\n\t\tstyle,\r\n\t} );\r\n\r\n\tconst { canGenerateAnchors } = useSelect( ( select ) => {\r\n\t\tconst { getGlobalBlockCount, getSettings } = select( blockEditorStore );\r\n\t\tconst settings = getSettings();\r\n\r\n\t\treturn {\r\n\t\t\tcanGenerateAnchors:\r\n\t\t\t\t!! settings.generateAnchors ||\r\n\t\t\t\tgetGlobalBlockCount( 'core/table-of-contents' ) > 0,\r\n\t\t};\r\n\t}, [] );\r\n\r\n\tconst { __unstableMarkNextChangeAsNotPersistent } =\r\n\t\tuseDispatch( blockEditorStore );\r\n\r\n\t// Initially set anchor for headings that have content but no anchor set.\r\n\t// This is used when transforming a block to heading, or for legacy anchors.\r\n\tuseEffect( () => {\r\n\t\tif ( ! canGenerateAnchors ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( ! anchor && content ) {\r\n\t\t\t// This side-effect should not create an undo level.\r\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tanchor: generateAnchor( clientId, content ),\r\n\t\t\t} );\r\n\t\t}\r\n\t\tsetAnchor( clientId, anchor );\r\n\r\n\t\t// Remove anchor map when block unmounts.\r\n\t\treturn () => setAnchor( clientId, null );\r\n\t}, [ anchor, content, clientId, canGenerateAnchors ] );\r\n\r\n\tconst onContentChange = ( value ) => {\r\n\t\tconst newAttrs = { content: value };\r\n\t\tif (\r\n\t\t\tcanGenerateAnchors &&\r\n\t\t\t( ! anchor ||\r\n\t\t\t\t! value ||\r\n\t\t\t\tgenerateAnchor( clientId, content ) === anchor )\r\n\t\t) {\r\n\t\t\tnewAttrs.anchor = generateAnchor( clientId, value );\r\n\t\t}\r\n\t\tsetAttributes( newAttrs );\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<BlockControls group=\"block\">\r\n\t\t\t\t<HeadingLevelDropdown\r\n\t\t\t\t\tvalue={ level }\r\n\t\t\t\t\tonChange={ ( newLevel ) =>\r\n\t\t\t\t\t\tsetAttributes( { level: newLevel } )\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t\t<AlignmentControl\r\n\t\t\t\t\tvalue={ textAlign }\r\n\t\t\t\t\tonChange={ ( nextAlign ) => {\r\n\t\t\t\t\t\tsetAttributes( { textAlign: nextAlign } );\r\n\t\t\t\t\t} }\r\n\t\t\t\t/>\r\n\t\t\t</BlockControls>\r\n\t\t\t<RichText\r\n\t\t\t\tidentifier=\"content\"\r\n\t\t\t\ttagName={ tagName }\r\n\t\t\t\tvalue={ content }\r\n\t\t\t\tonChange={ onContentChange }\r\n\t\t\t\tonMerge={ mergeBlocks }\r\n\t\t\t\tonSplit={ ( value, isOriginal ) => {\r\n\t\t\t\t\tlet block;\r\n\r\n\t\t\t\t\tif ( isOriginal || value ) {\r\n\t\t\t\t\t\tblock = createBlock( 'core/heading', {\r\n\t\t\t\t\t\t\t...attributes,\r\n\t\t\t\t\t\t\tcontent: value,\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tblock = createBlock(\r\n\t\t\t\t\t\t\tgetDefaultBlockName() ?? 'core/heading'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( isOriginal ) {\r\n\t\t\t\t\t\tblock.clientId = clientId;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn block;\r\n\t\t\t\t} }\r\n\t\t\t\tonReplace={ onReplace }\r\n\t\t\t\tonRemove={ () => onReplace( [] ) }\r\n\t\t\t\tplaceholder={ placeholder || __( 'Heading' ) }\r\n\t\t\t\ttextAlign={ textAlign }\r\n\t\t\t\t{ ...( Platform.isNative && { deleteEnter: true } ) } // setup RichText on native mobile to delete the \"Enter\" key as it's handled by the JS/RN side\r\n\t\t\t\t{ ...blockProps }\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default HeadingEdit;\r\n"],"mappings":"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","ignoreList":[]}