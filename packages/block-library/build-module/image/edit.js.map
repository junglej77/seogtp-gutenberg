{"version":3,"names":["clsx","isBlobURL","createBlobURL","store","blocksStore","createBlock","Placeholder","useDispatch","useSelect","BlockIcon","MediaPlaceholder","useBlockProps","blockEditorStore","__experimentalUseBorderProps","useBorderProps","__experimentalGetShadowClassesAndStyles","getShadowClassesAndStyles","useBlockEditingMode","useEffect","useRef","useState","__","sprintf","image","icon","plugins","pluginsIcon","noticesStore","useResizeObserver","unlock","useUploadMediaFromBlobURL","Image","isValidFileType","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_MEDIA","LINK_DESTINATION_NONE","ALLOWED_MEDIA_TYPES","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","pickRelevantMediaFiles","size","imageProps","Object","fromEntries","entries","filter","key","includes","url","sizes","media_details","source_url","isExternalImage","id","hasSize","_image$sizes$size","_image$media_details$","ImageEdit","attributes","setAttributes","isSelected","isSingleSelected","className","insertBlocksAfter","onReplace","context","clientId","__unstableParentLayout","parentLayout","alt","caption","width","height","sizeSlug","aspectRatio","scale","align","metadata","temporaryURL","setTemporaryURL","blob","figureRef","contentResizeListener","containerWidth","altRef","current","captionRef","__unstableMarkNextChangeAsNotPersistent","replaceBlock","undefined","getSettings","getBlockRootClientId","getBlockName","canInsertBlockType","blockEditingMode","createErrorNotice","onUploadError","message","type","src","onSelectImagesList","images","win","ownerDocument","defaultView","every","file","File","files","rootClientId","some","imageBlocks","map","galleryBlock","onSelectImage","media","Array","isArray","title","imageDefaultSize","newSize","mediaAttributes","omittedCaption","restMediaAttributes","additionalAttributes","linkDestination","window","wp","view","settings","defaultProps","link","href","onSelectURL","newURL","allowedTypes","onChange","onError","isExternal","mediaPreview","borderProps","shadowProps","classes","style","keys","length","blockProps","ref","lockUrlControls","lockUrlControlsMessage","select","blockBindingsSource","getBlockBindingsSource","bindings","source","canUserEditValue","args","label","placeholder","content","withIllustration","instructions","objectFit","children","parentLayoutType","onSelect","accept","handleUpload","value","disableMediaButtons"],"sources":["@wordpress/block-library/src/image/edit.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { isBlobURL, createBlobURL } from '@wordpress/blob';\r\nimport { store as blocksStore, createBlock } from '@wordpress/blocks';\r\nimport { Placeholder } from '@wordpress/components';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport {\r\n\tBlockIcon,\r\n\tMediaPlaceholder,\r\n\tuseBlockProps,\r\n\tstore as blockEditorStore,\r\n\t__experimentalUseBorderProps as useBorderProps,\r\n\t__experimentalGetShadowClassesAndStyles as getShadowClassesAndStyles,\r\n\tuseBlockEditingMode,\r\n} from '@wordpress/block-editor';\r\nimport { useEffect, useRef, useState } from '@wordpress/element';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { image as icon, plugins as pluginsIcon } from '@wordpress/icons';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { useResizeObserver } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { unlock } from '../lock-unlock';\r\nimport { useUploadMediaFromBlobURL } from '../utils/hooks';\r\nimport Image from './image';\r\nimport { isValidFileType } from './utils';\r\n\r\n/**\r\n * Module constants\r\n */\r\nimport {\r\n\tLINK_DESTINATION_ATTACHMENT,\r\n\tLINK_DESTINATION_CUSTOM,\r\n\tLINK_DESTINATION_MEDIA,\r\n\tLINK_DESTINATION_NONE,\r\n\tALLOWED_MEDIA_TYPES,\r\n} from './constants';\r\n\r\nexport const pickRelevantMediaFiles = ( image, size ) => {\r\n\tconst imageProps = Object.fromEntries(\r\n\t\tObject.entries( image ?? {} ).filter( ( [ key ] ) =>\r\n\t\t\t[ 'alt', 'id', 'link', 'caption' ].includes( key )\r\n\t\t)\r\n\t);\r\n\r\n\timageProps.url =\r\n\t\timage?.sizes?.[ size ]?.url ||\r\n\t\timage?.media_details?.sizes?.[ size ]?.source_url ||\r\n\t\timage.url;\r\n\treturn imageProps;\r\n};\r\n\r\n/**\r\n * Is the url for the image hosted externally. An externally hosted image has no\r\n * id and is not a blob url.\r\n *\r\n * @param {number=} id  The id of the image.\r\n * @param {string=} url The url of the image.\r\n *\r\n * @return {boolean} Is the url an externally hosted url?\r\n */\r\nexport const isExternalImage = ( id, url ) => url && ! id && ! isBlobURL( url );\r\n\r\n/**\r\n * Checks if WP generated the specified image size. Size generation is skipped\r\n * when the image is smaller than the said size.\r\n *\r\n * @param {Object} image\r\n * @param {string} size\r\n *\r\n * @return {boolean} Whether or not it has default image size.\r\n */\r\nfunction hasSize( image, size ) {\r\n\treturn (\r\n\t\t'url' in ( image?.sizes?.[ size ] ?? {} ) ||\r\n\t\t'source_url' in ( image?.media_details?.sizes?.[ size ] ?? {} )\r\n\t);\r\n}\r\n\r\nexport function ImageEdit( {\r\n\tattributes,\r\n\tsetAttributes,\r\n\tisSelected: isSingleSelected,\r\n\tclassName,\r\n\tinsertBlocksAfter,\r\n\tonReplace,\r\n\tcontext,\r\n\tclientId,\r\n\t__unstableParentLayout: parentLayout,\r\n} ) {\r\n\tconst {\r\n\t\turl = '',\r\n\t\talt,\r\n\t\tcaption,\r\n\t\tid,\r\n\t\twidth,\r\n\t\theight,\r\n\t\tsizeSlug,\r\n\t\taspectRatio,\r\n\t\tscale,\r\n\t\talign,\r\n\t\tmetadata,\r\n\t} = attributes;\r\n\tconst [ temporaryURL, setTemporaryURL ] = useState( attributes.blob );\r\n\tconst figureRef = useRef();\r\n\r\n\tconst [ contentResizeListener, { width: containerWidth } ] =\r\n\t\tuseResizeObserver();\r\n\r\n\tconst altRef = useRef();\r\n\tuseEffect( () => {\r\n\t\taltRef.current = alt;\r\n\t}, [ alt ] );\r\n\r\n\tconst captionRef = useRef();\r\n\tuseEffect( () => {\r\n\t\tcaptionRef.current = caption;\r\n\t}, [ caption ] );\r\n\r\n\tconst { __unstableMarkNextChangeAsNotPersistent, replaceBlock } =\r\n\t\tuseDispatch( blockEditorStore );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( [ 'wide', 'full' ].includes( align ) ) {\r\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\r\n\t\t\tsetAttributes( {\r\n\t\t\t\twidth: undefined,\r\n\t\t\t\theight: undefined,\r\n\t\t\t\taspectRatio: undefined,\r\n\t\t\t\tscale: undefined,\r\n\t\t\t} );\r\n\t\t}\r\n\t}, [ __unstableMarkNextChangeAsNotPersistent, align, setAttributes ] );\r\n\r\n\tconst {\r\n\t\tgetSettings,\r\n\t\tgetBlockRootClientId,\r\n\t\tgetBlockName,\r\n\t\tcanInsertBlockType,\r\n\t} = useSelect( blockEditorStore );\r\n\tconst blockEditingMode = useBlockEditingMode();\r\n\r\n\tconst { createErrorNotice } = useDispatch( noticesStore );\r\n\tfunction onUploadError( message ) {\r\n\t\tcreateErrorNotice( message, { type: 'snackbar' } );\r\n\t\tsetAttributes( {\r\n\t\t\tsrc: undefined,\r\n\t\t\tid: undefined,\r\n\t\t\turl: undefined,\r\n\t\t\tblob: undefined,\r\n\t\t} );\r\n\t}\r\n\r\n\tfunction onSelectImagesList( images ) {\r\n\t\tconst win = figureRef.current?.ownerDocument.defaultView;\r\n\r\n\t\tif ( images.every( ( file ) => file instanceof win.File ) ) {\r\n\t\t\t/** @type {File[]} */\r\n\t\t\tconst files = images;\r\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\r\n\r\n\t\t\tif ( files.some( ( file ) => ! isValidFileType( file ) ) ) {\r\n\t\t\t\t// Copied from the same notice in the gallery block.\r\n\t\t\t\tcreateErrorNotice(\r\n\t\t\t\t\t__(\r\n\t\t\t\t\t\t'If uploading to a gallery all files need to be image formats'\r\n\t\t\t\t\t),\r\n\t\t\t\t\t{ id: 'gallery-upload-invalid-file', type: 'snackbar' }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tconst imageBlocks = files\r\n\t\t\t\t.filter( ( file ) => isValidFileType( file ) )\r\n\t\t\t\t.map( ( file ) =>\r\n\t\t\t\t\tcreateBlock( 'core/image', {\r\n\t\t\t\t\t\tblob: createBlobURL( file ),\r\n\t\t\t\t\t} )\r\n\t\t\t\t);\r\n\r\n\t\t\tif ( getBlockName( rootClientId ) === 'core/gallery' ) {\r\n\t\t\t\treplaceBlock( clientId, imageBlocks );\r\n\t\t\t} else if ( canInsertBlockType( 'core/gallery', rootClientId ) ) {\r\n\t\t\t\tconst galleryBlock = createBlock(\r\n\t\t\t\t\t'core/gallery',\r\n\t\t\t\t\t{},\r\n\t\t\t\t\timageBlocks\r\n\t\t\t\t);\r\n\r\n\t\t\t\treplaceBlock( clientId, galleryBlock );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onSelectImage( media ) {\r\n\t\tif ( Array.isArray( media ) ) {\r\n\t\t\tonSelectImagesList( media );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( ! media || ! media.url ) {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\turl: undefined,\r\n\t\t\t\talt: undefined,\r\n\t\t\t\tid: undefined,\r\n\t\t\t\ttitle: undefined,\r\n\t\t\t\tcaption: undefined,\r\n\t\t\t\tblob: undefined,\r\n\t\t\t} );\r\n\t\t\tsetTemporaryURL();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( isBlobURL( media.url ) ) {\r\n\t\t\tsetTemporaryURL( media.url );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { imageDefaultSize } = getSettings();\r\n\r\n\t\t// Try to use the previous selected image size if its available\r\n\t\t// otherwise try the default image size or fallback to \"full\"\r\n\t\tlet newSize = 'full';\r\n\t\tif ( sizeSlug && hasSize( media, sizeSlug ) ) {\r\n\t\t\tnewSize = sizeSlug;\r\n\t\t} else if ( hasSize( media, imageDefaultSize ) ) {\r\n\t\t\tnewSize = imageDefaultSize;\r\n\t\t}\r\n\r\n\t\tlet mediaAttributes = pickRelevantMediaFiles( media, newSize );\r\n\r\n\t\t// If a caption text was meanwhile written by the user,\r\n\t\t// make sure the text is not overwritten by empty captions.\r\n\t\tif ( captionRef.current && ! mediaAttributes.caption ) {\r\n\t\t\tconst { caption: omittedCaption, ...restMediaAttributes } =\r\n\t\t\t\tmediaAttributes;\r\n\t\t\tmediaAttributes = restMediaAttributes;\r\n\t\t}\r\n\r\n\t\tlet additionalAttributes;\r\n\t\t// Reset the dimension attributes if changing to a different image.\r\n\t\tif ( ! media.id || media.id !== id ) {\r\n\t\t\tadditionalAttributes = {\r\n\t\t\t\tsizeSlug: newSize,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\t// Keep the same url when selecting the same file, so \"Resolution\"\r\n\t\t\t// option is not changed.\r\n\t\t\tadditionalAttributes = { url };\r\n\t\t}\r\n\r\n\t\t// Check if default link setting should be used.\r\n\t\tlet linkDestination = attributes.linkDestination;\r\n\t\tif ( ! linkDestination ) {\r\n\t\t\t// Use the WordPress option to determine the proper default.\r\n\t\t\t// The constants used in Gutenberg do not match WP options so a little more complicated than ideal.\r\n\t\t\t// TODO: fix this in a follow up PR, requires updating media-text and ui component.\r\n\t\t\tswitch (\r\n\t\t\t\twindow?.wp?.media?.view?.settings?.defaultProps?.link ||\r\n\t\t\t\tLINK_DESTINATION_NONE\r\n\t\t\t) {\r\n\t\t\t\tcase 'file':\r\n\t\t\t\tcase LINK_DESTINATION_MEDIA:\r\n\t\t\t\t\tlinkDestination = LINK_DESTINATION_MEDIA;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'post':\r\n\t\t\t\tcase LINK_DESTINATION_ATTACHMENT:\r\n\t\t\t\t\tlinkDestination = LINK_DESTINATION_ATTACHMENT;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LINK_DESTINATION_CUSTOM:\r\n\t\t\t\t\tlinkDestination = LINK_DESTINATION_CUSTOM;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LINK_DESTINATION_NONE:\r\n\t\t\t\t\tlinkDestination = LINK_DESTINATION_NONE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if the image is linked to it's media.\r\n\t\tlet href;\r\n\t\tswitch ( linkDestination ) {\r\n\t\t\tcase LINK_DESTINATION_MEDIA:\r\n\t\t\t\thref = media.url;\r\n\t\t\t\tbreak;\r\n\t\t\tcase LINK_DESTINATION_ATTACHMENT:\r\n\t\t\t\thref = media.link;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tmediaAttributes.href = href;\r\n\r\n\t\tsetAttributes( {\r\n\t\t\tblob: undefined,\r\n\t\t\t...mediaAttributes,\r\n\t\t\t...additionalAttributes,\r\n\t\t\tlinkDestination,\r\n\t\t} );\r\n\t\tsetTemporaryURL();\r\n\t}\r\n\r\n\tfunction onSelectURL( newURL ) {\r\n\t\tif ( newURL !== url ) {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tblob: undefined,\r\n\t\t\t\turl: newURL,\r\n\t\t\t\tid: undefined,\r\n\t\t\t\tsizeSlug: getSettings().imageDefaultSize,\r\n\t\t\t} );\r\n\t\t\tsetTemporaryURL();\r\n\t\t}\r\n\t}\r\n\r\n\tuseUploadMediaFromBlobURL( {\r\n\t\turl: temporaryURL,\r\n\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\r\n\t\tonChange: onSelectImage,\r\n\t\tonError: onUploadError,\r\n\t} );\r\n\r\n\tconst isExternal = isExternalImage( id, url );\r\n\tconst src = isExternal ? url : undefined;\r\n\tconst mediaPreview = !! url && (\r\n\t\t<img\r\n\t\t\talt={ __( 'Edit image' ) }\r\n\t\t\ttitle={ __( 'Edit image' ) }\r\n\t\t\tclassName=\"edit-image-preview\"\r\n\t\t\tsrc={ url }\r\n\t\t/>\r\n\t);\r\n\r\n\tconst borderProps = useBorderProps( attributes );\r\n\tconst shadowProps = getShadowClassesAndStyles( attributes );\r\n\r\n\tconst classes = clsx( className, {\r\n\t\t'is-transient': !! temporaryURL,\r\n\t\t'is-resized': !! width || !! height,\r\n\t\t[ `size-${ sizeSlug }` ]: sizeSlug,\r\n\t\t'has-custom-border':\r\n\t\t\t!! borderProps.className ||\r\n\t\t\t( borderProps.style &&\r\n\t\t\t\tObject.keys( borderProps.style ).length > 0 ),\r\n\t} );\r\n\r\n\tconst blockProps = useBlockProps( { ref: figureRef, className: classes } );\r\n\r\n\t// Much of this description is duplicated from MediaPlaceholder.\r\n\tconst { lockUrlControls = false, lockUrlControlsMessage } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tif ( ! isSingleSelected ) {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\r\n\t\t\tconst blockBindingsSource = unlock(\r\n\t\t\t\tselect( blocksStore )\r\n\t\t\t).getBlockBindingsSource( metadata?.bindings?.url?.source );\r\n\r\n\t\t\treturn {\r\n\t\t\t\tlockUrlControls:\r\n\t\t\t\t\t!! metadata?.bindings?.url &&\r\n\t\t\t\t\t! blockBindingsSource?.canUserEditValue?.( {\r\n\t\t\t\t\t\tselect,\r\n\t\t\t\t\t\tcontext,\r\n\t\t\t\t\t\targs: metadata?.bindings?.url?.args,\r\n\t\t\t\t\t} ),\r\n\t\t\t\tlockUrlControlsMessage: blockBindingsSource?.label\r\n\t\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t\t/* translators: %s: Label of the bindings source. */\r\n\t\t\t\t\t\t\t__( 'Connected to %s' ),\r\n\t\t\t\t\t\t\tblockBindingsSource.label\r\n\t\t\t\t\t  )\r\n\t\t\t\t\t: __( 'Connected to dynamic data' ),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ context, isSingleSelected, metadata?.bindings?.url ]\r\n\t);\r\n\tconst placeholder = ( content ) => {\r\n\t\treturn (\r\n\t\t\t<Placeholder\r\n\t\t\t\tclassName={ clsx( 'block-editor-media-placeholder', {\r\n\t\t\t\t\t[ borderProps.className ]:\r\n\t\t\t\t\t\t!! borderProps.className && ! isSingleSelected,\r\n\t\t\t\t} ) }\r\n\t\t\t\twithIllustration\r\n\t\t\t\ticon={ lockUrlControls ? pluginsIcon : icon }\r\n\t\t\t\tlabel={ __( 'Image' ) }\r\n\t\t\t\tinstructions={\r\n\t\t\t\t\t! lockUrlControls &&\r\n\t\t\t\t\t__(\r\n\t\t\t\t\t\t'Upload or drag an image file here, or pick one from your library.'\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t\tstyle={ {\r\n\t\t\t\t\taspectRatio:\r\n\t\t\t\t\t\t! ( width && height ) && aspectRatio\r\n\t\t\t\t\t\t\t? aspectRatio\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\twidth: height && aspectRatio ? '100%' : width,\r\n\t\t\t\t\theight: width && aspectRatio ? '100%' : height,\r\n\t\t\t\t\tobjectFit: scale,\r\n\t\t\t\t\t...borderProps.style,\r\n\t\t\t\t\t...shadowProps.style,\r\n\t\t\t\t} }\r\n\t\t\t>\r\n\t\t\t\t{ lockUrlControls ? (\r\n\t\t\t\t\t<span className=\"block-bindings-media-placeholder-message\">\r\n\t\t\t\t\t\t{ lockUrlControlsMessage }\r\n\t\t\t\t\t</span>\r\n\t\t\t\t) : (\r\n\t\t\t\t\tcontent\r\n\t\t\t\t) }\r\n\t\t\t</Placeholder>\r\n\t\t);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<figure { ...blockProps }>\r\n\t\t\t\t<Image\r\n\t\t\t\t\ttemporaryURL={ temporaryURL }\r\n\t\t\t\t\tattributes={ attributes }\r\n\t\t\t\t\tsetAttributes={ setAttributes }\r\n\t\t\t\t\tisSingleSelected={ isSingleSelected }\r\n\t\t\t\t\tinsertBlocksAfter={ insertBlocksAfter }\r\n\t\t\t\t\tonReplace={ onReplace }\r\n\t\t\t\t\tonSelectImage={ onSelectImage }\r\n\t\t\t\t\tonSelectURL={ onSelectURL }\r\n\t\t\t\t\tonUploadError={ onUploadError }\r\n\t\t\t\t\tcontext={ context }\r\n\t\t\t\t\tclientId={ clientId }\r\n\t\t\t\t\tblockEditingMode={ blockEditingMode }\r\n\t\t\t\t\tparentLayoutType={ parentLayout?.type }\r\n\t\t\t\t\tcontainerWidth={ containerWidth }\r\n\t\t\t\t/>\r\n\t\t\t\t<MediaPlaceholder\r\n\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\r\n\t\t\t\t\tonSelect={ onSelectImage }\r\n\t\t\t\t\tonSelectURL={ onSelectURL }\r\n\t\t\t\t\tonError={ onUploadError }\r\n\t\t\t\t\tplaceholder={ placeholder }\r\n\t\t\t\t\taccept=\"image/*\"\r\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\r\n\t\t\t\t\thandleUpload={ ( files ) => files.length === 1 }\r\n\t\t\t\t\tvalue={ { id, src } }\r\n\t\t\t\t\tmediaPreview={ mediaPreview }\r\n\t\t\t\t\tdisableMediaButtons={ temporaryURL || url }\r\n\t\t\t\t/>\r\n\t\t\t</figure>\r\n\t\t\t{\r\n\t\t\t\t// The listener cannot be placed as the first element as it will break the in-between inserter.\r\n\t\t\t\t// See https://github.com/WordPress/gutenberg/blob/71134165868298fc15e22896d0c28b41b3755ff7/packages/block-editor/src/components/block-list/use-in-between-inserter.js#L120\r\n\t\t\t\tcontentResizeListener\r\n\t\t\t}\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default ImageEdit;\r\n"],"mappings":"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","ignoreList":[]}