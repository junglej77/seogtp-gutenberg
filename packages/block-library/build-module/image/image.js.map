{"version":3,"names":["isBlobURL","ExternalLink","ResizableBox","Spinner","TextareaControl","TextControl","ToolbarButton","ToolbarGroup","Dropdown","__experimentalToolsPanel","ToolsPanel","__experimentalToolsPanelItem","ToolsPanelItem","__experimentalUseCustomUnits","useCustomUnits","Placeholder","useViewportMatch","useSelect","useDispatch","BlockControls","InspectorControls","__experimentalImageURLInputUI","ImageURLInputUI","MediaReplaceFlow","store","blockEditorStore","useSettings","__experimentalImageEditor","ImageEditor","__experimentalUseBorderProps","useBorderProps","__experimentalGetShadowClassesAndStyles","getShadowClassesAndStyles","privateApis","blockEditorPrivateApis","useEffect","useMemo","useState","useRef","__","_x","sprintf","isRTL","DOWN","getFilename","switchToBlockType","blocksStore","crop","overlayText","upload","noticesStore","coreStore","unlock","createUpgradedEmbedBlock","isExternalImage","Caption","useToolsPanelDropdownMenuProps","MIN_SIZE","ALLOWED_MEDIA_TYPES","evalAspectRatio","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","DimensionsTool","ResolutionTool","scaleOptions","value","label","help","ImageWrapper","href","children","onClick","event","preventDefault","style","pointerEvents","cursor","display","Image","temporaryURL","attributes","setAttributes","isSingleSelected","insertBlocksAfter","onReplace","onSelectImage","onSelectURL","onUploadError","context","clientId","blockEditingMode","parentLayoutType","containerWidth","url","alt","align","id","rel","linkClass","linkDestination","title","width","height","aspectRatio","scale","linkTarget","sizeSlug","lightbox","metadata","numericWidth","parseInt","undefined","numericHeight","imageRef","allowResize","getBlock","getSettings","image","select","getMedia","canInsertCover","imageEditing","imageSizes","maxWidth","getBlockRootClientId","canInsertBlockType","rootClientId","settings","replaceBlocks","toggleSelection","createErrorNotice","createSuccessNotice","isLargeViewport","isWideAligned","includes","loadedNaturalWidth","loadedNaturalHeight","setLoadedNaturalSize","isEditingImage","setIsEditingImage","externalBlob","setExternalBlob","hasImageErrored","setHasImageErrored","hasNonContentControls","isContentOnlyMode","isResizable","imageSizeOptions","filter","slug","media_details","sizes","source_url","map","name","mediaUpload","window","fetch","then","response","blob","catch","naturalWidth","naturalHeight","current","complete","onResizeStart","onResizeStop","onImageError","embedBlock","onImageLoad","target","onSetHref","props","onSetLightbox","enable","lightboxSetting","enabled","resetLightbox","allowEditing","onSetTitle","updateAlt","newAlt","updateImage","newSizeSlug","newUrl","uploadExternal","filesList","onFileChange","img","type","allowedTypes","onError","message","canEditImage","allowCrop","switchToCover","dimensionsUnitsOptions","availableUnits","showLightboxSetting","lightboxChecked","dropdownMenuProps","dimensionsControl","onChange","newWidth","newHeight","newScale","newAspectRatio","defaultScale","defaultAspectRatio","unitsOptions","aspectRatioControl","tools","resetAll","sizeControls","arePatternOverridesEnabled","bindings","__default","source","lockUrlControls","lockHrefControls","lockAltControls","lockAltControlsMessage","lockTitleControls","lockTitleControlsMessage","lockCaption","getBlockBindingsSource","urlBinding","altBinding","titleBinding","hasParentPattern","urlBindingSource","altBindingSource","titleBindingSource","canUserEditValue","args","showUrlInput","showCoverControls","showBlockControls","controls","group","onChangeUrl","mediaUrl","mediaLink","link","lightboxEnabled","icon","mediaId","mediaURL","accept","onSelect","onReset","popoverProps","position","renderToggle","isOpen","onToggle","onKeyDown","keyCode","renderContent","className","disabled","__nextHasNoMarginBottom","__next40pxDefaultSize","isShownByDefault","hasValue","onDeselect","readOnly","length","options","filename","defaultedAlt","borderProps","shadowProps","isRounded","withIllustration","src","onLoad","ref","objectFit","onSaveImage","imageAttributes","onFinishEditing","numericRatio","customRatio","naturalRatio","ratio","currentWidth","currentHeight","minWidth","minHeight","maxWidthBuffer","maxContentWidth","showRightHandle","showLeftHandle","size","showHandle","maxHeight","lockAspectRatio","top","right","bottom","left","direction","elt","Math","abs","offsetWidth","String","resizeRatio","isSelected","showToolbarButton"],"sources":["@wordpress/block-library/src/image/image.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { isBlobURL } from '@wordpress/blob';\r\nimport {\r\n\tExternalLink,\r\n\tResizableBox,\r\n\tSpinner,\r\n\tTextareaControl,\r\n\tTextControl,\r\n\tToolbarButton,\r\n\tToolbarGroup,\r\n\tDropdown,\r\n\t__experimentalToolsPanel as ToolsPanel,\r\n\t__experimentalToolsPanelItem as ToolsPanelItem,\r\n\t__experimentalUseCustomUnits as useCustomUnits,\r\n\tPlaceholder,\r\n} from '@wordpress/components';\r\nimport { useViewportMatch } from '@wordpress/compose';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport {\r\n\tBlockControls,\r\n\tInspectorControls,\r\n\t__experimentalImageURLInputUI as ImageURLInputUI,\r\n\tMediaReplaceFlow,\r\n\tstore as blockEditorStore,\r\n\tuseSettings,\r\n\t__experimentalImageEditor as ImageEditor,\r\n\t__experimentalUseBorderProps as useBorderProps,\r\n\t__experimentalGetShadowClassesAndStyles as getShadowClassesAndStyles,\r\n\tprivateApis as blockEditorPrivateApis,\r\n} from '@wordpress/block-editor';\r\nimport { useEffect, useMemo, useState, useRef } from '@wordpress/element';\r\nimport { __, _x, sprintf, isRTL } from '@wordpress/i18n';\r\nimport { DOWN } from '@wordpress/keycodes';\r\nimport { getFilename } from '@wordpress/url';\r\nimport { switchToBlockType, store as blocksStore } from '@wordpress/blocks';\r\nimport { crop, overlayText, upload } from '@wordpress/icons';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { unlock } from '../lock-unlock';\r\nimport { createUpgradedEmbedBlock } from '../embed/util';\r\nimport { isExternalImage } from './edit';\r\nimport { Caption } from '../utils/caption';\r\n\r\n/**\r\n * Module constants\r\n */\r\nimport { useToolsPanelDropdownMenuProps } from '../utils/hooks';\r\nimport { MIN_SIZE, ALLOWED_MEDIA_TYPES } from './constants';\r\nimport { evalAspectRatio } from './utils';\r\n\r\nconst { DimensionsTool, ResolutionTool } = unlock( blockEditorPrivateApis );\r\n\r\nconst scaleOptions = [\r\n\t{\r\n\t\tvalue: 'cover',\r\n\t\tlabel: _x( 'Cover', 'Scale option for dimensions control' ),\r\n\t\thelp: __( 'Image covers the space evenly.' ),\r\n\t},\r\n\t{\r\n\t\tvalue: 'contain',\r\n\t\tlabel: _x( 'Contain', 'Scale option for dimensions control' ),\r\n\t\thelp: __( 'Image is contained without distortion.' ),\r\n\t},\r\n];\r\n\r\n// If the image has a href, wrap in an <a /> tag to trigger any inherited link element styles.\r\nconst ImageWrapper = ( { href, children } ) => {\r\n\tif ( ! href ) {\r\n\t\treturn children;\r\n\t}\r\n\treturn (\r\n\t\t<a\r\n\t\t\thref={ href }\r\n\t\t\tonClick={ ( event ) => event.preventDefault() }\r\n\t\t\taria-disabled\r\n\t\t\tstyle={ {\r\n\t\t\t\t// When the Image block is linked,\r\n\t\t\t\t// it's wrapped with a disabled <a /> tag.\r\n\t\t\t\t// Restore cursor style so it doesn't appear 'clickable'\r\n\t\t\t\t// and remove pointer events. Safari needs the display property.\r\n\t\t\t\tpointerEvents: 'none',\r\n\t\t\t\tcursor: 'default',\r\n\t\t\t\tdisplay: 'inline',\r\n\t\t\t} }\r\n\t\t>\r\n\t\t\t{ children }\r\n\t\t</a>\r\n\t);\r\n};\r\n\r\nexport default function Image( {\r\n\ttemporaryURL,\r\n\tattributes,\r\n\tsetAttributes,\r\n\tisSingleSelected,\r\n\tinsertBlocksAfter,\r\n\tonReplace,\r\n\tonSelectImage,\r\n\tonSelectURL,\r\n\tonUploadError,\r\n\tcontext,\r\n\tclientId,\r\n\tblockEditingMode,\r\n\tparentLayoutType,\r\n\tcontainerWidth,\r\n} ) {\r\n\tconst {\r\n\t\turl = '',\r\n\t\talt,\r\n\t\talign,\r\n\t\tid,\r\n\t\thref,\r\n\t\trel,\r\n\t\tlinkClass,\r\n\t\tlinkDestination,\r\n\t\ttitle,\r\n\t\twidth,\r\n\t\theight,\r\n\t\taspectRatio,\r\n\t\tscale,\r\n\t\tlinkTarget,\r\n\t\tsizeSlug,\r\n\t\tlightbox,\r\n\t\tmetadata,\r\n\t} = attributes;\r\n\r\n\t// The only supported unit is px, so we can parseInt to strip the px here.\r\n\tconst numericWidth = width ? parseInt( width, 10 ) : undefined;\r\n\tconst numericHeight = height ? parseInt( height, 10 ) : undefined;\r\n\r\n\tconst imageRef = useRef();\r\n\tconst { allowResize = true } = context;\r\n\tconst { getBlock, getSettings } = useSelect( blockEditorStore );\r\n\r\n\tconst image = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tid && isSingleSelected\r\n\t\t\t\t? select( coreStore ).getMedia( id, { context: 'view' } )\r\n\t\t\t\t: null,\r\n\t\t[ id, isSingleSelected ]\r\n\t);\r\n\r\n\tconst { canInsertCover, imageEditing, imageSizes, maxWidth } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getBlockRootClientId, canInsertBlockType } =\r\n\t\t\t\tselect( blockEditorStore );\r\n\r\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\r\n\t\t\tconst settings = getSettings();\r\n\r\n\t\t\treturn {\r\n\t\t\t\timageEditing: settings.imageEditing,\r\n\t\t\t\timageSizes: settings.imageSizes,\r\n\t\t\t\tmaxWidth: settings.maxWidth,\r\n\t\t\t\tcanInsertCover: canInsertBlockType(\r\n\t\t\t\t\t'core/cover',\r\n\t\t\t\t\trootClientId\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ clientId ]\r\n\t);\r\n\r\n\tconst { replaceBlocks, toggleSelection } = useDispatch( blockEditorStore );\r\n\tconst { createErrorNotice, createSuccessNotice } =\r\n\t\tuseDispatch( noticesStore );\r\n\tconst isLargeViewport = useViewportMatch( 'medium' );\r\n\tconst isWideAligned = [ 'wide', 'full' ].includes( align );\r\n\tconst [\r\n\t\t{ loadedNaturalWidth, loadedNaturalHeight },\r\n\t\tsetLoadedNaturalSize,\r\n\t] = useState( {} );\r\n\tconst [ isEditingImage, setIsEditingImage ] = useState( false );\r\n\tconst [ externalBlob, setExternalBlob ] = useState();\r\n\tconst [ hasImageErrored, setHasImageErrored ] = useState( false );\r\n\tconst hasNonContentControls = blockEditingMode === 'default';\r\n\tconst isContentOnlyMode = blockEditingMode === 'contentOnly';\r\n\tconst isResizable =\r\n\t\tallowResize &&\r\n\t\thasNonContentControls &&\r\n\t\t! isWideAligned &&\r\n\t\tisLargeViewport;\r\n\tconst imageSizeOptions = imageSizes\r\n\t\t.filter(\r\n\t\t\t( { slug } ) => image?.media_details?.sizes?.[ slug ]?.source_url\r\n\t\t)\r\n\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\r\n\r\n\t// If an image is externally hosted, try to fetch the image data. This may\r\n\t// fail if the image host doesn't allow CORS with the domain. If it works,\r\n\t// we can enable a button in the toolbar to upload the image.\r\n\tuseEffect( () => {\r\n\t\tif (\r\n\t\t\t! isExternalImage( id, url ) ||\r\n\t\t\t! isSingleSelected ||\r\n\t\t\t! getSettings().mediaUpload\r\n\t\t) {\r\n\t\t\tsetExternalBlob();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( externalBlob ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twindow\r\n\t\t\t// Avoid cache, which seems to help avoid CORS problems.\r\n\t\t\t.fetch( url.includes( '?' ) ? url : url + '?' )\r\n\t\t\t.then( ( response ) => response.blob() )\r\n\t\t\t.then( ( blob ) => setExternalBlob( blob ) )\r\n\t\t\t// Do nothing, cannot upload.\r\n\t\t\t.catch( () => {} );\r\n\t}, [ id, url, isSingleSelected, externalBlob ] );\r\n\r\n\t// Get naturalWidth and naturalHeight from image ref, and fall back to loaded natural\r\n\t// width and height. This resolves an issue in Safari where the loaded natural\r\n\t// width and height is otherwise lost when switching between alignments.\r\n\t// See: https://github.com/WordPress/gutenberg/pull/37210.\r\n\tconst { naturalWidth, naturalHeight } = useMemo( () => {\r\n\t\treturn {\r\n\t\t\tnaturalWidth:\r\n\t\t\t\timageRef.current?.naturalWidth ||\r\n\t\t\t\tloadedNaturalWidth ||\r\n\t\t\t\tundefined,\r\n\t\t\tnaturalHeight:\r\n\t\t\t\timageRef.current?.naturalHeight ||\r\n\t\t\t\tloadedNaturalHeight ||\r\n\t\t\t\tundefined,\r\n\t\t};\r\n\t}, [\r\n\t\tloadedNaturalWidth,\r\n\t\tloadedNaturalHeight,\r\n\t\timageRef.current?.complete,\r\n\t] );\r\n\r\n\tfunction onResizeStart() {\r\n\t\ttoggleSelection( false );\r\n\t}\r\n\r\n\tfunction onResizeStop() {\r\n\t\ttoggleSelection( true );\r\n\t}\r\n\r\n\tfunction onImageError() {\r\n\t\tsetHasImageErrored( true );\r\n\r\n\t\t// Check if there's an embed block that handles this URL, e.g., instagram URL.\r\n\t\t// See: https://github.com/WordPress/gutenberg/pull/11472\r\n\t\tconst embedBlock = createUpgradedEmbedBlock( { attributes: { url } } );\r\n\t\tif ( undefined !== embedBlock ) {\r\n\t\t\tonReplace( embedBlock );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onImageLoad( event ) {\r\n\t\tsetHasImageErrored( false );\r\n\t\tsetLoadedNaturalSize( {\r\n\t\t\tloadedNaturalWidth: event.target?.naturalWidth,\r\n\t\t\tloadedNaturalHeight: event.target?.naturalHeight,\r\n\t\t} );\r\n\t}\r\n\r\n\tfunction onSetHref( props ) {\r\n\t\tsetAttributes( props );\r\n\t}\r\n\r\n\tfunction onSetLightbox( enable ) {\r\n\t\tif ( enable && ! lightboxSetting?.enabled ) {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tlightbox: { enabled: true },\r\n\t\t\t} );\r\n\t\t} else if ( ! enable && lightboxSetting?.enabled ) {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tlightbox: { enabled: false },\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tlightbox: undefined,\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction resetLightbox() {\r\n\t\t// When deleting a link from an image while lightbox settings\r\n\t\t// are enabled by default, we should disable the lightbox,\r\n\t\t// otherwise the resulting UX looks like a mistake.\r\n\t\t// See https://github.com/WordPress/gutenberg/pull/59890/files#r1532286123.\r\n\t\tif ( lightboxSetting?.enabled && lightboxSetting?.allowEditing ) {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tlightbox: { enabled: false },\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tlightbox: undefined,\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onSetTitle( value ) {\r\n\t\t// This is the HTML title attribute, separate from the media object\r\n\t\t// title.\r\n\t\tsetAttributes( { title: value } );\r\n\t}\r\n\r\n\tfunction updateAlt( newAlt ) {\r\n\t\tsetAttributes( { alt: newAlt } );\r\n\t}\r\n\r\n\tfunction updateImage( newSizeSlug ) {\r\n\t\tconst newUrl = image?.media_details?.sizes?.[ newSizeSlug ]?.source_url;\r\n\t\tif ( ! newUrl ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tsetAttributes( {\r\n\t\t\turl: newUrl,\r\n\t\t\tsizeSlug: newSizeSlug,\r\n\t\t} );\r\n\t}\r\n\r\n\tfunction uploadExternal() {\r\n\t\tconst { mediaUpload } = getSettings();\r\n\t\tif ( ! mediaUpload ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmediaUpload( {\r\n\t\t\tfilesList: [ externalBlob ],\r\n\t\t\tonFileChange( [ img ] ) {\r\n\t\t\t\tonSelectImage( img );\r\n\r\n\t\t\t\tif ( isBlobURL( img.url ) ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetExternalBlob();\r\n\t\t\t\tcreateSuccessNotice( __( 'Image uploaded.' ), {\r\n\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\r\n\t\t\tonError( message ) {\r\n\t\t\t\tcreateErrorNotice( message, { type: 'snackbar' } );\r\n\t\t\t},\r\n\t\t} );\r\n\t}\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! isSingleSelected ) {\r\n\t\t\tsetIsEditingImage( false );\r\n\t\t}\r\n\t}, [ isSingleSelected ] );\r\n\r\n\tconst canEditImage = id && naturalWidth && naturalHeight && imageEditing;\r\n\tconst allowCrop =\r\n\t\tisSingleSelected &&\r\n\t\tcanEditImage &&\r\n\t\t! isEditingImage &&\r\n\t\t! isContentOnlyMode;\r\n\r\n\tfunction switchToCover() {\r\n\t\treplaceBlocks(\r\n\t\t\tclientId,\r\n\t\t\tswitchToBlockType( getBlock( clientId ), 'core/cover' )\r\n\t\t);\r\n\t}\r\n\r\n\t// TODO: Can allow more units after figuring out how they should interact\r\n\t// with the ResizableBox and ImageEditor components. Calculations later on\r\n\t// for those components are currently assuming px units.\r\n\tconst dimensionsUnitsOptions = useCustomUnits( {\r\n\t\tavailableUnits: [ 'px' ],\r\n\t} );\r\n\r\n\tconst [ lightboxSetting ] = useSettings( 'lightbox' );\r\n\r\n\tconst showLightboxSetting =\r\n\t\t// If a block-level override is set, we should give users the option to\r\n\t\t// remove that override, even if the lightbox UI is disabled in the settings.\r\n\t\t( !! lightbox && lightbox?.enabled !== lightboxSetting?.enabled ) ||\r\n\t\tlightboxSetting?.allowEditing;\r\n\r\n\tconst lightboxChecked =\r\n\t\t!! lightbox?.enabled || ( ! lightbox && !! lightboxSetting?.enabled );\r\n\r\n\tconst dropdownMenuProps = useToolsPanelDropdownMenuProps();\r\n\r\n\tconst dimensionsControl = (\r\n\t\t<DimensionsTool\r\n\t\t\tvalue={ { width, height, scale, aspectRatio } }\r\n\t\t\tonChange={ ( {\r\n\t\t\t\twidth: newWidth,\r\n\t\t\t\theight: newHeight,\r\n\t\t\t\tscale: newScale,\r\n\t\t\t\taspectRatio: newAspectRatio,\r\n\t\t\t} ) => {\r\n\t\t\t\t// Rebuilding the object forces setting `undefined`\r\n\t\t\t\t// for values that are removed since setAttributes\r\n\t\t\t\t// doesn't do anything with keys that aren't set.\r\n\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t// CSS includes `height: auto`, but we need\r\n\t\t\t\t\t// `width: auto` to fix the aspect ratio when\r\n\t\t\t\t\t// only height is set due to the width and\r\n\t\t\t\t\t// height attributes set via the server.\r\n\t\t\t\t\twidth: ! newWidth && newHeight ? 'auto' : newWidth,\r\n\t\t\t\t\theight: newHeight,\r\n\t\t\t\t\tscale: newScale,\r\n\t\t\t\t\taspectRatio: newAspectRatio,\r\n\t\t\t\t} );\r\n\t\t\t} }\r\n\t\t\tdefaultScale=\"cover\"\r\n\t\t\tdefaultAspectRatio=\"auto\"\r\n\t\t\tscaleOptions={ scaleOptions }\r\n\t\t\tunitsOptions={ dimensionsUnitsOptions }\r\n\t\t/>\r\n\t);\r\n\r\n\tconst aspectRatioControl = (\r\n\t\t<DimensionsTool\r\n\t\t\tvalue={ { aspectRatio } }\r\n\t\t\tonChange={ ( { aspectRatio: newAspectRatio } ) => {\r\n\t\t\t\tsetAttributes( {\r\n\t\t\t\t\taspectRatio: newAspectRatio,\r\n\t\t\t\t\tscale: 'cover',\r\n\t\t\t\t} );\r\n\t\t\t} }\r\n\t\t\tdefaultAspectRatio=\"auto\"\r\n\t\t\ttools={ [ 'aspectRatio' ] }\r\n\t\t/>\r\n\t);\r\n\r\n\tconst resetAll = () => {\r\n\t\tsetAttributes( {\r\n\t\t\talt: undefined,\r\n\t\t\twidth: undefined,\r\n\t\t\theight: undefined,\r\n\t\t\tscale: undefined,\r\n\t\t\taspectRatio: undefined,\r\n\t\t\tlightbox: undefined,\r\n\t\t} );\r\n\t};\r\n\r\n\tconst sizeControls = (\r\n\t\t<InspectorControls>\r\n\t\t\t<ToolsPanel\r\n\t\t\t\tlabel={ __( 'Settings' ) }\r\n\t\t\t\tresetAll={ resetAll }\r\n\t\t\t\tdropdownMenuProps={ dropdownMenuProps }\r\n\t\t\t>\r\n\t\t\t\t{ isResizable &&\r\n\t\t\t\t\t( parentLayoutType === 'grid'\r\n\t\t\t\t\t\t? aspectRatioControl\r\n\t\t\t\t\t\t: dimensionsControl ) }\r\n\t\t\t</ToolsPanel>\r\n\t\t</InspectorControls>\r\n\t);\r\n\r\n\tconst arePatternOverridesEnabled =\r\n\t\tmetadata?.bindings?.__default?.source === 'core/pattern-overrides';\r\n\r\n\tconst {\r\n\t\tlockUrlControls = false,\r\n\t\tlockHrefControls = false,\r\n\t\tlockAltControls = false,\r\n\t\tlockAltControlsMessage,\r\n\t\tlockTitleControls = false,\r\n\t\tlockTitleControlsMessage,\r\n\t\tlockCaption = false,\r\n\t} = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tif ( ! isSingleSelected ) {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t\tconst { getBlockBindingsSource } = unlock( select( blocksStore ) );\r\n\t\t\tconst {\r\n\t\t\t\turl: urlBinding,\r\n\t\t\t\talt: altBinding,\r\n\t\t\t\ttitle: titleBinding,\r\n\t\t\t} = metadata?.bindings || {};\r\n\t\t\tconst hasParentPattern = !! context[ 'pattern/overrides' ];\r\n\t\t\tconst urlBindingSource = getBlockBindingsSource(\r\n\t\t\t\turlBinding?.source\r\n\t\t\t);\r\n\t\t\tconst altBindingSource = getBlockBindingsSource(\r\n\t\t\t\taltBinding?.source\r\n\t\t\t);\r\n\t\t\tconst titleBindingSource = getBlockBindingsSource(\r\n\t\t\t\ttitleBinding?.source\r\n\t\t\t);\r\n\t\t\treturn {\r\n\t\t\t\tlockUrlControls:\r\n\t\t\t\t\t!! urlBinding &&\r\n\t\t\t\t\t! urlBindingSource?.canUserEditValue?.( {\r\n\t\t\t\t\t\tselect,\r\n\t\t\t\t\t\tcontext,\r\n\t\t\t\t\t\targs: urlBinding?.args,\r\n\t\t\t\t\t} ),\r\n\t\t\t\tlockHrefControls:\r\n\t\t\t\t\t// Disable editing the link of the URL if the image is inside a pattern instance.\r\n\t\t\t\t\t// This is a temporary solution until we support overriding the link on the frontend.\r\n\t\t\t\t\thasParentPattern || arePatternOverridesEnabled,\r\n\t\t\t\tlockCaption:\r\n\t\t\t\t\t// Disable editing the caption if the image is inside a pattern instance.\r\n\t\t\t\t\t// This is a temporary solution until we support overriding the caption on the frontend.\r\n\t\t\t\t\thasParentPattern,\r\n\t\t\t\tlockAltControls:\r\n\t\t\t\t\t!! altBinding &&\r\n\t\t\t\t\t! altBindingSource?.canUserEditValue?.( {\r\n\t\t\t\t\t\tselect,\r\n\t\t\t\t\t\tcontext,\r\n\t\t\t\t\t\targs: altBinding?.args,\r\n\t\t\t\t\t} ),\r\n\t\t\t\tlockAltControlsMessage: altBindingSource?.label\r\n\t\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t\t/* translators: %s: Label of the bindings source. */\r\n\t\t\t\t\t\t\t__( 'Connected to %s' ),\r\n\t\t\t\t\t\t\taltBindingSource.label\r\n\t\t\t\t\t  )\r\n\t\t\t\t\t: __( 'Connected to dynamic data' ),\r\n\t\t\t\tlockTitleControls:\r\n\t\t\t\t\t!! titleBinding &&\r\n\t\t\t\t\t! titleBindingSource?.canUserEditValue?.( {\r\n\t\t\t\t\t\tselect,\r\n\t\t\t\t\t\tcontext,\r\n\t\t\t\t\t\targs: titleBinding?.args,\r\n\t\t\t\t\t} ),\r\n\t\t\t\tlockTitleControlsMessage: titleBindingSource?.label\r\n\t\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t\t/* translators: %s: Label of the bindings source. */\r\n\t\t\t\t\t\t\t__( 'Connected to %s' ),\r\n\t\t\t\t\t\t\ttitleBindingSource.label\r\n\t\t\t\t\t  )\r\n\t\t\t\t\t: __( 'Connected to dynamic data' ),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[\r\n\t\t\tarePatternOverridesEnabled,\r\n\t\t\tcontext,\r\n\t\t\tisSingleSelected,\r\n\t\t\tmetadata?.bindings,\r\n\t\t]\r\n\t);\r\n\r\n\tconst showUrlInput =\r\n\t\tisSingleSelected &&\r\n\t\t! isEditingImage &&\r\n\t\t! lockHrefControls &&\r\n\t\t! lockUrlControls;\r\n\r\n\tconst showCoverControls = isSingleSelected && canInsertCover;\r\n\r\n\tconst showBlockControls = showUrlInput || allowCrop || showCoverControls;\r\n\r\n\tconst controls = (\r\n\t\t<>\r\n\t\t\t{ showBlockControls && (\r\n\t\t\t\t<BlockControls group=\"block\">\r\n\t\t\t\t\t{ showUrlInput && (\r\n\t\t\t\t\t\t<ImageURLInputUI\r\n\t\t\t\t\t\t\turl={ href || '' }\r\n\t\t\t\t\t\t\tonChangeUrl={ onSetHref }\r\n\t\t\t\t\t\t\tlinkDestination={ linkDestination }\r\n\t\t\t\t\t\t\tmediaUrl={ ( image && image.source_url ) || url }\r\n\t\t\t\t\t\t\tmediaLink={ image && image.link }\r\n\t\t\t\t\t\t\tlinkTarget={ linkTarget }\r\n\t\t\t\t\t\t\tlinkClass={ linkClass }\r\n\t\t\t\t\t\t\trel={ rel }\r\n\t\t\t\t\t\t\tshowLightboxSetting={ showLightboxSetting }\r\n\t\t\t\t\t\t\tlightboxEnabled={ lightboxChecked }\r\n\t\t\t\t\t\t\tonSetLightbox={ onSetLightbox }\r\n\t\t\t\t\t\t\tresetLightbox={ resetLightbox }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t\t{ allowCrop && (\r\n\t\t\t\t\t\t<ToolbarButton\r\n\t\t\t\t\t\t\tonClick={ () => setIsEditingImage( true ) }\r\n\t\t\t\t\t\t\ticon={ crop }\r\n\t\t\t\t\t\t\tlabel={ __( 'Crop' ) }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t\t{ showCoverControls && (\r\n\t\t\t\t\t\t<ToolbarButton\r\n\t\t\t\t\t\t\ticon={ overlayText }\r\n\t\t\t\t\t\t\tlabel={ __( 'Add text over image' ) }\r\n\t\t\t\t\t\t\tonClick={ switchToCover }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</BlockControls>\r\n\t\t\t) }\r\n\t\t\t{ isSingleSelected && ! isEditingImage && ! lockUrlControls && (\r\n\t\t\t\t<BlockControls group=\"other\">\r\n\t\t\t\t\t<MediaReplaceFlow\r\n\t\t\t\t\t\tmediaId={ id }\r\n\t\t\t\t\t\tmediaURL={ url }\r\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\r\n\t\t\t\t\t\taccept=\"image/*\"\r\n\t\t\t\t\t\tonSelect={ onSelectImage }\r\n\t\t\t\t\t\tonSelectURL={ onSelectURL }\r\n\t\t\t\t\t\tonError={ onUploadError }\r\n\t\t\t\t\t\tonReset={ () => onSelectImage( undefined ) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</BlockControls>\r\n\t\t\t) }\r\n\t\t\t{ isSingleSelected && externalBlob && (\r\n\t\t\t\t<BlockControls>\r\n\t\t\t\t\t<ToolbarGroup>\r\n\t\t\t\t\t\t<ToolbarButton\r\n\t\t\t\t\t\t\tonClick={ uploadExternal }\r\n\t\t\t\t\t\t\ticon={ upload }\r\n\t\t\t\t\t\t\tlabel={ __( 'Upload to Media Library' ) }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</ToolbarGroup>\r\n\t\t\t\t</BlockControls>\r\n\t\t\t) }\r\n\t\t\t{ isContentOnlyMode && (\r\n\t\t\t\t// Add some extra controls for content attributes when content only mode is active.\r\n\t\t\t\t// With content only mode active, the inspector is hidden, so users need another way\r\n\t\t\t\t// to edit these attributes.\r\n\t\t\t\t<BlockControls group=\"other\">\r\n\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\tpopoverProps={ { position: 'bottom right' } }\r\n\t\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\r\n\t\t\t\t\t\t\t<ToolbarButton\r\n\t\t\t\t\t\t\t\tonClick={ onToggle }\r\n\t\t\t\t\t\t\t\taria-haspopup=\"true\"\r\n\t\t\t\t\t\t\t\taria-expanded={ isOpen }\r\n\t\t\t\t\t\t\t\tonKeyDown={ ( event ) => {\r\n\t\t\t\t\t\t\t\t\tif ( ! isOpen && event.keyCode === DOWN ) {\r\n\t\t\t\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\tonToggle();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{ _x(\r\n\t\t\t\t\t\t\t\t\t'Alternative text',\r\n\t\t\t\t\t\t\t\t\t'Alternative text for an image. Block toolbar label, a low character count is preferred.'\r\n\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t</ToolbarButton>\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t\trenderContent={ () => (\r\n\t\t\t\t\t\t\t<TextareaControl\r\n\t\t\t\t\t\t\t\tclassName=\"wp-block-image__toolbar_content_textarea\"\r\n\t\t\t\t\t\t\t\tlabel={ __( 'Alternative text' ) }\r\n\t\t\t\t\t\t\t\tvalue={ alt || '' }\r\n\t\t\t\t\t\t\t\tonChange={ updateAlt }\r\n\t\t\t\t\t\t\t\tdisabled={ lockAltControls }\r\n\t\t\t\t\t\t\t\thelp={\r\n\t\t\t\t\t\t\t\t\tlockAltControls ? (\r\n\t\t\t\t\t\t\t\t\t\t<>{ lockAltControlsMessage }</>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t<ExternalLink\r\n\t\t\t\t\t\t\t\t\t\t\t\thref={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// translators: Localized tutorial, if one exists. W3C Web Accessibility Initiative link has list of existing translations.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Describe the purpose of the image.'\r\n\t\t\t\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t\t\t\t</ExternalLink>\r\n\t\t\t\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Leave empty if decorative.'\r\n\t\t\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{ title && (\r\n\t\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\t\tpopoverProps={ { position: 'bottom right' } }\r\n\t\t\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\r\n\t\t\t\t\t\t\t\t<ToolbarButton\r\n\t\t\t\t\t\t\t\t\tonClick={ onToggle }\r\n\t\t\t\t\t\t\t\t\taria-haspopup=\"true\"\r\n\t\t\t\t\t\t\t\t\taria-expanded={ isOpen }\r\n\t\t\t\t\t\t\t\t\tonKeyDown={ ( event ) => {\r\n\t\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\t\t! isOpen &&\r\n\t\t\t\t\t\t\t\t\t\t\tevent.keyCode === DOWN\r\n\t\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t\tonToggle();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{ __( 'Title' ) }\r\n\t\t\t\t\t\t\t\t</ToolbarButton>\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\trenderContent={ () => (\r\n\t\t\t\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t\t\t\tclassName=\"wp-block-image__toolbar_content_textarea\"\r\n\t\t\t\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Title attribute' ) }\r\n\t\t\t\t\t\t\t\t\tvalue={ title || '' }\r\n\t\t\t\t\t\t\t\t\tonChange={ onSetTitle }\r\n\t\t\t\t\t\t\t\t\tdisabled={ lockTitleControls }\r\n\t\t\t\t\t\t\t\t\thelp={\r\n\t\t\t\t\t\t\t\t\t\tlockTitleControls ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<>{ lockTitleControlsMessage }</>\r\n\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Describe the role of this image on the page.'\r\n\t\t\t\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ExternalLink href=\"https://www.w3.org/TR/html52/dom.html#the-title-attribute\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'(Note: many devices and browsers do not display this text.)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</ExternalLink>\r\n\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</BlockControls>\r\n\t\t\t) }\r\n\t\t\t<InspectorControls>\r\n\t\t\t\t<ToolsPanel\r\n\t\t\t\t\tlabel={ __( 'Settings' ) }\r\n\t\t\t\t\tresetAll={ resetAll }\r\n\t\t\t\t\tdropdownMenuProps={ dropdownMenuProps }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ isSingleSelected && (\r\n\t\t\t\t\t\t<ToolsPanelItem\r\n\t\t\t\t\t\t\tlabel={ __( 'Alternative text' ) }\r\n\t\t\t\t\t\t\tisShownByDefault\r\n\t\t\t\t\t\t\thasValue={ () => !! alt }\r\n\t\t\t\t\t\t\tonDeselect={ () =>\r\n\t\t\t\t\t\t\t\tsetAttributes( { alt: undefined } )\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<TextareaControl\r\n\t\t\t\t\t\t\t\tlabel={ __( 'Alternative text' ) }\r\n\t\t\t\t\t\t\t\tvalue={ alt || '' }\r\n\t\t\t\t\t\t\t\tonChange={ updateAlt }\r\n\t\t\t\t\t\t\t\treadOnly={ lockAltControls }\r\n\t\t\t\t\t\t\t\thelp={\r\n\t\t\t\t\t\t\t\t\tlockAltControls ? (\r\n\t\t\t\t\t\t\t\t\t\t<>{ lockAltControlsMessage }</>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t<ExternalLink\r\n\t\t\t\t\t\t\t\t\t\t\t\thref={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// translators: Localized tutorial, if one exists. W3C Web Accessibility Initiative link has list of existing translations.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Describe the purpose of the image.'\r\n\t\t\t\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t\t\t\t</ExternalLink>\r\n\t\t\t\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Leave empty if decorative.'\r\n\t\t\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</ToolsPanelItem>\r\n\t\t\t\t\t) }\r\n\t\t\t\t\t{ isResizable &&\r\n\t\t\t\t\t\t( parentLayoutType === 'grid'\r\n\t\t\t\t\t\t\t? aspectRatioControl\r\n\t\t\t\t\t\t\t: dimensionsControl ) }\r\n\t\t\t\t\t{ !! imageSizeOptions.length && (\r\n\t\t\t\t\t\t<ResolutionTool\r\n\t\t\t\t\t\t\tvalue={ sizeSlug }\r\n\t\t\t\t\t\t\tonChange={ updateImage }\r\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</ToolsPanel>\r\n\t\t\t</InspectorControls>\r\n\t\t\t<InspectorControls group=\"advanced\">\r\n\t\t\t\t<TextControl\r\n\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\tlabel={ __( 'Title attribute' ) }\r\n\t\t\t\t\tvalue={ title || '' }\r\n\t\t\t\t\tonChange={ onSetTitle }\r\n\t\t\t\t\treadOnly={ lockTitleControls }\r\n\t\t\t\t\thelp={\r\n\t\t\t\t\t\tlockTitleControls ? (\r\n\t\t\t\t\t\t\t<>{ lockTitleControlsMessage }</>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t'Describe the role of this image on the page.'\r\n\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t<ExternalLink href=\"https://www.w3.org/TR/html52/dom.html#the-title-attribute\">\r\n\t\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t\t'(Note: many devices and browsers do not display this text.)'\r\n\t\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\t</ExternalLink>\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t</InspectorControls>\r\n\t\t</>\r\n\t);\r\n\r\n\tconst filename = getFilename( url );\r\n\tlet defaultedAlt;\r\n\r\n\tif ( alt ) {\r\n\t\tdefaultedAlt = alt;\r\n\t} else if ( filename ) {\r\n\t\tdefaultedAlt = sprintf(\r\n\t\t\t/* translators: %s: file name */\r\n\t\t\t__( 'This image has an empty alt attribute; its file name is %s' ),\r\n\t\t\tfilename\r\n\t\t);\r\n\t} else {\r\n\t\tdefaultedAlt = __( 'This image has an empty alt attribute' );\r\n\t}\r\n\r\n\tconst borderProps = useBorderProps( attributes );\r\n\tconst shadowProps = getShadowClassesAndStyles( attributes );\r\n\tconst isRounded = attributes.className?.includes( 'is-style-rounded' );\r\n\r\n\tlet img =\r\n\t\ttemporaryURL && hasImageErrored ? (\r\n\t\t\t// Show a placeholder during upload when the blob URL can't be loaded. This can\r\n\t\t\t// happen when the user uploads a HEIC image in a browser that doesn't support them.\r\n\t\t\t<Placeholder\r\n\t\t\t\tclassName=\"wp-block-image__placeholder\"\r\n\t\t\t\twithIllustration\r\n\t\t\t>\r\n\t\t\t\t<Spinner />\r\n\t\t\t</Placeholder>\r\n\t\t) : (\r\n\t\t\t// Disable reason: Image itself is not meant to be interactive, but\r\n\t\t\t// should direct focus to block.\r\n\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions, jsx-a11y/click-events-have-key-events */\r\n\t\t\t<>\r\n\t\t\t\t<img\r\n\t\t\t\t\tsrc={ temporaryURL || url }\r\n\t\t\t\t\talt={ defaultedAlt }\r\n\t\t\t\t\tonError={ onImageError }\r\n\t\t\t\t\tonLoad={ onImageLoad }\r\n\t\t\t\t\tref={ imageRef }\r\n\t\t\t\t\tclassName={ borderProps.className }\r\n\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\twidth:\r\n\t\t\t\t\t\t\t( width && height ) || aspectRatio\r\n\t\t\t\t\t\t\t\t? '100%'\r\n\t\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\theight:\r\n\t\t\t\t\t\t\t( width && height ) || aspectRatio\r\n\t\t\t\t\t\t\t\t? '100%'\r\n\t\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\tobjectFit: scale,\r\n\t\t\t\t\t\t...borderProps.style,\r\n\t\t\t\t\t\t...shadowProps.style,\r\n\t\t\t\t\t} }\r\n\t\t\t\t/>\r\n\t\t\t\t{ temporaryURL && <Spinner /> }\r\n\t\t\t</>\r\n\t\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions, jsx-a11y/click-events-have-key-events */\r\n\t\t);\r\n\r\n\tif ( canEditImage && isEditingImage ) {\r\n\t\timg = (\r\n\t\t\t<ImageWrapper href={ href }>\r\n\t\t\t\t<ImageEditor\r\n\t\t\t\t\tid={ id }\r\n\t\t\t\t\turl={ url }\r\n\t\t\t\t\twidth={ numericWidth }\r\n\t\t\t\t\theight={ numericHeight }\r\n\t\t\t\t\tnaturalHeight={ naturalHeight }\r\n\t\t\t\t\tnaturalWidth={ naturalWidth }\r\n\t\t\t\t\tonSaveImage={ ( imageAttributes ) =>\r\n\t\t\t\t\t\tsetAttributes( imageAttributes )\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonFinishEditing={ () => {\r\n\t\t\t\t\t\tsetIsEditingImage( false );\r\n\t\t\t\t\t} }\r\n\t\t\t\t\tborderProps={ isRounded ? undefined : borderProps }\r\n\t\t\t\t/>\r\n\t\t\t</ImageWrapper>\r\n\t\t);\r\n\t} else if ( ! isResizable || parentLayoutType === 'grid' ) {\r\n\t\timg = (\r\n\t\t\t<div style={ { width, height, aspectRatio } }>\r\n\t\t\t\t<ImageWrapper href={ href }>{ img }</ImageWrapper>\r\n\t\t\t</div>\r\n\t\t);\r\n\t} else {\r\n\t\tconst numericRatio = aspectRatio && evalAspectRatio( aspectRatio );\r\n\t\tconst customRatio = numericWidth / numericHeight;\r\n\t\tconst naturalRatio = naturalWidth / naturalHeight;\r\n\t\tconst ratio = numericRatio || customRatio || naturalRatio || 1;\r\n\t\tconst currentWidth =\r\n\t\t\t! numericWidth && numericHeight\r\n\t\t\t\t? numericHeight * ratio\r\n\t\t\t\t: numericWidth;\r\n\t\tconst currentHeight =\r\n\t\t\t! numericHeight && numericWidth\r\n\t\t\t\t? numericWidth / ratio\r\n\t\t\t\t: numericHeight;\r\n\r\n\t\tconst minWidth =\r\n\t\t\tnaturalWidth < naturalHeight ? MIN_SIZE : MIN_SIZE * ratio;\r\n\t\tconst minHeight =\r\n\t\t\tnaturalHeight < naturalWidth ? MIN_SIZE : MIN_SIZE / ratio;\r\n\r\n\t\t// With the current implementation of ResizableBox, an image needs an\r\n\t\t// explicit pixel value for the max-width. In absence of being able to\r\n\t\t// set the content-width, this max-width is currently dictated by the\r\n\t\t// vanilla editor style. The following variable adds a buffer to this\r\n\t\t// vanilla style, so 3rd party themes have some wiggleroom. This does,\r\n\t\t// in most cases, allow you to scale the image beyond the width of the\r\n\t\t// main column, though not infinitely.\r\n\t\t// @todo It would be good to revisit this once a content-width variable\r\n\t\t// becomes available.\r\n\t\tconst maxWidthBuffer = maxWidth * 2.5;\r\n\t\tconst maxContentWidth = containerWidth || maxWidthBuffer;\r\n\r\n\t\tlet showRightHandle = false;\r\n\t\tlet showLeftHandle = false;\r\n\r\n\t\t/* eslint-disable no-lonely-if */\r\n\t\t// See https://github.com/WordPress/gutenberg/issues/7584.\r\n\t\tif ( align === 'center' ) {\r\n\t\t\t// When the image is centered, show both handles.\r\n\t\t\tshowRightHandle = true;\r\n\t\t\tshowLeftHandle = true;\r\n\t\t} else if ( isRTL() ) {\r\n\t\t\t// In RTL mode the image is on the right by default.\r\n\t\t\t// Show the right handle and hide the left handle only when it is\r\n\t\t\t// aligned left. Otherwise always show the left handle.\r\n\t\t\tif ( align === 'left' ) {\r\n\t\t\t\tshowRightHandle = true;\r\n\t\t\t} else {\r\n\t\t\t\tshowLeftHandle = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Show the left handle and hide the right handle only when the\r\n\t\t\t// image is aligned right. Otherwise always show the right handle.\r\n\t\t\tif ( align === 'right' ) {\r\n\t\t\t\tshowLeftHandle = true;\r\n\t\t\t} else {\r\n\t\t\t\tshowRightHandle = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t/* eslint-enable no-lonely-if */\r\n\t\timg = (\r\n\t\t\t<ResizableBox\r\n\t\t\t\tstyle={ {\r\n\t\t\t\t\tdisplay: 'block',\r\n\t\t\t\t\tobjectFit: scale,\r\n\t\t\t\t\taspectRatio:\r\n\t\t\t\t\t\t! width && ! height && aspectRatio\r\n\t\t\t\t\t\t\t? aspectRatio\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t} }\r\n\t\t\t\tsize={ {\r\n\t\t\t\t\twidth: currentWidth ?? 'auto',\r\n\t\t\t\t\theight: currentHeight ?? 'auto',\r\n\t\t\t\t} }\r\n\t\t\t\tshowHandle={ isSingleSelected }\r\n\t\t\t\tminWidth={ minWidth }\r\n\t\t\t\tmaxWidth={ maxContentWidth }\r\n\t\t\t\tminHeight={ minHeight }\r\n\t\t\t\tmaxHeight={ maxContentWidth / ratio }\r\n\t\t\t\tlockAspectRatio={ ratio }\r\n\t\t\t\tenable={ {\r\n\t\t\t\t\ttop: false,\r\n\t\t\t\t\tright: showRightHandle,\r\n\t\t\t\t\tbottom: true,\r\n\t\t\t\t\tleft: showLeftHandle,\r\n\t\t\t\t} }\r\n\t\t\t\tonResizeStart={ onResizeStart }\r\n\t\t\t\tonResizeStop={ ( event, direction, elt ) => {\r\n\t\t\t\t\tonResizeStop();\r\n\r\n\t\t\t\t\t// Clear hardcoded width if the resized width is close to the max-content width.\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t// Only do this if the image is bigger than the container to prevent it from being squished.\r\n\t\t\t\t\t\t// TODO: Remove this check if the image support setting 100% width.\r\n\t\t\t\t\t\tnaturalWidth >= maxContentWidth &&\r\n\t\t\t\t\t\tMath.abs( elt.offsetWidth - maxContentWidth ) < 10\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t\t\twidth: undefined,\r\n\t\t\t\t\t\t\theight: undefined,\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Since the aspect ratio is locked when resizing, we can\r\n\t\t\t\t\t// use the width of the resized element to calculate the\r\n\t\t\t\t\t// height in CSS to prevent stretching when the max-width\r\n\t\t\t\t\t// is reached.\r\n\t\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t\twidth: `${ elt.offsetWidth }px`,\r\n\t\t\t\t\t\theight: 'auto',\r\n\t\t\t\t\t\taspectRatio:\r\n\t\t\t\t\t\t\tratio === naturalRatio\r\n\t\t\t\t\t\t\t\t? undefined\r\n\t\t\t\t\t\t\t\t: String( ratio ),\r\n\t\t\t\t\t} );\r\n\t\t\t\t} }\r\n\t\t\t\tresizeRatio={ align === 'center' ? 2 : 1 }\r\n\t\t\t>\r\n\t\t\t\t<ImageWrapper href={ href }>{ img }</ImageWrapper>\r\n\t\t\t</ResizableBox>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( ! url && ! temporaryURL ) {\r\n\t\t// Add all controls if the image attributes are connected.\r\n\t\treturn metadata?.bindings ? controls : sizeControls;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ controls }\r\n\t\t\t{ img }\r\n\r\n\t\t\t<Caption\r\n\t\t\t\tattributes={ attributes }\r\n\t\t\t\tsetAttributes={ setAttributes }\r\n\t\t\t\tisSelected={ isSingleSelected }\r\n\t\t\t\tinsertBlocksAfter={ insertBlocksAfter }\r\n\t\t\t\tlabel={ __( 'Image caption text' ) }\r\n\t\t\t\tshowToolbarButton={\r\n\t\t\t\t\tisSingleSelected &&\r\n\t\t\t\t\thasNonContentControls &&\r\n\t\t\t\t\t! arePatternOverridesEnabled\r\n\t\t\t\t}\r\n\t\t\t\treadOnly={ lockCaption }\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}