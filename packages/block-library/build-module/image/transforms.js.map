{"version":3,"names":["createBlobURL","isBlobURL","createBlock","getBlockAttributes","dispatch","store","noticesStore","__","stripFirstImage","attributes","shortcode","body","document","implementation","createHTMLDocument","innerHTML","content","nodeToRemove","querySelector","parentNode","removeChild","trim","getFirstAnchorAttributeFormHTML","html","attributeName","firstElementChild","nodeName","getAttribute","undefined","imageSchema","img","classes","schema","phrasingContentSchema","figure","require","children","a","figcaption","transforms","from","type","isMatch","node","transform","className","alignMatches","exec","anchor","id","align","idMatches","Number","anchorElement","linkDestination","href","rel","linkClass","outerHTML","url","blob","files","some","file","indexOf","createErrorNotice","every","blocks","map","tag","source","attribute","selector","alt","caption","named","parseInt","replace"],"sources":["@wordpress/block-library/src/image/transforms.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createBlobURL, isBlobURL } from '@wordpress/blob';\r\nimport { createBlock, getBlockAttributes } from '@wordpress/blocks';\r\nimport { dispatch } from '@wordpress/data';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { __ } from '@wordpress/i18n';\r\n\r\nexport function stripFirstImage( attributes, { shortcode } ) {\r\n\tconst { body } = document.implementation.createHTMLDocument( '' );\r\n\r\n\tbody.innerHTML = shortcode.content;\r\n\r\n\tlet nodeToRemove = body.querySelector( 'img' );\r\n\r\n\t// If an image has parents, find the topmost node to remove.\r\n\twhile (\r\n\t\tnodeToRemove &&\r\n\t\tnodeToRemove.parentNode &&\r\n\t\tnodeToRemove.parentNode !== body\r\n\t) {\r\n\t\tnodeToRemove = nodeToRemove.parentNode;\r\n\t}\r\n\r\n\tif ( nodeToRemove ) {\r\n\t\tnodeToRemove.parentNode.removeChild( nodeToRemove );\r\n\t}\r\n\r\n\treturn body.innerHTML.trim();\r\n}\r\n\r\nfunction getFirstAnchorAttributeFormHTML( html, attributeName ) {\r\n\tconst { body } = document.implementation.createHTMLDocument( '' );\r\n\r\n\tbody.innerHTML = html;\r\n\r\n\tconst { firstElementChild } = body;\r\n\r\n\tif ( firstElementChild && firstElementChild.nodeName === 'A' ) {\r\n\t\treturn firstElementChild.getAttribute( attributeName ) || undefined;\r\n\t}\r\n}\r\n\r\nconst imageSchema = {\r\n\timg: {\r\n\t\tattributes: [ 'src', 'alt', 'title' ],\r\n\t\tclasses: [\r\n\t\t\t'alignleft',\r\n\t\t\t'aligncenter',\r\n\t\t\t'alignright',\r\n\t\t\t'alignnone',\r\n\t\t\t/^wp-image-\\d+$/,\r\n\t\t],\r\n\t},\r\n};\r\n\r\nconst schema = ( { phrasingContentSchema } ) => ( {\r\n\tfigure: {\r\n\t\trequire: [ 'img' ],\r\n\t\tchildren: {\r\n\t\t\t...imageSchema,\r\n\t\t\ta: {\r\n\t\t\t\tattributes: [ 'href', 'rel', 'target' ],\r\n\t\t\t\tchildren: imageSchema,\r\n\t\t\t},\r\n\t\t\tfigcaption: {\r\n\t\t\t\tchildren: phrasingContentSchema,\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n} );\r\n\r\nconst transforms = {\r\n\tfrom: [\r\n\t\t{\r\n\t\t\ttype: 'raw',\r\n\t\t\tisMatch: ( node ) =>\r\n\t\t\t\tnode.nodeName === 'FIGURE' && !! node.querySelector( 'img' ),\r\n\t\t\tschema,\r\n\t\t\ttransform: ( node ) => {\r\n\t\t\t\t// Search both figure and image classes. Alignment could be\r\n\t\t\t\t// set on either. ID is set on the image.\r\n\t\t\t\tconst className =\r\n\t\t\t\t\tnode.className +\r\n\t\t\t\t\t' ' +\r\n\t\t\t\t\tnode.querySelector( 'img' ).className;\r\n\t\t\t\tconst alignMatches =\r\n\t\t\t\t\t/(?:^|\\s)align(left|center|right)(?:$|\\s)/.exec(\r\n\t\t\t\t\t\tclassName\r\n\t\t\t\t\t);\r\n\t\t\t\tconst anchor = node.id === '' ? undefined : node.id;\r\n\t\t\t\tconst align = alignMatches ? alignMatches[ 1 ] : undefined;\r\n\t\t\t\tconst idMatches = /(?:^|\\s)wp-image-(\\d+)(?:$|\\s)/.exec(\r\n\t\t\t\t\tclassName\r\n\t\t\t\t);\r\n\t\t\t\tconst id = idMatches ? Number( idMatches[ 1 ] ) : undefined;\r\n\t\t\t\tconst anchorElement = node.querySelector( 'a' );\r\n\t\t\t\tconst linkDestination =\r\n\t\t\t\t\tanchorElement && anchorElement.href ? 'custom' : undefined;\r\n\t\t\t\tconst href =\r\n\t\t\t\t\tanchorElement && anchorElement.href\r\n\t\t\t\t\t\t? anchorElement.href\r\n\t\t\t\t\t\t: undefined;\r\n\t\t\t\tconst rel =\r\n\t\t\t\t\tanchorElement && anchorElement.rel\r\n\t\t\t\t\t\t? anchorElement.rel\r\n\t\t\t\t\t\t: undefined;\r\n\t\t\t\tconst linkClass =\r\n\t\t\t\t\tanchorElement && anchorElement.className\r\n\t\t\t\t\t\t? anchorElement.className\r\n\t\t\t\t\t\t: undefined;\r\n\t\t\t\tconst attributes = getBlockAttributes(\r\n\t\t\t\t\t'core/image',\r\n\t\t\t\t\tnode.outerHTML,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\talign,\r\n\t\t\t\t\t\tid,\r\n\t\t\t\t\t\tlinkDestination,\r\n\t\t\t\t\t\thref,\r\n\t\t\t\t\t\trel,\r\n\t\t\t\t\t\tlinkClass,\r\n\t\t\t\t\t\tanchor,\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif ( isBlobURL( attributes.url ) ) {\r\n\t\t\t\t\tattributes.blob = attributes.url;\r\n\t\t\t\t\tdelete attributes.url;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn createBlock( 'core/image', attributes );\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\t// Note: when dragging and dropping multiple files onto a gallery this overrides the\r\n\t\t\t// gallery transform in order to add new images to the gallery instead of\r\n\t\t\t// creating a new gallery.\r\n\t\t\ttype: 'files',\r\n\t\t\tisMatch( files ) {\r\n\t\t\t\t// The following check is intended to catch non-image files when dropped together with images.\r\n\t\t\t\tif (\r\n\t\t\t\t\tfiles.some(\r\n\t\t\t\t\t\t( file ) => file.type.indexOf( 'image/' ) === 0\r\n\t\t\t\t\t) &&\r\n\t\t\t\t\tfiles.some(\r\n\t\t\t\t\t\t( file ) => file.type.indexOf( 'image/' ) !== 0\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\tconst { createErrorNotice } = dispatch( noticesStore );\r\n\t\t\t\t\tcreateErrorNotice(\r\n\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t'If uploading to a gallery all files need to be image formats'\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 'gallery-transform-invalid-file',\r\n\t\t\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\treturn files.every(\r\n\t\t\t\t\t( file ) => file.type.indexOf( 'image/' ) === 0\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\ttransform( files ) {\r\n\t\t\t\tconst blocks = files.map( ( file ) => {\r\n\t\t\t\t\treturn createBlock( 'core/image', {\r\n\t\t\t\t\t\tblob: createBlobURL( file ),\r\n\t\t\t\t\t} );\r\n\t\t\t\t} );\r\n\t\t\t\treturn blocks;\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'shortcode',\r\n\t\t\ttag: 'caption',\r\n\t\t\tattributes: {\r\n\t\t\t\turl: {\r\n\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\tsource: 'attribute',\r\n\t\t\t\t\tattribute: 'src',\r\n\t\t\t\t\tselector: 'img',\r\n\t\t\t\t},\r\n\t\t\t\talt: {\r\n\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\tsource: 'attribute',\r\n\t\t\t\t\tattribute: 'alt',\r\n\t\t\t\t\tselector: 'img',\r\n\t\t\t\t},\r\n\t\t\t\tcaption: {\r\n\t\t\t\t\tshortcode: stripFirstImage,\r\n\t\t\t\t},\r\n\t\t\t\thref: {\r\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\r\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\r\n\t\t\t\t\t\t\tshortcode.content,\r\n\t\t\t\t\t\t\t'href'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\trel: {\r\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\r\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\r\n\t\t\t\t\t\t\tshortcode.content,\r\n\t\t\t\t\t\t\t'rel'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tlinkClass: {\r\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\r\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\r\n\t\t\t\t\t\t\tshortcode.content,\r\n\t\t\t\t\t\t\t'class'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tid: {\r\n\t\t\t\t\ttype: 'number',\r\n\t\t\t\t\tshortcode: ( { named: { id } } ) => {\r\n\t\t\t\t\t\tif ( ! id ) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn parseInt( id.replace( 'attachment_', '' ), 10 );\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\talign: {\r\n\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\tshortcode: ( { named: { align = 'alignnone' } } ) => {\r\n\t\t\t\t\t\treturn align.replace( 'align', '' );\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t},\r\n\t],\r\n};\r\n\r\nexport default transforms;\r\n"],"mappings":"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","ignoreList":[]}