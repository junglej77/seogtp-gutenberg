{"version":3,"names":["escapeHTML","safeDecodeURI","updateAttributes","updatedValue","setAttributes","blockAttributes","label","originalLabel","kind","originalKind","type","originalType","title","newLabel","url","newUrl","opensInNewTab","id","newKind","newType","newLabelWithoutHttp","replace","newUrlWithoutHttp","useNewLabel","isBuiltInType","indexOf","isCustomLink","encodeURI","undefined","Number","isInteger"],"sources":["@wordpress/block-library/src/navigation-link/update-attributes.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { escapeHTML } from '@wordpress/escape-html';\r\nimport { safeDecodeURI } from '@wordpress/url';\r\n\r\n/**\r\n * @typedef {'post-type'|'custom'|'taxonomy'|'post-type-archive'} WPNavigationLinkKind\r\n */\r\n/**\r\n * Navigation Link Block Attributes\r\n *\r\n * @typedef {Object} WPNavigationLinkBlockAttributes\r\n *\r\n * @property {string}               [label]         Link text.\r\n * @property {WPNavigationLinkKind} [kind]          Kind is used to differentiate between term and post ids to check post draft status.\r\n * @property {string}               [type]          The type such as post, page, tag, category and other custom types.\r\n * @property {string}               [rel]           The relationship of the linked URL.\r\n * @property {number}               [id]            A post or term id.\r\n * @property {boolean}              [opensInNewTab] Sets link target to _blank when true.\r\n * @property {string}               [url]           Link href.\r\n * @property {string}               [title]         Link title attribute.\r\n */\r\n/**\r\n * Link Control onChange handler that updates block attributes when a setting is changed.\r\n *\r\n * @param {Object}                          updatedValue    New block attributes to update.\r\n * @param {Function}                        setAttributes   Block attribute update function.\r\n * @param {WPNavigationLinkBlockAttributes} blockAttributes Current block attributes.\r\n */\r\n\r\nexport const updateAttributes = (\r\n\tupdatedValue = {},\r\n\tsetAttributes,\r\n\tblockAttributes = {}\r\n) => {\r\n\tconst {\r\n\t\tlabel: originalLabel = '',\r\n\t\tkind: originalKind = '',\r\n\t\ttype: originalType = '',\r\n\t} = blockAttributes;\r\n\r\n\tconst {\r\n\t\ttitle: newLabel = '', // the title of any provided Post.\r\n\t\turl: newUrl = '',\r\n\t\topensInNewTab,\r\n\t\tid,\r\n\t\tkind: newKind = originalKind,\r\n\t\ttype: newType = originalType,\r\n\t} = updatedValue;\r\n\r\n\tconst newLabelWithoutHttp = newLabel.replace( /http(s?):\\/\\//gi, '' );\r\n\tconst newUrlWithoutHttp = newUrl.replace( /http(s?):\\/\\//gi, '' );\r\n\r\n\tconst useNewLabel =\r\n\t\tnewLabel &&\r\n\t\tnewLabel !== originalLabel &&\r\n\t\t// LinkControl without the title field relies\r\n\t\t// on the check below. Specifically, it assumes that\r\n\t\t// the URL is the same as a title.\r\n\t\t// This logic a) looks suspicious and b) should really\r\n\t\t// live in the LinkControl and not here. It's a great\r\n\t\t// candidate for future refactoring.\r\n\t\tnewLabelWithoutHttp !== newUrlWithoutHttp;\r\n\r\n\t// Unfortunately this causes the escaping model to be inverted.\r\n\t// The escaped content is stored in the block attributes (and ultimately in the database),\r\n\t// and then the raw data is \"recovered\" when outputting into the DOM.\r\n\t// It would be preferable to store the **raw** data in the block attributes and escape it in JS.\r\n\t// Why? Because there isn't one way to escape data. Depending on the context, you need to do\r\n\t// different transforms. It doesn't make sense to me to choose one of them for the purposes of storage.\r\n\t// See also:\r\n\t// - https://github.com/WordPress/gutenberg/pull/41063\r\n\t// - https://github.com/WordPress/gutenberg/pull/18617.\r\n\tconst label = useNewLabel\r\n\t\t? escapeHTML( newLabel )\r\n\t\t: originalLabel || escapeHTML( newUrlWithoutHttp );\r\n\r\n\t// In https://github.com/WordPress/gutenberg/pull/24670 we decided to use \"tag\" in favor of \"post_tag\"\r\n\tconst type = newType === 'post_tag' ? 'tag' : newType.replace( '-', '_' );\r\n\r\n\tconst isBuiltInType =\r\n\t\t[ 'post', 'page', 'tag', 'category' ].indexOf( type ) > -1;\r\n\r\n\tconst isCustomLink =\r\n\t\t( ! newKind && ! isBuiltInType ) || newKind === 'custom';\r\n\tconst kind = isCustomLink ? 'custom' : newKind;\r\n\r\n\tsetAttributes( {\r\n\t\t// Passed `url` may already be encoded. To prevent double encoding, decodeURI is executed to revert to the original string.\r\n\t\t...( newUrl && { url: encodeURI( safeDecodeURI( newUrl ) ) } ),\r\n\t\t...( label && { label } ),\r\n\t\t...( undefined !== opensInNewTab && { opensInNewTab } ),\r\n\t\t...( id && Number.isInteger( id ) && { id } ),\r\n\t\t...( kind && { kind } ),\r\n\t\t...( type && type !== 'URL' && { type } ),\r\n\t} );\r\n};\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,UAAU,QAAQ,wBAAwB;AACnD,SAASC,aAAa,QAAQ,gBAAgB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,MAAMC,gBAAgB,GAAGA,CAC/BC,YAAY,GAAG,CAAC,CAAC,EACjBC,aAAa,EACbC,eAAe,GAAG,CAAC,CAAC,KAChB;EACJ,MAAM;IACLC,KAAK,EAAEC,aAAa,GAAG,EAAE;IACzBC,IAAI,EAAEC,YAAY,GAAG,EAAE;IACvBC,IAAI,EAAEC,YAAY,GAAG;EACtB,CAAC,GAAGN,eAAe;EAEnB,MAAM;IACLO,KAAK,EAAEC,QAAQ,GAAG,EAAE;IAAE;IACtBC,GAAG,EAAEC,MAAM,GAAG,EAAE;IAChBC,aAAa;IACbC,EAAE;IACFT,IAAI,EAAEU,OAAO,GAAGT,YAAY;IAC5BC,IAAI,EAAES,OAAO,GAAGR;EACjB,CAAC,GAAGR,YAAY;EAEhB,MAAMiB,mBAAmB,GAAGP,QAAQ,CAACQ,OAAO,CAAE,iBAAiB,EAAE,EAAG,CAAC;EACrE,MAAMC,iBAAiB,GAAGP,MAAM,CAACM,OAAO,CAAE,iBAAiB,EAAE,EAAG,CAAC;EAEjE,MAAME,WAAW,GAChBV,QAAQ,IACRA,QAAQ,KAAKN,aAAa;EAC1B;EACA;EACA;EACA;EACA;EACA;EACAa,mBAAmB,KAAKE,iBAAiB;;EAE1C;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAMhB,KAAK,GAAGiB,WAAW,GACtBvB,UAAU,CAAEa,QAAS,CAAC,GACtBN,aAAa,IAAIP,UAAU,CAAEsB,iBAAkB,CAAC;;EAEnD;EACA,MAAMZ,IAAI,GAAGS,OAAO,KAAK,UAAU,GAAG,KAAK,GAAGA,OAAO,CAACE,OAAO,CAAE,GAAG,EAAE,GAAI,CAAC;EAEzE,MAAMG,aAAa,GAClB,CAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,UAAU,CAAE,CAACC,OAAO,CAAEf,IAAK,CAAC,GAAG,CAAC,CAAC;EAE3D,MAAMgB,YAAY,GACf,CAAER,OAAO,IAAI,CAAEM,aAAa,IAAMN,OAAO,KAAK,QAAQ;EACzD,MAAMV,IAAI,GAAGkB,YAAY,GAAG,QAAQ,GAAGR,OAAO;EAE9Cd,aAAa,CAAE;IACd;IACA,IAAKW,MAAM,IAAI;MAAED,GAAG,EAAEa,SAAS,CAAE1B,aAAa,CAAEc,MAAO,CAAE;IAAE,CAAC,CAAE;IAC9D,IAAKT,KAAK,IAAI;MAAEA;IAAM,CAAC,CAAE;IACzB,IAAKsB,SAAS,KAAKZ,aAAa,IAAI;MAAEA;IAAc,CAAC,CAAE;IACvD,IAAKC,EAAE,IAAIY,MAAM,CAACC,SAAS,CAAEb,EAAG,CAAC,IAAI;MAAEA;IAAG,CAAC,CAAE;IAC7C,IAAKT,IAAI,IAAI;MAAEA;IAAK,CAAC,CAAE;IACvB,IAAKE,IAAI,IAAIA,IAAI,KAAK,KAAK,IAAI;MAAEA;IAAK,CAAC;EACxC,CAAE,CAAC;AACJ,CAAC","ignoreList":[]}