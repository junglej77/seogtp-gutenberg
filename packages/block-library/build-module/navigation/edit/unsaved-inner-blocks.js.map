{"version":3,"names":["useInnerBlocksProps","Disabled","store","coreStore","useSelect","useContext","useEffect","useRef","areBlocksDirty","DEFAULT_BLOCK","SELECT_NAVIGATION_MENUS_ARGS","jsx","_jsx","EMPTY_OBJECT","UnsavedInnerBlocks","blocks","createNavigationMenu","hasSelection","originalBlocksRef","current","innerBlocksAreDirty","isDisabled","Context","innerBlocksProps","className","renderAppender","undefined","defaultBlock","directInsert","isSaving","hasResolvedAllNavigationMenus","select","hasFinishedResolution","isSavingEntityRecord","Wrapper"],"sources":["@wordpress/block-library/src/navigation/edit/unsaved-inner-blocks.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useInnerBlocksProps } from '@wordpress/block-editor';\r\nimport { Disabled } from '@wordpress/components';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useContext, useEffect, useRef } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { areBlocksDirty } from './are-blocks-dirty';\r\nimport { DEFAULT_BLOCK, SELECT_NAVIGATION_MENUS_ARGS } from '../constants';\r\n\r\nconst EMPTY_OBJECT = {};\r\n\r\nexport default function UnsavedInnerBlocks( {\r\n\tblocks,\r\n\tcreateNavigationMenu,\r\n\thasSelection,\r\n} ) {\r\n\tconst originalBlocksRef = useRef();\r\n\r\n\tuseEffect( () => {\r\n\t\t// Initially store the uncontrolled inner blocks for\r\n\t\t// dirty state comparison.\r\n\t\tif ( ! originalBlocksRef?.current ) {\r\n\t\t\toriginalBlocksRef.current = blocks;\r\n\t\t}\r\n\t}, [ blocks ] );\r\n\r\n\t// If the current inner blocks are different from the original inner blocks\r\n\t// from the post content then the user has made changes to the inner blocks.\r\n\t// At this point the inner blocks can be considered \"dirty\".\r\n\t// Note: referential equality is not sufficient for comparison as the inner blocks\r\n\t// of the page list are controlled and may be updated async due to syncing with\r\n\t// entity records. As a result we need to perform a deep equality check skipping\r\n\t// the page list's inner blocks.\r\n\tconst innerBlocksAreDirty = areBlocksDirty(\r\n\t\toriginalBlocksRef?.current,\r\n\t\tblocks\r\n\t);\r\n\r\n\t// The block will be disabled in a block preview, use this as a way of\r\n\t// avoiding the side-effects of this component for block previews.\r\n\tconst isDisabled = useContext( Disabled.Context );\r\n\r\n\tconst innerBlocksProps = useInnerBlocksProps(\r\n\t\t{\r\n\t\t\tclassName: 'wp-block-navigation__container',\r\n\t\t},\r\n\t\t{\r\n\t\t\trenderAppender: hasSelection ? undefined : false,\r\n\t\t\tdefaultBlock: DEFAULT_BLOCK,\r\n\t\t\tdirectInsert: true,\r\n\t\t}\r\n\t);\r\n\r\n\tconst { isSaving, hasResolvedAllNavigationMenus } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tif ( isDisabled ) {\r\n\t\t\t\treturn EMPTY_OBJECT;\r\n\t\t\t}\r\n\r\n\t\t\tconst { hasFinishedResolution, isSavingEntityRecord } =\r\n\t\t\t\tselect( coreStore );\r\n\r\n\t\t\treturn {\r\n\t\t\t\tisSaving: isSavingEntityRecord( 'postType', 'wp_navigation' ),\r\n\t\t\t\thasResolvedAllNavigationMenus: hasFinishedResolution(\r\n\t\t\t\t\t'getEntityRecords',\r\n\t\t\t\t\tSELECT_NAVIGATION_MENUS_ARGS\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ isDisabled ]\r\n\t);\r\n\r\n\t// Automatically save the uncontrolled blocks.\r\n\tuseEffect( () => {\r\n\t\t// The block will be disabled when used in a BlockPreview.\r\n\t\t// In this case avoid automatic creation of a wp_navigation post.\r\n\t\t// Otherwise the user will be spammed with lots of menus!\r\n\t\t//\r\n\t\t// Also ensure other navigation menus have loaded so an\r\n\t\t// accurate name can be created.\r\n\t\t//\r\n\t\t// Don't try saving when another save is already\r\n\t\t// in progress.\r\n\t\t//\r\n\t\t// And finally only create the menu when the block is selected,\r\n\t\t// which is an indication they want to start editing.\r\n\t\tif (\r\n\t\t\tisDisabled ||\r\n\t\t\tisSaving ||\r\n\t\t\t! hasResolvedAllNavigationMenus ||\r\n\t\t\t! hasSelection ||\r\n\t\t\t! innerBlocksAreDirty\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcreateNavigationMenu( null, blocks );\r\n\t}, [\r\n\t\tblocks,\r\n\t\tcreateNavigationMenu,\r\n\t\tisDisabled,\r\n\t\tisSaving,\r\n\t\thasResolvedAllNavigationMenus,\r\n\t\tinnerBlocksAreDirty,\r\n\t\thasSelection,\r\n\t] );\r\n\r\n\tconst Wrapper = isSaving ? Disabled : 'div';\r\n\r\n\treturn <Wrapper { ...innerBlocksProps } />;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,mBAAmB,QAAQ,yBAAyB;AAC7D,SAASC,QAAQ,QAAQ,uBAAuB;AAChD,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;AACzD,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,UAAU,EAAEC,SAAS,EAAEC,MAAM,QAAQ,oBAAoB;;AAElE;AACA;AACA;AACA,SAASC,cAAc,QAAQ,oBAAoB;AACnD,SAASC,aAAa,EAAEC,4BAA4B,QAAQ,cAAc;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAE3E,MAAMC,YAAY,GAAG,CAAC,CAAC;AAEvB,eAAe,SAASC,kBAAkBA,CAAE;EAC3CC,MAAM;EACNC,oBAAoB;EACpBC;AACD,CAAC,EAAG;EACH,MAAMC,iBAAiB,GAAGX,MAAM,CAAC,CAAC;EAElCD,SAAS,CAAE,MAAM;IAChB;IACA;IACA,IAAK,CAAEY,iBAAiB,EAAEC,OAAO,EAAG;MACnCD,iBAAiB,CAACC,OAAO,GAAGJ,MAAM;IACnC;EACD,CAAC,EAAE,CAAEA,MAAM,CAAG,CAAC;;EAEf;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAMK,mBAAmB,GAAGZ,cAAc,CACzCU,iBAAiB,EAAEC,OAAO,EAC1BJ,MACD,CAAC;;EAED;EACA;EACA,MAAMM,UAAU,GAAGhB,UAAU,CAAEJ,QAAQ,CAACqB,OAAQ,CAAC;EAEjD,MAAMC,gBAAgB,GAAGvB,mBAAmB,CAC3C;IACCwB,SAAS,EAAE;EACZ,CAAC,EACD;IACCC,cAAc,EAAER,YAAY,GAAGS,SAAS,GAAG,KAAK;IAChDC,YAAY,EAAElB,aAAa;IAC3BmB,YAAY,EAAE;EACf,CACD,CAAC;EAED,MAAM;IAAEC,QAAQ;IAAEC;EAA8B,CAAC,GAAG1B,SAAS,CAC1D2B,MAAM,IAAM;IACb,IAAKV,UAAU,EAAG;MACjB,OAAOR,YAAY;IACpB;IAEA,MAAM;MAAEmB,qBAAqB;MAAEC;IAAqB,CAAC,GACpDF,MAAM,CAAE5B,SAAU,CAAC;IAEpB,OAAO;MACN0B,QAAQ,EAAEI,oBAAoB,CAAE,UAAU,EAAE,eAAgB,CAAC;MAC7DH,6BAA6B,EAAEE,qBAAqB,CACnD,kBAAkB,EAClBtB,4BACD;IACD,CAAC;EACF,CAAC,EACD,CAAEW,UAAU,CACb,CAAC;;EAED;EACAf,SAAS,CAAE,MAAM;IAChB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,IACCe,UAAU,IACVQ,QAAQ,IACR,CAAEC,6BAA6B,IAC/B,CAAEb,YAAY,IACd,CAAEG,mBAAmB,EACpB;MACD;IACD;IAEAJ,oBAAoB,CAAE,IAAI,EAAED,MAAO,CAAC;EACrC,CAAC,EAAE,CACFA,MAAM,EACNC,oBAAoB,EACpBK,UAAU,EACVQ,QAAQ,EACRC,6BAA6B,EAC7BV,mBAAmB,EACnBH,YAAY,CACX,CAAC;EAEH,MAAMiB,OAAO,GAAGL,QAAQ,GAAG5B,QAAQ,GAAG,KAAK;EAE3C,oBAAOW,IAAA,CAACsB,OAAO;IAAA,GAAMX;EAAgB,CAAI,CAAC;AAC3C","ignoreList":[]}