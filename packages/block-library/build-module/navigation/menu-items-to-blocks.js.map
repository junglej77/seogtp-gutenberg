{"version":3,"names":["createBlock","parse","applyFilters","menuItemsToBlocks","menuItems","menuTree","createDataTree","blocks","mapMenuItemsToBlocks","level","mapping","sortedItems","sort","a","b","menu_order","innerBlocks","map","menuItem","type","block","content","raw","blockType","children","length","attributes","menuItemToBlockAttributes","nestedBlocks","nestedMapping","id","clientId","title","menuItemTitleField","xfn","classes","attr_title","object","object_id","description","url","menuItemTypeField","target","label","rendered","kind","replace","join","trim","rel","className","opensInNewTab","isTopLevelItem","isTopLevelLink","dataset","relation","hashTable","Object","create","dataTree","data","push"],"sources":["@wordpress/block-library/src/navigation/menu-items-to-blocks.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createBlock, parse } from '@wordpress/blocks';\r\nimport { applyFilters } from '@wordpress/hooks';\r\n\r\n/**\r\n * Convert a flat menu item structure to a nested blocks structure.\r\n *\r\n * @param {Object[]} menuItems An array of menu items.\r\n *\r\n * @return {WPBlock[]} An array of blocks.\r\n */\r\nexport default function menuItemsToBlocks( menuItems ) {\r\n\tif ( ! menuItems ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst menuTree = createDataTree( menuItems );\r\n\tconst blocks = mapMenuItemsToBlocks( menuTree );\r\n\treturn applyFilters(\r\n\t\t'blocks.navigation.__unstableMenuItemsToBlocks',\r\n\t\tblocks,\r\n\t\tmenuItems\r\n\t);\r\n}\r\n\r\n/**\r\n * A recursive function that maps menu item nodes to blocks.\r\n *\r\n * @param {WPNavMenuItem[]} menuItems An array of WPNavMenuItem items.\r\n * @param {number}          level     An integer representing the nesting level.\r\n * @return {Object} Object containing innerBlocks and mapping.\r\n */\r\nfunction mapMenuItemsToBlocks( menuItems, level = 0 ) {\r\n\tlet mapping = {};\r\n\r\n\t// The menuItem should be in menu_order sort order.\r\n\tconst sortedItems = [ ...menuItems ].sort(\r\n\t\t( a, b ) => a.menu_order - b.menu_order\r\n\t);\r\n\r\n\tconst innerBlocks = sortedItems.map( ( menuItem ) => {\r\n\t\tif ( menuItem.type === 'block' ) {\r\n\t\t\tconst [ block ] = parse( menuItem.content.raw );\r\n\r\n\t\t\tif ( ! block ) {\r\n\t\t\t\treturn createBlock( 'core/freeform', {\r\n\t\t\t\t\tcontent: menuItem.content,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\treturn block;\r\n\t\t}\r\n\r\n\t\tconst blockType = menuItem.children?.length\r\n\t\t\t? 'core/navigation-submenu'\r\n\t\t\t: 'core/navigation-link';\r\n\r\n\t\tconst attributes = menuItemToBlockAttributes(\r\n\t\t\tmenuItem,\r\n\t\t\tblockType,\r\n\t\t\tlevel\r\n\t\t);\r\n\r\n\t\t// If there are children recurse to build those nested blocks.\r\n\t\tconst {\r\n\t\t\tinnerBlocks: nestedBlocks = [], // alias to avoid shadowing\r\n\t\t\tmapping: nestedMapping = {}, // alias to avoid shadowing\r\n\t\t} = menuItem.children?.length\r\n\t\t\t? mapMenuItemsToBlocks( menuItem.children, level + 1 )\r\n\t\t\t: {};\r\n\r\n\t\t// Update parent mapping with nested mapping.\r\n\t\tmapping = {\r\n\t\t\t...mapping,\r\n\t\t\t...nestedMapping,\r\n\t\t};\r\n\r\n\t\t// Create block with nested \"innerBlocks\".\r\n\t\tconst block = createBlock( blockType, attributes, nestedBlocks );\r\n\r\n\t\t// Create mapping for menuItem -> block.\r\n\t\tmapping[ menuItem.id ] = block.clientId;\r\n\r\n\t\treturn block;\r\n\t} );\r\n\r\n\treturn {\r\n\t\tinnerBlocks,\r\n\t\tmapping,\r\n\t};\r\n}\r\n\r\n/**\r\n * A WP nav_menu_item object.\r\n * For more documentation on the individual fields present on a menu item please see:\r\n * https://core.trac.wordpress.org/browser/tags/5.7.1/src/wp-includes/nav-menu.php#L789\r\n *\r\n * @typedef WPNavMenuItem\r\n *\r\n * @property {Object} title       stores the raw and rendered versions of the title/label for this menu item.\r\n * @property {Array}  xfn         the XFN relationships expressed in the link of this menu item.\r\n * @property {Array}  classes     the HTML class attributes for this menu item.\r\n * @property {string} attr_title  the HTML title attribute for this menu item.\r\n * @property {string} object      The type of object originally represented, such as 'category', 'post', or 'attachment'.\r\n * @property {string} object_id   The DB ID of the original object this menu item represents, e.g. ID for posts and term_id for categories.\r\n * @property {string} description The description of this menu item.\r\n * @property {string} url         The URL to which this menu item points.\r\n * @property {string} type        The family of objects originally represented, such as 'post_type' or 'taxonomy'.\r\n * @property {string} target      The target attribute of the link element for this menu item.\r\n */\r\n\r\n/**\r\n * Convert block attributes to menu item.\r\n *\r\n * @param {WPNavMenuItem} menuItem  the menu item to be converted to block attributes.\r\n * @param {string}        blockType The block type.\r\n * @param {number}        level     An integer representing the nesting level.\r\n * @return {Object} the block attributes converted from the WPNavMenuItem item.\r\n */\r\nfunction menuItemToBlockAttributes(\r\n\t{\r\n\t\ttitle: menuItemTitleField,\r\n\t\txfn,\r\n\t\tclasses,\r\n\t\t// eslint-disable-next-line camelcase\r\n\t\tattr_title,\r\n\t\tobject,\r\n\t\t// eslint-disable-next-line camelcase\r\n\t\tobject_id,\r\n\t\tdescription,\r\n\t\turl,\r\n\t\ttype: menuItemTypeField,\r\n\t\ttarget,\r\n\t},\r\n\tblockType,\r\n\tlevel\r\n) {\r\n\t// For historical reasons, the `core/navigation-link` variation type is `tag`\r\n\t// whereas WP Core expects `post_tag` as the `object` type.\r\n\t// To avoid writing a block migration we perform a conversion here.\r\n\t// See also inverse equivalent in `blockAttributesToMenuItem`.\r\n\tif ( object && object === 'post_tag' ) {\r\n\t\tobject = 'tag';\r\n\t}\r\n\r\n\treturn {\r\n\t\tlabel: menuItemTitleField?.rendered || '',\r\n\t\t...( object?.length && {\r\n\t\t\ttype: object,\r\n\t\t} ),\r\n\t\tkind: menuItemTypeField?.replace( '_', '-' ) || 'custom',\r\n\t\turl: url || '',\r\n\t\t...( xfn?.length &&\r\n\t\t\txfn.join( ' ' ).trim() && {\r\n\t\t\t\trel: xfn.join( ' ' ).trim(),\r\n\t\t\t} ),\r\n\t\t...( classes?.length &&\r\n\t\t\tclasses.join( ' ' ).trim() && {\r\n\t\t\t\tclassName: classes.join( ' ' ).trim(),\r\n\t\t\t} ),\r\n\t\t/* eslint-disable camelcase */\r\n\t\t...( attr_title?.length && {\r\n\t\t\ttitle: attr_title,\r\n\t\t} ),\r\n\t\t...( object_id &&\r\n\t\t\t'custom' !== object && {\r\n\t\t\t\tid: object_id,\r\n\t\t\t} ),\r\n\t\t/* eslint-enable camelcase */\r\n\t\t...( description?.length && {\r\n\t\t\tdescription,\r\n\t\t} ),\r\n\t\t...( target === '_blank' && {\r\n\t\t\topensInNewTab: true,\r\n\t\t} ),\r\n\t\t...( blockType === 'core/navigation-submenu' && {\r\n\t\t\tisTopLevelItem: level === 0,\r\n\t\t} ),\r\n\t\t...( blockType === 'core/navigation-link' && {\r\n\t\t\tisTopLevelLink: level === 0,\r\n\t\t} ),\r\n\t};\r\n}\r\n\r\n/**\r\n * Creates a nested, hierarchical tree representation from unstructured data that\r\n * has an inherent relationship defined between individual items.\r\n *\r\n * For example, by default, each element in the dataset should have an `id` and\r\n * `parent` property where the `parent` property indicates a relationship between\r\n * the current item and another item with a matching `id` properties.\r\n *\r\n * This is useful for building linked lists of data from flat data structures.\r\n *\r\n * @param {Array}  dataset  linked data to be rearranged into a hierarchical tree based on relational fields.\r\n * @param {string} id       the property which uniquely identifies each entry within the array.\r\n * @param {*}      relation the property which identifies how the current item is related to other items in the data (if at all).\r\n * @return {Array} a nested array of parent/child relationships\r\n */\r\nfunction createDataTree( dataset, id = 'id', relation = 'parent' ) {\r\n\tconst hashTable = Object.create( null );\r\n\tconst dataTree = [];\r\n\r\n\tfor ( const data of dataset ) {\r\n\t\thashTable[ data[ id ] ] = {\r\n\t\t\t...data,\r\n\t\t\tchildren: [],\r\n\t\t};\r\n\t\tif ( data[ relation ] ) {\r\n\t\t\thashTable[ data[ relation ] ] = hashTable[ data[ relation ] ] || {};\r\n\t\t\thashTable[ data[ relation ] ].children =\r\n\t\t\t\thashTable[ data[ relation ] ].children || [];\r\n\t\t\thashTable[ data[ relation ] ].children.push(\r\n\t\t\t\thashTable[ data[ id ] ]\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tdataTree.push( hashTable[ data[ id ] ] );\r\n\t\t}\r\n\t}\r\n\r\n\treturn dataTree;\r\n}\r\n"],"mappings":"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","ignoreList":[]}