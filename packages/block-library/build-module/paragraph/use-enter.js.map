{"version":3,"names":["useRef","useRefEffect","ENTER","useSelect","useDispatch","useRegistry","store","blockEditorStore","hasBlockSupport","createBlock","getDefaultBlockName","useOnEnter","props","batch","moveBlocksToPosition","replaceInnerBlocks","duplicateBlocks","insertBlock","getBlockRootClientId","getBlockIndex","getBlockOrder","getBlockName","getBlock","getNextBlockClientId","canInsertBlockType","propsRef","current","element","onKeyDown","event","defaultPrevented","keyCode","content","clientId","length","wrapperClientId","order","position","indexOf","newWrapperClientId","preventDefault","defaultBlockName","wrapperBlock","blockIndex","innerBlocks","slice","addEventListener","removeEventListener"],"sources":["D:/jungle/gutenberg/packages/block-library/src/paragraph/use-enter.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useRef } from '@wordpress/element';\r\nimport { useRefEffect } from '@wordpress/compose';\r\nimport { ENTER } from '@wordpress/keycodes';\r\nimport { useSelect, useDispatch, useRegistry } from '@wordpress/data';\r\nimport { store as blockEditorStore } from '@wordpress/block-editor';\r\nimport {\r\n\thasBlockSupport,\r\n\tcreateBlock,\r\n\tgetDefaultBlockName,\r\n} from '@wordpress/blocks';\r\n\r\nexport function useOnEnter( props ) {\r\n\tconst { batch } = useRegistry();\r\n\tconst {\r\n\t\tmoveBlocksToPosition,\r\n\t\treplaceInnerBlocks,\r\n\t\tduplicateBlocks,\r\n\t\tinsertBlock,\r\n\t} = useDispatch( blockEditorStore );\r\n\tconst {\r\n\t\tgetBlockRootClientId,\r\n\t\tgetBlockIndex,\r\n\t\tgetBlockOrder,\r\n\t\tgetBlockName,\r\n\t\tgetBlock,\r\n\t\tgetNextBlockClientId,\r\n\t\tcanInsertBlockType,\r\n\t} = useSelect( blockEditorStore );\r\n\tconst propsRef = useRef( props );\r\n\tpropsRef.current = props;\r\n\treturn useRefEffect( ( element ) => {\r\n\t\tfunction onKeyDown( event ) {\r\n\t\t\tif ( event.defaultPrevented ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( event.keyCode !== ENTER ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst { content, clientId } = propsRef.current;\r\n\r\n\t\t\t// The paragraph should be empty.\r\n\t\t\tif ( content.length ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst wrapperClientId = getBlockRootClientId( clientId );\r\n\r\n\t\t\tif (\r\n\t\t\t\t! hasBlockSupport(\r\n\t\t\t\t\tgetBlockName( wrapperClientId ),\r\n\t\t\t\t\t'__experimentalOnEnter',\r\n\t\t\t\t\tfalse\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst order = getBlockOrder( wrapperClientId );\r\n\t\t\tconst position = order.indexOf( clientId );\r\n\r\n\t\t\t// If it is the last block, exit.\r\n\t\t\tif ( position === order.length - 1 ) {\r\n\t\t\t\tlet newWrapperClientId = wrapperClientId;\r\n\r\n\t\t\t\twhile (\r\n\t\t\t\t\t! canInsertBlockType(\r\n\t\t\t\t\t\tgetBlockName( clientId ),\r\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId )\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\tnewWrapperClientId =\r\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( typeof newWrapperClientId === 'string' ) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tmoveBlocksToPosition(\r\n\t\t\t\t\t\t[ clientId ],\r\n\t\t\t\t\t\twrapperClientId,\r\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId ),\r\n\t\t\t\t\t\tgetBlockIndex( newWrapperClientId ) + 1\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst defaultBlockName = getDefaultBlockName();\r\n\r\n\t\t\tif (\r\n\t\t\t\t! canInsertBlockType(\r\n\t\t\t\t\tdefaultBlockName,\r\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId )\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\t// If it is in the middle, split the block in two.\r\n\t\t\tconst wrapperBlock = getBlock( wrapperClientId );\r\n\t\t\tbatch( () => {\r\n\t\t\t\tduplicateBlocks( [ wrapperClientId ] );\r\n\t\t\t\tconst blockIndex = getBlockIndex( wrapperClientId );\r\n\r\n\t\t\t\treplaceInnerBlocks(\r\n\t\t\t\t\twrapperClientId,\r\n\t\t\t\t\twrapperBlock.innerBlocks.slice( 0, position )\r\n\t\t\t\t);\r\n\t\t\t\treplaceInnerBlocks(\r\n\t\t\t\t\tgetNextBlockClientId( wrapperClientId ),\r\n\t\t\t\t\twrapperBlock.innerBlocks.slice( position + 1 )\r\n\t\t\t\t);\r\n\t\t\t\tinsertBlock(\r\n\t\t\t\t\tcreateBlock( defaultBlockName ),\r\n\t\t\t\t\tblockIndex + 1,\r\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId ),\r\n\t\t\t\t\ttrue\r\n\t\t\t\t);\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\telement.addEventListener( 'keydown', onKeyDown );\r\n\t\treturn () => {\r\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\r\n\t\t};\r\n\t}, [] );\r\n}\r\n"],"mappings":"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","ignoreList":[]}