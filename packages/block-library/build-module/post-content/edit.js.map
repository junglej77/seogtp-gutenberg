{"version":3,"names":["__","useBlockProps","useInnerBlocksProps","RecursionProvider","useHasRecursion","Warning","useEntityProp","useEntityBlockEditor","store","coreStore","useSelect","useCanEditEntity","jsx","_jsx","jsxs","_jsxs","ReadOnlyContent","layoutClassNames","userCanEdit","postType","postId","content","blockProps","className","protected","children","dangerouslySetInnerHTML","__html","rendered","EditableContent","context","blocks","onInput","onChange","id","entityRecord","select","getEntityRecord","hasInnerBlocks","raw","length","initialInnerBlocks","props","value","template","undefined","Content","queryId","isDescendentOfQueryLoop","Number","isFinite","isEditable","Placeholder","RecursionError","PostContentEdit","__unstableLayoutClassNames","contextPostId","contextPostType","hasAlreadyRendered","uniqueId"],"sources":["@wordpress/block-library/src/post-content/edit.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport {\r\n\tuseBlockProps,\r\n\tuseInnerBlocksProps,\r\n\tRecursionProvider,\r\n\tuseHasRecursion,\r\n\tWarning,\r\n} from '@wordpress/block-editor';\r\nimport {\r\n\tuseEntityProp,\r\n\tuseEntityBlockEditor,\r\n\tstore as coreStore,\r\n} from '@wordpress/core-data';\r\nimport { useSelect } from '@wordpress/data';\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { useCanEditEntity } from '../utils/hooks';\r\n\r\nfunction ReadOnlyContent( {\r\n\tlayoutClassNames,\r\n\tuserCanEdit,\r\n\tpostType,\r\n\tpostId,\r\n} ) {\r\n\tconst [ , , content ] = useEntityProp(\r\n\t\t'postType',\r\n\t\tpostType,\r\n\t\t'content',\r\n\t\tpostId\r\n\t);\r\n\tconst blockProps = useBlockProps( { className: layoutClassNames } );\r\n\treturn content?.protected && ! userCanEdit ? (\r\n\t\t<div { ...blockProps }>\r\n\t\t\t<Warning>{ __( 'This content is password protected.' ) }</Warning>\r\n\t\t</div>\r\n\t) : (\r\n\t\t<div\r\n\t\t\t{ ...blockProps }\r\n\t\t\tdangerouslySetInnerHTML={ { __html: content?.rendered } }\r\n\t\t></div>\r\n\t);\r\n}\r\n\r\nfunction EditableContent( { context = {} } ) {\r\n\tconst { postType, postId } = context;\r\n\r\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\r\n\t\t'postType',\r\n\t\tpostType,\r\n\t\t{ id: postId }\r\n\t);\r\n\r\n\tconst entityRecord = useSelect(\r\n\t\t( select ) => {\r\n\t\t\treturn select( coreStore ).getEntityRecord(\r\n\t\t\t\t'postType',\r\n\t\t\t\tpostType,\r\n\t\t\t\tpostId\r\n\t\t\t);\r\n\t\t},\r\n\t\t[ postType, postId ]\r\n\t);\r\n\r\n\tconst hasInnerBlocks = !! entityRecord?.content?.raw || blocks?.length;\r\n\r\n\tconst initialInnerBlocks = [ [ 'core/paragraph' ] ];\r\n\r\n\tconst props = useInnerBlocksProps(\r\n\t\tuseBlockProps( { className: 'entry-content' } ),\r\n\t\t{\r\n\t\t\tvalue: blocks,\r\n\t\t\tonInput,\r\n\t\t\tonChange,\r\n\t\t\ttemplate: ! hasInnerBlocks ? initialInnerBlocks : undefined,\r\n\t\t}\r\n\t);\r\n\treturn <div { ...props } />;\r\n}\r\n\r\nfunction Content( props ) {\r\n\tconst { context: { queryId, postType, postId } = {}, layoutClassNames } =\r\n\t\tprops;\r\n\tconst userCanEdit = useCanEditEntity( 'postType', postType, postId );\r\n\tif ( userCanEdit === undefined ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst isDescendentOfQueryLoop = Number.isFinite( queryId );\r\n\tconst isEditable = userCanEdit && ! isDescendentOfQueryLoop;\r\n\r\n\treturn isEditable ? (\r\n\t\t<EditableContent { ...props } />\r\n\t) : (\r\n\t\t<ReadOnlyContent\r\n\t\t\tlayoutClassNames={ layoutClassNames }\r\n\t\t\tuserCanEdit={ userCanEdit }\r\n\t\t\tpostType={ postType }\r\n\t\t\tpostId={ postId }\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nfunction Placeholder( { layoutClassNames } ) {\r\n\tconst blockProps = useBlockProps( { className: layoutClassNames } );\r\n\treturn (\r\n\t\t<div { ...blockProps }>\r\n\t\t\t<p>\r\n\t\t\t\t{ __(\r\n\t\t\t\t\t'This is the Content block, it will display all the blocks in any single post or page.'\r\n\t\t\t\t) }\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t{ __(\r\n\t\t\t\t\t'That might be a simple arrangement like consecutive paragraphs in a blog post, or a more elaborate composition that includes image galleries, videos, tables, columns, and any other block types.'\r\n\t\t\t\t) }\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t{ __(\r\n\t\t\t\t\t'If there are any Custom Post Types registered at your site, the Content block can display the contents of those entries as well.'\r\n\t\t\t\t) }\r\n\t\t\t</p>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction RecursionError() {\r\n\tconst blockProps = useBlockProps();\r\n\treturn (\r\n\t\t<div { ...blockProps }>\r\n\t\t\t<Warning>\r\n\t\t\t\t{ __( 'Block cannot be rendered inside itself.' ) }\r\n\t\t\t</Warning>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default function PostContentEdit( {\r\n\tcontext,\r\n\t__unstableLayoutClassNames: layoutClassNames,\r\n} ) {\r\n\tconst { postId: contextPostId, postType: contextPostType } = context;\r\n\tconst hasAlreadyRendered = useHasRecursion( contextPostId );\r\n\r\n\tif ( contextPostId && contextPostType && hasAlreadyRendered ) {\r\n\t\treturn <RecursionError />;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<RecursionProvider uniqueId={ contextPostId }>\r\n\t\t\t{ contextPostId && contextPostType ? (\r\n\t\t\t\t<Content\r\n\t\t\t\t\tcontext={ context }\r\n\t\t\t\t\tlayoutClassNames={ layoutClassNames }\r\n\t\t\t\t/>\r\n\t\t\t) : (\r\n\t\t\t\t<Placeholder layoutClassNames={ layoutClassNames } />\r\n\t\t\t) }\r\n\t\t</RecursionProvider>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}