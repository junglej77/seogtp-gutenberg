{"version":3,"names":["__","FormTokenField","useSelect","store","coreStore","getEntitiesInfo","jsx","_jsx","AUTHORS_QUERY","who","per_page","_fields","context","AuthorControl","value","onChange","authorsList","select","getUsers","authorsInfo","normalizedValue","toString","split","sanitizedValue","reduce","accumulator","authorId","author","mapById","push","id","name","getIdByValue","entitiesMappedByName","authorValue","onAuthorChange","newValue","ids","Array","from","mapByName","add","Set","join","label","suggestions","names","__experimentalShowHowTo","__nextHasNoMarginBottom","__next40pxDefaultSize"],"sources":["@wordpress/block-library/src/query/edit/inspector-controls/author-control.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { FormTokenField } from '@wordpress/components';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { getEntitiesInfo } from '../../utils';\r\n\r\nconst AUTHORS_QUERY = {\r\n\twho: 'authors',\r\n\tper_page: -1,\r\n\t_fields: 'id,name',\r\n\tcontext: 'view',\r\n};\r\n\r\nfunction AuthorControl( { value, onChange } ) {\r\n\tconst authorsList = useSelect( ( select ) => {\r\n\t\tconst { getUsers } = select( coreStore );\r\n\t\treturn getUsers( AUTHORS_QUERY );\r\n\t}, [] );\r\n\r\n\tif ( ! authorsList ) {\r\n\t\treturn null;\r\n\t}\r\n\tconst authorsInfo = getEntitiesInfo( authorsList );\r\n\t/**\r\n\t * We need to normalize the value because the block operates on a\r\n\t * comma(`,`) separated string value and `FormTokenFiels` needs an\r\n\t * array.\r\n\t */\r\n\tconst normalizedValue = ! value ? [] : value.toString().split( ',' );\r\n\t// Returns only the existing authors ids. This prevents the component\r\n\t// from crashing in the editor, when non existing ids are provided.\r\n\tconst sanitizedValue = normalizedValue.reduce(\r\n\t\t( accumulator, authorId ) => {\r\n\t\t\tconst author = authorsInfo.mapById[ authorId ];\r\n\t\t\tif ( author ) {\r\n\t\t\t\taccumulator.push( {\r\n\t\t\t\t\tid: authorId,\r\n\t\t\t\t\tvalue: author.name,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t\treturn accumulator;\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\tconst getIdByValue = ( entitiesMappedByName, authorValue ) => {\r\n\t\tconst id = authorValue?.id || entitiesMappedByName[ authorValue ]?.id;\r\n\t\tif ( id ) {\r\n\t\t\treturn id;\r\n\t\t}\r\n\t};\r\n\tconst onAuthorChange = ( newValue ) => {\r\n\t\tconst ids = Array.from(\r\n\t\t\tnewValue.reduce( ( accumulator, author ) => {\r\n\t\t\t\t// Verify that new values point to existing entities.\r\n\t\t\t\tconst id = getIdByValue( authorsInfo.mapByName, author );\r\n\t\t\t\tif ( id ) {\r\n\t\t\t\t\taccumulator.add( id );\r\n\t\t\t\t}\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}, new Set() )\r\n\t\t);\r\n\t\tonChange( { author: ids.join( ',' ) } );\r\n\t};\r\n\treturn (\r\n\t\t<FormTokenField\r\n\t\t\tlabel={ __( 'Authors' ) }\r\n\t\t\tvalue={ sanitizedValue }\r\n\t\t\tsuggestions={ authorsInfo.names }\r\n\t\t\tonChange={ onAuthorChange }\r\n\t\t\t__experimentalShowHowTo={ false }\r\n\t\t\t__nextHasNoMarginBottom\r\n\t\t\t__next40pxDefaultSize\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nexport default AuthorControl;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAE,QAAQ,iBAAiB;AACpC,SAASC,cAAc,QAAQ,uBAAuB;AACtD,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;;AAEzD;AACA;AACA;AACA,SAASC,eAAe,QAAQ,aAAa;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAE9C,MAAMC,aAAa,GAAG;EACrBC,GAAG,EAAE,SAAS;EACdC,QAAQ,EAAE,CAAC,CAAC;EACZC,OAAO,EAAE,SAAS;EAClBC,OAAO,EAAE;AACV,CAAC;AAED,SAASC,aAAaA,CAAE;EAAEC,KAAK;EAAEC;AAAS,CAAC,EAAG;EAC7C,MAAMC,WAAW,GAAGd,SAAS,CAAIe,MAAM,IAAM;IAC5C,MAAM;MAAEC;IAAS,CAAC,GAAGD,MAAM,CAAEb,SAAU,CAAC;IACxC,OAAOc,QAAQ,CAAEV,aAAc,CAAC;EACjC,CAAC,EAAE,EAAG,CAAC;EAEP,IAAK,CAAEQ,WAAW,EAAG;IACpB,OAAO,IAAI;EACZ;EACA,MAAMG,WAAW,GAAGd,eAAe,CAAEW,WAAY,CAAC;EAClD;AACD;AACA;AACA;AACA;EACC,MAAMI,eAAe,GAAG,CAAEN,KAAK,GAAG,EAAE,GAAGA,KAAK,CAACO,QAAQ,CAAC,CAAC,CAACC,KAAK,CAAE,GAAI,CAAC;EACpE;EACA;EACA,MAAMC,cAAc,GAAGH,eAAe,CAACI,MAAM,CAC5C,CAAEC,WAAW,EAAEC,QAAQ,KAAM;IAC5B,MAAMC,MAAM,GAAGR,WAAW,CAACS,OAAO,CAAEF,QAAQ,CAAE;IAC9C,IAAKC,MAAM,EAAG;MACbF,WAAW,CAACI,IAAI,CAAE;QACjBC,EAAE,EAAEJ,QAAQ;QACZZ,KAAK,EAAEa,MAAM,CAACI;MACf,CAAE,CAAC;IACJ;IACA,OAAON,WAAW;EACnB,CAAC,EACD,EACD,CAAC;EAED,MAAMO,YAAY,GAAGA,CAAEC,oBAAoB,EAAEC,WAAW,KAAM;IAC7D,MAAMJ,EAAE,GAAGI,WAAW,EAAEJ,EAAE,IAAIG,oBAAoB,CAAEC,WAAW,CAAE,EAAEJ,EAAE;IACrE,IAAKA,EAAE,EAAG;MACT,OAAOA,EAAE;IACV;EACD,CAAC;EACD,MAAMK,cAAc,GAAKC,QAAQ,IAAM;IACtC,MAAMC,GAAG,GAAGC,KAAK,CAACC,IAAI,CACrBH,QAAQ,CAACZ,MAAM,CAAE,CAAEC,WAAW,EAAEE,MAAM,KAAM;MAC3C;MACA,MAAMG,EAAE,GAAGE,YAAY,CAAEb,WAAW,CAACqB,SAAS,EAAEb,MAAO,CAAC;MACxD,IAAKG,EAAE,EAAG;QACTL,WAAW,CAACgB,GAAG,CAAEX,EAAG,CAAC;MACtB;MACA,OAAOL,WAAW;IACnB,CAAC,EAAE,IAAIiB,GAAG,CAAC,CAAE,CACd,CAAC;IACD3B,QAAQ,CAAE;MAAEY,MAAM,EAAEU,GAAG,CAACM,IAAI,CAAE,GAAI;IAAE,CAAE,CAAC;EACxC,CAAC;EACD,oBACCpC,IAAA,CAACN,cAAc;IACd2C,KAAK,EAAG5C,EAAE,CAAE,SAAU,CAAG;IACzBc,KAAK,EAAGS,cAAgB;IACxBsB,WAAW,EAAG1B,WAAW,CAAC2B,KAAO;IACjC/B,QAAQ,EAAGoB,cAAgB;IAC3BY,uBAAuB,EAAG,KAAO;IACjCC,uBAAuB;IACvBC,qBAAqB;EAAA,CACrB,CAAC;AAEJ;AAEA,eAAepC,aAAa","ignoreList":[]}