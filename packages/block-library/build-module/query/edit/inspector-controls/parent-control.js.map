{"version":3,"names":["__","FormTokenField","useSelect","store","coreStore","useState","useEffect","useMemo","useDebounce","getEntitiesInfo","mapToIHasNameAndId","jsx","_jsx","EMPTY_ARRAY","BASE_QUERY","order","_fields","context","ParentControl","parents","postType","onChange","search","setSearch","value","setValue","suggestions","setSuggestions","debouncedSearch","searchResults","searchHasResolved","select","getEntityRecords","hasFinishedResolution","selectorArgs","orderby","exclude","per_page","currentParents","length","include","currentParentsInfo","sanitizedValue","reduce","accumulator","id","entity","mapById","push","name","entitiesInfo","names","getIdByValue","entitiesMappedByName","onParentChange","newValue","ids","Array","from","mapByName","add","Set","__next40pxDefaultSize","label","onInputChange","__experimentalShowHowTo","__nextHasNoMarginBottom"],"sources":["@wordpress/block-library/src/query/edit/inspector-controls/parent-control.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { FormTokenField } from '@wordpress/components';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { useState, useEffect, useMemo } from '@wordpress/element';\r\nimport { useDebounce } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { getEntitiesInfo, mapToIHasNameAndId } from '../../utils';\r\n\r\nconst EMPTY_ARRAY = [];\r\nconst BASE_QUERY = {\r\n\torder: 'asc',\r\n\t_fields: 'id,title',\r\n\tcontext: 'view',\r\n};\r\n\r\nfunction ParentControl( { parents, postType, onChange } ) {\r\n\tconst [ search, setSearch ] = useState( '' );\r\n\tconst [ value, setValue ] = useState( EMPTY_ARRAY );\r\n\tconst [ suggestions, setSuggestions ] = useState( EMPTY_ARRAY );\r\n\tconst debouncedSearch = useDebounce( setSearch, 250 );\r\n\tconst { searchResults, searchHasResolved } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tif ( ! search ) {\r\n\t\t\t\treturn { searchResults: EMPTY_ARRAY, searchHasResolved: true };\r\n\t\t\t}\r\n\t\t\tconst { getEntityRecords, hasFinishedResolution } =\r\n\t\t\t\tselect( coreStore );\r\n\t\t\tconst selectorArgs = [\r\n\t\t\t\t'postType',\r\n\t\t\t\tpostType,\r\n\t\t\t\t{\r\n\t\t\t\t\t...BASE_QUERY,\r\n\t\t\t\t\tsearch,\r\n\t\t\t\t\torderby: 'relevance',\r\n\t\t\t\t\texclude: parents,\r\n\t\t\t\t\tper_page: 20,\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t\treturn {\r\n\t\t\t\tsearchResults: getEntityRecords( ...selectorArgs ),\r\n\t\t\t\tsearchHasResolved: hasFinishedResolution(\r\n\t\t\t\t\t'getEntityRecords',\r\n\t\t\t\t\tselectorArgs\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ search, parents ]\r\n\t);\r\n\tconst currentParents = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tif ( ! parents?.length ) {\r\n\t\t\t\treturn EMPTY_ARRAY;\r\n\t\t\t}\r\n\t\t\tconst { getEntityRecords } = select( coreStore );\r\n\t\t\treturn getEntityRecords( 'postType', postType, {\r\n\t\t\t\t...BASE_QUERY,\r\n\t\t\t\tinclude: parents,\r\n\t\t\t\tper_page: parents.length,\r\n\t\t\t} );\r\n\t\t},\r\n\t\t[ parents ]\r\n\t);\r\n\t// Update the `value` state only after the selectors are resolved\r\n\t// to avoid emptying the input when we're changing parents.\r\n\tuseEffect( () => {\r\n\t\tif ( ! parents?.length ) {\r\n\t\t\tsetValue( EMPTY_ARRAY );\r\n\t\t}\r\n\t\tif ( ! currentParents?.length ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst currentParentsInfo = getEntitiesInfo(\r\n\t\t\tmapToIHasNameAndId( currentParents, 'title.rendered' )\r\n\t\t);\r\n\t\t// Returns only the existing entity ids. This prevents the component\r\n\t\t// from crashing in the editor, when non existing ids are provided.\r\n\t\tconst sanitizedValue = parents.reduce( ( accumulator, id ) => {\r\n\t\t\tconst entity = currentParentsInfo.mapById[ id ];\r\n\t\t\tif ( entity ) {\r\n\t\t\t\taccumulator.push( {\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tvalue: entity.name,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t\treturn accumulator;\r\n\t\t}, [] );\r\n\t\tsetValue( sanitizedValue );\r\n\t}, [ parents, currentParents ] );\r\n\r\n\tconst entitiesInfo = useMemo( () => {\r\n\t\tif ( ! searchResults?.length ) {\r\n\t\t\treturn EMPTY_ARRAY;\r\n\t\t}\r\n\t\treturn getEntitiesInfo(\r\n\t\t\tmapToIHasNameAndId( searchResults, 'title.rendered' )\r\n\t\t);\r\n\t}, [ searchResults ] );\r\n\t// Update suggestions only when the query has resolved.\r\n\tuseEffect( () => {\r\n\t\tif ( ! searchHasResolved ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetSuggestions( entitiesInfo.names );\r\n\t}, [ entitiesInfo.names, searchHasResolved ] );\r\n\r\n\tconst getIdByValue = ( entitiesMappedByName, entity ) => {\r\n\t\tconst id = entity?.id || entitiesMappedByName?.[ entity ]?.id;\r\n\t\tif ( id ) {\r\n\t\t\treturn id;\r\n\t\t}\r\n\t};\r\n\tconst onParentChange = ( newValue ) => {\r\n\t\tconst ids = Array.from(\r\n\t\t\tnewValue.reduce( ( accumulator, entity ) => {\r\n\t\t\t\t// Verify that new values point to existing entities.\r\n\t\t\t\tconst id = getIdByValue( entitiesInfo.mapByName, entity );\r\n\t\t\t\tif ( id ) {\r\n\t\t\t\t\taccumulator.add( id );\r\n\t\t\t\t}\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}, new Set() )\r\n\t\t);\r\n\t\tsetSuggestions( EMPTY_ARRAY );\r\n\t\tonChange( { parents: ids } );\r\n\t};\r\n\treturn (\r\n\t\t<FormTokenField\r\n\t\t\t__next40pxDefaultSize\r\n\t\t\tlabel={ __( 'Parents' ) }\r\n\t\t\tvalue={ value }\r\n\t\t\tonInputChange={ debouncedSearch }\r\n\t\t\tsuggestions={ suggestions }\r\n\t\t\tonChange={ onParentChange }\r\n\t\t\t__experimentalShowHowTo={ false }\r\n\t\t\t__nextHasNoMarginBottom\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nexport default ParentControl;\r\n"],"mappings":"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","ignoreList":[]}