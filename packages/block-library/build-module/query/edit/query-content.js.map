{"version":3,"names":["useSelect","useDispatch","useInstanceId","useEffect","BlockControls","InspectorControls","useBlockProps","store","blockEditorStore","useInnerBlocksProps","SelectControl","__","coreStore","EnhancedPaginationControl","QueryToolbar","QueryInspectorControls","EnhancedPaginationModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","DEFAULTS_POSTS_PER_PAGE","TEMPLATE","QueryContent","attributes","setAttributes","openPatternSelectionModal","name","clientId","queryId","query","displayLayout","enhancedPagination","tagName","TagName","inherit","__unstableMarkNextChangeAsNotPersistent","instanceId","blockProps","innerBlocksProps","template","postsPerPage","select","getSettings","getEntityRecord","getEntityRecordEdits","canUser","settingPerPage","kind","posts_per_page","editedSettingPerPage","newQuery","perPage","Object","keys","length","updateQuery","Number","isFinite","updateDisplayLayout","newDisplayLayout","htmlElementMessages","main","section","aside","children","setQuery","setDisplayLayout","group","__nextHasNoMarginBottom","__next40pxDefaultSize","label","options","value","onChange","help"],"sources":["@wordpress/block-library/src/query/edit/query-content.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useInstanceId } from '@wordpress/compose';\r\nimport { useEffect } from '@wordpress/element';\r\nimport {\r\n\tBlockControls,\r\n\tInspectorControls,\r\n\tuseBlockProps,\r\n\tstore as blockEditorStore,\r\n\tuseInnerBlocksProps,\r\n} from '@wordpress/block-editor';\r\nimport { SelectControl } from '@wordpress/components';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport EnhancedPaginationControl from './inspector-controls/enhanced-pagination-control';\r\nimport QueryToolbar from './query-toolbar';\r\nimport QueryInspectorControls from './inspector-controls';\r\nimport EnhancedPaginationModal from './enhanced-pagination-modal';\r\n\r\nconst DEFAULTS_POSTS_PER_PAGE = 3;\r\n\r\nconst TEMPLATE = [ [ 'core/post-template' ] ];\r\nexport default function QueryContent( {\r\n\tattributes,\r\n\tsetAttributes,\r\n\topenPatternSelectionModal,\r\n\tname,\r\n\tclientId,\r\n} ) {\r\n\tconst {\r\n\t\tqueryId,\r\n\t\tquery,\r\n\t\tdisplayLayout,\r\n\t\tenhancedPagination,\r\n\t\ttagName: TagName = 'div',\r\n\t\tquery: { inherit } = {},\r\n\t} = attributes;\r\n\tconst { __unstableMarkNextChangeAsNotPersistent } =\r\n\t\tuseDispatch( blockEditorStore );\r\n\tconst instanceId = useInstanceId( QueryContent );\r\n\tconst blockProps = useBlockProps();\r\n\tconst innerBlocksProps = useInnerBlocksProps( blockProps, {\r\n\t\ttemplate: TEMPLATE,\r\n\t} );\r\n\tconst { postsPerPage } = useSelect( ( select ) => {\r\n\t\tconst { getSettings } = select( blockEditorStore );\r\n\t\tconst { getEntityRecord, getEntityRecordEdits, canUser } =\r\n\t\t\tselect( coreStore );\r\n\t\tconst settingPerPage = canUser( 'read', {\r\n\t\t\tkind: 'root',\r\n\t\t\tname: 'site',\r\n\t\t} )\r\n\t\t\t? +getEntityRecord( 'root', 'site' )?.posts_per_page\r\n\t\t\t: +getSettings().postsPerPage;\r\n\r\n\t\t// Gets changes made via the template area posts per page setting. These won't be saved\r\n\t\t// until the page is saved, but we should reflect this setting within the query loops\r\n\t\t// that inherit it.\r\n\t\tconst editedSettingPerPage = +getEntityRecordEdits( 'root', 'site' )\r\n\t\t\t?.posts_per_page;\r\n\r\n\t\treturn {\r\n\t\t\tpostsPerPage:\r\n\t\t\t\teditedSettingPerPage ||\r\n\t\t\t\tsettingPerPage ||\r\n\t\t\t\tDEFAULTS_POSTS_PER_PAGE,\r\n\t\t};\r\n\t}, [] );\r\n\t// There are some effects running where some initialization logic is\r\n\t// happening and setting some values to some attributes (ex. queryId).\r\n\t// These updates can cause an `undo trap` where undoing will result in\r\n\t// resetting again, so we need to mark these changes as not persistent\r\n\t// with `__unstableMarkNextChangeAsNotPersistent`.\r\n\r\n\t// Changes in query property (which is an object) need to be in the same callback,\r\n\t// because updates are batched after the render and changes in different query properties\r\n\t// would cause to override previous wanted changes.\r\n\tuseEffect( () => {\r\n\t\tconst newQuery = {};\r\n\t\t// When we inherit from global query always need to set the `perPage`\r\n\t\t// based on the reading settings.\r\n\t\tif ( inherit && query.perPage !== postsPerPage ) {\r\n\t\t\tnewQuery.perPage = postsPerPage;\r\n\t\t} else if ( ! query.perPage && postsPerPage ) {\r\n\t\t\tnewQuery.perPage = postsPerPage;\r\n\t\t}\r\n\t\tif ( !! Object.keys( newQuery ).length ) {\r\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\r\n\t\t\tupdateQuery( newQuery );\r\n\t\t}\r\n\t}, [ query.perPage, postsPerPage, inherit ] );\r\n\t// We need this for multi-query block pagination.\r\n\t// Query parameters for each block are scoped to their ID.\r\n\tuseEffect( () => {\r\n\t\tif ( ! Number.isFinite( queryId ) ) {\r\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\r\n\t\t\tsetAttributes( { queryId: instanceId } );\r\n\t\t}\r\n\t}, [ queryId, instanceId ] );\r\n\tconst updateQuery = ( newQuery ) =>\r\n\t\tsetAttributes( { query: { ...query, ...newQuery } } );\r\n\tconst updateDisplayLayout = ( newDisplayLayout ) =>\r\n\t\tsetAttributes( {\r\n\t\t\tdisplayLayout: { ...displayLayout, ...newDisplayLayout },\r\n\t\t} );\r\n\tconst htmlElementMessages = {\r\n\t\tmain: __(\r\n\t\t\t'The <main> element should be used for the primary content of your document only.'\r\n\t\t),\r\n\t\tsection: __(\r\n\t\t\t\"The <section> element should represent a standalone portion of the document that can't be better represented by another element.\"\r\n\t\t),\r\n\t\taside: __(\r\n\t\t\t\"The <aside> element should represent a portion of a document whose content is only indirectly related to the document's main content.\"\r\n\t\t),\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<EnhancedPaginationModal\r\n\t\t\t\tattributes={ attributes }\r\n\t\t\t\tsetAttributes={ setAttributes }\r\n\t\t\t\tclientId={ clientId }\r\n\t\t\t/>\r\n\t\t\t<InspectorControls>\r\n\t\t\t\t<QueryInspectorControls\r\n\t\t\t\t\tattributes={ attributes }\r\n\t\t\t\t\tsetQuery={ updateQuery }\r\n\t\t\t\t\tsetDisplayLayout={ updateDisplayLayout }\r\n\t\t\t\t\tsetAttributes={ setAttributes }\r\n\t\t\t\t\tclientId={ clientId }\r\n\t\t\t\t/>\r\n\t\t\t</InspectorControls>\r\n\t\t\t<BlockControls>\r\n\t\t\t\t<QueryToolbar\r\n\t\t\t\t\tname={ name }\r\n\t\t\t\t\tclientId={ clientId }\r\n\t\t\t\t\tattributes={ attributes }\r\n\t\t\t\t\tsetQuery={ updateQuery }\r\n\t\t\t\t\topenPatternSelectionModal={ openPatternSelectionModal }\r\n\t\t\t\t/>\r\n\t\t\t</BlockControls>\r\n\t\t\t<InspectorControls group=\"advanced\">\r\n\t\t\t\t<SelectControl\r\n\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\tlabel={ __( 'HTML element' ) }\r\n\t\t\t\t\toptions={ [\r\n\t\t\t\t\t\t{ label: __( 'Default (<div>)' ), value: 'div' },\r\n\t\t\t\t\t\t{ label: '<main>', value: 'main' },\r\n\t\t\t\t\t\t{ label: '<section>', value: 'section' },\r\n\t\t\t\t\t\t{ label: '<aside>', value: 'aside' },\r\n\t\t\t\t\t] }\r\n\t\t\t\t\tvalue={ TagName }\r\n\t\t\t\t\tonChange={ ( value ) =>\r\n\t\t\t\t\t\tsetAttributes( { tagName: value } )\r\n\t\t\t\t\t}\r\n\t\t\t\t\thelp={ htmlElementMessages[ TagName ] }\r\n\t\t\t\t/>\r\n\t\t\t\t<EnhancedPaginationControl\r\n\t\t\t\t\tenhancedPagination={ enhancedPagination }\r\n\t\t\t\t\tsetAttributes={ setAttributes }\r\n\t\t\t\t\tclientId={ clientId }\r\n\t\t\t\t/>\r\n\t\t\t</InspectorControls>\r\n\t\t\t<TagName { ...innerBlocksProps } />\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}