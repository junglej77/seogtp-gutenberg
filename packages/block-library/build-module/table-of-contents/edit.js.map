{"version":3,"names":["BlockControls","BlockIcon","InspectorControls","store","blockEditorStore","useBlockProps","createBlock","PanelBody","Placeholder","ToggleControl","ToolbarButton","ToolbarGroup","useDispatch","useSelect","renderToString","__","useInstanceId","noticeStore","tableOfContents","icon","TableOfContentsList","linearToNestedHeadingList","useObserveHeadings","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","TableOfContentsEdit","attributes","headings","onlyIncludeCurrentPage","clientId","setAttributes","blockProps","instanceId","createWarningNotice","removeNotice","noticeId","showRedirectionPreventedNotice","event","preventDefault","id","type","canInsertList","select","getBlockRootClientId","canInsertBlockType","rootClientId","replaceBlocks","headingTree","toolbarControls","children","onClick","ordered","values","nestedHeadingList","inspectorControls","title","__nextHasNoMarginBottom","label","checked","onChange","value","help","length","instructions","disableLinkActivation"],"sources":["@wordpress/block-library/src/table-of-contents/edit.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tBlockControls,\r\n\tBlockIcon,\r\n\tInspectorControls,\r\n\tstore as blockEditorStore,\r\n\tuseBlockProps,\r\n} from '@wordpress/block-editor';\r\nimport { createBlock } from '@wordpress/blocks';\r\nimport {\r\n\tPanelBody,\r\n\tPlaceholder,\r\n\tToggleControl,\r\n\tToolbarButton,\r\n\tToolbarGroup,\r\n} from '@wordpress/components';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { renderToString } from '@wordpress/element';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useInstanceId } from '@wordpress/compose';\r\nimport { store as noticeStore } from '@wordpress/notices';\r\nimport { tableOfContents as icon } from '@wordpress/icons';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport TableOfContentsList from './list';\r\nimport { linearToNestedHeadingList } from './utils';\r\nimport { useObserveHeadings } from './hooks';\r\n\r\n/** @typedef {import('./utils').HeadingData} HeadingData */\r\n\r\n/**\r\n * Table of Contents block edit component.\r\n *\r\n * @param {Object}                       props                                   The props.\r\n * @param {Object}                       props.attributes                        The block attributes.\r\n * @param {HeadingData[]}                props.attributes.headings               A list of data for each heading in the post.\r\n * @param {boolean}                      props.attributes.onlyIncludeCurrentPage Whether to only include headings from the current page (if the post is paginated).\r\n * @param {string}                       props.clientId\r\n * @param {(attributes: Object) => void} props.setAttributes\r\n *\r\n * @return {Component} The component.\r\n */\r\nexport default function TableOfContentsEdit( {\r\n\tattributes: { headings = [], onlyIncludeCurrentPage },\r\n\tclientId,\r\n\tsetAttributes,\r\n} ) {\r\n\tuseObserveHeadings( clientId );\r\n\r\n\tconst blockProps = useBlockProps();\r\n\tconst instanceId = useInstanceId(\r\n\t\tTableOfContentsEdit,\r\n\t\t'table-of-contents'\r\n\t);\r\n\r\n\t// If a user clicks to a link prevent redirection and show a warning.\r\n\tconst { createWarningNotice, removeNotice } = useDispatch( noticeStore );\r\n\tlet noticeId;\r\n\tconst showRedirectionPreventedNotice = ( event ) => {\r\n\t\tevent.preventDefault();\r\n\t\t// Remove previous warning if any, to show one at a time per block.\r\n\t\tremoveNotice( noticeId );\r\n\t\tnoticeId = `block-library/core/table-of-contents/redirection-prevented/${ instanceId }`;\r\n\t\tcreateWarningNotice( __( 'Links are disabled in the editor.' ), {\r\n\t\t\tid: noticeId,\r\n\t\t\ttype: 'snackbar',\r\n\t\t} );\r\n\t};\r\n\r\n\tconst canInsertList = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getBlockRootClientId, canInsertBlockType } =\r\n\t\t\t\tselect( blockEditorStore );\r\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\r\n\r\n\t\t\treturn canInsertBlockType( 'core/list', rootClientId );\r\n\t\t},\r\n\t\t[ clientId ]\r\n\t);\r\n\r\n\tconst { replaceBlocks } = useDispatch( blockEditorStore );\r\n\r\n\tconst headingTree = linearToNestedHeadingList( headings );\r\n\r\n\tconst toolbarControls = canInsertList && (\r\n\t\t<BlockControls>\r\n\t\t\t<ToolbarGroup>\r\n\t\t\t\t<ToolbarButton\r\n\t\t\t\t\tonClick={ () =>\r\n\t\t\t\t\t\treplaceBlocks(\r\n\t\t\t\t\t\t\tclientId,\r\n\t\t\t\t\t\t\tcreateBlock( 'core/list', {\r\n\t\t\t\t\t\t\t\tordered: true,\r\n\t\t\t\t\t\t\t\tvalues: renderToString(\r\n\t\t\t\t\t\t\t\t\t<TableOfContentsList\r\n\t\t\t\t\t\t\t\t\t\tnestedHeadingList={ headingTree }\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t} )\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t{ __( 'Convert to static list' ) }\r\n\t\t\t\t</ToolbarButton>\r\n\t\t\t</ToolbarGroup>\r\n\t\t</BlockControls>\r\n\t);\r\n\r\n\tconst inspectorControls = (\r\n\t\t<InspectorControls>\r\n\t\t\t<PanelBody title={ __( 'Settings' ) }>\r\n\t\t\t\t<ToggleControl\r\n\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\tlabel={ __( 'Only include current page' ) }\r\n\t\t\t\t\tchecked={ onlyIncludeCurrentPage }\r\n\t\t\t\t\tonChange={ ( value ) =>\r\n\t\t\t\t\t\tsetAttributes( { onlyIncludeCurrentPage: value } )\r\n\t\t\t\t\t}\r\n\t\t\t\t\thelp={\r\n\t\t\t\t\t\tonlyIncludeCurrentPage\r\n\t\t\t\t\t\t\t? __(\r\n\t\t\t\t\t\t\t\t\t'Only including headings from the current page (if the post is paginated).'\r\n\t\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t\t: __(\r\n\t\t\t\t\t\t\t\t\t'Toggle to only include headings from the current page (if the post is paginated).'\r\n\t\t\t\t\t\t\t  )\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t</PanelBody>\r\n\t\t</InspectorControls>\r\n\t);\r\n\r\n\t// If there are no headings or the only heading is empty.\r\n\t// Note that the toolbar controls are intentionally omitted since the\r\n\t// \"Convert to static list\" option is useless to the placeholder state.\r\n\tif ( headings.length === 0 ) {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<div { ...blockProps }>\r\n\t\t\t\t\t<Placeholder\r\n\t\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\r\n\t\t\t\t\t\tlabel={ __( 'Table of Contents' ) }\r\n\t\t\t\t\t\tinstructions={ __(\r\n\t\t\t\t\t\t\t'Start adding Heading blocks to create a table of contents. Headings with HTML anchors will be linked here.'\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t{ inspectorControls }\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<nav { ...blockProps }>\r\n\t\t\t\t<ol>\r\n\t\t\t\t\t<TableOfContentsList\r\n\t\t\t\t\t\tnestedHeadingList={ headingTree }\r\n\t\t\t\t\t\tdisableLinkActivation\r\n\t\t\t\t\t\tonClick={ showRedirectionPreventedNotice }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</ol>\r\n\t\t\t</nav>\r\n\t\t\t{ toolbarControls }\r\n\t\t\t{ inspectorControls }\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}