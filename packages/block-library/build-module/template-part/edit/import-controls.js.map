{"version":3,"names":["__","_x","sprintf","useMemo","useState","useDispatch","useSelect","useRegistry","Button","FlexBlock","FlexItem","SelectControl","__experimentalHStack","HStack","__experimentalSpacer","Spacer","store","coreStore","noticesStore","useCreateTemplatePartFromBlocks","transformWidgetToBlock","jsx","_jsx","jsxs","_jsxs","SIDEBARS_QUERY","per_page","_fields","TemplatePartImportControls","area","setAttributes","selectedSidebar","setSelectedSidebar","isBusy","setIsBusy","registry","sidebars","hasResolved","select","getSidebars","hasFinishedResolution","createErrorNotice","createFromBlocks","options","sidebarOptions","filter","widgetArea","id","widgets","length","map","value","label","name","marginBottom","createFromWidgets","event","preventDefault","sidebar","find","getWidgets","resolveSelect","_embed","skippedWidgets","Set","blocks","flatMap","widget","block","add","id_base","size","Array","from","join","type","children","as","onSubmit","onChange","disabled","__next40pxDefaultSize","__nextHasNoMarginBottom","style","marginTop","variant"],"sources":["@wordpress/block-library/src/template-part/edit/import-controls.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, _x, sprintf } from '@wordpress/i18n';\r\nimport { useMemo, useState } from '@wordpress/element';\r\nimport { useDispatch, useSelect, useRegistry } from '@wordpress/data';\r\nimport {\r\n\tButton,\r\n\tFlexBlock,\r\n\tFlexItem,\r\n\tSelectControl,\r\n\t__experimentalHStack as HStack,\r\n\t__experimentalSpacer as Spacer,\r\n} from '@wordpress/components';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { useCreateTemplatePartFromBlocks } from './utils/hooks';\r\nimport { transformWidgetToBlock } from './utils/transformers';\r\n\r\nconst SIDEBARS_QUERY = {\r\n\tper_page: -1,\r\n\t_fields: 'id,name,description,status,widgets',\r\n};\r\n\r\nexport function TemplatePartImportControls( { area, setAttributes } ) {\r\n\tconst [ selectedSidebar, setSelectedSidebar ] = useState( '' );\r\n\tconst [ isBusy, setIsBusy ] = useState( false );\r\n\r\n\tconst registry = useRegistry();\r\n\tconst { sidebars, hasResolved } = useSelect( ( select ) => {\r\n\t\tconst { getSidebars, hasFinishedResolution } = select( coreStore );\r\n\r\n\t\treturn {\r\n\t\t\tsidebars: getSidebars( SIDEBARS_QUERY ),\r\n\t\t\thasResolved: hasFinishedResolution( 'getSidebars', [\r\n\t\t\t\tSIDEBARS_QUERY,\r\n\t\t\t] ),\r\n\t\t};\r\n\t}, [] );\r\n\tconst { createErrorNotice } = useDispatch( noticesStore );\r\n\r\n\tconst createFromBlocks = useCreateTemplatePartFromBlocks(\r\n\t\tarea,\r\n\t\tsetAttributes\r\n\t);\r\n\r\n\tconst options = useMemo( () => {\r\n\t\tconst sidebarOptions = ( sidebars ?? [] )\r\n\t\t\t.filter(\r\n\t\t\t\t( widgetArea ) =>\r\n\t\t\t\t\twidgetArea.id !== 'wp_inactive_widgets' &&\r\n\t\t\t\t\twidgetArea.widgets.length > 0\r\n\t\t\t)\r\n\t\t\t.map( ( widgetArea ) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: widgetArea.id,\r\n\t\t\t\t\tlabel: widgetArea.name,\r\n\t\t\t\t};\r\n\t\t\t} );\r\n\r\n\t\tif ( ! sidebarOptions.length ) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\treturn [\r\n\t\t\t{ value: '', label: __( 'Select widget area' ) },\r\n\t\t\t...sidebarOptions,\r\n\t\t];\r\n\t}, [ sidebars ] );\r\n\r\n\t// Render an empty node while data is loading to avoid SlotFill re-positioning bug.\r\n\t// See: https://github.com/WordPress/gutenberg/issues/15641.\r\n\tif ( ! hasResolved ) {\r\n\t\treturn <Spacer marginBottom=\"0\" />;\r\n\t}\r\n\r\n\tif ( hasResolved && ! options.length ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tasync function createFromWidgets( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tif ( isBusy || ! selectedSidebar ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsBusy( true );\r\n\r\n\t\tconst sidebar = options.find(\r\n\t\t\t( { value } ) => value === selectedSidebar\r\n\t\t);\r\n\t\tconst { getWidgets } = registry.resolveSelect( coreStore );\r\n\r\n\t\t// The widgets API always returns a successful response.\r\n\t\tconst widgets = await getWidgets( {\r\n\t\t\tsidebar: sidebar.value,\r\n\t\t\t_embed: 'about',\r\n\t\t} );\r\n\r\n\t\tconst skippedWidgets = new Set();\r\n\t\tconst blocks = widgets.flatMap( ( widget ) => {\r\n\t\t\tconst block = transformWidgetToBlock( widget );\r\n\r\n\t\t\t// Skip the block if we have no matching transformations.\r\n\t\t\tif ( ! block ) {\r\n\t\t\t\tskippedWidgets.add( widget.id_base );\r\n\t\t\t\treturn [];\r\n\t\t\t}\r\n\r\n\t\t\treturn block;\r\n\t\t} );\r\n\r\n\t\tawait createFromBlocks(\r\n\t\t\tblocks,\r\n\t\t\t/* translators: %s: name of the widget area */\r\n\t\t\tsprintf( __( 'Widget area: %s' ), sidebar.label )\r\n\t\t);\r\n\r\n\t\tif ( skippedWidgets.size ) {\r\n\t\t\tcreateErrorNotice(\r\n\t\t\t\tsprintf(\r\n\t\t\t\t\t/* translators: %s: the list of widgets */\r\n\t\t\t\t\t__( 'Unable to import the following widgets: %s.' ),\r\n\t\t\t\t\tArray.from( skippedWidgets ).join( ', ' )\r\n\t\t\t\t),\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tsetIsBusy( false );\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Spacer marginBottom=\"4\">\r\n\t\t\t<HStack as=\"form\" onSubmit={ createFromWidgets }>\r\n\t\t\t\t<FlexBlock>\r\n\t\t\t\t\t<SelectControl\r\n\t\t\t\t\t\tlabel={ __( 'Import widget area' ) }\r\n\t\t\t\t\t\tvalue={ selectedSidebar }\r\n\t\t\t\t\t\toptions={ options }\r\n\t\t\t\t\t\tonChange={ ( value ) => setSelectedSidebar( value ) }\r\n\t\t\t\t\t\tdisabled={ ! options.length }\r\n\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t/>\r\n\t\t\t\t</FlexBlock>\r\n\t\t\t\t<FlexItem\r\n\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\tmarginBottom: '8px',\r\n\t\t\t\t\t\tmarginTop: 'auto',\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\tisBusy={ isBusy }\r\n\t\t\t\t\t\taria-disabled={ isBusy || ! selectedSidebar }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ _x( 'Import', 'button label' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FlexItem>\r\n\t\t\t</HStack>\r\n\t\t</Spacer>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}