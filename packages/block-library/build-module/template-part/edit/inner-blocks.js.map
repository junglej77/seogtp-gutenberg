{"version":3,"names":["useEntityBlockEditor","store","coreStore","InnerBlocks","useInnerBlocksProps","useSettings","blockEditorStore","useBlockEditingMode","useSelect","useMemo","parse","jsx","_jsx","useRenderAppender","hasInnerBlocks","blockEditingMode","ButtonBlockAppender","useLayout","layout","themeSupportsLayout","select","getSettings","supportsLayout","defaultLayout","inherit","NonEditableTemplatePartPreview","postId","id","tagName","TagName","blockProps","content","editedBlocks","getEditedEntityRecord","editedRecord","context","blocks","undefined","innerBlocksProps","value","onInput","onChange","renderAppender","EditableTemplatePartInnerBlocks","onNavigateToEntityRecord","customProps","onDoubleClick","postType","TemplatePartInnerBlocks","canViewTemplatePart","canEditTemplatePart","canUser","kind","name","TemplatePartInnerBlocksComponent"],"sources":["@wordpress/block-library/src/template-part/edit/inner-blocks.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useEntityBlockEditor, store as coreStore } from '@wordpress/core-data';\r\nimport {\r\n\tInnerBlocks,\r\n\tuseInnerBlocksProps,\r\n\tuseSettings,\r\n\tstore as blockEditorStore,\r\n\tuseBlockEditingMode,\r\n} from '@wordpress/block-editor';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useMemo } from '@wordpress/element';\r\nimport { parse } from '@wordpress/blocks';\r\n\r\nfunction useRenderAppender( hasInnerBlocks ) {\r\n\tconst blockEditingMode = useBlockEditingMode();\r\n\t// Disable appending when the editing mode is 'contentOnly'. This is so that the user can't\r\n\t// append into a template part when editing a page in the site editor. See\r\n\t// DisableNonPageContentBlocks. Ideally instead of (mis)using editing mode there would be a\r\n\t// block editor API for achieving this.\r\n\tif ( blockEditingMode === 'contentOnly' ) {\r\n\t\treturn false;\r\n\t}\r\n\tif ( ! hasInnerBlocks ) {\r\n\t\treturn InnerBlocks.ButtonBlockAppender;\r\n\t}\r\n}\r\n\r\nfunction useLayout( layout ) {\r\n\tconst themeSupportsLayout = useSelect( ( select ) => {\r\n\t\tconst { getSettings } = select( blockEditorStore );\r\n\t\treturn getSettings()?.supportsLayout;\r\n\t}, [] );\r\n\tconst [ defaultLayout ] = useSettings( 'layout' );\r\n\tif ( themeSupportsLayout ) {\r\n\t\treturn layout?.inherit ? defaultLayout || {} : layout;\r\n\t}\r\n}\r\n\r\nfunction NonEditableTemplatePartPreview( {\r\n\tpostId: id,\r\n\tlayout,\r\n\ttagName: TagName,\r\n\tblockProps,\r\n} ) {\r\n\tuseBlockEditingMode( 'disabled' );\r\n\r\n\tconst { content, editedBlocks } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tif ( ! id ) {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t\tconst { getEditedEntityRecord } = select( coreStore );\r\n\t\t\tconst editedRecord = getEditedEntityRecord(\r\n\t\t\t\t'postType',\r\n\t\t\t\t'wp_template_part',\r\n\t\t\t\tid,\r\n\t\t\t\t{ context: 'view' }\r\n\t\t\t);\r\n\t\t\treturn {\r\n\t\t\t\teditedBlocks: editedRecord.blocks,\r\n\t\t\t\tcontent: editedRecord.content,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ id ]\r\n\t);\r\n\r\n\tconst blocks = useMemo( () => {\r\n\t\tif ( ! id ) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tif ( editedBlocks ) {\r\n\t\t\treturn editedBlocks;\r\n\t\t}\r\n\r\n\t\tif ( ! content || typeof content !== 'string' ) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\treturn parse( content );\r\n\t}, [ id, editedBlocks, content ] );\r\n\r\n\tconst innerBlocksProps = useInnerBlocksProps( blockProps, {\r\n\t\tvalue: blocks,\r\n\t\tonInput: () => {},\r\n\t\tonChange: () => {},\r\n\t\trenderAppender: false,\r\n\t\tlayout: useLayout( layout ),\r\n\t} );\r\n\r\n\treturn <TagName { ...innerBlocksProps } />;\r\n}\r\n\r\nfunction EditableTemplatePartInnerBlocks( {\r\n\tpostId: id,\r\n\thasInnerBlocks,\r\n\tlayout,\r\n\ttagName: TagName,\r\n\tblockProps,\r\n} ) {\r\n\tconst onNavigateToEntityRecord = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( blockEditorStore ).getSettings().onNavigateToEntityRecord,\r\n\t\t[]\r\n\t);\r\n\r\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\r\n\t\t'postType',\r\n\t\t'wp_template_part',\r\n\t\t{ id }\r\n\t);\r\n\r\n\tconst innerBlocksProps = useInnerBlocksProps( blockProps, {\r\n\t\tvalue: blocks,\r\n\t\tonInput,\r\n\t\tonChange,\r\n\t\trenderAppender: useRenderAppender( hasInnerBlocks ),\r\n\t\tlayout: useLayout( layout ),\r\n\t} );\r\n\r\n\tconst blockEditingMode = useBlockEditingMode();\r\n\r\n\tconst customProps =\r\n\t\tblockEditingMode === 'contentOnly' && onNavigateToEntityRecord\r\n\t\t\t? {\r\n\t\t\t\t\tonDoubleClick: () =>\r\n\t\t\t\t\t\tonNavigateToEntityRecord( {\r\n\t\t\t\t\t\t\tpostId: id,\r\n\t\t\t\t\t\t\tpostType: 'wp_template_part',\r\n\t\t\t\t\t\t} ),\r\n\t\t\t  }\r\n\t\t\t: {};\r\n\r\n\treturn <TagName { ...innerBlocksProps } { ...customProps } />;\r\n}\r\n\r\nexport default function TemplatePartInnerBlocks( {\r\n\tpostId: id,\r\n\thasInnerBlocks,\r\n\tlayout,\r\n\ttagName: TagName,\r\n\tblockProps,\r\n} ) {\r\n\tconst { canViewTemplatePart, canEditTemplatePart } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\treturn {\r\n\t\t\t\tcanViewTemplatePart: !! select( coreStore ).canUser( 'read', {\r\n\t\t\t\t\tkind: 'postType',\r\n\t\t\t\t\tname: 'wp_template_part',\r\n\t\t\t\t\tid,\r\n\t\t\t\t} ),\r\n\t\t\t\tcanEditTemplatePart: !! select( coreStore ).canUser( 'update', {\r\n\t\t\t\t\tkind: 'postType',\r\n\t\t\t\t\tname: 'wp_template_part',\r\n\t\t\t\t\tid,\r\n\t\t\t\t} ),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ id ]\r\n\t);\r\n\r\n\tif ( ! canViewTemplatePart ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst TemplatePartInnerBlocksComponent = canEditTemplatePart\r\n\t\t? EditableTemplatePartInnerBlocks\r\n\t\t: NonEditableTemplatePartPreview;\r\n\r\n\treturn (\r\n\t\t<TemplatePartInnerBlocksComponent\r\n\t\t\tpostId={ id }\r\n\t\t\thasInnerBlocks={ hasInnerBlocks }\r\n\t\t\tlayout={ layout }\r\n\t\t\ttagName={ TagName }\r\n\t\t\tblockProps={ blockProps }\r\n\t\t/>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}