{"version":3,"names":["parse","cloneBlock","createBlock","getGroupingBlockName","getPossibleBlockTransformations","switchToBlockType","transformWidgetToBlock","widget","id_base","attributes","_embedded","about","is_multi","idBase","instance","id","switchLegacyWidgetType","parsedBlocks","raw","content","__unstableSkipAutop","length","undefined","block","name","transformInnerBlocks","innerBlocks","transforms","filter","item","hasWildCardFrom","from","find","blocks","includes","hasWildCardTo","to","flatMap"],"sources":["@wordpress/block-library/src/template-part/edit/utils/transformers.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tparse,\r\n\tcloneBlock,\r\n\tcreateBlock,\r\n\tgetGroupingBlockName,\r\n\tgetPossibleBlockTransformations,\r\n\tswitchToBlockType,\r\n} from '@wordpress/blocks';\r\n\r\n/**\r\n * Converts a widget entity record into a block.\r\n *\r\n * @param {Object} widget The widget entity record.\r\n * @return {Object} a block (converted from the entity record).\r\n */\r\nexport function transformWidgetToBlock( widget ) {\r\n\tif ( widget.id_base !== 'block' ) {\r\n\t\tlet attributes;\r\n\t\tif ( widget._embedded.about[ 0 ].is_multi ) {\r\n\t\t\tattributes = {\r\n\t\t\t\tidBase: widget.id_base,\r\n\t\t\t\tinstance: widget.instance,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tattributes = {\r\n\t\t\t\tid: widget.id,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn switchLegacyWidgetType(\r\n\t\t\tcreateBlock( 'core/legacy-widget', attributes )\r\n\t\t);\r\n\t}\r\n\r\n\tconst parsedBlocks = parse( widget.instance.raw.content, {\r\n\t\t__unstableSkipAutop: true,\r\n\t} );\r\n\r\n\tif ( ! parsedBlocks.length ) {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tconst block = parsedBlocks[ 0 ];\r\n\r\n\tif ( block.name === 'core/widget-group' ) {\r\n\t\treturn createBlock(\r\n\t\t\tgetGroupingBlockName(),\r\n\t\t\tundefined,\r\n\t\t\ttransformInnerBlocks( block.innerBlocks )\r\n\t\t);\r\n\t}\r\n\r\n\tif ( block.innerBlocks.length > 0 ) {\r\n\t\treturn cloneBlock(\r\n\t\t\tblock,\r\n\t\t\tundefined,\r\n\t\t\ttransformInnerBlocks( block.innerBlocks )\r\n\t\t);\r\n\t}\r\n\r\n\treturn block;\r\n}\r\n\r\n/**\r\n * Switch Legacy Widget to the first matching transformation block.\r\n *\r\n * @param {Object} block Legacy Widget block object\r\n * @return {Object|undefined} a block\r\n */\r\nfunction switchLegacyWidgetType( block ) {\r\n\tconst transforms = getPossibleBlockTransformations( [ block ] ).filter(\r\n\t\t( item ) => {\r\n\t\t\t// The block without any transformations can't be a wildcard.\r\n\t\t\tif ( ! item.transforms ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tconst hasWildCardFrom = item.transforms?.from?.find(\r\n\t\t\t\t( from ) => from.blocks && from.blocks.includes( '*' )\r\n\t\t\t);\r\n\t\t\tconst hasWildCardTo = item.transforms?.to?.find(\r\n\t\t\t\t( to ) => to.blocks && to.blocks.includes( '*' )\r\n\t\t\t);\r\n\r\n\t\t\t// Skip wildcard transformations.\r\n\t\t\treturn ! hasWildCardFrom && ! hasWildCardTo;\r\n\t\t}\r\n\t);\r\n\r\n\tif ( ! transforms.length ) {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\treturn switchToBlockType( block, transforms[ 0 ].name );\r\n}\r\n\r\nfunction transformInnerBlocks( innerBlocks = [] ) {\r\n\treturn innerBlocks\r\n\t\t.flatMap( ( block ) => {\r\n\t\t\tif ( block.name === 'core/legacy-widget' ) {\r\n\t\t\t\treturn switchLegacyWidgetType( block );\r\n\t\t\t}\r\n\r\n\t\t\treturn createBlock(\r\n\t\t\t\tblock.name,\r\n\t\t\t\tblock.attributes,\r\n\t\t\t\ttransformInnerBlocks( block.innerBlocks )\r\n\t\t\t);\r\n\t\t} )\r\n\t\t.filter( ( block ) => !! block );\r\n}\r\n"],"mappings":"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","ignoreList":[]}