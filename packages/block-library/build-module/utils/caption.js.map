{"version":3,"names":["clsx","useState","useEffect","useCallback","usePrevious","__","BlockControls","__experimentalGetElementClassName","privateApis","blockEditorPrivateApis","ToolbarButton","caption","captionIcon","createBlock","getDefaultBlockName","unlock","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Caption","attributeKey","attributes","setAttributes","isSelected","insertBlocksAfter","placeholder","label","showToolbarButton","excludeElementClassName","className","readOnly","tagName","addLabel","removeLabel","icon","props","prevCaption","PrivateRichText","RichText","isCaptionEmpty","isEmpty","isPrevCaptionEmpty","showCaption","setShowCaption","ref","node","focus","children","group","onClick","undefined","isPressed","identifier","value","onChange","inlineToolbar","__unstableOnSplitAtEnd"],"sources":["@wordpress/block-library/src/utils/caption.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useState, useEffect, useCallback } from '@wordpress/element';\r\nimport { usePrevious } from '@wordpress/compose';\r\nimport { __ } from '@wordpress/i18n';\r\nimport {\r\n\tBlockControls,\r\n\t__experimentalGetElementClassName,\r\n\tprivateApis as blockEditorPrivateApis,\r\n} from '@wordpress/block-editor';\r\nimport { ToolbarButton } from '@wordpress/components';\r\nimport { caption as captionIcon } from '@wordpress/icons';\r\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { unlock } from '../lock-unlock';\r\n\r\nexport function Caption( {\r\n\tattributeKey = 'caption',\r\n\tattributes,\r\n\tsetAttributes,\r\n\tisSelected,\r\n\tinsertBlocksAfter,\r\n\tplaceholder = __( 'Add caption' ),\r\n\tlabel = __( 'Caption text' ),\r\n\tshowToolbarButton = true,\r\n\texcludeElementClassName,\r\n\tclassName,\r\n\treadOnly,\r\n\ttagName = 'figcaption',\r\n\taddLabel = __( 'Add caption' ),\r\n\tremoveLabel = __( 'Remove caption' ),\r\n\ticon = captionIcon,\r\n\t...props\r\n} ) {\r\n\tconst caption = attributes[ attributeKey ];\r\n\tconst prevCaption = usePrevious( caption );\r\n\tconst { PrivateRichText: RichText } = unlock( blockEditorPrivateApis );\r\n\tconst isCaptionEmpty = RichText.isEmpty( caption );\r\n\tconst isPrevCaptionEmpty = RichText.isEmpty( prevCaption );\r\n\tconst [ showCaption, setShowCaption ] = useState( ! isCaptionEmpty );\r\n\r\n\t// We need to show the caption when changes come from\r\n\t// history navigation(undo/redo).\r\n\tuseEffect( () => {\r\n\t\tif ( ! isCaptionEmpty && isPrevCaptionEmpty ) {\r\n\t\t\tsetShowCaption( true );\r\n\t\t}\r\n\t}, [ isCaptionEmpty, isPrevCaptionEmpty ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! isSelected && isCaptionEmpty ) {\r\n\t\t\tsetShowCaption( false );\r\n\t\t}\r\n\t}, [ isSelected, isCaptionEmpty ] );\r\n\r\n\t// Focus the caption when we click to add one.\r\n\tconst ref = useCallback(\r\n\t\t( node ) => {\r\n\t\t\tif ( node && isCaptionEmpty ) {\r\n\t\t\t\tnode.focus();\r\n\t\t\t}\r\n\t\t},\r\n\t\t[ isCaptionEmpty ]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ showToolbarButton && (\r\n\t\t\t\t<BlockControls group=\"block\">\r\n\t\t\t\t\t<ToolbarButton\r\n\t\t\t\t\t\tonClick={ () => {\r\n\t\t\t\t\t\t\tsetShowCaption( ! showCaption );\r\n\t\t\t\t\t\t\tif ( showCaption && caption ) {\r\n\t\t\t\t\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t\t\t\t\t[ attributeKey ]: undefined,\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\ticon={ icon }\r\n\t\t\t\t\t\tisPressed={ showCaption }\r\n\t\t\t\t\t\tlabel={ showCaption ? removeLabel : addLabel }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</BlockControls>\r\n\t\t\t) }\r\n\t\t\t{ showCaption &&\r\n\t\t\t\t( ! RichText.isEmpty( caption ) || isSelected ) && (\r\n\t\t\t\t\t<RichText\r\n\t\t\t\t\t\tidentifier={ attributeKey }\r\n\t\t\t\t\t\ttagName={ tagName }\r\n\t\t\t\t\t\tclassName={ clsx(\r\n\t\t\t\t\t\t\tclassName,\r\n\t\t\t\t\t\t\texcludeElementClassName\r\n\t\t\t\t\t\t\t\t? ''\r\n\t\t\t\t\t\t\t\t: __experimentalGetElementClassName( 'caption' )\r\n\t\t\t\t\t\t) }\r\n\t\t\t\t\t\tref={ ref }\r\n\t\t\t\t\t\taria-label={ label }\r\n\t\t\t\t\t\tplaceholder={ placeholder }\r\n\t\t\t\t\t\tvalue={ caption }\r\n\t\t\t\t\t\tonChange={ ( value ) =>\r\n\t\t\t\t\t\t\tsetAttributes( { [ attributeKey ]: value } )\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinlineToolbar\r\n\t\t\t\t\t\t__unstableOnSplitAtEnd={ () =>\r\n\t\t\t\t\t\t\tinsertBlocksAfter(\r\n\t\t\t\t\t\t\t\tcreateBlock( getDefaultBlockName() )\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treadOnly={ readOnly }\r\n\t\t\t\t\t\t{ ...props }\r\n\t\t\t\t\t/>\r\n\t\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}