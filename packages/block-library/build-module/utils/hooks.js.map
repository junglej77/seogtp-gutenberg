{"version":3,"names":["useSelect","useLayoutEffect","useEffect","useRef","getBlobByURL","isBlobURL","revokeBlobURL","store","blockEditorStore","coreStore","useViewportMatch","useCanEditEntity","kind","name","recordId","select","canUser","id","useUploadMediaFromBlobURL","args","latestArgsRef","hasUploadStartedRef","getSettings","current","url","file","allowedTypes","onChange","onError","mediaUpload","filesList","onFileChange","media","message","useToolsPanelDropdownMenuProps","isMobile","popoverProps","placement","offset"],"sources":["@wordpress/block-library/src/utils/hooks.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useLayoutEffect, useEffect, useRef } from '@wordpress/element';\r\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\r\nimport { store as blockEditorStore } from '@wordpress/block-editor';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { useViewportMatch } from '@wordpress/compose';\r\n\r\n/**\r\n * Returns whether the current user can edit the given entity.\r\n *\r\n * @param {string} kind     Entity kind.\r\n * @param {string} name     Entity name.\r\n * @param {string} recordId Record's id.\r\n */\r\nexport function useCanEditEntity( kind, name, recordId ) {\r\n\treturn useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( coreStore ).canUser( 'update', {\r\n\t\t\t\tkind,\r\n\t\t\t\tname,\r\n\t\t\t\tid: recordId,\r\n\t\t\t} ),\r\n\t\t[ kind, name, recordId ]\r\n\t);\r\n}\r\n\r\n/**\r\n * Handles uploading a media file from a blob URL on mount.\r\n *\r\n * @param {Object}   args              Upload media arguments.\r\n * @param {string}   args.url          Blob URL.\r\n * @param {?Array}   args.allowedTypes Array of allowed media types.\r\n * @param {Function} args.onChange     Function called when the media is uploaded.\r\n * @param {Function} args.onError      Function called when an error happens.\r\n */\r\nexport function useUploadMediaFromBlobURL( args = {} ) {\r\n\tconst latestArgsRef = useRef( args );\r\n\tconst hasUploadStartedRef = useRef( false );\r\n\tconst { getSettings } = useSelect( blockEditorStore );\r\n\r\n\tuseLayoutEffect( () => {\r\n\t\tlatestArgsRef.current = args;\r\n\t} );\r\n\r\n\tuseEffect( () => {\r\n\t\t// Uploading is a special effect that can't be canceled via the cleanup method.\r\n\t\t// The extra check avoids duplicate uploads in development mode (React.StrictMode).\r\n\t\tif ( hasUploadStartedRef.current ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (\r\n\t\t\t! latestArgsRef.current.url ||\r\n\t\t\t! isBlobURL( latestArgsRef.current.url )\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst file = getBlobByURL( latestArgsRef.current.url );\r\n\t\tif ( ! file ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { url, allowedTypes, onChange, onError } = latestArgsRef.current;\r\n\t\tconst { mediaUpload } = getSettings();\r\n\r\n\t\thasUploadStartedRef.current = true;\r\n\r\n\t\tmediaUpload( {\r\n\t\t\tfilesList: [ file ],\r\n\t\t\tallowedTypes,\r\n\t\t\tonFileChange: ( [ media ] ) => {\r\n\t\t\t\tif ( isBlobURL( media?.url ) ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trevokeBlobURL( url );\r\n\t\t\t\tonChange( media );\r\n\t\t\t\thasUploadStartedRef.current = false;\r\n\t\t\t},\r\n\t\t\tonError: ( message ) => {\r\n\t\t\t\trevokeBlobURL( url );\r\n\t\t\t\tonError( message );\r\n\t\t\t\thasUploadStartedRef.current = false;\r\n\t\t\t},\r\n\t\t} );\r\n\t}, [ getSettings ] );\r\n}\r\n\r\nexport function useToolsPanelDropdownMenuProps() {\r\n\tconst isMobile = useViewportMatch( 'medium', '<' );\r\n\treturn ! isMobile\r\n\t\t? {\r\n\t\t\t\tpopoverProps: {\r\n\t\t\t\t\tplacement: 'left-start',\r\n\t\t\t\t\t// For non-mobile, inner sidebar width (248px) - button width (24px) - border (1px) + padding (16px) + spacing (20px)\r\n\t\t\t\t\toffset: 259,\r\n\t\t\t\t},\r\n\t\t  }\r\n\t\t: {};\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,eAAe,EAAEC,SAAS,EAAEC,MAAM,QAAQ,oBAAoB;AACvE,SAASC,YAAY,EAAEC,SAAS,EAAEC,aAAa,QAAQ,iBAAiB;AACxE,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,yBAAyB;AACnE,SAASD,KAAK,IAAIE,SAAS,QAAQ,sBAAsB;AACzD,SAASC,gBAAgB,QAAQ,oBAAoB;;AAErD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,gBAAgBA,CAAEC,IAAI,EAAEC,IAAI,EAAEC,QAAQ,EAAG;EACxD,OAAOd,SAAS,CACbe,MAAM,IACPA,MAAM,CAAEN,SAAU,CAAC,CAACO,OAAO,CAAE,QAAQ,EAAE;IACtCJ,IAAI;IACJC,IAAI;IACJI,EAAE,EAAEH;EACL,CAAE,CAAC,EACJ,CAAEF,IAAI,EAAEC,IAAI,EAAEC,QAAQ,CACvB,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASI,yBAAyBA,CAAEC,IAAI,GAAG,CAAC,CAAC,EAAG;EACtD,MAAMC,aAAa,GAAGjB,MAAM,CAAEgB,IAAK,CAAC;EACpC,MAAME,mBAAmB,GAAGlB,MAAM,CAAE,KAAM,CAAC;EAC3C,MAAM;IAAEmB;EAAY,CAAC,GAAGtB,SAAS,CAAEQ,gBAAiB,CAAC;EAErDP,eAAe,CAAE,MAAM;IACtBmB,aAAa,CAACG,OAAO,GAAGJ,IAAI;EAC7B,CAAE,CAAC;EAEHjB,SAAS,CAAE,MAAM;IAChB;IACA;IACA,IAAKmB,mBAAmB,CAACE,OAAO,EAAG;MAClC;IACD;IACA,IACC,CAAEH,aAAa,CAACG,OAAO,CAACC,GAAG,IAC3B,CAAEnB,SAAS,CAAEe,aAAa,CAACG,OAAO,CAACC,GAAI,CAAC,EACvC;MACD;IACD;IAEA,MAAMC,IAAI,GAAGrB,YAAY,CAAEgB,aAAa,CAACG,OAAO,CAACC,GAAI,CAAC;IACtD,IAAK,CAAEC,IAAI,EAAG;MACb;IACD;IAEA,MAAM;MAAED,GAAG;MAAEE,YAAY;MAAEC,QAAQ;MAAEC;IAAQ,CAAC,GAAGR,aAAa,CAACG,OAAO;IACtE,MAAM;MAAEM;IAAY,CAAC,GAAGP,WAAW,CAAC,CAAC;IAErCD,mBAAmB,CAACE,OAAO,GAAG,IAAI;IAElCM,WAAW,CAAE;MACZC,SAAS,EAAE,CAAEL,IAAI,CAAE;MACnBC,YAAY;MACZK,YAAY,EAAEA,CAAE,CAAEC,KAAK,CAAE,KAAM;QAC9B,IAAK3B,SAAS,CAAE2B,KAAK,EAAER,GAAI,CAAC,EAAG;UAC9B;QACD;QAEAlB,aAAa,CAAEkB,GAAI,CAAC;QACpBG,QAAQ,CAAEK,KAAM,CAAC;QACjBX,mBAAmB,CAACE,OAAO,GAAG,KAAK;MACpC,CAAC;MACDK,OAAO,EAAIK,OAAO,IAAM;QACvB3B,aAAa,CAAEkB,GAAI,CAAC;QACpBI,OAAO,CAAEK,OAAQ,CAAC;QAClBZ,mBAAmB,CAACE,OAAO,GAAG,KAAK;MACpC;IACD,CAAE,CAAC;EACJ,CAAC,EAAE,CAAED,WAAW,CAAG,CAAC;AACrB;AAEA,OAAO,SAASY,8BAA8BA,CAAA,EAAG;EAChD,MAAMC,QAAQ,GAAGzB,gBAAgB,CAAE,QAAQ,EAAE,GAAI,CAAC;EAClD,OAAO,CAAEyB,QAAQ,GACd;IACAC,YAAY,EAAE;MACbC,SAAS,EAAE,YAAY;MACvB;MACAC,MAAM,EAAE;IACT;EACA,CAAC,GACD,CAAC,CAAC;AACN","ignoreList":[]}