{"version":3,"names":["hasBlockSupport","getSaveContent","parseWithAttributeSchema","CLASS_ATTR_SCHEMA","type","source","selector","attribute","getHTMLRootElementClasses","innerHTML","parsed","trim","split","fixCustomClassname","blockAttributes","blockType","modifiedBlockAttributes","className","omittedClassName","attributesSansClassName","serialized","defaultClasses","actualClasses","customClasses","filter","includes","length","join"],"sources":["@wordpress/blocks/src/api/parser/fix-custom-classname.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport { hasBlockSupport } from '../registration';\r\nimport { getSaveContent } from '../serializer';\r\nimport { parseWithAttributeSchema } from './get-block-attributes';\r\n\r\nconst CLASS_ATTR_SCHEMA = {\r\n\ttype: 'string',\r\n\tsource: 'attribute',\r\n\tselector: '[data-custom-class-name] > *',\r\n\tattribute: 'class',\r\n};\r\n\r\n/**\r\n * Given an HTML string, returns an array of class names assigned to the root\r\n * element in the markup.\r\n *\r\n * @param {string} innerHTML Markup string from which to extract classes.\r\n *\r\n * @return {string[]} Array of class names assigned to the root element.\r\n */\r\nexport function getHTMLRootElementClasses( innerHTML ) {\r\n\tconst parsed = parseWithAttributeSchema(\r\n\t\t`<div data-custom-class-name>${ innerHTML }</div>`,\r\n\t\tCLASS_ATTR_SCHEMA\r\n\t);\r\n\r\n\treturn parsed ? parsed.trim().split( /\\s+/ ) : [];\r\n}\r\n\r\n/**\r\n * Given a parsed set of block attributes, if the block supports custom class\r\n * names and an unknown class (per the block's serialization behavior) is\r\n * found, the unknown classes are treated as custom classes. This prevents the\r\n * block from being considered as invalid.\r\n *\r\n * @param {Object} blockAttributes Original block attributes.\r\n * @param {Object} blockType       Block type settings.\r\n * @param {string} innerHTML       Original block markup.\r\n *\r\n * @return {Object} Filtered block attributes.\r\n */\r\nexport function fixCustomClassname( blockAttributes, blockType, innerHTML ) {\r\n\tif ( ! hasBlockSupport( blockType, 'customClassName', true ) ) {\r\n\t\treturn blockAttributes;\r\n\t}\r\n\r\n\tconst modifiedBlockAttributes = { ...blockAttributes };\r\n\t// To determine difference, serialize block given the known set of\r\n\t// attributes, with the exception of `className`. This will determine\r\n\t// the default set of classes. From there, any difference in innerHTML\r\n\t// can be considered as custom classes.\r\n\tconst { className: omittedClassName, ...attributesSansClassName } =\r\n\t\tmodifiedBlockAttributes;\r\n\tconst serialized = getSaveContent( blockType, attributesSansClassName );\r\n\tconst defaultClasses = getHTMLRootElementClasses( serialized );\r\n\tconst actualClasses = getHTMLRootElementClasses( innerHTML );\r\n\r\n\tconst customClasses = actualClasses.filter(\r\n\t\t( className ) => ! defaultClasses.includes( className )\r\n\t);\r\n\r\n\tif ( customClasses.length ) {\r\n\t\tmodifiedBlockAttributes.className = customClasses.join( ' ' );\r\n\t} else if ( serialized ) {\r\n\t\tdelete modifiedBlockAttributes.className;\r\n\t}\r\n\r\n\treturn modifiedBlockAttributes;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,eAAe,QAAQ,iBAAiB;AACjD,SAASC,cAAc,QAAQ,eAAe;AAC9C,SAASC,wBAAwB,QAAQ,wBAAwB;AAEjE,MAAMC,iBAAiB,GAAG;EACzBC,IAAI,EAAE,QAAQ;EACdC,MAAM,EAAE,WAAW;EACnBC,QAAQ,EAAE,8BAA8B;EACxCC,SAAS,EAAE;AACZ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,yBAAyBA,CAAEC,SAAS,EAAG;EACtD,MAAMC,MAAM,GAAGR,wBAAwB,CACrC,+BAA+BO,SAAW,QAAO,EAClDN,iBACD,CAAC;EAED,OAAOO,MAAM,GAAGA,MAAM,CAACC,IAAI,CAAC,CAAC,CAACC,KAAK,CAAE,KAAM,CAAC,GAAG,EAAE;AAClD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,kBAAkBA,CAAEC,eAAe,EAAEC,SAAS,EAAEN,SAAS,EAAG;EAC3E,IAAK,CAAET,eAAe,CAAEe,SAAS,EAAE,iBAAiB,EAAE,IAAK,CAAC,EAAG;IAC9D,OAAOD,eAAe;EACvB;EAEA,MAAME,uBAAuB,GAAG;IAAE,GAAGF;EAAgB,CAAC;EACtD;EACA;EACA;EACA;EACA,MAAM;IAAEG,SAAS,EAAEC,gBAAgB;IAAE,GAAGC;EAAwB,CAAC,GAChEH,uBAAuB;EACxB,MAAMI,UAAU,GAAGnB,cAAc,CAAEc,SAAS,EAAEI,uBAAwB,CAAC;EACvE,MAAME,cAAc,GAAGb,yBAAyB,CAAEY,UAAW,CAAC;EAC9D,MAAME,aAAa,GAAGd,yBAAyB,CAAEC,SAAU,CAAC;EAE5D,MAAMc,aAAa,GAAGD,aAAa,CAACE,MAAM,CACvCP,SAAS,IAAM,CAAEI,cAAc,CAACI,QAAQ,CAAER,SAAU,CACvD,CAAC;EAED,IAAKM,aAAa,CAACG,MAAM,EAAG;IAC3BV,uBAAuB,CAACC,SAAS,GAAGM,aAAa,CAACI,IAAI,CAAE,GAAI,CAAC;EAC9D,CAAC,MAAM,IAAKP,UAAU,EAAG;IACxB,OAAOJ,uBAAuB,CAACC,SAAS;EACzC;EAEA,OAAOD,uBAAuB;AAC/B","ignoreList":[]}