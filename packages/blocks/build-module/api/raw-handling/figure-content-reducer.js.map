{"version":3,"names":["isTextContent","isFigureContent","node","schema","_schema$figure$childr","tag","nodeName","toLowerCase","figure","children","canHaveAnchor","_schema$figure$childr2","a","wrapFigureContent","element","beforeElement","ownerDocument","createElement","parentNode","insertBefore","appendChild","figureContentReducer","doc","nodeToInsert","childNodes","length","wrapper","closest","classList","contains","textContent","trim"],"sources":["@wordpress/blocks/src/api/raw-handling/figure-content-reducer.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { isTextContent } from '@wordpress/dom';\r\n\r\n/**\r\n * Whether or not the given node is figure content.\r\n *\r\n * @param {Node}   node   The node to check.\r\n * @param {Object} schema The schema to use.\r\n *\r\n * @return {boolean} True if figure content, false if not.\r\n */\r\nfunction isFigureContent( node, schema ) {\r\n\tconst tag = node.nodeName.toLowerCase();\r\n\r\n\t// We are looking for tags that can be a child of the figure tag, excluding\r\n\t// `figcaption` and any phrasing content.\r\n\tif ( tag === 'figcaption' || isTextContent( node ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn tag in ( schema?.figure?.children ?? {} );\r\n}\r\n\r\n/**\r\n * Whether or not the given node can have an anchor.\r\n *\r\n * @param {Node}   node   The node to check.\r\n * @param {Object} schema The schema to use.\r\n *\r\n * @return {boolean} True if it can, false if not.\r\n */\r\nfunction canHaveAnchor( node, schema ) {\r\n\tconst tag = node.nodeName.toLowerCase();\r\n\r\n\treturn tag in ( schema?.figure?.children?.a?.children ?? {} );\r\n}\r\n\r\n/**\r\n * Wraps the given element in a figure element.\r\n *\r\n * @param {Element} element       The element to wrap.\r\n * @param {Element} beforeElement The element before which to place the figure.\r\n */\r\nfunction wrapFigureContent( element, beforeElement = element ) {\r\n\tconst figure = element.ownerDocument.createElement( 'figure' );\r\n\tbeforeElement.parentNode.insertBefore( figure, beforeElement );\r\n\tfigure.appendChild( element );\r\n}\r\n\r\n/**\r\n * This filter takes figure content out of paragraphs, wraps it in a figure\r\n * element, and moves any anchors with it if needed.\r\n *\r\n * @param {Node}     node   The node to filter.\r\n * @param {Document} doc    The document of the node.\r\n * @param {Object}   schema The schema to use.\r\n *\r\n * @return {void}\r\n */\r\nexport default function figureContentReducer( node, doc, schema ) {\r\n\tif ( ! isFigureContent( node, schema ) ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet nodeToInsert = node;\r\n\tconst parentNode = node.parentNode;\r\n\r\n\t// If the figure content can have an anchor and its parent is an anchor with\r\n\t// only the figure content, take the anchor out instead of just the content.\r\n\tif (\r\n\t\tcanHaveAnchor( node, schema ) &&\r\n\t\tparentNode.nodeName === 'A' &&\r\n\t\tparentNode.childNodes.length === 1\r\n\t) {\r\n\t\tnodeToInsert = node.parentNode;\r\n\t}\r\n\r\n\tconst wrapper = nodeToInsert.closest( 'p,div' );\r\n\r\n\t// If wrapped in a paragraph or div, only extract if it's aligned or if\r\n\t// there is no text content.\r\n\t// Otherwise, if directly at the root, wrap in a figure element.\r\n\tif ( wrapper ) {\r\n\t\t// In jsdom-jscore, 'node.classList' can be undefined.\r\n\t\t// In this case, default to extract as it offers a better UI experience on mobile.\r\n\t\tif ( ! node.classList ) {\r\n\t\t\twrapFigureContent( nodeToInsert, wrapper );\r\n\t\t} else if (\r\n\t\t\tnode.classList.contains( 'alignright' ) ||\r\n\t\t\tnode.classList.contains( 'alignleft' ) ||\r\n\t\t\tnode.classList.contains( 'aligncenter' ) ||\r\n\t\t\t! wrapper.textContent.trim()\r\n\t\t) {\r\n\t\t\twrapFigureContent( nodeToInsert, wrapper );\r\n\t\t}\r\n\t} else {\r\n\t\twrapFigureContent( nodeToInsert );\r\n\t}\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,aAAa,QAAQ,gBAAgB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,eAAeA,CAAEC,IAAI,EAAEC,MAAM,EAAG;EAAA,IAAAC,qBAAA;EACxC,MAAMC,GAAG,GAAGH,IAAI,CAACI,QAAQ,CAACC,WAAW,CAAC,CAAC;;EAEvC;EACA;EACA,IAAKF,GAAG,KAAK,YAAY,IAAIL,aAAa,CAAEE,IAAK,CAAC,EAAG;IACpD,OAAO,KAAK;EACb;EAEA,OAAOG,GAAG,MAAAD,qBAAA,GAAMD,MAAM,EAAEK,MAAM,EAAEC,QAAQ,cAAAL,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC,CAAE;AACjD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASM,aAAaA,CAAER,IAAI,EAAEC,MAAM,EAAG;EAAA,IAAAQ,sBAAA;EACtC,MAAMN,GAAG,GAAGH,IAAI,CAACI,QAAQ,CAACC,WAAW,CAAC,CAAC;EAEvC,OAAOF,GAAG,MAAAM,sBAAA,GAAMR,MAAM,EAAEK,MAAM,EAAEC,QAAQ,EAAEG,CAAC,EAAEH,QAAQ,cAAAE,sBAAA,cAAAA,sBAAA,GAAI,CAAC,CAAC,CAAE;AAC9D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAASE,iBAAiBA,CAAEC,OAAO,EAAEC,aAAa,GAAGD,OAAO,EAAG;EAC9D,MAAMN,MAAM,GAAGM,OAAO,CAACE,aAAa,CAACC,aAAa,CAAE,QAAS,CAAC;EAC9DF,aAAa,CAACG,UAAU,CAACC,YAAY,CAAEX,MAAM,EAAEO,aAAc,CAAC;EAC9DP,MAAM,CAACY,WAAW,CAAEN,OAAQ,CAAC;AAC9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASO,oBAAoBA,CAAEnB,IAAI,EAAEoB,GAAG,EAAEnB,MAAM,EAAG;EACjE,IAAK,CAAEF,eAAe,CAAEC,IAAI,EAAEC,MAAO,CAAC,EAAG;IACxC;EACD;EAEA,IAAIoB,YAAY,GAAGrB,IAAI;EACvB,MAAMgB,UAAU,GAAGhB,IAAI,CAACgB,UAAU;;EAElC;EACA;EACA,IACCR,aAAa,CAAER,IAAI,EAAEC,MAAO,CAAC,IAC7Be,UAAU,CAACZ,QAAQ,KAAK,GAAG,IAC3BY,UAAU,CAACM,UAAU,CAACC,MAAM,KAAK,CAAC,EACjC;IACDF,YAAY,GAAGrB,IAAI,CAACgB,UAAU;EAC/B;EAEA,MAAMQ,OAAO,GAAGH,YAAY,CAACI,OAAO,CAAE,OAAQ,CAAC;;EAE/C;EACA;EACA;EACA,IAAKD,OAAO,EAAG;IACd;IACA;IACA,IAAK,CAAExB,IAAI,CAAC0B,SAAS,EAAG;MACvBf,iBAAiB,CAAEU,YAAY,EAAEG,OAAQ,CAAC;IAC3C,CAAC,MAAM,IACNxB,IAAI,CAAC0B,SAAS,CAACC,QAAQ,CAAE,YAAa,CAAC,IACvC3B,IAAI,CAAC0B,SAAS,CAACC,QAAQ,CAAE,WAAY,CAAC,IACtC3B,IAAI,CAAC0B,SAAS,CAACC,QAAQ,CAAE,aAAc,CAAC,IACxC,CAAEH,OAAO,CAACI,WAAW,CAACC,IAAI,CAAC,CAAC,EAC3B;MACDlB,iBAAiB,CAAEU,YAAY,EAAEG,OAAQ,CAAC;IAC3C;EACD,CAAC,MAAM;IACNb,iBAAiB,CAAEU,YAAa,CAAC;EAClC;AACD","ignoreList":[]}