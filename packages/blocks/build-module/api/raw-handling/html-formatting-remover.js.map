{"version":3,"names":["getSibling","isFormattingSpace","character","htmlFormattingRemover","node","nodeType","TEXT_NODE","parent","parentNode","ELEMENT_NODE","nodeName","newData","data","replace","previousSibling","textContent","slice","length","nextSibling","removeChild"],"sources":["@wordpress/blocks/src/api/raw-handling/html-formatting-remover.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport { getSibling } from './utils';\r\n\r\nfunction isFormattingSpace( character ) {\r\n\treturn (\r\n\t\tcharacter === ' ' ||\r\n\t\tcharacter === '\\r' ||\r\n\t\tcharacter === '\\n' ||\r\n\t\tcharacter === '\\t'\r\n\t);\r\n}\r\n\r\n/**\r\n * Removes spacing that formats HTML.\r\n *\r\n * @see https://www.w3.org/TR/css-text-3/#white-space-processing\r\n *\r\n * @param {Node} node The node to be processed.\r\n * @return {void}\r\n */\r\nexport default function htmlFormattingRemover( node ) {\r\n\tif ( node.nodeType !== node.TEXT_NODE ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Ignore pre content. Note that this does not use Element#closest due to\r\n\t// a combination of (a) node may not be Element and (b) node.parentElement\r\n\t// does not have full support in all browsers (Internet Exporer).\r\n\t//\r\n\t// See: https://developer.mozilla.org/en-US/docs/Web/API/Node/parentElement#Browser_compatibility\r\n\r\n\t/** @type {Node?} */\r\n\tlet parent = node;\r\n\twhile ( ( parent = parent.parentNode ) ) {\r\n\t\tif (\r\n\t\t\tparent.nodeType === parent.ELEMENT_NODE &&\r\n\t\t\tparent.nodeName === 'PRE'\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t// First, replace any sequence of HTML formatting space with a single space.\r\n\tlet newData = node.data.replace( /[ \\r\\n\\t]+/g, ' ' );\r\n\r\n\t// Remove the leading space if the text element is at the start of a block,\r\n\t// is preceded by a line break element, or has a space in the previous\r\n\t// node.\r\n\tif ( newData[ 0 ] === ' ' ) {\r\n\t\tconst previousSibling = getSibling( node, 'previous' );\r\n\r\n\t\tif (\r\n\t\t\t! previousSibling ||\r\n\t\t\tpreviousSibling.nodeName === 'BR' ||\r\n\t\t\tpreviousSibling.textContent.slice( -1 ) === ' '\r\n\t\t) {\r\n\t\t\tnewData = newData.slice( 1 );\r\n\t\t}\r\n\t}\r\n\r\n\t// Remove the trailing space if the text element is at the end of a block,\r\n\t// is succeded by a line break element, or has a space in the next text\r\n\t// node.\r\n\tif ( newData[ newData.length - 1 ] === ' ' ) {\r\n\t\tconst nextSibling = getSibling( node, 'next' );\r\n\r\n\t\tif (\r\n\t\t\t! nextSibling ||\r\n\t\t\tnextSibling.nodeName === 'BR' ||\r\n\t\t\t( nextSibling.nodeType === nextSibling.TEXT_NODE &&\r\n\t\t\t\tisFormattingSpace( nextSibling.textContent[ 0 ] ) )\r\n\t\t) {\r\n\t\t\tnewData = newData.slice( 0, -1 );\r\n\t\t}\r\n\t}\r\n\r\n\t// If there's no data left, remove the node, so `previousSibling` stays\r\n\t// accurate. Otherwise, update the node data.\r\n\tif ( ! newData ) {\r\n\t\tnode.parentNode.removeChild( node );\r\n\t} else {\r\n\t\tnode.data = newData;\r\n\t}\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,UAAU,QAAQ,SAAS;AAEpC,SAASC,iBAAiBA,CAAEC,SAAS,EAAG;EACvC,OACCA,SAAS,KAAK,GAAG,IACjBA,SAAS,KAAK,IAAI,IAClBA,SAAS,KAAK,IAAI,IAClBA,SAAS,KAAK,IAAI;AAEpB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,qBAAqBA,CAAEC,IAAI,EAAG;EACrD,IAAKA,IAAI,CAACC,QAAQ,KAAKD,IAAI,CAACE,SAAS,EAAG;IACvC;EACD;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACA,IAAIC,MAAM,GAAGH,IAAI;EACjB,OAAUG,MAAM,GAAGA,MAAM,CAACC,UAAU,EAAK;IACxC,IACCD,MAAM,CAACF,QAAQ,KAAKE,MAAM,CAACE,YAAY,IACvCF,MAAM,CAACG,QAAQ,KAAK,KAAK,EACxB;MACD;IACD;EACD;;EAEA;EACA,IAAIC,OAAO,GAAGP,IAAI,CAACQ,IAAI,CAACC,OAAO,CAAE,aAAa,EAAE,GAAI,CAAC;;EAErD;EACA;EACA;EACA,IAAKF,OAAO,CAAE,CAAC,CAAE,KAAK,GAAG,EAAG;IAC3B,MAAMG,eAAe,GAAGd,UAAU,CAAEI,IAAI,EAAE,UAAW,CAAC;IAEtD,IACC,CAAEU,eAAe,IACjBA,eAAe,CAACJ,QAAQ,KAAK,IAAI,IACjCI,eAAe,CAACC,WAAW,CAACC,KAAK,CAAE,CAAC,CAAE,CAAC,KAAK,GAAG,EAC9C;MACDL,OAAO,GAAGA,OAAO,CAACK,KAAK,CAAE,CAAE,CAAC;IAC7B;EACD;;EAEA;EACA;EACA;EACA,IAAKL,OAAO,CAAEA,OAAO,CAACM,MAAM,GAAG,CAAC,CAAE,KAAK,GAAG,EAAG;IAC5C,MAAMC,WAAW,GAAGlB,UAAU,CAAEI,IAAI,EAAE,MAAO,CAAC;IAE9C,IACC,CAAEc,WAAW,IACbA,WAAW,CAACR,QAAQ,KAAK,IAAI,IAC3BQ,WAAW,CAACb,QAAQ,KAAKa,WAAW,CAACZ,SAAS,IAC/CL,iBAAiB,CAAEiB,WAAW,CAACH,WAAW,CAAE,CAAC,CAAG,CAAG,EACnD;MACDJ,OAAO,GAAGA,OAAO,CAACK,KAAK,CAAE,CAAC,EAAE,CAAC,CAAE,CAAC;IACjC;EACD;;EAEA;EACA;EACA,IAAK,CAAEL,OAAO,EAAG;IAChBP,IAAI,CAACI,UAAU,CAACW,WAAW,CAAEf,IAAK,CAAC;EACpC,CAAC,MAAM;IACNA,IAAI,CAACQ,IAAI,GAAGD,OAAO;EACpB;AACD","ignoreList":[]}