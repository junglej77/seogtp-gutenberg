{"version":3,"names":["createBlobURL","imageCorrector","node","nodeName","src","indexOf","properties","data","split","type","slice","decoded","atob","e","uint8Array","Uint8Array","length","i","charCodeAt","name","replace","file","window","File","height","width","parentNode","removeChild"],"sources":["@wordpress/blocks/src/api/raw-handling/image-corrector.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createBlobURL } from '@wordpress/blob';\r\n\r\nexport default function imageCorrector( node ) {\r\n\tif ( node.nodeName !== 'IMG' ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif ( node.src.indexOf( 'file:' ) === 0 ) {\r\n\t\tnode.src = '';\r\n\t}\r\n\r\n\t// This piece cannot be tested outside a browser env.\r\n\tif ( node.src.indexOf( 'data:' ) === 0 ) {\r\n\t\tconst [ properties, data ] = node.src.split( ',' );\r\n\t\tconst [ type ] = properties.slice( 5 ).split( ';' );\r\n\r\n\t\tif ( ! data || ! type ) {\r\n\t\t\tnode.src = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet decoded;\r\n\r\n\t\t// Can throw DOMException!\r\n\t\ttry {\r\n\t\t\tdecoded = atob( data );\r\n\t\t} catch ( e ) {\r\n\t\t\tnode.src = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst uint8Array = new Uint8Array( decoded.length );\r\n\r\n\t\tfor ( let i = 0; i < uint8Array.length; i++ ) {\r\n\t\t\tuint8Array[ i ] = decoded.charCodeAt( i );\r\n\t\t}\r\n\r\n\t\tconst name = type.replace( '/', '.' );\r\n\t\tconst file = new window.File( [ uint8Array ], name, { type } );\r\n\r\n\t\tnode.src = createBlobURL( file );\r\n\t}\r\n\r\n\t// Remove trackers and hardly visible images.\r\n\tif ( node.height === 1 || node.width === 1 ) {\r\n\t\tnode.parentNode.removeChild( node );\r\n\t}\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,aAAa,QAAQ,iBAAiB;AAE/C,eAAe,SAASC,cAAcA,CAAEC,IAAI,EAAG;EAC9C,IAAKA,IAAI,CAACC,QAAQ,KAAK,KAAK,EAAG;IAC9B;EACD;EAEA,IAAKD,IAAI,CAACE,GAAG,CAACC,OAAO,CAAE,OAAQ,CAAC,KAAK,CAAC,EAAG;IACxCH,IAAI,CAACE,GAAG,GAAG,EAAE;EACd;;EAEA;EACA,IAAKF,IAAI,CAACE,GAAG,CAACC,OAAO,CAAE,OAAQ,CAAC,KAAK,CAAC,EAAG;IACxC,MAAM,CAAEC,UAAU,EAAEC,IAAI,CAAE,GAAGL,IAAI,CAACE,GAAG,CAACI,KAAK,CAAE,GAAI,CAAC;IAClD,MAAM,CAAEC,IAAI,CAAE,GAAGH,UAAU,CAACI,KAAK,CAAE,CAAE,CAAC,CAACF,KAAK,CAAE,GAAI,CAAC;IAEnD,IAAK,CAAED,IAAI,IAAI,CAAEE,IAAI,EAAG;MACvBP,IAAI,CAACE,GAAG,GAAG,EAAE;MACb;IACD;IAEA,IAAIO,OAAO;;IAEX;IACA,IAAI;MACHA,OAAO,GAAGC,IAAI,CAAEL,IAAK,CAAC;IACvB,CAAC,CAAC,OAAQM,CAAC,EAAG;MACbX,IAAI,CAACE,GAAG,GAAG,EAAE;MACb;IACD;IAEA,MAAMU,UAAU,GAAG,IAAIC,UAAU,CAAEJ,OAAO,CAACK,MAAO,CAAC;IAEnD,KAAM,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,UAAU,CAACE,MAAM,EAAEC,CAAC,EAAE,EAAG;MAC7CH,UAAU,CAAEG,CAAC,CAAE,GAAGN,OAAO,CAACO,UAAU,CAAED,CAAE,CAAC;IAC1C;IAEA,MAAME,IAAI,GAAGV,IAAI,CAACW,OAAO,CAAE,GAAG,EAAE,GAAI,CAAC;IACrC,MAAMC,IAAI,GAAG,IAAIC,MAAM,CAACC,IAAI,CAAE,CAAET,UAAU,CAAE,EAAEK,IAAI,EAAE;MAAEV;IAAK,CAAE,CAAC;IAE9DP,IAAI,CAACE,GAAG,GAAGJ,aAAa,CAAEqB,IAAK,CAAC;EACjC;;EAEA;EACA,IAAKnB,IAAI,CAACsB,MAAM,KAAK,CAAC,IAAItB,IAAI,CAACuB,KAAK,KAAK,CAAC,EAAG;IAC5CvB,IAAI,CAACwB,UAAU,CAACC,WAAW,CAAEzB,IAAK,CAAC;EACpC;AACD","ignoreList":[]}