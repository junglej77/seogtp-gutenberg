{"version":3,"names":["isEmpty","isPhrasingContent","normaliseBlocks","HTML","options","decuDoc","document","implementation","createHTMLDocument","accuDoc","decu","body","accu","innerHTML","firstChild","node","nodeType","TEXT_NODE","removeChild","lastChild","nodeName","appendChild","createElement","ELEMENT_NODE","nextSibling","hasChildNodes","raw"],"sources":["@wordpress/blocks/src/api/raw-handling/normalise-blocks.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { isEmpty, isPhrasingContent } from '@wordpress/dom';\r\n\r\nexport default function normaliseBlocks( HTML, options = {} ) {\r\n\tconst decuDoc = document.implementation.createHTMLDocument( '' );\r\n\tconst accuDoc = document.implementation.createHTMLDocument( '' );\r\n\r\n\tconst decu = decuDoc.body;\r\n\tconst accu = accuDoc.body;\r\n\r\n\tdecu.innerHTML = HTML;\r\n\r\n\twhile ( decu.firstChild ) {\r\n\t\tconst node = decu.firstChild;\r\n\r\n\t\t// Text nodes: wrap in a paragraph, or append to previous.\r\n\t\tif ( node.nodeType === node.TEXT_NODE ) {\r\n\t\t\tif ( isEmpty( node ) ) {\r\n\t\t\t\tdecu.removeChild( node );\r\n\t\t\t} else {\r\n\t\t\t\tif ( ! accu.lastChild || accu.lastChild.nodeName !== 'P' ) {\r\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\r\n\t\t\t\t}\r\n\r\n\t\t\t\taccu.lastChild.appendChild( node );\r\n\t\t\t}\r\n\t\t\t// Element nodes.\r\n\t\t} else if ( node.nodeType === node.ELEMENT_NODE ) {\r\n\t\t\t// BR nodes: create a new paragraph on double, or append to previous.\r\n\t\t\tif ( node.nodeName === 'BR' ) {\r\n\t\t\t\tif ( node.nextSibling && node.nextSibling.nodeName === 'BR' ) {\r\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\r\n\t\t\t\t\tdecu.removeChild( node.nextSibling );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Don't append to an empty paragraph.\r\n\t\t\t\tif (\r\n\t\t\t\t\taccu.lastChild &&\r\n\t\t\t\t\taccu.lastChild.nodeName === 'P' &&\r\n\t\t\t\t\taccu.lastChild.hasChildNodes()\r\n\t\t\t\t) {\r\n\t\t\t\t\taccu.lastChild.appendChild( node );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdecu.removeChild( node );\r\n\t\t\t\t}\r\n\t\t\t} else if ( node.nodeName === 'P' ) {\r\n\t\t\t\t// Only append non-empty paragraph nodes.\r\n\t\t\t\tif ( isEmpty( node ) && ! options.raw ) {\r\n\t\t\t\t\tdecu.removeChild( node );\r\n\t\t\t\t} else {\r\n\t\t\t\t\taccu.appendChild( node );\r\n\t\t\t\t}\r\n\t\t\t} else if ( isPhrasingContent( node ) ) {\r\n\t\t\t\tif ( ! accu.lastChild || accu.lastChild.nodeName !== 'P' ) {\r\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\r\n\t\t\t\t}\r\n\t\t\t\taccu.lastChild.appendChild( node );\r\n\t\t\t} else {\r\n\t\t\t\taccu.appendChild( node );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdecu.removeChild( node );\r\n\t\t}\r\n\t}\r\n\r\n\treturn accu.innerHTML;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,OAAO,EAAEC,iBAAiB,QAAQ,gBAAgB;AAE3D,eAAe,SAASC,eAAeA,CAAEC,IAAI,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAG;EAC7D,MAAMC,OAAO,GAAGC,QAAQ,CAACC,cAAc,CAACC,kBAAkB,CAAE,EAAG,CAAC;EAChE,MAAMC,OAAO,GAAGH,QAAQ,CAACC,cAAc,CAACC,kBAAkB,CAAE,EAAG,CAAC;EAEhE,MAAME,IAAI,GAAGL,OAAO,CAACM,IAAI;EACzB,MAAMC,IAAI,GAAGH,OAAO,CAACE,IAAI;EAEzBD,IAAI,CAACG,SAAS,GAAGV,IAAI;EAErB,OAAQO,IAAI,CAACI,UAAU,EAAG;IACzB,MAAMC,IAAI,GAAGL,IAAI,CAACI,UAAU;;IAE5B;IACA,IAAKC,IAAI,CAACC,QAAQ,KAAKD,IAAI,CAACE,SAAS,EAAG;MACvC,IAAKjB,OAAO,CAAEe,IAAK,CAAC,EAAG;QACtBL,IAAI,CAACQ,WAAW,CAAEH,IAAK,CAAC;MACzB,CAAC,MAAM;QACN,IAAK,CAAEH,IAAI,CAACO,SAAS,IAAIP,IAAI,CAACO,SAAS,CAACC,QAAQ,KAAK,GAAG,EAAG;UAC1DR,IAAI,CAACS,WAAW,CAAEZ,OAAO,CAACa,aAAa,CAAE,GAAI,CAAE,CAAC;QACjD;QAEAV,IAAI,CAACO,SAAS,CAACE,WAAW,CAAEN,IAAK,CAAC;MACnC;MACA;IACD,CAAC,MAAM,IAAKA,IAAI,CAACC,QAAQ,KAAKD,IAAI,CAACQ,YAAY,EAAG;MACjD;MACA,IAAKR,IAAI,CAACK,QAAQ,KAAK,IAAI,EAAG;QAC7B,IAAKL,IAAI,CAACS,WAAW,IAAIT,IAAI,CAACS,WAAW,CAACJ,QAAQ,KAAK,IAAI,EAAG;UAC7DR,IAAI,CAACS,WAAW,CAAEZ,OAAO,CAACa,aAAa,CAAE,GAAI,CAAE,CAAC;UAChDZ,IAAI,CAACQ,WAAW,CAAEH,IAAI,CAACS,WAAY,CAAC;QACrC;;QAEA;QACA,IACCZ,IAAI,CAACO,SAAS,IACdP,IAAI,CAACO,SAAS,CAACC,QAAQ,KAAK,GAAG,IAC/BR,IAAI,CAACO,SAAS,CAACM,aAAa,CAAC,CAAC,EAC7B;UACDb,IAAI,CAACO,SAAS,CAACE,WAAW,CAAEN,IAAK,CAAC;QACnC,CAAC,MAAM;UACNL,IAAI,CAACQ,WAAW,CAAEH,IAAK,CAAC;QACzB;MACD,CAAC,MAAM,IAAKA,IAAI,CAACK,QAAQ,KAAK,GAAG,EAAG;QACnC;QACA,IAAKpB,OAAO,CAAEe,IAAK,CAAC,IAAI,CAAEX,OAAO,CAACsB,GAAG,EAAG;UACvChB,IAAI,CAACQ,WAAW,CAAEH,IAAK,CAAC;QACzB,CAAC,MAAM;UACNH,IAAI,CAACS,WAAW,CAAEN,IAAK,CAAC;QACzB;MACD,CAAC,MAAM,IAAKd,iBAAiB,CAAEc,IAAK,CAAC,EAAG;QACvC,IAAK,CAAEH,IAAI,CAACO,SAAS,IAAIP,IAAI,CAACO,SAAS,CAACC,QAAQ,KAAK,GAAG,EAAG;UAC1DR,IAAI,CAACS,WAAW,CAAEZ,OAAO,CAACa,aAAa,CAAE,GAAI,CAAE,CAAC;QACjD;QACAV,IAAI,CAACO,SAAS,CAACE,WAAW,CAAEN,IAAK,CAAC;MACnC,CAAC,MAAM;QACNH,IAAI,CAACS,WAAW,CAAEN,IAAK,CAAC;MACzB;IACD,CAAC,MAAM;MACNL,IAAI,CAACQ,WAAW,CAAEH,IAAK,CAAC;IACzB;EACD;EAEA,OAAOH,IAAI,CAACC,SAAS;AACtB","ignoreList":[]}