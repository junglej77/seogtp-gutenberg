{"version":3,"names":["remove","replace","specialCommentConverter","node","doc","nodeType","COMMENT_NODE","nodeValue","indexOf","block","createBlock","parentNode","nodeName","childNodes","Array","from","nodeIndex","wrapperNode","body","paragraphBuilder","acc","child","createElement","appendChild","slice","reduce","forEach","element","insertBefore","commentNode","createNextpage","customText","trim","sibling","noTeaser","nextSibling","createMore","dataset"],"sources":["@wordpress/blocks/src/api/raw-handling/special-comment-converter.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { remove, replace } from '@wordpress/dom';\r\n\r\n/**\r\n * Looks for `<!--nextpage-->` and `<!--more-->` comments and\r\n * replaces them with a custom element representing a future block.\r\n *\r\n * The custom element is a way to bypass the rest of the `raw-handling`\r\n * transforms, which would eliminate other kinds of node with which to carry\r\n * `<!--more-->`'s data: nodes with `data` attributes, empty paragraphs, etc.\r\n *\r\n * The custom element is then expected to be recognized by any registered\r\n * block's `raw` transform.\r\n *\r\n * @param {Node}     node The node to be processed.\r\n * @param {Document} doc  The document of the node.\r\n * @return {void}\r\n */\r\nexport default function specialCommentConverter( node, doc ) {\r\n\tif ( node.nodeType !== node.COMMENT_NODE ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (\r\n\t\tnode.nodeValue !== 'nextpage' &&\r\n\t\tnode.nodeValue.indexOf( 'more' ) !== 0\r\n\t) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst block = createBlock( node, doc );\r\n\r\n\t// If our `<!--more-->` comment is in the middle of a paragraph, we should\r\n\t// split the paragraph in two and insert the more block in between. If it's\r\n\t// inside an empty paragraph, we should still move it out of the paragraph\r\n\t// and remove the paragraph. If there's no paragraph, fall back to simply\r\n\t// replacing the comment.\r\n\tif ( ! node.parentNode || node.parentNode.nodeName !== 'P' ) {\r\n\t\treplace( node, block );\r\n\t} else {\r\n\t\tconst childNodes = Array.from( node.parentNode.childNodes );\r\n\t\tconst nodeIndex = childNodes.indexOf( node );\r\n\t\tconst wrapperNode = node.parentNode.parentNode || doc.body;\r\n\r\n\t\tconst paragraphBuilder = ( acc, child ) => {\r\n\t\t\tif ( ! acc ) {\r\n\t\t\t\tacc = doc.createElement( 'p' );\r\n\t\t\t}\r\n\r\n\t\t\tacc.appendChild( child );\r\n\r\n\t\t\treturn acc;\r\n\t\t};\r\n\r\n\t\t// Split the original parent node and insert our more block\r\n\t\t[\r\n\t\t\tchildNodes.slice( 0, nodeIndex ).reduce( paragraphBuilder, null ),\r\n\t\t\tblock,\r\n\t\t\tchildNodes.slice( nodeIndex + 1 ).reduce( paragraphBuilder, null ),\r\n\t\t].forEach(\r\n\t\t\t( element ) =>\r\n\t\t\t\telement && wrapperNode.insertBefore( element, node.parentNode )\r\n\t\t);\r\n\r\n\t\t// Remove the old parent paragraph\r\n\t\tremove( node.parentNode );\r\n\t}\r\n}\r\n\r\nfunction createBlock( commentNode, doc ) {\r\n\tif ( commentNode.nodeValue === 'nextpage' ) {\r\n\t\treturn createNextpage( doc );\r\n\t}\r\n\r\n\t// Grab any custom text in the comment.\r\n\tconst customText = commentNode.nodeValue.slice( 4 ).trim();\r\n\r\n\t/*\r\n\t * When a `<!--more-->` comment is found, we need to look for any\r\n\t * `<!--noteaser-->` sibling, but it may not be a direct sibling\r\n\t * (whitespace typically lies in between)\r\n\t */\r\n\tlet sibling = commentNode;\r\n\tlet noTeaser = false;\r\n\twhile ( ( sibling = sibling.nextSibling ) ) {\r\n\t\tif (\r\n\t\t\tsibling.nodeType === sibling.COMMENT_NODE &&\r\n\t\t\tsibling.nodeValue === 'noteaser'\r\n\t\t) {\r\n\t\t\tnoTeaser = true;\r\n\t\t\tremove( sibling );\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn createMore( customText, noTeaser, doc );\r\n}\r\n\r\nfunction createMore( customText, noTeaser, doc ) {\r\n\tconst node = doc.createElement( 'wp-block' );\r\n\tnode.dataset.block = 'core/more';\r\n\tif ( customText ) {\r\n\t\tnode.dataset.customText = customText;\r\n\t}\r\n\tif ( noTeaser ) {\r\n\t\t// \"Boolean\" data attribute.\r\n\t\tnode.dataset.noTeaser = '';\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nfunction createNextpage( doc ) {\r\n\tconst node = doc.createElement( 'wp-block' );\r\n\tnode.dataset.block = 'core/nextpage';\r\n\r\n\treturn node;\r\n}\r\n"],"mappings":"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","ignoreList":[]}