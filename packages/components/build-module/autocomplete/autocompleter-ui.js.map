{"version":3,"names":["clsx","useLayoutEffect","useRef","useEffect","useState","useAnchor","useDebounce","useMergeRefs","useRefEffect","speak","__","_n","sprintf","getDefaultUseItems","Button","Popover","VisuallyHidden","createPortal","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ListBox","items","onSelect","selectedIndex","instanceId","listBoxId","className","Component","id","role","children","map","option","index","key","accessibleWhenDisabled","disabled","isDisabled","variant","undefined","onClick","label","getAutoCompleterUI","autocompleter","_autocompleter$useIte","useItems","AutocompleterUI","filterValue","onChangeOptions","onReset","reset","contentRef","popoverAnchor","editableContentElement","current","needsA11yCompat","setNeedsA11yCompat","popoverRef","popoverRefs","node","ownerDocument","useOnClickOutside","debouncedSpeak","announce","options","length","focusOnMount","onClose","placement","anchor","ref","body","handler","listener","event","contains","target","document","addEventListener","removeEventListener"],"sources":["@wordpress/components/src/autocomplete/autocompleter-ui.tsx"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tuseLayoutEffect,\r\n\tuseRef,\r\n\tuseEffect,\r\n\tuseState,\r\n} from '@wordpress/element';\r\nimport { useAnchor } from '@wordpress/rich-text';\r\nimport { useDebounce, useMergeRefs, useRefEffect } from '@wordpress/compose';\r\nimport { speak } from '@wordpress/a11y';\r\nimport { __, _n, sprintf } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport getDefaultUseItems from './get-default-use-items';\r\nimport Button from '../button';\r\nimport Popover from '../popover';\r\nimport { VisuallyHidden } from '../visually-hidden';\r\nimport { createPortal } from 'react-dom';\r\nimport type { AutocompleterUIProps, KeyedOption, WPCompleter } from './types';\r\n\r\ntype ListBoxProps = {\r\n\titems: KeyedOption[];\r\n\tonSelect: ( option: KeyedOption ) => void;\r\n\tselectedIndex: number;\r\n\tinstanceId: number;\r\n\tlistBoxId: string | undefined;\r\n\tclassName?: string;\r\n\tComponent?: React.ElementType;\r\n};\r\n\r\nfunction ListBox( {\r\n\titems,\r\n\tonSelect,\r\n\tselectedIndex,\r\n\tinstanceId,\r\n\tlistBoxId,\r\n\tclassName,\r\n\tComponent = 'div',\r\n}: ListBoxProps ) {\r\n\treturn (\r\n\t\t<Component\r\n\t\t\tid={ listBoxId }\r\n\t\t\trole=\"listbox\"\r\n\t\t\tclassName=\"components-autocomplete__results\"\r\n\t\t>\r\n\t\t\t{ items.map( ( option, index ) => (\r\n\t\t\t\t<Button\r\n\t\t\t\t\tkey={ option.key }\r\n\t\t\t\t\tid={ `components-autocomplete-item-${ instanceId }-${ option.key }` }\r\n\t\t\t\t\trole=\"option\"\r\n\t\t\t\t\taria-selected={ index === selectedIndex }\r\n\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t\tdisabled={ option.isDisabled }\r\n\t\t\t\t\tclassName={ clsx(\r\n\t\t\t\t\t\t'components-autocomplete__result',\r\n\t\t\t\t\t\tclassName,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// Unused, for backwards compatibility.\r\n\t\t\t\t\t\t\t'is-selected': index === selectedIndex,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t) }\r\n\t\t\t\t\tvariant={ index === selectedIndex ? 'primary' : undefined }\r\n\t\t\t\t\tonClick={ () => onSelect( option ) }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ option.label }\r\n\t\t\t\t</Button>\r\n\t\t\t) ) }\r\n\t\t</Component>\r\n\t);\r\n}\r\n\r\nexport function getAutoCompleterUI( autocompleter: WPCompleter ) {\r\n\tconst useItems =\r\n\t\tautocompleter.useItems ?? getDefaultUseItems( autocompleter );\r\n\r\n\tfunction AutocompleterUI( {\r\n\t\tfilterValue,\r\n\t\tinstanceId,\r\n\t\tlistBoxId,\r\n\t\tclassName,\r\n\t\tselectedIndex,\r\n\t\tonChangeOptions,\r\n\t\tonSelect,\r\n\t\tonReset,\r\n\t\treset,\r\n\t\tcontentRef,\r\n\t}: AutocompleterUIProps ) {\r\n\t\tconst [ items ] = useItems( filterValue );\r\n\t\tconst popoverAnchor = useAnchor( {\r\n\t\t\teditableContentElement: contentRef.current,\r\n\t\t} );\r\n\r\n\t\tconst [ needsA11yCompat, setNeedsA11yCompat ] = useState( false );\r\n\t\tconst popoverRef = useRef< HTMLElement >( null );\r\n\t\tconst popoverRefs = useMergeRefs( [\r\n\t\t\tpopoverRef,\r\n\t\t\tuseRefEffect(\r\n\t\t\t\t( node ) => {\r\n\t\t\t\t\tif ( ! contentRef.current ) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the popover is rendered in a different document than\r\n\t\t\t\t\t// the content, we need to duplicate the options list in the\r\n\t\t\t\t\t// content document so that it's available to the screen\r\n\t\t\t\t\t// readers, which check the DOM ID based aria-* attributes.\r\n\t\t\t\t\tsetNeedsA11yCompat(\r\n\t\t\t\t\t\tnode.ownerDocument !== contentRef.current.ownerDocument\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\t[ contentRef ]\r\n\t\t\t),\r\n\t\t] );\r\n\r\n\t\tuseOnClickOutside( popoverRef, reset );\r\n\r\n\t\tconst debouncedSpeak = useDebounce( speak, 500 );\r\n\r\n\t\tfunction announce( options: Array< KeyedOption > ) {\r\n\t\t\tif ( ! debouncedSpeak ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( !! options.length ) {\r\n\t\t\t\tif ( filterValue ) {\r\n\t\t\t\t\tdebouncedSpeak(\r\n\t\t\t\t\t\tsprintf(\r\n\t\t\t\t\t\t\t/* translators: %d: number of results. */\r\n\t\t\t\t\t\t\t_n(\r\n\t\t\t\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\r\n\t\t\t\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\r\n\t\t\t\t\t\t\t\toptions.length\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\toptions.length\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t'assertive'\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdebouncedSpeak(\r\n\t\t\t\t\t\tsprintf(\r\n\t\t\t\t\t\t\t/* translators: %d: number of results. */\r\n\t\t\t\t\t\t\t_n(\r\n\t\t\t\t\t\t\t\t'Initial %d result loaded. Type to filter all available results. Use up and down arrow keys to navigate.',\r\n\t\t\t\t\t\t\t\t'Initial %d results loaded. Type to filter all available results. Use up and down arrow keys to navigate.',\r\n\t\t\t\t\t\t\t\toptions.length\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\toptions.length\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t'assertive'\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdebouncedSpeak( __( 'No results.' ), 'assertive' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tuseLayoutEffect( () => {\r\n\t\t\tonChangeOptions( items );\r\n\t\t\tannounce( items );\r\n\t\t\t// Temporarily disabling exhaustive-deps to avoid introducing unexpected side effecst.\r\n\t\t\t// See https://github.com/WordPress/gutenberg/pull/41820\r\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t\t}, [ items ] );\r\n\r\n\t\tif ( items.length === 0 ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<Popover\r\n\t\t\t\t\tfocusOnMount={ false }\r\n\t\t\t\t\tonClose={ onReset }\r\n\t\t\t\t\tplacement=\"top-start\"\r\n\t\t\t\t\tclassName=\"components-autocomplete__popover\"\r\n\t\t\t\t\tanchor={ popoverAnchor }\r\n\t\t\t\t\tref={ popoverRefs }\r\n\t\t\t\t>\r\n\t\t\t\t\t<ListBox\r\n\t\t\t\t\t\titems={ items }\r\n\t\t\t\t\t\tonSelect={ onSelect }\r\n\t\t\t\t\t\tselectedIndex={ selectedIndex }\r\n\t\t\t\t\t\tinstanceId={ instanceId }\r\n\t\t\t\t\t\tlistBoxId={ listBoxId }\r\n\t\t\t\t\t\tclassName={ className }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Popover>\r\n\t\t\t\t{ contentRef.current &&\r\n\t\t\t\t\tneedsA11yCompat &&\r\n\t\t\t\t\tcreatePortal(\r\n\t\t\t\t\t\t<ListBox\r\n\t\t\t\t\t\t\titems={ items }\r\n\t\t\t\t\t\t\tonSelect={ onSelect }\r\n\t\t\t\t\t\t\tselectedIndex={ selectedIndex }\r\n\t\t\t\t\t\t\tinstanceId={ instanceId }\r\n\t\t\t\t\t\t\tlistBoxId={ listBoxId }\r\n\t\t\t\t\t\t\tclassName={ className }\r\n\t\t\t\t\t\t\tComponent={ VisuallyHidden }\r\n\t\t\t\t\t\t/>,\r\n\t\t\t\t\t\tcontentRef.current.ownerDocument.body\r\n\t\t\t\t\t) }\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\treturn AutocompleterUI;\r\n}\r\n\r\nfunction useOnClickOutside(\r\n\tref: React.RefObject< HTMLElement >,\r\n\thandler: AutocompleterUIProps[ 'reset' ]\r\n) {\r\n\tuseEffect( () => {\r\n\t\tconst listener = ( event: MouseEvent | TouchEvent ) => {\r\n\t\t\t// Do nothing if clicking ref's element or descendent elements, or if the ref is not referencing an element\r\n\t\t\tif (\r\n\t\t\t\t! ref.current ||\r\n\t\t\t\tref.current.contains( event.target as Node )\r\n\t\t\t) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\thandler( event );\r\n\t\t};\r\n\t\tdocument.addEventListener( 'mousedown', listener );\r\n\t\tdocument.addEventListener( 'touchstart', listener );\r\n\t\treturn () => {\r\n\t\t\tdocument.removeEventListener( 'mousedown', listener );\r\n\t\t\tdocument.removeEventListener( 'touchstart', listener );\r\n\t\t};\r\n\t\t// Disable reason: `ref` is a ref object and should not be included in a\r\n\t\t// hook's dependency list.\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [ handler ] );\r\n}\r\n"],"mappings":"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","ignoreList":[]}