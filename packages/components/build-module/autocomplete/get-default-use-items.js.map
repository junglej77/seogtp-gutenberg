{"version":3,"names":["removeAccents","debounce","useLayoutEffect","useState","escapeRegExp","filterOptions","search","options","maxResults","filtered","i","length","option","keywords","label","isMatch","some","keyword","test","push","getDefaultUseItems","autocompleter","filterValue","items","setItems","isDebounced","loadOptions","promise","Promise","resolve","then","optionsData","canceled","keyedOptions","map","optionData","optionIndex","key","name","value","getOptionLabel","getOptionKeywords","isDisabled","isOptionDisabled","RegExp","cancel"],"sources":["@wordpress/components/src/autocomplete/get-default-use-items.tsx"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport removeAccents from 'remove-accents';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { debounce } from '@wordpress/compose';\r\nimport { useLayoutEffect, useState } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { escapeRegExp } from '../utils/strings';\r\nimport type { CancelablePromise, KeyedOption, WPCompleter } from './types';\r\n\r\nfunction filterOptions(\r\n\tsearch: RegExp,\r\n\toptions: Array< KeyedOption > = [],\r\n\tmaxResults = 10\r\n) {\r\n\tconst filtered = [];\r\n\tfor ( let i = 0; i < options.length; i++ ) {\r\n\t\tconst option = options[ i ];\r\n\r\n\t\t// Merge label into keywords.\r\n\t\tlet { keywords = [] } = option;\r\n\t\tif ( 'string' === typeof option.label ) {\r\n\t\t\tkeywords = [ ...keywords, option.label ];\r\n\t\t}\r\n\r\n\t\tconst isMatch = keywords.some( ( keyword ) =>\r\n\t\t\tsearch.test( removeAccents( keyword ) )\r\n\t\t);\r\n\t\tif ( ! isMatch ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tfiltered.push( option );\r\n\r\n\t\t// Abort early if max reached.\r\n\t\tif ( filtered.length === maxResults ) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn filtered;\r\n}\r\n\r\nexport default function getDefaultUseItems( autocompleter: WPCompleter ) {\r\n\treturn ( filterValue: string ) => {\r\n\t\tconst [ items, setItems ] = useState< Array< KeyedOption > >( [] );\r\n\t\t/*\r\n\t\t * We support both synchronous and asynchronous retrieval of completer options\r\n\t\t * but internally treat all as async so we maintain a single, consistent code path.\r\n\t\t *\r\n\t\t * Because networks can be slow, and the internet is wonderfully unpredictable,\r\n\t\t * we don't want two promises updating the state at once. This ensures that only\r\n\t\t * the most recent promise will act on `optionsData`. This doesn't use the state\r\n\t\t * because `setState` is batched, and so there's no guarantee that setting\r\n\t\t * `activePromise` in the state would result in it actually being in `this.state`\r\n\t\t * before the promise resolves and we check to see if this is the active promise or not.\r\n\t\t */\r\n\t\tuseLayoutEffect( () => {\r\n\t\t\tconst { options, isDebounced } = autocompleter;\r\n\t\t\tconst loadOptions = debounce(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tconst promise: CancelablePromise = Promise.resolve(\r\n\t\t\t\t\t\ttypeof options === 'function'\r\n\t\t\t\t\t\t\t? options( filterValue )\r\n\t\t\t\t\t\t\t: options\r\n\t\t\t\t\t).then( ( optionsData ) => {\r\n\t\t\t\t\t\tif ( promise.canceled ) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst keyedOptions = optionsData.map(\r\n\t\t\t\t\t\t\t( optionData, optionIndex ) => ( {\r\n\t\t\t\t\t\t\t\tkey: `${ autocompleter.name }-${ optionIndex }`,\r\n\t\t\t\t\t\t\t\tvalue: optionData,\r\n\t\t\t\t\t\t\t\tlabel: autocompleter.getOptionLabel(\r\n\t\t\t\t\t\t\t\t\toptionData\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\tkeywords: autocompleter.getOptionKeywords\r\n\t\t\t\t\t\t\t\t\t? autocompleter.getOptionKeywords(\r\n\t\t\t\t\t\t\t\t\t\t\toptionData\r\n\t\t\t\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t\t\t\t: [],\r\n\t\t\t\t\t\t\t\tisDisabled: autocompleter.isOptionDisabled\r\n\t\t\t\t\t\t\t\t\t? autocompleter.isOptionDisabled(\r\n\t\t\t\t\t\t\t\t\t\t\toptionData\r\n\t\t\t\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t\t\t\t: false,\r\n\t\t\t\t\t\t\t} )\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t// Create a regular expression to filter the options.\r\n\t\t\t\t\t\tconst search = new RegExp(\r\n\t\t\t\t\t\t\t'(?:\\\\b|\\\\s|^)' + escapeRegExp( filterValue ),\r\n\t\t\t\t\t\t\t'i'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tsetItems( filterOptions( search, keyedOptions ) );\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\treturn promise;\r\n\t\t\t\t},\r\n\t\t\t\tisDebounced ? 250 : 0\r\n\t\t\t);\r\n\r\n\t\t\tconst promise = loadOptions();\r\n\r\n\t\t\treturn () => {\r\n\t\t\t\tloadOptions.cancel();\r\n\t\t\t\tif ( promise ) {\r\n\t\t\t\t\tpromise.canceled = true;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}, [ filterValue ] );\r\n\r\n\t\treturn [ items ] as const;\r\n\t};\r\n}\r\n"],"mappings":"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","ignoreList":[]}