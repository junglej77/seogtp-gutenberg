{"version":3,"names":["gradientParser","colord","extend","namesPlugin","DEFAULT_GRADIENT","HORIZONTAL_GRADIENT_ORIENTATION","DIRECTIONAL_ORIENTATION_ANGLE_MAP","serializeGradient","getLinearGradientRepresentation","gradientAST","type","orientation","colorStops","hasUnsupportedLength","item","length","undefined","getGradientAstWithDefault","value","hasGradient","valueToParse","parse","error","console","warn","Array","isArray","toString","some","step","forEach","stop","index","getGradientAstWithControlPoints","newControlPoints","map","position","color","r","g","b","a","toRgb","getStopCssColor","colorStop","join"],"sources":["@wordpress/components/src/custom-gradient-picker/utils.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport gradientParser from 'gradient-parser';\r\nimport { colord, extend } from 'colord';\r\nimport namesPlugin from 'colord/plugins/names';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport {\r\n\tDEFAULT_GRADIENT,\r\n\tHORIZONTAL_GRADIENT_ORIENTATION,\r\n\tDIRECTIONAL_ORIENTATION_ANGLE_MAP,\r\n} from './constants';\r\nimport { serializeGradient } from './serializer';\r\nimport type { ControlPoint } from './types';\r\n\r\nextend( [ namesPlugin ] );\r\n\r\nexport function getLinearGradientRepresentation(\r\n\tgradientAST: gradientParser.GradientNode\r\n) {\r\n\treturn serializeGradient( {\r\n\t\ttype: 'linear-gradient',\r\n\t\torientation: HORIZONTAL_GRADIENT_ORIENTATION,\r\n\t\tcolorStops: gradientAST.colorStops,\r\n\t} );\r\n}\r\n\r\nfunction hasUnsupportedLength( item: gradientParser.ColorStop ) {\r\n\treturn item.length === undefined || item.length.type !== '%';\r\n}\r\n\r\nexport function getGradientAstWithDefault( value?: string | null ) {\r\n\t// gradientAST will contain the gradient AST as parsed by gradient-parser npm module.\r\n\t// More information of its structure available at https://www.npmjs.com/package/gradient-parser#ast.\r\n\tlet gradientAST: gradientParser.GradientNode | undefined;\r\n\tlet hasGradient = !! value;\r\n\r\n\tconst valueToParse = value ?? DEFAULT_GRADIENT;\r\n\r\n\ttry {\r\n\t\tgradientAST = gradientParser.parse( valueToParse )[ 0 ];\r\n\t} catch ( error ) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.warn(\r\n\t\t\t'wp.components.CustomGradientPicker failed to parse the gradient with error',\r\n\t\t\terror\r\n\t\t);\r\n\r\n\t\tgradientAST = gradientParser.parse( DEFAULT_GRADIENT )[ 0 ];\r\n\t\thasGradient = false;\r\n\t}\r\n\r\n\tif (\r\n\t\t! Array.isArray( gradientAST.orientation ) &&\r\n\t\tgradientAST.orientation?.type === 'directional'\r\n\t) {\r\n\t\tgradientAST.orientation = {\r\n\t\t\ttype: 'angular',\r\n\t\t\tvalue: DIRECTIONAL_ORIENTATION_ANGLE_MAP[\r\n\t\t\t\tgradientAST.orientation.value\r\n\t\t\t].toString(),\r\n\t\t};\r\n\t}\r\n\r\n\tif ( gradientAST.colorStops.some( hasUnsupportedLength ) ) {\r\n\t\tconst { colorStops } = gradientAST;\r\n\t\tconst step = 100 / ( colorStops.length - 1 );\r\n\t\tcolorStops.forEach( ( stop, index ) => {\r\n\t\t\tstop.length = {\r\n\t\t\t\tvalue: `${ step * index }`,\r\n\t\t\t\ttype: '%',\r\n\t\t\t};\r\n\t\t} );\r\n\t}\r\n\r\n\treturn { gradientAST, hasGradient };\r\n}\r\n\r\nexport function getGradientAstWithControlPoints(\r\n\tgradientAST: gradientParser.GradientNode,\r\n\tnewControlPoints: ControlPoint[]\r\n) {\r\n\treturn {\r\n\t\t...gradientAST,\r\n\t\tcolorStops: newControlPoints.map( ( { position, color } ) => {\r\n\t\t\tconst { r, g, b, a } = colord( color ).toRgb();\r\n\t\t\treturn {\r\n\t\t\t\tlength: {\r\n\t\t\t\t\ttype: '%',\r\n\t\t\t\t\tvalue: position?.toString(),\r\n\t\t\t\t},\r\n\t\t\t\ttype: a < 1 ? 'rgba' : 'rgb',\r\n\t\t\t\tvalue:\r\n\t\t\t\t\ta < 1\r\n\t\t\t\t\t\t? [ `${ r }`, `${ g }`, `${ b }`, `${ a }` ]\r\n\t\t\t\t\t\t: [ `${ r }`, `${ g }`, `${ b }` ],\r\n\t\t\t};\r\n\t\t} ),\r\n\t} as gradientParser.GradientNode;\r\n}\r\n\r\nexport function getStopCssColor( colorStop: gradientParser.ColorStop ) {\r\n\tswitch ( colorStop.type ) {\r\n\t\tcase 'hex':\r\n\t\t\treturn `#${ colorStop.value }`;\r\n\t\tcase 'literal':\r\n\t\t\treturn colorStop.value;\r\n\t\tcase 'rgb':\r\n\t\tcase 'rgba':\r\n\t\t\treturn `${ colorStop.type }(${ colorStop.value.join( ',' ) })`;\r\n\t\tdefault:\r\n\t\t\t// Should be unreachable if passing an AST from gradient-parser.\r\n\t\t\t// See https://github.com/rafaelcaricio/gradient-parser#ast.\r\n\t\t\treturn 'transparent';\r\n\t}\r\n}\r\n"],"mappings":"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","ignoreList":[]}