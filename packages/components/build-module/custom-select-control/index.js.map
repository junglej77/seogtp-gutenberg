{"version":3,"names":["Ariakit","clsx","useInstanceId","__","sprintf","_CustomSelect","CustomSelectItem","Styled","VisuallyHidden","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","useDeprecatedProps","__experimentalShowSelectedHint","otherProps","showSelectedHint","applyOptionDeprecations","__experimentalHint","rest","hint","getDescribedBy","currentValue","describedBy","CustomSelectControl","props","__next40pxDefaultSize","options","onChange","size","value","className","classNameProp","restProps","descriptionId","store","useSelectStore","setValue","nextValue","nextOption","find","item","name","Promise","resolve","state","getState","changeObject","highlightedIndex","renderedItems","findIndex","inputValue","isOpen","open","selectedItem","type","defaultValue","children","map","key","style","withHint","WithHintItemWrapper","WithHintItemHint","renderSelectedValueHint","selectedOptionHint","SelectedExperimentalHintWrapper","SelectedExperimentalHintItem","translatedSize","renderSelectedValue","undefined","isLegacy","id"],"sources":["@wordpress/components/src/custom-select-control/index.tsx"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport * as Ariakit from '@ariakit/react';\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useInstanceId } from '@wordpress/compose';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport _CustomSelect from '../custom-select-control-v2/custom-select';\r\nimport CustomSelectItem from '../custom-select-control-v2/item';\r\nimport * as Styled from '../custom-select-control-v2/styles';\r\nimport type { CustomSelectProps, CustomSelectOption } from './types';\r\nimport { VisuallyHidden } from '../visually-hidden';\r\n\r\nfunction useDeprecatedProps< T extends CustomSelectOption >( {\r\n\t__experimentalShowSelectedHint,\r\n\t...otherProps\r\n}: CustomSelectProps< T > ) {\r\n\treturn {\r\n\t\tshowSelectedHint: __experimentalShowSelectedHint,\r\n\t\t...otherProps,\r\n\t};\r\n}\r\n\r\n// The removal of `__experimentalHint` in favour of `hint` doesn't happen in\r\n// the `useDeprecatedProps` hook in order not to break consumers that rely\r\n// on object identity (see https://github.com/WordPress/gutenberg/pull/63248#discussion_r1672213131)\r\nfunction applyOptionDeprecations( {\r\n\t__experimentalHint,\r\n\t...rest\r\n}: CustomSelectOption ) {\r\n\treturn {\r\n\t\thint: __experimentalHint,\r\n\t\t...rest,\r\n\t};\r\n}\r\n\r\nfunction getDescribedBy( currentValue: string, describedBy?: string ) {\r\n\tif ( describedBy ) {\r\n\t\treturn describedBy;\r\n\t}\r\n\r\n\t// translators: %s: The selected option.\r\n\treturn sprintf( __( 'Currently selected: %s' ), currentValue );\r\n}\r\n\r\nfunction CustomSelectControl< T extends CustomSelectOption >(\r\n\tprops: CustomSelectProps< T >\r\n) {\r\n\tconst {\r\n\t\t__next40pxDefaultSize = false,\r\n\t\tdescribedBy,\r\n\t\toptions,\r\n\t\tonChange,\r\n\t\tsize = 'default',\r\n\t\tvalue,\r\n\t\tclassName: classNameProp,\r\n\t\tshowSelectedHint = false,\r\n\t\t...restProps\r\n\t} = useDeprecatedProps( props );\r\n\r\n\tconst descriptionId = useInstanceId(\r\n\t\tCustomSelectControl,\r\n\t\t'custom-select-control__description'\r\n\t);\r\n\r\n\t// Forward props + store from v2 implementation\r\n\tconst store = Ariakit.useSelectStore< string >( {\r\n\t\tasync setValue( nextValue ) {\r\n\t\t\tconst nextOption = options.find(\r\n\t\t\t\t( item ) => item.name === nextValue\r\n\t\t\t);\r\n\r\n\t\t\tif ( ! onChange || ! nextOption ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Executes the logic in a microtask after the popup is closed.\r\n\t\t\t// This is simply to ensure the isOpen state matches the one from the\r\n\t\t\t// previous legacy implementation.\r\n\t\t\tawait Promise.resolve();\r\n\t\t\tconst state = store.getState();\r\n\r\n\t\t\tconst changeObject = {\r\n\t\t\t\thighlightedIndex: state.renderedItems.findIndex(\r\n\t\t\t\t\t( item ) => item.value === nextValue\r\n\t\t\t\t),\r\n\t\t\t\tinputValue: '',\r\n\t\t\t\tisOpen: state.open,\r\n\t\t\t\tselectedItem: nextOption,\r\n\t\t\t\ttype: '',\r\n\t\t\t};\r\n\t\t\tonChange( changeObject );\r\n\t\t},\r\n\t\tvalue: value?.name,\r\n\t\t// Setting the first option as a default value when no value is provided\r\n\t\t// is already done natively by the underlying Ariakit component,\r\n\t\t// but doing this explicitly avoids the `onChange` callback from firing\r\n\t\t// on initial render, thus making this implementation closer to the v1.\r\n\t\tdefaultValue: options[ 0 ]?.name,\r\n\t} );\r\n\r\n\tconst children = options\r\n\t\t.map( applyOptionDeprecations )\r\n\t\t.map( ( { name, key, hint, style, className } ) => {\r\n\t\t\tconst withHint = (\r\n\t\t\t\t<Styled.WithHintItemWrapper>\r\n\t\t\t\t\t<span>{ name }</span>\r\n\t\t\t\t\t<Styled.WithHintItemHint\r\n\t\t\t\t\t\t// Keeping the classname for legacy reasons\r\n\t\t\t\t\t\tclassName=\"components-custom-select-control__item-hint\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ hint }\r\n\t\t\t\t\t</Styled.WithHintItemHint>\r\n\t\t\t\t</Styled.WithHintItemWrapper>\r\n\t\t\t);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<CustomSelectItem\r\n\t\t\t\t\tkey={ key }\r\n\t\t\t\t\tvalue={ name }\r\n\t\t\t\t\tchildren={ hint ? withHint : name }\r\n\t\t\t\t\tstyle={ style }\r\n\t\t\t\t\tclassName={ clsx(\r\n\t\t\t\t\t\tclassName,\r\n\t\t\t\t\t\t// Keeping the classnames for legacy reasons\r\n\t\t\t\t\t\t'components-custom-select-control__item',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t'has-hint': hint,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t) }\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t} );\r\n\r\n\tconst { value: currentValue } = store.getState();\r\n\r\n\tconst renderSelectedValueHint = () => {\r\n\t\tconst selectedOptionHint = options\r\n\t\t\t?.map( applyOptionDeprecations )\r\n\t\t\t?.find( ( { name } ) => currentValue === name )?.hint;\r\n\r\n\t\treturn (\r\n\t\t\t<Styled.SelectedExperimentalHintWrapper>\r\n\t\t\t\t{ currentValue }\r\n\t\t\t\t{ selectedOptionHint && (\r\n\t\t\t\t\t<Styled.SelectedExperimentalHintItem\r\n\t\t\t\t\t\t// Keeping the classname for legacy reasons\r\n\t\t\t\t\t\tclassName=\"components-custom-select-control__hint\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ selectedOptionHint }\r\n\t\t\t\t\t</Styled.SelectedExperimentalHintItem>\r\n\t\t\t\t) }\r\n\t\t\t</Styled.SelectedExperimentalHintWrapper>\r\n\t\t);\r\n\t};\r\n\r\n\tconst translatedSize = ( () => {\r\n\t\tif (\r\n\t\t\t( __next40pxDefaultSize && size === 'default' ) ||\r\n\t\t\tsize === '__unstable-large'\r\n\t\t) {\r\n\t\t\treturn 'default';\r\n\t\t}\r\n\t\tif ( ! __next40pxDefaultSize && size === 'default' ) {\r\n\t\t\treturn 'compact';\r\n\t\t}\r\n\t\treturn size;\r\n\t} )();\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<_CustomSelect\r\n\t\t\t\taria-describedby={ descriptionId }\r\n\t\t\t\trenderSelectedValue={\r\n\t\t\t\t\tshowSelectedHint ? renderSelectedValueHint : undefined\r\n\t\t\t\t}\r\n\t\t\t\tsize={ translatedSize }\r\n\t\t\t\tstore={ store }\r\n\t\t\t\tclassName={ clsx(\r\n\t\t\t\t\t// Keeping the classname for legacy reasons\r\n\t\t\t\t\t'components-custom-select-control',\r\n\t\t\t\t\tclassNameProp\r\n\t\t\t\t) }\r\n\t\t\t\tisLegacy\r\n\t\t\t\t{ ...restProps }\r\n\t\t\t>\r\n\t\t\t\t{ children }\r\n\t\t\t</_CustomSelect>\r\n\t\t\t<VisuallyHidden>\r\n\t\t\t\t<span id={ descriptionId }>\r\n\t\t\t\t\t{ getDescribedBy( currentValue, describedBy ) }\r\n\t\t\t\t</span>\r\n\t\t\t</VisuallyHidden>\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default CustomSelectControl;\r\n"],"mappings":"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","ignoreList":[]}