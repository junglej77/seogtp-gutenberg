{"version":3,"names":["throttle","useEffect","useRef","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","dragImageClass","cloneWrapperClass","clonePadding","bodyClass","Draggable","children","onDragStart","onDragOver","onDragEnd","appendToOwnerDocument","cloneClassname","elementId","transferData","__experimentalTransferDataType","transferDataType","__experimentalDragComponent","dragComponent","dragComponentRef","cleanupRef","end","event","preventDefault","current","start","ownerDocument","target","dataTransfer","setData","JSON","stringify","cloneWrapper","createElement","style","top","left","dragImage","setDragImage","classList","add","body","appendChild","x","y","clientX","clientY","transform","clonedDragComponent","innerHTML","element","getElementById","elementRect","getBoundingClientRect","elementWrapper","parentNode","elementTopOffset","elementLeftOffset","width","clone","cloneNode","id","Array","from","querySelectorAll","forEach","child","removeChild","cursorLeft","cursorTop","over","e","nextX","nextY","throttledDragOver","addEventListener","remove","removeEventListener","onDraggableStart","onDraggableEnd","className","display","ref"],"sources":["@wordpress/components/src/draggable/index.tsx"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport type { DragEvent } from 'react';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { throttle } from '@wordpress/compose';\r\nimport { useEffect, useRef } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport type { DraggableProps } from './types';\r\n\r\nconst dragImageClass = 'components-draggable__invisible-drag-image';\r\nconst cloneWrapperClass = 'components-draggable__clone';\r\nconst clonePadding = 0;\r\nconst bodyClass = 'is-dragging-components-draggable';\r\n\r\n/**\r\n * `Draggable` is a Component that provides a way to set up a cross-browser\r\n * (including IE) customizable drag image and the transfer data for the drag\r\n * event. It decouples the drag handle and the element to drag: use it by\r\n * wrapping the component that will become the drag handle and providing the DOM\r\n * ID of the element to drag.\r\n *\r\n * Note that the drag handle needs to declare the `draggable=\"true\"` property\r\n * and bind the `Draggable`s `onDraggableStart` and `onDraggableEnd` event\r\n * handlers to its own `onDragStart` and `onDragEnd` respectively. `Draggable`\r\n * takes care of the logic to setup the drag image and the transfer data, but is\r\n * not concerned with creating an actual DOM element that is draggable.\r\n *\r\n * ```jsx\r\n * import { Draggable, Panel, PanelBody } from '@wordpress/components';\r\n * import { Icon, more } from '@wordpress/icons';\r\n *\r\n * const MyDraggable = () => (\r\n *   <div id=\"draggable-panel\">\r\n *     <Panel header=\"Draggable panel\">\r\n *       <PanelBody>\r\n *         <Draggable elementId=\"draggable-panel\" transferData={ {} }>\r\n *           { ( { onDraggableStart, onDraggableEnd } ) => (\r\n *             <div\r\n *               className=\"example-drag-handle\"\r\n *               draggable\r\n *               onDragStart={ onDraggableStart }\r\n *               onDragEnd={ onDraggableEnd }\r\n *             >\r\n *               <Icon icon={ more } />\r\n *             </div>\r\n *           ) }\r\n *         </Draggable>\r\n *       </PanelBody>\r\n *     </Panel>\r\n *   </div>\r\n * );\r\n * ```\r\n */\r\nexport function Draggable( {\r\n\tchildren,\r\n\tonDragStart,\r\n\tonDragOver,\r\n\tonDragEnd,\r\n\tappendToOwnerDocument = false,\r\n\tcloneClassname,\r\n\telementId,\r\n\ttransferData,\r\n\t__experimentalTransferDataType: transferDataType = 'text',\r\n\t__experimentalDragComponent: dragComponent,\r\n}: DraggableProps ) {\r\n\tconst dragComponentRef = useRef< HTMLDivElement >( null );\r\n\tconst cleanupRef = useRef( () => {} );\r\n\r\n\t/**\r\n\t * Removes the element clone, resets cursor, and removes drag listener.\r\n\t *\r\n\t * @param event The non-custom DragEvent.\r\n\t */\r\n\tfunction end( event: DragEvent ) {\r\n\t\tevent.preventDefault();\r\n\t\tcleanupRef.current();\r\n\r\n\t\tif ( onDragEnd ) {\r\n\t\t\tonDragEnd( event );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This method does a couple of things:\r\n\t *\r\n\t * - Clones the current element and spawns clone over original element.\r\n\t * - Adds a fake temporary drag image to avoid browser defaults.\r\n\t * - Sets transfer data.\r\n\t * - Adds dragover listener.\r\n\t *\r\n\t * @param event The non-custom DragEvent.\r\n\t */\r\n\tfunction start( event: DragEvent ) {\r\n\t\tconst { ownerDocument } = event.target as HTMLElement;\r\n\r\n\t\tevent.dataTransfer.setData(\r\n\t\t\ttransferDataType,\r\n\t\t\tJSON.stringify( transferData )\r\n\t\t);\r\n\r\n\t\tconst cloneWrapper = ownerDocument.createElement( 'div' );\r\n\t\t// Reset position to 0,0. Natural stacking order will position this lower, even with a transform otherwise.\r\n\t\tcloneWrapper.style.top = '0';\r\n\t\tcloneWrapper.style.left = '0';\r\n\r\n\t\tconst dragImage = ownerDocument.createElement( 'div' );\r\n\r\n\t\t// Set a fake drag image to avoid browser defaults. Remove from DOM\r\n\t\t// right after. event.dataTransfer.setDragImage is not supported yet in\r\n\t\t// IE, we need to check for its existence first.\r\n\t\tif ( 'function' === typeof event.dataTransfer.setDragImage ) {\r\n\t\t\tdragImage.classList.add( dragImageClass );\r\n\t\t\townerDocument.body.appendChild( dragImage );\r\n\t\t\tevent.dataTransfer.setDragImage( dragImage, 0, 0 );\r\n\t\t}\r\n\r\n\t\tcloneWrapper.classList.add( cloneWrapperClass );\r\n\r\n\t\tif ( cloneClassname ) {\r\n\t\t\tcloneWrapper.classList.add( cloneClassname );\r\n\t\t}\r\n\r\n\t\tlet x = 0;\r\n\t\tlet y = 0;\r\n\t\t// If a dragComponent is defined, the following logic will clone the\r\n\t\t// HTML node and inject it into the cloneWrapper.\r\n\t\tif ( dragComponentRef.current ) {\r\n\t\t\t// Position dragComponent at the same position as the cursor.\r\n\t\t\tx = event.clientX;\r\n\t\t\ty = event.clientY;\r\n\t\t\tcloneWrapper.style.transform = `translate( ${ x }px, ${ y }px )`;\r\n\r\n\t\t\tconst clonedDragComponent = ownerDocument.createElement( 'div' );\r\n\t\t\tclonedDragComponent.innerHTML = dragComponentRef.current.innerHTML;\r\n\t\t\tcloneWrapper.appendChild( clonedDragComponent );\r\n\r\n\t\t\t// Inject the cloneWrapper into the DOM.\r\n\t\t\townerDocument.body.appendChild( cloneWrapper );\r\n\t\t} else {\r\n\t\t\tconst element = ownerDocument.getElementById(\r\n\t\t\t\telementId\r\n\t\t\t) as HTMLElement;\r\n\r\n\t\t\t// Prepare element clone and append to element wrapper.\r\n\t\t\tconst elementRect = element.getBoundingClientRect();\r\n\t\t\tconst elementWrapper = element.parentNode;\r\n\t\t\tconst elementTopOffset = elementRect.top;\r\n\t\t\tconst elementLeftOffset = elementRect.left;\r\n\r\n\t\t\tcloneWrapper.style.width = `${\r\n\t\t\t\telementRect.width + clonePadding * 2\r\n\t\t\t}px`;\r\n\r\n\t\t\tconst clone = element.cloneNode( true ) as HTMLElement;\r\n\t\t\tclone.id = `clone-${ elementId }`;\r\n\r\n\t\t\t// Position clone right over the original element (20px padding).\r\n\t\t\tx = elementLeftOffset - clonePadding;\r\n\t\t\ty = elementTopOffset - clonePadding;\r\n\t\t\tcloneWrapper.style.transform = `translate( ${ x }px, ${ y }px )`;\r\n\r\n\t\t\t// Hack: Remove iFrames as it's causing the embeds drag clone to freeze.\r\n\t\t\tArray.from< HTMLIFrameElement >(\r\n\t\t\t\tclone.querySelectorAll( 'iframe' )\r\n\t\t\t).forEach( ( child ) => child.parentNode?.removeChild( child ) );\r\n\r\n\t\t\tcloneWrapper.appendChild( clone );\r\n\r\n\t\t\t// Inject the cloneWrapper into the DOM.\r\n\t\t\tif ( appendToOwnerDocument ) {\r\n\t\t\t\townerDocument.body.appendChild( cloneWrapper );\r\n\t\t\t} else {\r\n\t\t\t\telementWrapper?.appendChild( cloneWrapper );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Mark the current cursor coordinates.\r\n\t\tlet cursorLeft = event.clientX;\r\n\t\tlet cursorTop = event.clientY;\r\n\r\n\t\tfunction over( e: DragEvent ) {\r\n\t\t\t// Skip doing any work if mouse has not moved.\r\n\t\t\tif ( cursorLeft === e.clientX && cursorTop === e.clientY ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst nextX = x + e.clientX - cursorLeft;\r\n\t\t\tconst nextY = y + e.clientY - cursorTop;\r\n\t\t\tcloneWrapper.style.transform = `translate( ${ nextX }px, ${ nextY }px )`;\r\n\t\t\tcursorLeft = e.clientX;\r\n\t\t\tcursorTop = e.clientY;\r\n\t\t\tx = nextX;\r\n\t\t\ty = nextY;\r\n\t\t\tif ( onDragOver ) {\r\n\t\t\t\tonDragOver( e );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Aim for 60fps (16 ms per frame) for now. We can potentially use requestAnimationFrame (raf) instead,\r\n\t\t// note that browsers may throttle raf below 60fps in certain conditions.\r\n\t\t// @ts-ignore\r\n\t\tconst throttledDragOver = throttle( over, 16 );\r\n\r\n\t\townerDocument.addEventListener( 'dragover', throttledDragOver );\r\n\r\n\t\t// Update cursor to 'grabbing', document wide.\r\n\t\townerDocument.body.classList.add( bodyClass );\r\n\r\n\t\tif ( onDragStart ) {\r\n\t\t\tonDragStart( event );\r\n\t\t}\r\n\r\n\t\tcleanupRef.current = () => {\r\n\t\t\t// Remove drag clone.\r\n\t\t\tif ( cloneWrapper && cloneWrapper.parentNode ) {\r\n\t\t\t\tcloneWrapper.parentNode.removeChild( cloneWrapper );\r\n\t\t\t}\r\n\r\n\t\t\tif ( dragImage && dragImage.parentNode ) {\r\n\t\t\t\tdragImage.parentNode.removeChild( dragImage );\r\n\t\t\t}\r\n\r\n\t\t\t// Reset cursor.\r\n\t\t\townerDocument.body.classList.remove( bodyClass );\r\n\r\n\t\t\townerDocument.removeEventListener( 'dragover', throttledDragOver );\r\n\t\t};\r\n\t}\r\n\r\n\tuseEffect(\r\n\t\t() => () => {\r\n\t\t\tcleanupRef.current();\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ children( {\r\n\t\t\t\tonDraggableStart: start,\r\n\t\t\t\tonDraggableEnd: end,\r\n\t\t\t} ) }\r\n\t\t\t{ dragComponent && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"components-draggable-drag-component-root\"\r\n\t\t\t\t\tstyle={ { display: 'none' } }\r\n\t\t\t\t\tref={ dragComponentRef }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ dragComponent }\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default Draggable;\r\n"],"mappings":"AAAA;AACA;AACA;;AAGA;AACA;AACA;AACA,SAASA,QAAQ,QAAQ,oBAAoB;AAC7C,SAASC,SAAS,EAAEC,MAAM,QAAQ,oBAAoB;;AAEtD;AACA;AACA;AAFA,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAKA,MAAMC,cAAc,GAAG,4CAA4C;AACnE,MAAMC,iBAAiB,GAAG,6BAA6B;AACvD,MAAMC,YAAY,GAAG,CAAC;AACtB,MAAMC,SAAS,GAAG,kCAAkC;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,SAASA,CAAE;EAC1BC,QAAQ;EACRC,WAAW;EACXC,UAAU;EACVC,SAAS;EACTC,qBAAqB,GAAG,KAAK;EAC7BC,cAAc;EACdC,SAAS;EACTC,YAAY;EACZC,8BAA8B,EAAEC,gBAAgB,GAAG,MAAM;EACzDC,2BAA2B,EAAEC;AACd,CAAC,EAAG;EACnB,MAAMC,gBAAgB,GAAGxB,MAAM,CAAoB,IAAK,CAAC;EACzD,MAAMyB,UAAU,GAAGzB,MAAM,CAAE,MAAM,CAAC,CAAE,CAAC;;EAErC;AACD;AACA;AACA;AACA;EACC,SAAS0B,GAAGA,CAAEC,KAAgB,EAAG;IAChCA,KAAK,CAACC,cAAc,CAAC,CAAC;IACtBH,UAAU,CAACI,OAAO,CAAC,CAAC;IAEpB,IAAKd,SAAS,EAAG;MAChBA,SAAS,CAAEY,KAAM,CAAC;IACnB;EACD;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,SAASG,KAAKA,CAAEH,KAAgB,EAAG;IAClC,MAAM;MAAEI;IAAc,CAAC,GAAGJ,KAAK,CAACK,MAAqB;IAErDL,KAAK,CAACM,YAAY,CAACC,OAAO,CACzBb,gBAAgB,EAChBc,IAAI,CAACC,SAAS,CAAEjB,YAAa,CAC9B,CAAC;IAED,MAAMkB,YAAY,GAAGN,aAAa,CAACO,aAAa,CAAE,KAAM,CAAC;IACzD;IACAD,YAAY,CAACE,KAAK,CAACC,GAAG,GAAG,GAAG;IAC5BH,YAAY,CAACE,KAAK,CAACE,IAAI,GAAG,GAAG;IAE7B,MAAMC,SAAS,GAAGX,aAAa,CAACO,aAAa,CAAE,KAAM,CAAC;;IAEtD;IACA;IACA;IACA,IAAK,UAAU,KAAK,OAAOX,KAAK,CAACM,YAAY,CAACU,YAAY,EAAG;MAC5DD,SAAS,CAACE,SAAS,CAACC,GAAG,CAAEtC,cAAe,CAAC;MACzCwB,aAAa,CAACe,IAAI,CAACC,WAAW,CAAEL,SAAU,CAAC;MAC3Cf,KAAK,CAACM,YAAY,CAACU,YAAY,CAAED,SAAS,EAAE,CAAC,EAAE,CAAE,CAAC;IACnD;IAEAL,YAAY,CAACO,SAAS,CAACC,GAAG,CAAErC,iBAAkB,CAAC;IAE/C,IAAKS,cAAc,EAAG;MACrBoB,YAAY,CAACO,SAAS,CAACC,GAAG,CAAE5B,cAAe,CAAC;IAC7C;IAEA,IAAI+B,CAAC,GAAG,CAAC;IACT,IAAIC,CAAC,GAAG,CAAC;IACT;IACA;IACA,IAAKzB,gBAAgB,CAACK,OAAO,EAAG;MAC/B;MACAmB,CAAC,GAAGrB,KAAK,CAACuB,OAAO;MACjBD,CAAC,GAAGtB,KAAK,CAACwB,OAAO;MACjBd,YAAY,CAACE,KAAK,CAACa,SAAS,GAAI,cAAcJ,CAAG,OAAOC,CAAG,MAAK;MAEhE,MAAMI,mBAAmB,GAAGtB,aAAa,CAACO,aAAa,CAAE,KAAM,CAAC;MAChEe,mBAAmB,CAACC,SAAS,GAAG9B,gBAAgB,CAACK,OAAO,CAACyB,SAAS;MAClEjB,YAAY,CAACU,WAAW,CAAEM,mBAAoB,CAAC;;MAE/C;MACAtB,aAAa,CAACe,IAAI,CAACC,WAAW,CAAEV,YAAa,CAAC;IAC/C,CAAC,MAAM;MACN,MAAMkB,OAAO,GAAGxB,aAAa,CAACyB,cAAc,CAC3CtC,SACD,CAAgB;;MAEhB;MACA,MAAMuC,WAAW,GAAGF,OAAO,CAACG,qBAAqB,CAAC,CAAC;MACnD,MAAMC,cAAc,GAAGJ,OAAO,CAACK,UAAU;MACzC,MAAMC,gBAAgB,GAAGJ,WAAW,CAACjB,GAAG;MACxC,MAAMsB,iBAAiB,GAAGL,WAAW,CAAChB,IAAI;MAE1CJ,YAAY,CAACE,KAAK,CAACwB,KAAK,GAAI,GAC3BN,WAAW,CAACM,KAAK,GAAGtD,YAAY,GAAG,CACnC,IAAG;MAEJ,MAAMuD,KAAK,GAAGT,OAAO,CAACU,SAAS,CAAE,IAAK,CAAgB;MACtDD,KAAK,CAACE,EAAE,GAAI,SAAShD,SAAW,EAAC;;MAEjC;MACA8B,CAAC,GAAGc,iBAAiB,GAAGrD,YAAY;MACpCwC,CAAC,GAAGY,gBAAgB,GAAGpD,YAAY;MACnC4B,YAAY,CAACE,KAAK,CAACa,SAAS,GAAI,cAAcJ,CAAG,OAAOC,CAAG,MAAK;;MAEhE;MACAkB,KAAK,CAACC,IAAI,CACTJ,KAAK,CAACK,gBAAgB,CAAE,QAAS,CAClC,CAAC,CAACC,OAAO,CAAIC,KAAK,IAAMA,KAAK,CAACX,UAAU,EAAEY,WAAW,CAAED,KAAM,CAAE,CAAC;MAEhElC,YAAY,CAACU,WAAW,CAAEiB,KAAM,CAAC;;MAEjC;MACA,IAAKhD,qBAAqB,EAAG;QAC5Be,aAAa,CAACe,IAAI,CAACC,WAAW,CAAEV,YAAa,CAAC;MAC/C,CAAC,MAAM;QACNsB,cAAc,EAAEZ,WAAW,CAAEV,YAAa,CAAC;MAC5C;IACD;;IAEA;IACA,IAAIoC,UAAU,GAAG9C,KAAK,CAACuB,OAAO;IAC9B,IAAIwB,SAAS,GAAG/C,KAAK,CAACwB,OAAO;IAE7B,SAASwB,IAAIA,CAAEC,CAAY,EAAG;MAC7B;MACA,IAAKH,UAAU,KAAKG,CAAC,CAAC1B,OAAO,IAAIwB,SAAS,KAAKE,CAAC,CAACzB,OAAO,EAAG;QAC1D;MACD;MACA,MAAM0B,KAAK,GAAG7B,CAAC,GAAG4B,CAAC,CAAC1B,OAAO,GAAGuB,UAAU;MACxC,MAAMK,KAAK,GAAG7B,CAAC,GAAG2B,CAAC,CAACzB,OAAO,GAAGuB,SAAS;MACvCrC,YAAY,CAACE,KAAK,CAACa,SAAS,GAAI,cAAcyB,KAAO,OAAOC,KAAO,MAAK;MACxEL,UAAU,GAAGG,CAAC,CAAC1B,OAAO;MACtBwB,SAAS,GAAGE,CAAC,CAACzB,OAAO;MACrBH,CAAC,GAAG6B,KAAK;MACT5B,CAAC,GAAG6B,KAAK;MACT,IAAKhE,UAAU,EAAG;QACjBA,UAAU,CAAE8D,CAAE,CAAC;MAChB;IACD;;IAEA;IACA;IACA;IACA,MAAMG,iBAAiB,GAAGjF,QAAQ,CAAE6E,IAAI,EAAE,EAAG,CAAC;IAE9C5C,aAAa,CAACiD,gBAAgB,CAAE,UAAU,EAAED,iBAAkB,CAAC;;IAE/D;IACAhD,aAAa,CAACe,IAAI,CAACF,SAAS,CAACC,GAAG,CAAEnC,SAAU,CAAC;IAE7C,IAAKG,WAAW,EAAG;MAClBA,WAAW,CAAEc,KAAM,CAAC;IACrB;IAEAF,UAAU,CAACI,OAAO,GAAG,MAAM;MAC1B;MACA,IAAKQ,YAAY,IAAIA,YAAY,CAACuB,UAAU,EAAG;QAC9CvB,YAAY,CAACuB,UAAU,CAACY,WAAW,CAAEnC,YAAa,CAAC;MACpD;MAEA,IAAKK,SAAS,IAAIA,SAAS,CAACkB,UAAU,EAAG;QACxClB,SAAS,CAACkB,UAAU,CAACY,WAAW,CAAE9B,SAAU,CAAC;MAC9C;;MAEA;MACAX,aAAa,CAACe,IAAI,CAACF,SAAS,CAACqC,MAAM,CAAEvE,SAAU,CAAC;MAEhDqB,aAAa,CAACmD,mBAAmB,CAAE,UAAU,EAAEH,iBAAkB,CAAC;IACnE,CAAC;EACF;EAEAhF,SAAS,CACR,MAAM,MAAM;IACX0B,UAAU,CAACI,OAAO,CAAC,CAAC;EACrB,CAAC,EACD,EACD,CAAC;EAED,oBACCvB,KAAA,CAAAF,SAAA;IAAAQ,QAAA,GACGA,QAAQ,CAAE;MACXuE,gBAAgB,EAAErD,KAAK;MACvBsD,cAAc,EAAE1D;IACjB,CAAE,CAAC,EACDH,aAAa,iBACdrB,IAAA;MACCmF,SAAS,EAAC,0CAA0C;MACpD9C,KAAK,EAAG;QAAE+C,OAAO,EAAE;MAAO,CAAG;MAC7BC,GAAG,EAAG/D,gBAAkB;MAAAZ,QAAA,EAEtBW;IAAa,CACX,CACL;EAAA,CACA,CAAC;AAEL;AAEA,eAAeZ,SAAS","ignoreList":[]}