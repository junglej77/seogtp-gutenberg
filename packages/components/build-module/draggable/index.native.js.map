{"version":3,"names":["Gesture","GestureDetector","LongPressGestureHandler","Animated","useSharedValue","runOnJS","useAnimatedReaction","useAnimatedGestureHandler","createContext","useContext","useRef","useMemo","styles","jsx","_jsx","Context","Provider","Draggable","children","onDragEnd","onDragOver","onDragStart","testID","isDragging","isPanActive","draggingId","panGestureRef","currentFirstTouchId","initialPosition","x","y","lastPosition","value","result","previous","id","getFirstTouchEvent","event","allTouches","find","touch","panGesture","Pan","manualActivation","onTouchesDown","firstEvent","onTouchesMove","state","activate","end","onTouchesCancelled","_event","onEnd","withRef","shouldCancelWhenOutside","withTestId","providerValue","gesture","View","style","draggable__container","DraggableTrigger","enabled","maxDistance","minDuration","onLongPress","onLongPressEnd","gestureHandler","onActive","minDurationMs","maxDist","simultaneousHandlers","onGestureEvent"],"sources":["@wordpress/components/src/draggable/index.native.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport {\r\n\tGesture,\r\n\tGestureDetector,\r\n\tLongPressGestureHandler,\r\n} from 'react-native-gesture-handler';\r\nimport Animated, {\r\n\tuseSharedValue,\r\n\trunOnJS,\r\n\tuseAnimatedReaction,\r\n\tuseAnimatedGestureHandler,\r\n} from 'react-native-reanimated';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { createContext, useContext, useRef, useMemo } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport styles from './style.scss';\r\n\r\nconst Context = createContext( {} );\r\nconst { Provider } = Context;\r\n\r\n/**\r\n * Draggable component.\r\n *\r\n * @param {Object}      props               Component props.\r\n * @param {JSX.Element} props.children      Children to be rendered.\r\n * @param {Function}    [props.onDragEnd]   Callback when dragging ends.\r\n * @param {Function}    [props.onDragOver]  Callback when dragging happens over an element.\r\n * @param {Function}    [props.onDragStart] Callback when dragging starts.\r\n * @param {string}      [props.testID]      Id used for querying the pan gesture in tests.\r\n *\r\n * @return {JSX.Element} The component to be rendered.\r\n */\r\nconst Draggable = ( {\r\n\tchildren,\r\n\tonDragEnd,\r\n\tonDragOver,\r\n\tonDragStart,\r\n\ttestID,\r\n} ) => {\r\n\tconst isDragging = useSharedValue( false );\r\n\tconst isPanActive = useSharedValue( false );\r\n\tconst draggingId = useSharedValue( '' );\r\n\tconst panGestureRef = useRef();\r\n\tconst currentFirstTouchId = useSharedValue( null );\r\n\r\n\tconst initialPosition = {\r\n\t\tx: useSharedValue( 0 ),\r\n\t\ty: useSharedValue( 0 ),\r\n\t};\r\n\tconst lastPosition = {\r\n\t\tx: useSharedValue( 0 ),\r\n\t\ty: useSharedValue( 0 ),\r\n\t};\r\n\r\n\tuseAnimatedReaction(\r\n\t\t() => isDragging.value,\r\n\t\t( result, previous ) => {\r\n\t\t\tif ( result === previous ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( result ) {\r\n\t\t\t\tif ( onDragStart ) {\r\n\t\t\t\t\tonDragStart( {\r\n\t\t\t\t\t\tx: initialPosition.x.value,\r\n\t\t\t\t\t\ty: initialPosition.y.value,\r\n\t\t\t\t\t\tid: draggingId.value,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} else if ( previous !== null && onDragEnd ) {\r\n\t\t\t\tonDragEnd( {\r\n\t\t\t\t\tx: lastPosition.x.value,\r\n\t\t\t\t\ty: lastPosition.y.value,\r\n\t\t\t\t\tid: draggingId.value,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tfunction getFirstTouchEvent( event ) {\r\n\t\t'worklet';\r\n\r\n\t\treturn event.allTouches.find(\r\n\t\t\t( touch ) => touch.id === currentFirstTouchId.value\r\n\t\t);\r\n\t}\r\n\r\n\tconst panGesture = Gesture.Pan()\r\n\t\t.manualActivation( true )\r\n\t\t.onTouchesDown( ( event ) => {\r\n\t\t\tif ( ! currentFirstTouchId.value ) {\r\n\t\t\t\tconst firstEvent = event.allTouches[ 0 ];\r\n\t\t\t\tconst { x = 0, y = 0 } = firstEvent;\r\n\r\n\t\t\t\tcurrentFirstTouchId.value = firstEvent.id;\r\n\r\n\t\t\t\tinitialPosition.x.value = x;\r\n\t\t\t\tinitialPosition.y.value = y;\r\n\t\t\t}\r\n\t\t} )\r\n\t\t.onTouchesMove( ( event, state ) => {\r\n\t\t\tif ( ! isPanActive.value && isDragging.value ) {\r\n\t\t\t\tisPanActive.value = true;\r\n\t\t\t\tstate.activate();\r\n\t\t\t}\r\n\r\n\t\t\tif ( isPanActive.value && isDragging.value ) {\r\n\t\t\t\tconst firstEvent = getFirstTouchEvent( event );\r\n\r\n\t\t\t\tif ( ! firstEvent ) {\r\n\t\t\t\t\tstate.end();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastPosition.x.value = firstEvent.x;\r\n\t\t\t\tlastPosition.y.value = firstEvent.y;\r\n\r\n\t\t\t\tif ( onDragOver ) {\r\n\t\t\t\t\tonDragOver( firstEvent );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} )\r\n\t\t.onTouchesCancelled( ( _event, state ) => {\r\n\t\t\tstate.end();\r\n\t\t} )\r\n\t\t.onEnd( () => {\r\n\t\t\tcurrentFirstTouchId.value = null;\r\n\t\t\tisPanActive.value = false;\r\n\t\t\tisDragging.value = false;\r\n\t\t} )\r\n\t\t.withRef( panGestureRef )\r\n\t\t.shouldCancelWhenOutside( false )\r\n\t\t.withTestId( testID );\r\n\r\n\tconst providerValue = useMemo( () => {\r\n\t\treturn { panGestureRef, isDragging, isPanActive, draggingId };\r\n\t}, [\r\n\t\t// `isDragging`, `isPanActive` and `draggingId` are created using the\r\n\t\t// `useSharedValue` hook provided by the `react-native-reanimated`, which in\r\n\t\t// theory should guarantee that the value of these variables remains stable.\r\n\t\t// ESLint can't pick this up, and that's why they have to be specified as\r\n\t\t// dependencies for this hook call.\r\n\t\tisDragging,\r\n\t\tisPanActive,\r\n\t\tdraggingId,\r\n\t] );\r\n\r\n\treturn (\r\n\t\t<GestureDetector gesture={ panGesture }>\r\n\t\t\t<Animated.View style={ styles.draggable__container }>\r\n\t\t\t\t<Provider value={ providerValue }>{ children }</Provider>\r\n\t\t\t</Animated.View>\r\n\t\t</GestureDetector>\r\n\t);\r\n};\r\n\r\n/**\r\n * Draggable trigger component.\r\n *\r\n * This component acts as the trigger for the dragging functionality.\r\n *\r\n * @param {Object}      props                  Component props.\r\n * @param {JSX.Element} props.children         Children to be rendered.\r\n * @param {*}           props.id               Identifier passed within the event callbacks.\r\n * @param {boolean}     [props.enabled]        Enables the long-press gesture.\r\n * @param {number}      [props.maxDistance]    Maximum distance, that defines how far the finger is allowed to travel during a long press gesture.\r\n * @param {number}      [props.minDuration]    Minimum time, that a finger must remain pressed on the corresponding view.\r\n * @param {Function}    [props.onLongPress]    Callback when long-press gesture is triggered over an element.\r\n * @param {Function}    [props.onLongPressEnd] Callback when long-press gesture ends.\r\n * @param {string}      [props.testID]         Id used for querying the long-press gesture handler in tests.\r\n *\r\n * @return {JSX.Element} The component to be rendered.\r\n */\r\nconst DraggableTrigger = ( {\r\n\tchildren,\r\n\tenabled = true,\r\n\tid,\r\n\tmaxDistance = 1000,\r\n\tminDuration = 500,\r\n\tonLongPress,\r\n\tonLongPressEnd,\r\n\ttestID,\r\n} ) => {\r\n\tconst { panGestureRef, isDragging, isPanActive, draggingId } =\r\n\t\tuseContext( Context );\r\n\r\n\tconst gestureHandler = useAnimatedGestureHandler( {\r\n\t\tonActive: () => {\r\n\t\t\tif ( isDragging.value ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdraggingId.value = id;\r\n\t\t\tisDragging.value = true;\r\n\t\t\tif ( onLongPress ) {\r\n\t\t\t\trunOnJS( onLongPress )( id );\r\n\t\t\t}\r\n\t\t},\r\n\t\tonEnd: () => {\r\n\t\t\tif ( ! isPanActive.value ) {\r\n\t\t\t\tisDragging.value = false;\r\n\t\t\t}\r\n\r\n\t\t\tif ( onLongPressEnd ) {\r\n\t\t\t\trunOnJS( onLongPressEnd )( id );\r\n\t\t\t}\r\n\t\t},\r\n\t} );\r\n\r\n\treturn (\r\n\t\t<LongPressGestureHandler\r\n\t\t\tenabled={ enabled }\r\n\t\t\tminDurationMs={ minDuration }\r\n\t\t\tmaxDist={ maxDistance }\r\n\t\t\tsimultaneousHandlers={ panGestureRef }\r\n\t\t\tshouldCancelWhenOutside={ false }\r\n\t\t\tonGestureEvent={ gestureHandler }\r\n\t\t\ttestID={ testID }\r\n\t\t>\r\n\t\t\t{ children }\r\n\t\t</LongPressGestureHandler>\r\n\t);\r\n};\r\n\r\nexport { DraggableTrigger };\r\nexport default Draggable;\r\n"],"mappings":"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","ignoreList":[]}