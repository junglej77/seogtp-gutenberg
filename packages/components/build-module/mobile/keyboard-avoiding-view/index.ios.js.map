{"version":3,"names":["KeyboardAvoidingView","IOSKeyboardAvoidingView","Animated","Keyboard","Dimensions","View","SafeArea","useEffect","useRef","useState","useResizeObserver","useIsFloatingKeyboard","styles","jsxs","_jsxs","jsx","_jsx","AnimatedKeyboardAvoidingView","createAnimatedComponent","MIN_HEIGHT","parentHeight","style","withAnimatedHeight","otherProps","resizeObserver","sizes","isKeyboardOpen","setIsKeyboardOpen","safeAreaBottomInset","setSafeAreaBottomInset","height","floatingKeyboard","animatedHeight","Value","current","fullHeight","get","keyboardVerticalOffset","getSafeAreaInsetsForRootView","then","safeAreaInsets","bottom","safeAreaSubscription","addEventListener","onSafeAreaInsetsUpdate","keyboardShowSubscription","addListener","onKeyboardWillShow","keyboardHideSubscription","onKeyboardWillHide","remove","endCoordinates","setValue","duration","startCoordinates","keyboardIsOpenBreakpoint","animatedListenerId","value","timing","toValue","useNativeDriver","start","removeListener","enabled","behavior","marginBottom","children","top","animatedChildStyle","defaultChildStyle"],"sources":["@wordpress/components/src/mobile/keyboard-avoiding-view/index.ios.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport {\r\n\tKeyboardAvoidingView as IOSKeyboardAvoidingView,\r\n\tAnimated,\r\n\tKeyboard,\r\n\tDimensions,\r\n\tView,\r\n} from 'react-native';\r\nimport SafeArea from 'react-native-safe-area';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useEffect, useRef, useState } from '@wordpress/element';\r\nimport { useResizeObserver } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport useIsFloatingKeyboard from '../utils/use-is-floating-keyboard';\r\nimport styles from './styles.scss';\r\n\r\nconst AnimatedKeyboardAvoidingView = Animated.createAnimatedComponent(\r\n\tIOSKeyboardAvoidingView\r\n);\r\n\r\nconst MIN_HEIGHT = 44;\r\n\r\nexport const KeyboardAvoidingView = ( {\r\n\tparentHeight,\r\n\tstyle,\r\n\twithAnimatedHeight = false,\r\n\t...otherProps\r\n} ) => {\r\n\tconst [ resizeObserver, sizes ] = useResizeObserver();\r\n\tconst [ isKeyboardOpen, setIsKeyboardOpen ] = useState( false );\r\n\tconst [ safeAreaBottomInset, setSafeAreaBottomInset ] = useState( 0 );\r\n\tconst { height = 0 } = sizes || {};\r\n\tconst floatingKeyboard = useIsFloatingKeyboard();\r\n\r\n\tconst animatedHeight = useRef( new Animated.Value( MIN_HEIGHT ) ).current;\r\n\r\n\tconst { height: fullHeight } = Dimensions.get( 'screen' );\r\n\tconst keyboardVerticalOffset = fullHeight - parentHeight;\r\n\r\n\tuseEffect( () => {\r\n\t\tSafeArea.getSafeAreaInsetsForRootView().then(\r\n\t\t\t( { safeAreaInsets } ) => {\r\n\t\t\t\tsetSafeAreaBottomInset( safeAreaInsets.bottom );\r\n\t\t\t}\r\n\t\t);\r\n\t\tconst safeAreaSubscription = SafeArea.addEventListener(\r\n\t\t\t'safeAreaInsetsForRootViewDidChange',\r\n\t\t\tonSafeAreaInsetsUpdate\r\n\t\t);\r\n\t\tconst keyboardShowSubscription = Keyboard.addListener(\r\n\t\t\t'keyboardWillShow',\r\n\t\t\tonKeyboardWillShow\r\n\t\t);\r\n\t\tconst keyboardHideSubscription = Keyboard.addListener(\r\n\t\t\t'keyboardWillHide',\r\n\t\t\tonKeyboardWillHide\r\n\t\t);\r\n\r\n\t\treturn () => {\r\n\t\t\tsafeAreaSubscription.remove();\r\n\t\t\tkeyboardShowSubscription.remove();\r\n\t\t\tkeyboardHideSubscription.remove();\r\n\t\t};\r\n\t\t// Disable reason: deferring this refactor to the native team.\r\n\t\t// see https://github.com/WordPress/gutenberg/pull/41166\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [] );\r\n\r\n\tfunction onSafeAreaInsetsUpdate( { safeAreaInsets } ) {\r\n\t\tsetSafeAreaBottomInset( safeAreaInsets.bottom );\r\n\t}\r\n\r\n\tfunction onKeyboardWillShow( { endCoordinates } ) {\r\n\t\tsetIsKeyboardOpen( true );\r\n\t\tanimatedHeight.setValue( endCoordinates.height + MIN_HEIGHT );\r\n\t}\r\n\r\n\tfunction onKeyboardWillHide( { duration, startCoordinates } ) {\r\n\t\t// The startCoordinates.height is set to wrong value when we use cmd + k for hide the keyboard (Have no idea why).\r\n\t\t// Because of that the `setIsKeyboardOpened` is not invoked and the state of keyboard is wrong.\r\n\t\t// The keyboardIsOpenBreakpoint use 100 as a fallback if the startCoordinates.height is too small (cmd + k case)\r\n\t\tconst keyboardIsOpenBreakpoint =\r\n\t\t\tstartCoordinates.height > 100 ? startCoordinates.height / 3 : 100;\r\n\t\tconst animatedListenerId = animatedHeight.addListener(\r\n\t\t\t( { value } ) => {\r\n\t\t\t\tif ( value < keyboardIsOpenBreakpoint ) {\r\n\t\t\t\t\tsetIsKeyboardOpen( false );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tAnimated.timing( animatedHeight, {\r\n\t\t\ttoValue: MIN_HEIGHT,\r\n\t\t\tduration,\r\n\t\t\tuseNativeDriver: false,\r\n\t\t} ).start( () => {\r\n\t\t\tanimatedHeight.removeListener( animatedListenerId );\r\n\t\t} );\r\n\t}\r\n\r\n\treturn (\r\n\t\t<AnimatedKeyboardAvoidingView\r\n\t\t\t{ ...otherProps }\r\n\t\t\tenabled={ ! floatingKeyboard }\r\n\t\t\tbehavior=\"padding\"\r\n\t\t\tkeyboardVerticalOffset={ keyboardVerticalOffset }\r\n\t\t\tstyle={\r\n\t\t\t\twithAnimatedHeight\r\n\t\t\t\t\t? [\r\n\t\t\t\t\t\t\tstyle,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\theight: animatedHeight,\r\n\t\t\t\t\t\t\t\tmarginBottom: isKeyboardOpen\r\n\t\t\t\t\t\t\t\t\t? -safeAreaBottomInset\r\n\t\t\t\t\t\t\t\t\t: 0,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t  ]\r\n\t\t\t\t\t: style\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t<View\r\n\t\t\t\tstyle={ [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttop: -height + MIN_HEIGHT,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstyles.animatedChildStyle,\r\n\t\t\t\t\t! withAnimatedHeight && styles.defaultChildStyle,\r\n\t\t\t\t] }\r\n\t\t\t>\r\n\t\t\t\t{ resizeObserver }\r\n\t\t\t\t{ otherProps.children }\r\n\t\t\t</View>\r\n\t\t</AnimatedKeyboardAvoidingView>\r\n\t);\r\n};\r\n\r\nexport default KeyboardAvoidingView;\r\n"],"mappings":"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","ignoreList":[]}