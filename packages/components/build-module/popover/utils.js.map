{"version":3,"names":["POSITION_TO_PLACEMENT","bottom","top","middle","positionToPlacement","position","_POSITION_TO_PLACEMEN","PLACEMENT_TO_ANIMATION_ORIGIN","originX","originY","right","left","overlay","placementToMotionAnimationProps","placement","translateProp","startsWith","translateDirection","style","initial","opacity","scale","animate","transition","duration","ease","isTopBottom","anchorRef","isRef","current","getReferenceElement","anchor","anchorRect","getAnchorRect","fallbackReferenceElement","_referenceElement","referenceElement","getBoundingClientRect","topRect","bottomRect","window","DOMRect","x","y","width","_rect$x","_rect$y","_rect$width","_rect$height","rect","height","parentElement","computePopoverPosition","c","Number","isNaN","undefined","Math","round"],"sources":["@wordpress/components/src/popover/utils.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport type { MotionProps } from 'framer-motion';\r\nimport type { Placement, ReferenceType } from '@floating-ui/react-dom';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport type {\r\n\tPopoverProps,\r\n\tPopoverAnchorRefReference,\r\n\tPopoverAnchorRefTopBottom,\r\n} from './types';\r\n\r\nconst POSITION_TO_PLACEMENT: Record<\r\n\tNonNullable< PopoverProps[ 'position' ] >,\r\n\tPlacement\r\n> = {\r\n\tbottom: 'bottom',\r\n\ttop: 'top',\r\n\t'middle left': 'left',\r\n\t'middle right': 'right',\r\n\t'bottom left': 'bottom-end',\r\n\t'bottom center': 'bottom',\r\n\t'bottom right': 'bottom-start',\r\n\t'top left': 'top-end',\r\n\t'top center': 'top',\r\n\t'top right': 'top-start',\r\n\t'middle left left': 'left',\r\n\t'middle left right': 'left',\r\n\t'middle left bottom': 'left-end',\r\n\t'middle left top': 'left-start',\r\n\t'middle right left': 'right',\r\n\t'middle right right': 'right',\r\n\t'middle right bottom': 'right-end',\r\n\t'middle right top': 'right-start',\r\n\t'bottom left left': 'bottom-end',\r\n\t'bottom left right': 'bottom-end',\r\n\t'bottom left bottom': 'bottom-end',\r\n\t'bottom left top': 'bottom-end',\r\n\t'bottom center left': 'bottom',\r\n\t'bottom center right': 'bottom',\r\n\t'bottom center bottom': 'bottom',\r\n\t'bottom center top': 'bottom',\r\n\t'bottom right left': 'bottom-start',\r\n\t'bottom right right': 'bottom-start',\r\n\t'bottom right bottom': 'bottom-start',\r\n\t'bottom right top': 'bottom-start',\r\n\t'top left left': 'top-end',\r\n\t'top left right': 'top-end',\r\n\t'top left bottom': 'top-end',\r\n\t'top left top': 'top-end',\r\n\t'top center left': 'top',\r\n\t'top center right': 'top',\r\n\t'top center bottom': 'top',\r\n\t'top center top': 'top',\r\n\t'top right left': 'top-start',\r\n\t'top right right': 'top-start',\r\n\t'top right bottom': 'top-start',\r\n\t'top right top': 'top-start',\r\n\t// `middle`/`middle center [corner?]` positions are associated to a fallback\r\n\t// `bottom` placement because there aren't any corresponding placement values.\r\n\tmiddle: 'bottom',\r\n\t'middle center': 'bottom',\r\n\t'middle center bottom': 'bottom',\r\n\t'middle center left': 'bottom',\r\n\t'middle center right': 'bottom',\r\n\t'middle center top': 'bottom',\r\n};\r\n\r\n/**\r\n * Converts the `Popover`'s legacy \"position\" prop to the new \"placement\" prop\r\n * (used by `floating-ui`).\r\n *\r\n * @param position The legacy position\r\n * @return The corresponding placement\r\n */\r\nexport const positionToPlacement = (\r\n\tposition: NonNullable< PopoverProps[ 'position' ] >\r\n) => POSITION_TO_PLACEMENT[ position ] ?? 'bottom';\r\n\r\n/**\r\n * @typedef AnimationOrigin\r\n * @type {Object}\r\n * @property {number} originX A number between 0 and 1 (in CSS logical properties jargon, 0 is \"start\", 0.5 is \"center\", and 1 is \"end\")\r\n * @property {number} originY A number between 0 and 1 (0 is top, 0.5 is center, and 1 is bottom)\r\n */\r\n\r\nconst PLACEMENT_TO_ANIMATION_ORIGIN: Record<\r\n\tNonNullable< PopoverProps[ 'placement' ] >,\r\n\t{ originX: number; originY: number }\r\n> = {\r\n\ttop: { originX: 0.5, originY: 1 }, // open from bottom, center\r\n\t'top-start': { originX: 0, originY: 1 }, // open from bottom, left\r\n\t'top-end': { originX: 1, originY: 1 }, // open from bottom, right\r\n\tright: { originX: 0, originY: 0.5 }, // open from middle, left\r\n\t'right-start': { originX: 0, originY: 0 }, // open from top, left\r\n\t'right-end': { originX: 0, originY: 1 }, // open from bottom, left\r\n\tbottom: { originX: 0.5, originY: 0 }, // open from top, center\r\n\t'bottom-start': { originX: 0, originY: 0 }, // open from top, left\r\n\t'bottom-end': { originX: 1, originY: 0 }, // open from top, right\r\n\tleft: { originX: 1, originY: 0.5 }, // open from middle, right\r\n\t'left-start': { originX: 1, originY: 0 }, // open from top, right\r\n\t'left-end': { originX: 1, originY: 1 }, // open from bottom, right\r\n\toverlay: { originX: 0.5, originY: 0.5 }, // open from center, center\r\n};\r\n\r\n/**\r\n * Given the floating-ui `placement`, compute the framer-motion props for the\r\n * popover's entry animation.\r\n *\r\n * @param placement A placement string from floating ui\r\n * @return The object containing the motion props\r\n */\r\nexport const placementToMotionAnimationProps = (\r\n\tplacement: NonNullable< PopoverProps[ 'placement' ] >\r\n): MotionProps => {\r\n\tconst translateProp =\r\n\t\tplacement.startsWith( 'top' ) || placement.startsWith( 'bottom' )\r\n\t\t\t? 'translateY'\r\n\t\t\t: 'translateX';\r\n\tconst translateDirection =\r\n\t\tplacement.startsWith( 'top' ) || placement.startsWith( 'left' )\r\n\t\t\t? 1\r\n\t\t\t: -1;\r\n\r\n\treturn {\r\n\t\tstyle: PLACEMENT_TO_ANIMATION_ORIGIN[ placement ],\r\n\t\tinitial: {\r\n\t\t\topacity: 0,\r\n\t\t\tscale: 0,\r\n\t\t\t[ translateProp ]: `${ 2 * translateDirection }em`,\r\n\t\t},\r\n\t\tanimate: { opacity: 1, scale: 1, [ translateProp ]: 0 },\r\n\t\ttransition: { duration: 0.1, ease: [ 0, 0, 0.2, 1 ] },\r\n\t};\r\n};\r\n\r\nfunction isTopBottom(\r\n\tanchorRef: PopoverProps[ 'anchorRef' ]\r\n): anchorRef is PopoverAnchorRefTopBottom {\r\n\treturn !! ( anchorRef as PopoverAnchorRefTopBottom )?.top;\r\n}\r\n\r\nfunction isRef(\r\n\tanchorRef: PopoverProps[ 'anchorRef' ]\r\n): anchorRef is PopoverAnchorRefReference {\r\n\treturn !! ( anchorRef as PopoverAnchorRefReference )?.current;\r\n}\r\n\r\nexport const getReferenceElement = ( {\r\n\tanchor,\r\n\tanchorRef,\r\n\tanchorRect,\r\n\tgetAnchorRect,\r\n\tfallbackReferenceElement,\r\n}: Pick<\r\n\tPopoverProps,\r\n\t'anchorRef' | 'anchorRect' | 'getAnchorRect' | 'anchor'\r\n> & {\r\n\tfallbackReferenceElement: Element | null;\r\n} ): ReferenceType | null => {\r\n\tlet referenceElement = null;\r\n\r\n\tif ( anchor ) {\r\n\t\treferenceElement = anchor;\r\n\t} else if ( isTopBottom( anchorRef ) ) {\r\n\t\t// Create a virtual element for the ref. The expectation is that\r\n\t\t// if anchorRef.top is defined, then anchorRef.bottom is defined too.\r\n\t\t// Seems to be used by the block toolbar, when multiple blocks are selected\r\n\t\t// (top and bottom blocks are used to calculate the resulting rect).\r\n\t\treferenceElement = {\r\n\t\t\tgetBoundingClientRect() {\r\n\t\t\t\tconst topRect = anchorRef.top.getBoundingClientRect();\r\n\t\t\t\tconst bottomRect = anchorRef.bottom.getBoundingClientRect();\r\n\t\t\t\treturn new window.DOMRect(\r\n\t\t\t\t\ttopRect.x,\r\n\t\t\t\t\ttopRect.y,\r\n\t\t\t\t\ttopRect.width,\r\n\t\t\t\t\tbottomRect.bottom - topRect.top\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t};\r\n\t} else if ( isRef( anchorRef ) ) {\r\n\t\t// Standard React ref.\r\n\t\treferenceElement = anchorRef.current;\r\n\t} else if ( anchorRef ) {\r\n\t\t// If `anchorRef` holds directly the element's value (no `current` key)\r\n\t\t// This is a weird scenario and should be deprecated.\r\n\t\treferenceElement = anchorRef as Element;\r\n\t} else if ( anchorRect ) {\r\n\t\t// Create a virtual element for the ref.\r\n\t\treferenceElement = {\r\n\t\t\tgetBoundingClientRect() {\r\n\t\t\t\treturn anchorRect;\r\n\t\t\t},\r\n\t\t};\r\n\t} else if ( getAnchorRect ) {\r\n\t\t// Create a virtual element for the ref.\r\n\t\treferenceElement = {\r\n\t\t\tgetBoundingClientRect() {\r\n\t\t\t\tconst rect = getAnchorRect( fallbackReferenceElement );\r\n\t\t\t\treturn new window.DOMRect(\r\n\t\t\t\t\trect.x ?? rect.left,\r\n\t\t\t\t\trect.y ?? rect.top,\r\n\t\t\t\t\trect.width ?? rect.right - rect.left,\r\n\t\t\t\t\trect.height ?? rect.bottom - rect.top\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t};\r\n\t} else if ( fallbackReferenceElement ) {\r\n\t\t// If no explicit ref is passed via props, fall back to\r\n\t\t// anchoring to the popover's parent node.\r\n\t\treferenceElement = fallbackReferenceElement.parentElement;\r\n\t}\r\n\r\n\t// Convert any `undefined` value to `null`.\r\n\treturn referenceElement ?? null;\r\n};\r\n\r\n/**\r\n * Computes the final coordinate that needs to be applied to the floating\r\n * element when applying transform inline styles, defaulting to `undefined`\r\n * if the provided value is `null` or `NaN`.\r\n *\r\n * @param c input coordinate (usually as returned from floating-ui)\r\n * @return The coordinate's value to be used for inline styles. An `undefined`\r\n *         return value means \"no style set\" for this coordinate.\r\n */\r\nexport const computePopoverPosition = ( c: number | null ) =>\r\n\tc === null || Number.isNaN( c ) ? undefined : Math.round( c );\r\n"],"mappings":"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","ignoreList":[]}