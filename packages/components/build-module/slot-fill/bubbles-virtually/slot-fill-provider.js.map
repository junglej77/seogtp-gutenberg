{"version":3,"names":["useState","isShallowEqual","observableMap","SlotFillContext","jsx","_jsx","createSlotRegistry","slots","fills","registerSlot","name","ref","fillProps","slot","get","set","unregisterSlot","delete","updateSlot","slotFills","forEach","fill","current","rerender","registerFill","unregisterFill","fillsForName","filter","fillRef","SlotFillProvider","children","registry","Provider","value"],"sources":["@wordpress/components/src/slot-fill/bubbles-virtually/slot-fill-provider.tsx"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useState } from '@wordpress/element';\r\nimport isShallowEqual from '@wordpress/is-shallow-equal';\r\nimport { observableMap } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport SlotFillContext from './slot-fill-context';\r\nimport type {\r\n\tSlotFillProviderProps,\r\n\tSlotFillBubblesVirtuallyContext,\r\n} from '../types';\r\n\r\nfunction createSlotRegistry(): SlotFillBubblesVirtuallyContext {\r\n\tconst slots: SlotFillBubblesVirtuallyContext[ 'slots' ] = observableMap();\r\n\tconst fills: SlotFillBubblesVirtuallyContext[ 'fills' ] = observableMap();\r\n\r\n\tconst registerSlot: SlotFillBubblesVirtuallyContext[ 'registerSlot' ] = (\r\n\t\tname,\r\n\t\tref,\r\n\t\tfillProps\r\n\t) => {\r\n\t\tconst slot = slots.get( name );\r\n\r\n\t\tslots.set( name, {\r\n\t\t\t...slot,\r\n\t\t\tref: ref || slot?.ref,\r\n\t\t\tfillProps: fillProps || slot?.fillProps || {},\r\n\t\t} );\r\n\t};\r\n\r\n\tconst unregisterSlot: SlotFillBubblesVirtuallyContext[ 'unregisterSlot' ] =\r\n\t\t( name, ref ) => {\r\n\t\t\t// Make sure we're not unregistering a slot registered by another element\r\n\t\t\t// See https://github.com/WordPress/gutenberg/pull/19242#issuecomment-590295412\r\n\t\t\tif ( slots.get( name )?.ref === ref ) {\r\n\t\t\t\tslots.delete( name );\r\n\t\t\t}\r\n\t\t};\r\n\r\n\tconst updateSlot: SlotFillBubblesVirtuallyContext[ 'updateSlot' ] = (\r\n\t\tname,\r\n\t\tfillProps\r\n\t) => {\r\n\t\tconst slot = slots.get( name );\r\n\t\tif ( ! slot ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( isShallowEqual( slot.fillProps, fillProps ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tslot.fillProps = fillProps;\r\n\t\tconst slotFills = fills.get( name );\r\n\t\tif ( slotFills ) {\r\n\t\t\t// Force update fills.\r\n\t\t\tslotFills.forEach( ( fill ) => fill.current.rerender() );\r\n\t\t}\r\n\t};\r\n\r\n\tconst registerFill: SlotFillBubblesVirtuallyContext[ 'registerFill' ] = (\r\n\t\tname,\r\n\t\tref\r\n\t) => {\r\n\t\tfills.set( name, [ ...( fills.get( name ) || [] ), ref ] );\r\n\t};\r\n\r\n\tconst unregisterFill: SlotFillBubblesVirtuallyContext[ 'registerFill' ] = (\r\n\t\tname,\r\n\t\tref\r\n\t) => {\r\n\t\tconst fillsForName = fills.get( name );\r\n\t\tif ( ! fillsForName ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfills.set(\r\n\t\t\tname,\r\n\t\t\tfillsForName.filter( ( fillRef ) => fillRef !== ref )\r\n\t\t);\r\n\t};\r\n\r\n\treturn {\r\n\t\tslots,\r\n\t\tfills,\r\n\t\tregisterSlot,\r\n\t\tupdateSlot,\r\n\t\tunregisterSlot,\r\n\t\tregisterFill,\r\n\t\tunregisterFill,\r\n\t};\r\n}\r\n\r\nexport default function SlotFillProvider( {\r\n\tchildren,\r\n}: SlotFillProviderProps ) {\r\n\tconst [ registry ] = useState( createSlotRegistry );\r\n\treturn (\r\n\t\t<SlotFillContext.Provider value={ registry }>\r\n\t\t\t{ children }\r\n\t\t</SlotFillContext.Provider>\r\n\t);\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,QAAQ,QAAQ,oBAAoB;AAC7C,OAAOC,cAAc,MAAM,6BAA6B;AACxD,SAASC,aAAa,QAAQ,oBAAoB;;AAElD;AACA;AACA;AACA,OAAOC,eAAe,MAAM,qBAAqB;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAMlD,SAASC,kBAAkBA,CAAA,EAAoC;EAC9D,MAAMC,KAAiD,GAAGL,aAAa,CAAC,CAAC;EACzE,MAAMM,KAAiD,GAAGN,aAAa,CAAC,CAAC;EAEzE,MAAMO,YAA+D,GAAGA,CACvEC,IAAI,EACJC,GAAG,EACHC,SAAS,KACL;IACJ,MAAMC,IAAI,GAAGN,KAAK,CAACO,GAAG,CAAEJ,IAAK,CAAC;IAE9BH,KAAK,CAACQ,GAAG,CAAEL,IAAI,EAAE;MAChB,GAAGG,IAAI;MACPF,GAAG,EAAEA,GAAG,IAAIE,IAAI,EAAEF,GAAG;MACrBC,SAAS,EAAEA,SAAS,IAAIC,IAAI,EAAED,SAAS,IAAI,CAAC;IAC7C,CAAE,CAAC;EACJ,CAAC;EAED,MAAMI,cAAmE,GACxEA,CAAEN,IAAI,EAAEC,GAAG,KAAM;IAChB;IACA;IACA,IAAKJ,KAAK,CAACO,GAAG,CAAEJ,IAAK,CAAC,EAAEC,GAAG,KAAKA,GAAG,EAAG;MACrCJ,KAAK,CAACU,MAAM,CAAEP,IAAK,CAAC;IACrB;EACD,CAAC;EAEF,MAAMQ,UAA2D,GAAGA,CACnER,IAAI,EACJE,SAAS,KACL;IACJ,MAAMC,IAAI,GAAGN,KAAK,CAACO,GAAG,CAAEJ,IAAK,CAAC;IAC9B,IAAK,CAAEG,IAAI,EAAG;MACb;IACD;IAEA,IAAKZ,cAAc,CAAEY,IAAI,CAACD,SAAS,EAAEA,SAAU,CAAC,EAAG;MAClD;IACD;IAEAC,IAAI,CAACD,SAAS,GAAGA,SAAS;IAC1B,MAAMO,SAAS,GAAGX,KAAK,CAACM,GAAG,CAAEJ,IAAK,CAAC;IACnC,IAAKS,SAAS,EAAG;MAChB;MACAA,SAAS,CAACC,OAAO,CAAIC,IAAI,IAAMA,IAAI,CAACC,OAAO,CAACC,QAAQ,CAAC,CAAE,CAAC;IACzD;EACD,CAAC;EAED,MAAMC,YAA+D,GAAGA,CACvEd,IAAI,EACJC,GAAG,KACC;IACJH,KAAK,CAACO,GAAG,CAAEL,IAAI,EAAE,CAAE,IAAKF,KAAK,CAACM,GAAG,CAAEJ,IAAK,CAAC,IAAI,EAAE,CAAE,EAAEC,GAAG,CAAG,CAAC;EAC3D,CAAC;EAED,MAAMc,cAAiE,GAAGA,CACzEf,IAAI,EACJC,GAAG,KACC;IACJ,MAAMe,YAAY,GAAGlB,KAAK,CAACM,GAAG,CAAEJ,IAAK,CAAC;IACtC,IAAK,CAAEgB,YAAY,EAAG;MACrB;IACD;IAEAlB,KAAK,CAACO,GAAG,CACRL,IAAI,EACJgB,YAAY,CAACC,MAAM,CAAIC,OAAO,IAAMA,OAAO,KAAKjB,GAAI,CACrD,CAAC;EACF,CAAC;EAED,OAAO;IACNJ,KAAK;IACLC,KAAK;IACLC,YAAY;IACZS,UAAU;IACVF,cAAc;IACdQ,YAAY;IACZC;EACD,CAAC;AACF;AAEA,eAAe,SAASI,gBAAgBA,CAAE;EACzCC;AACsB,CAAC,EAAG;EAC1B,MAAM,CAAEC,QAAQ,CAAE,GAAG/B,QAAQ,CAAEM,kBAAmB,CAAC;EACnD,oBACCD,IAAA,CAACF,eAAe,CAAC6B,QAAQ;IAACC,KAAK,EAAGF,QAAU;IAAAD,QAAA,EACzCA;EAAQ,CACe,CAAC;AAE7B","ignoreList":[]}