{"version":3,"names":["usePrevious","useCallback","useEffect","useLayoutEffect","useMemo","styles","useToolsPanelContext","useContextSystem","useCx","noop","useToolsPanelItem","props","className","hasValue","isShownByDefault","label","panelId","resetAllFilter","onDeselect","onSelect","otherProps","currentPanelId","menuItems","registerResetAllFilter","deregisterResetAllFilter","registerPanelItem","deregisterPanelItem","flagItemCustomization","isResetting","shouldRenderPlaceholderItems","shouldRenderPlaceholder","firstDisplayedItem","lastDisplayedItem","__experimentalFirstVisibleItemClass","__experimentalLastVisibleItemClass","hasValueCallback","resetAllFilterCallback","previousPanelId","hasMatchingPanel","menuGroup","isMenuItemChecked","wasMenuItemChecked","isRegistered","undefined","isValueSet","isShown","cx","classes","shouldApplyPlaceholderStyles","firstItemStyle","lastItemStyle","ToolsPanelItem","ToolsPanelItemPlaceholder"],"sources":["@wordpress/components/src/tools-panel/tools-panel-item/hook.ts"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { usePrevious } from '@wordpress/compose';\r\nimport {\r\n\tuseCallback,\r\n\tuseEffect,\r\n\tuseLayoutEffect,\r\n\tuseMemo,\r\n} from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport * as styles from '../styles';\r\nimport { useToolsPanelContext } from '../context';\r\nimport type { WordPressComponentProps } from '../../context';\r\nimport { useContextSystem } from '../../context';\r\nimport { useCx } from '../../utils/hooks/use-cx';\r\nimport type { ToolsPanelItemProps } from '../types';\r\n\r\nconst noop = () => {};\r\n\r\nexport function useToolsPanelItem(\r\n\tprops: WordPressComponentProps< ToolsPanelItemProps, 'div' >\r\n) {\r\n\tconst {\r\n\t\tclassName,\r\n\t\thasValue,\r\n\t\tisShownByDefault = false,\r\n\t\tlabel,\r\n\t\tpanelId,\r\n\t\tresetAllFilter = noop,\r\n\t\tonDeselect,\r\n\t\tonSelect,\r\n\t\t...otherProps\r\n\t} = useContextSystem( props, 'ToolsPanelItem' );\r\n\r\n\tconst {\r\n\t\tpanelId: currentPanelId,\r\n\t\tmenuItems,\r\n\t\tregisterResetAllFilter,\r\n\t\tderegisterResetAllFilter,\r\n\t\tregisterPanelItem,\r\n\t\tderegisterPanelItem,\r\n\t\tflagItemCustomization,\r\n\t\tisResetting,\r\n\t\tshouldRenderPlaceholderItems: shouldRenderPlaceholder,\r\n\t\tfirstDisplayedItem,\r\n\t\tlastDisplayedItem,\r\n\t\t__experimentalFirstVisibleItemClass,\r\n\t\t__experimentalLastVisibleItemClass,\r\n\t} = useToolsPanelContext();\r\n\r\n\t// hasValue is a new function on every render, so do not add it as a\r\n\t// dependency to the useCallback hook! If needed, we should use a ref.\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\tconst hasValueCallback = useCallback( hasValue, [ panelId ] );\r\n\t// resetAllFilter is a new function on every render, so do not add it as a\r\n\t// dependency to the useCallback hook! If needed, we should use a ref.\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\tconst resetAllFilterCallback = useCallback( resetAllFilter, [ panelId ] );\r\n\tconst previousPanelId = usePrevious( currentPanelId );\r\n\r\n\tconst hasMatchingPanel =\r\n\t\tcurrentPanelId === panelId || currentPanelId === null;\r\n\r\n\t// Registering the panel item allows the panel to include it in its\r\n\t// automatically generated menu and determine its initial checked status.\r\n\t//\r\n\t// This is performed in a layout effect to ensure that the panel item\r\n\t// is registered before it is rendered preventing a rendering glitch.\r\n\t// See: https://github.com/WordPress/gutenberg/issues/56470\r\n\tuseLayoutEffect( () => {\r\n\t\tif ( hasMatchingPanel && previousPanelId !== null ) {\r\n\t\t\tregisterPanelItem( {\r\n\t\t\t\thasValue: hasValueCallback,\r\n\t\t\t\tisShownByDefault,\r\n\t\t\t\tlabel,\r\n\t\t\t\tpanelId,\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\treturn () => {\r\n\t\t\tif (\r\n\t\t\t\t( previousPanelId === null && !! currentPanelId ) ||\r\n\t\t\t\tcurrentPanelId === panelId\r\n\t\t\t) {\r\n\t\t\t\tderegisterPanelItem( label );\r\n\t\t\t}\r\n\t\t};\r\n\t}, [\r\n\t\tcurrentPanelId,\r\n\t\thasMatchingPanel,\r\n\t\tisShownByDefault,\r\n\t\tlabel,\r\n\t\thasValueCallback,\r\n\t\tpanelId,\r\n\t\tpreviousPanelId,\r\n\t\tregisterPanelItem,\r\n\t\tderegisterPanelItem,\r\n\t] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( hasMatchingPanel ) {\r\n\t\t\tregisterResetAllFilter( resetAllFilterCallback );\r\n\t\t}\r\n\t\treturn () => {\r\n\t\t\tif ( hasMatchingPanel ) {\r\n\t\t\t\tderegisterResetAllFilter( resetAllFilterCallback );\r\n\t\t\t}\r\n\t\t};\r\n\t}, [\r\n\t\tregisterResetAllFilter,\r\n\t\tderegisterResetAllFilter,\r\n\t\tresetAllFilterCallback,\r\n\t\thasMatchingPanel,\r\n\t] );\r\n\r\n\t// Note: `label` is used as a key when building menu item state in\r\n\t// `ToolsPanel`.\r\n\tconst menuGroup = isShownByDefault ? 'default' : 'optional';\r\n\tconst isMenuItemChecked = menuItems?.[ menuGroup ]?.[ label ];\r\n\tconst wasMenuItemChecked = usePrevious( isMenuItemChecked );\r\n\tconst isRegistered = menuItems?.[ menuGroup ]?.[ label ] !== undefined;\r\n\r\n\tconst isValueSet = hasValue();\r\n\t// Notify the panel when an item's value has changed except for optional\r\n\t// items without value because the item should not cause itself to hide.\r\n\tuseEffect( () => {\r\n\t\tif ( ! isShownByDefault && ! isValueSet ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tflagItemCustomization( isValueSet, label, menuGroup );\r\n\t}, [\r\n\t\tisValueSet,\r\n\t\tmenuGroup,\r\n\t\tlabel,\r\n\t\tflagItemCustomization,\r\n\t\tisShownByDefault,\r\n\t] );\r\n\r\n\t// Determine if the panel item's corresponding menu is being toggled and\r\n\t// trigger appropriate callback if it is.\r\n\tuseEffect( () => {\r\n\t\t// We check whether this item is currently registered as items rendered\r\n\t\t// via fills can persist through the parent panel being remounted.\r\n\t\t// See: https://github.com/WordPress/gutenberg/pull/45673\r\n\t\tif ( ! isRegistered || isResetting || ! hasMatchingPanel ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( isMenuItemChecked && ! isValueSet && ! wasMenuItemChecked ) {\r\n\t\t\tonSelect?.();\r\n\t\t}\r\n\r\n\t\tif ( ! isMenuItemChecked && isValueSet && wasMenuItemChecked ) {\r\n\t\t\tonDeselect?.();\r\n\t\t}\r\n\t}, [\r\n\t\thasMatchingPanel,\r\n\t\tisMenuItemChecked,\r\n\t\tisRegistered,\r\n\t\tisResetting,\r\n\t\tisValueSet,\r\n\t\twasMenuItemChecked,\r\n\t\tonSelect,\r\n\t\tonDeselect,\r\n\t] );\r\n\r\n\t// The item is shown if it is a default control regardless of whether it\r\n\t// has a value. Optional items are shown when they are checked or have\r\n\t// a value.\r\n\tconst isShown = isShownByDefault\r\n\t\t? menuItems?.[ menuGroup ]?.[ label ] !== undefined\r\n\t\t: isMenuItemChecked;\r\n\r\n\tconst cx = useCx();\r\n\tconst classes = useMemo( () => {\r\n\t\tconst shouldApplyPlaceholderStyles =\r\n\t\t\tshouldRenderPlaceholder && ! isShown;\r\n\t\tconst firstItemStyle =\r\n\t\t\tfirstDisplayedItem === label && __experimentalFirstVisibleItemClass;\r\n\t\tconst lastItemStyle =\r\n\t\t\tlastDisplayedItem === label && __experimentalLastVisibleItemClass;\r\n\t\treturn cx(\r\n\t\t\tstyles.ToolsPanelItem,\r\n\t\t\tshouldApplyPlaceholderStyles && styles.ToolsPanelItemPlaceholder,\r\n\t\t\t! shouldApplyPlaceholderStyles && className,\r\n\t\t\tfirstItemStyle,\r\n\t\t\tlastItemStyle\r\n\t\t);\r\n\t}, [\r\n\t\tisShown,\r\n\t\tshouldRenderPlaceholder,\r\n\t\tclassName,\r\n\t\tcx,\r\n\t\tfirstDisplayedItem,\r\n\t\tlastDisplayedItem,\r\n\t\t__experimentalFirstVisibleItemClass,\r\n\t\t__experimentalLastVisibleItemClass,\r\n\t\tlabel,\r\n\t] );\r\n\r\n\treturn {\r\n\t\t...otherProps,\r\n\t\tisShown,\r\n\t\tshouldRenderPlaceholder,\r\n\t\tclassName: classes,\r\n\t};\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,WAAW,QAAQ,oBAAoB;AAChD,SACCC,WAAW,EACXC,SAAS,EACTC,eAAe,EACfC,OAAO,QACD,oBAAoB;;AAE3B;AACA;AACA;AACA,OAAO,KAAKC,MAAM,MAAM,WAAW;AACnC,SAASC,oBAAoB,QAAQ,YAAY;AAEjD,SAASC,gBAAgB,QAAQ,eAAe;AAChD,SAASC,KAAK,QAAQ,0BAA0B;AAGhD,MAAMC,IAAI,GAAGA,CAAA,KAAM,CAAC,CAAC;AAErB,OAAO,SAASC,iBAAiBA,CAChCC,KAA4D,EAC3D;EACD,MAAM;IACLC,SAAS;IACTC,QAAQ;IACRC,gBAAgB,GAAG,KAAK;IACxBC,KAAK;IACLC,OAAO;IACPC,cAAc,GAAGR,IAAI;IACrBS,UAAU;IACVC,QAAQ;IACR,GAAGC;EACJ,CAAC,GAAGb,gBAAgB,CAAEI,KAAK,EAAE,gBAAiB,CAAC;EAE/C,MAAM;IACLK,OAAO,EAAEK,cAAc;IACvBC,SAAS;IACTC,sBAAsB;IACtBC,wBAAwB;IACxBC,iBAAiB;IACjBC,mBAAmB;IACnBC,qBAAqB;IACrBC,WAAW;IACXC,4BAA4B,EAAEC,uBAAuB;IACrDC,kBAAkB;IAClBC,iBAAiB;IACjBC,mCAAmC;IACnCC;EACD,CAAC,GAAG5B,oBAAoB,CAAC,CAAC;;EAE1B;EACA;EACA;EACA,MAAM6B,gBAAgB,GAAGlC,WAAW,CAAEY,QAAQ,EAAE,CAAEG,OAAO,CAAG,CAAC;EAC7D;EACA;EACA;EACA,MAAMoB,sBAAsB,GAAGnC,WAAW,CAAEgB,cAAc,EAAE,CAAED,OAAO,CAAG,CAAC;EACzE,MAAMqB,eAAe,GAAGrC,WAAW,CAAEqB,cAAe,CAAC;EAErD,MAAMiB,gBAAgB,GACrBjB,cAAc,KAAKL,OAAO,IAAIK,cAAc,KAAK,IAAI;;EAEtD;EACA;EACA;EACA;EACA;EACA;EACAlB,eAAe,CAAE,MAAM;IACtB,IAAKmC,gBAAgB,IAAID,eAAe,KAAK,IAAI,EAAG;MACnDZ,iBAAiB,CAAE;QAClBZ,QAAQ,EAAEsB,gBAAgB;QAC1BrB,gBAAgB;QAChBC,KAAK;QACLC;MACD,CAAE,CAAC;IACJ;IAEA,OAAO,MAAM;MACZ,IACGqB,eAAe,KAAK,IAAI,IAAI,CAAC,CAAEhB,cAAc,IAC/CA,cAAc,KAAKL,OAAO,EACzB;QACDU,mBAAmB,CAAEX,KAAM,CAAC;MAC7B;IACD,CAAC;EACF,CAAC,EAAE,CACFM,cAAc,EACdiB,gBAAgB,EAChBxB,gBAAgB,EAChBC,KAAK,EACLoB,gBAAgB,EAChBnB,OAAO,EACPqB,eAAe,EACfZ,iBAAiB,EACjBC,mBAAmB,CAClB,CAAC;EAEHxB,SAAS,CAAE,MAAM;IAChB,IAAKoC,gBAAgB,EAAG;MACvBf,sBAAsB,CAAEa,sBAAuB,CAAC;IACjD;IACA,OAAO,MAAM;MACZ,IAAKE,gBAAgB,EAAG;QACvBd,wBAAwB,CAAEY,sBAAuB,CAAC;MACnD;IACD,CAAC;EACF,CAAC,EAAE,CACFb,sBAAsB,EACtBC,wBAAwB,EACxBY,sBAAsB,EACtBE,gBAAgB,CACf,CAAC;;EAEH;EACA;EACA,MAAMC,SAAS,GAAGzB,gBAAgB,GAAG,SAAS,GAAG,UAAU;EAC3D,MAAM0B,iBAAiB,GAAGlB,SAAS,GAAIiB,SAAS,CAAE,GAAIxB,KAAK,CAAE;EAC7D,MAAM0B,kBAAkB,GAAGzC,WAAW,CAAEwC,iBAAkB,CAAC;EAC3D,MAAME,YAAY,GAAGpB,SAAS,GAAIiB,SAAS,CAAE,GAAIxB,KAAK,CAAE,KAAK4B,SAAS;EAEtE,MAAMC,UAAU,GAAG/B,QAAQ,CAAC,CAAC;EAC7B;EACA;EACAX,SAAS,CAAE,MAAM;IAChB,IAAK,CAAEY,gBAAgB,IAAI,CAAE8B,UAAU,EAAG;MACzC;IACD;IAEAjB,qBAAqB,CAAEiB,UAAU,EAAE7B,KAAK,EAAEwB,SAAU,CAAC;EACtD,CAAC,EAAE,CACFK,UAAU,EACVL,SAAS,EACTxB,KAAK,EACLY,qBAAqB,EACrBb,gBAAgB,CACf,CAAC;;EAEH;EACA;EACAZ,SAAS,CAAE,MAAM;IAChB;IACA;IACA;IACA,IAAK,CAAEwC,YAAY,IAAId,WAAW,IAAI,CAAEU,gBAAgB,EAAG;MAC1D;IACD;IAEA,IAAKE,iBAAiB,IAAI,CAAEI,UAAU,IAAI,CAAEH,kBAAkB,EAAG;MAChEtB,QAAQ,GAAG,CAAC;IACb;IAEA,IAAK,CAAEqB,iBAAiB,IAAII,UAAU,IAAIH,kBAAkB,EAAG;MAC9DvB,UAAU,GAAG,CAAC;IACf;EACD,CAAC,EAAE,CACFoB,gBAAgB,EAChBE,iBAAiB,EACjBE,YAAY,EACZd,WAAW,EACXgB,UAAU,EACVH,kBAAkB,EAClBtB,QAAQ,EACRD,UAAU,CACT,CAAC;;EAEH;EACA;EACA;EACA,MAAM2B,OAAO,GAAG/B,gBAAgB,GAC7BQ,SAAS,GAAIiB,SAAS,CAAE,GAAIxB,KAAK,CAAE,KAAK4B,SAAS,GACjDH,iBAAiB;EAEpB,MAAMM,EAAE,GAAGtC,KAAK,CAAC,CAAC;EAClB,MAAMuC,OAAO,GAAG3C,OAAO,CAAE,MAAM;IAC9B,MAAM4C,4BAA4B,GACjClB,uBAAuB,IAAI,CAAEe,OAAO;IACrC,MAAMI,cAAc,GACnBlB,kBAAkB,KAAKhB,KAAK,IAAIkB,mCAAmC;IACpE,MAAMiB,aAAa,GAClBlB,iBAAiB,KAAKjB,KAAK,IAAImB,kCAAkC;IAClE,OAAOY,EAAE,CACRzC,MAAM,CAAC8C,cAAc,EACrBH,4BAA4B,IAAI3C,MAAM,CAAC+C,yBAAyB,EAChE,CAAEJ,4BAA4B,IAAIpC,SAAS,EAC3CqC,cAAc,EACdC,aACD,CAAC;EACF,CAAC,EAAE,CACFL,OAAO,EACPf,uBAAuB,EACvBlB,SAAS,EACTkC,EAAE,EACFf,kBAAkB,EAClBC,iBAAiB,EACjBC,mCAAmC,EACnCC,kCAAkC,EAClCnB,KAAK,CACJ,CAAC;EAEH,OAAO;IACN,GAAGK,UAAU;IACbyB,OAAO;IACPf,uBAAuB;IACvBlB,SAAS,EAAEmC;EACZ,CAAC;AACF","ignoreList":[]}