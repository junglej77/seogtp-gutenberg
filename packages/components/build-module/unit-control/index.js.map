{"version":3,"names":["clsx","deprecated","forwardRef","useMemo","useRef","useEffect","__","ValueInput","UnitSelectControl","CSS_UNITS","getParsedQuantityAndUnit","getUnitsWithCurrentUnit","getValidParsedQuantityAndUnit","useControlledState","escapeRegExp","useDeprecated36pxDefaultSizeProp","jsx","_jsx","UnforwardedUnitControl","unitControlProps","forwardedRef","__unstableStateReducer","autoComplete","children","className","disabled","disableUnits","isPressEnterToChange","isResetValueOnUnitChange","isUnitSelectTabbable","label","onChange","onChangeProp","onUnitChange","size","unit","unitProp","units","unitsProp","value","valueProp","onFocus","onFocusProp","props","since","hint","version","nonNullValueProp","undefined","reFirstCharacterOfUnits","list","firstUnitValue","rest","firstCharacters","reduce","carry","first","substring","includes","RegExp","parsedQuantity","parsedUnit","setUnit","length","initial","fallback","classes","handleOnQuantityChange","nextQuantityValue","changeProps","onChangeValue","join","handleOnUnitChange","nextUnitValue","data","nextValue","default","handleOnKeyDown","event","onKeyDown","metaKey","ctrlKey","test","key","refInputSuffix","current","focus","inputSuffix","ref","__next40pxDefaultSize","onBlur","step","_activeUnit$step","activeUnit","find","option","spinControls","suffix","type","UnitControl","parseQuantityAndUnitFromRawValue","useCustomUnits"],"sources":["@wordpress/components/src/unit-control/index.tsx"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport type { KeyboardEvent, ForwardedRef, SyntheticEvent } from 'react';\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport deprecated from '@wordpress/deprecated';\r\nimport { forwardRef, useMemo, useRef, useEffect } from '@wordpress/element';\r\nimport { __ } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport type { WordPressComponentProps } from '../context';\r\nimport { ValueInput } from './styles/unit-control-styles';\r\nimport UnitSelectControl from './unit-select-control';\r\nimport {\r\n\tCSS_UNITS,\r\n\tgetParsedQuantityAndUnit,\r\n\tgetUnitsWithCurrentUnit,\r\n\tgetValidParsedQuantityAndUnit,\r\n} from './utils';\r\nimport { useControlledState } from '../utils/hooks';\r\nimport { escapeRegExp } from '../utils/strings';\r\nimport type { UnitControlProps, UnitControlOnChangeCallback } from './types';\r\nimport { useDeprecated36pxDefaultSizeProp } from '../utils/use-deprecated-props';\r\n\r\nfunction UnforwardedUnitControl(\r\n\tunitControlProps: WordPressComponentProps<\r\n\t\tUnitControlProps,\r\n\t\t'input',\r\n\t\tfalse\r\n\t>,\r\n\tforwardedRef: ForwardedRef< any >\r\n) {\r\n\tconst {\r\n\t\t__unstableStateReducer,\r\n\t\tautoComplete = 'off',\r\n\t\t// @ts-expect-error Ensure that children is omitted from restProps\r\n\t\tchildren,\r\n\t\tclassName,\r\n\t\tdisabled = false,\r\n\t\tdisableUnits = false,\r\n\t\tisPressEnterToChange = false,\r\n\t\tisResetValueOnUnitChange = false,\r\n\t\tisUnitSelectTabbable = true,\r\n\t\tlabel,\r\n\t\tonChange: onChangeProp,\r\n\t\tonUnitChange,\r\n\t\tsize = 'default',\r\n\t\tunit: unitProp,\r\n\t\tunits: unitsProp = CSS_UNITS,\r\n\t\tvalue: valueProp,\r\n\t\tonFocus: onFocusProp,\r\n\t\t...props\r\n\t} = useDeprecated36pxDefaultSizeProp( unitControlProps );\r\n\r\n\tif ( 'unit' in unitControlProps ) {\r\n\t\tdeprecated( 'UnitControl unit prop', {\r\n\t\t\tsince: '5.6',\r\n\t\t\thint: 'The unit should be provided within the `value` prop.',\r\n\t\t\tversion: '6.2',\r\n\t\t} );\r\n\t}\r\n\r\n\t// The `value` prop, in theory, should not be `null`, but the following line\r\n\t// ensures it fallback to `undefined` in case a consumer of `UnitControl`\r\n\t// still passes `null` as a `value`.\r\n\tconst nonNullValueProp = valueProp ?? undefined;\r\n\tconst [ units, reFirstCharacterOfUnits ] = useMemo( () => {\r\n\t\tconst list = getUnitsWithCurrentUnit(\r\n\t\t\tnonNullValueProp,\r\n\t\t\tunitProp,\r\n\t\t\tunitsProp\r\n\t\t);\r\n\t\tconst [ { value: firstUnitValue = '' } = {}, ...rest ] = list;\r\n\t\tconst firstCharacters = rest.reduce(\r\n\t\t\t( carry, { value } ) => {\r\n\t\t\t\tconst first = escapeRegExp( value?.substring( 0, 1 ) || '' );\r\n\t\t\t\treturn carry.includes( first )\r\n\t\t\t\t\t? carry\r\n\t\t\t\t\t: `${ carry }|${ first }`;\r\n\t\t\t},\r\n\t\t\tescapeRegExp( firstUnitValue.substring( 0, 1 ) )\r\n\t\t);\r\n\t\treturn [ list, new RegExp( `^(?:${ firstCharacters })$`, 'i' ) ];\r\n\t}, [ nonNullValueProp, unitProp, unitsProp ] );\r\n\tconst [ parsedQuantity, parsedUnit ] = getParsedQuantityAndUnit(\r\n\t\tnonNullValueProp,\r\n\t\tunitProp,\r\n\t\tunits\r\n\t);\r\n\r\n\tconst [ unit, setUnit ] = useControlledState< string | undefined >(\r\n\t\tunits.length === 1 ? units[ 0 ].value : unitProp,\r\n\t\t{\r\n\t\t\tinitial: parsedUnit,\r\n\t\t\tfallback: '',\r\n\t\t}\r\n\t);\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( parsedUnit !== undefined ) {\r\n\t\t\tsetUnit( parsedUnit );\r\n\t\t}\r\n\t}, [ parsedUnit, setUnit ] );\r\n\r\n\tconst classes = clsx(\r\n\t\t'components-unit-control',\r\n\t\t// This class is added for legacy purposes to maintain it on the outer\r\n\t\t// wrapper. See: https://github.com/WordPress/gutenberg/pull/45139\r\n\t\t'components-unit-control-wrapper',\r\n\t\tclassName\r\n\t);\r\n\r\n\tconst handleOnQuantityChange = (\r\n\t\tnextQuantityValue: number | string | undefined,\r\n\t\tchangeProps: {\r\n\t\t\tevent: SyntheticEvent;\r\n\t\t}\r\n\t) => {\r\n\t\tif (\r\n\t\t\tnextQuantityValue === '' ||\r\n\t\t\ttypeof nextQuantityValue === 'undefined' ||\r\n\t\t\tnextQuantityValue === null\r\n\t\t) {\r\n\t\t\tonChangeProp?.( '', changeProps );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t * Customizing the onChange callback.\r\n\t\t * This allows as to broadcast a combined value+unit to onChange.\r\n\t\t */\r\n\t\tconst onChangeValue = getValidParsedQuantityAndUnit(\r\n\t\t\tnextQuantityValue,\r\n\t\t\tunits,\r\n\t\t\tparsedQuantity,\r\n\t\t\tunit\r\n\t\t).join( '' );\r\n\r\n\t\tonChangeProp?.( onChangeValue, changeProps );\r\n\t};\r\n\r\n\tconst handleOnUnitChange: UnitControlOnChangeCallback = (\r\n\t\tnextUnitValue,\r\n\t\tchangeProps\r\n\t) => {\r\n\t\tconst { data } = changeProps;\r\n\r\n\t\tlet nextValue = `${ parsedQuantity ?? '' }${ nextUnitValue }`;\r\n\r\n\t\tif ( isResetValueOnUnitChange && data?.default !== undefined ) {\r\n\t\t\tnextValue = `${ data.default }${ nextUnitValue }`;\r\n\t\t}\r\n\r\n\t\tonChangeProp?.( nextValue, changeProps );\r\n\t\tonUnitChange?.( nextUnitValue, changeProps );\r\n\r\n\t\tsetUnit( nextUnitValue );\r\n\t};\r\n\r\n\tlet handleOnKeyDown;\r\n\tif ( ! disableUnits && isUnitSelectTabbable && units.length ) {\r\n\t\thandleOnKeyDown = ( event: KeyboardEvent< HTMLInputElement > ) => {\r\n\t\t\tprops.onKeyDown?.( event );\r\n\t\t\t// Unless the meta or ctrl key was pressed (to avoid interfering with\r\n\t\t\t// shortcuts, e.g. pastes), move focus to the unit select if a key\r\n\t\t\t// matches the first character of a unit.\r\n\t\t\tif (\r\n\t\t\t\t! event.metaKey &&\r\n\t\t\t\t! event.ctrlKey &&\r\n\t\t\t\treFirstCharacterOfUnits.test( event.key )\r\n\t\t\t) {\r\n\t\t\t\trefInputSuffix.current?.focus();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tconst refInputSuffix = useRef< HTMLSelectElement >( null );\r\n\tconst inputSuffix = ! disableUnits ? (\r\n\t\t<UnitSelectControl\r\n\t\t\tref={ refInputSuffix }\r\n\t\t\taria-label={ __( 'Select unit' ) }\r\n\t\t\tdisabled={ disabled }\r\n\t\t\tisUnitSelectTabbable={ isUnitSelectTabbable }\r\n\t\t\tonChange={ handleOnUnitChange }\r\n\t\t\tsize={\r\n\t\t\t\t[ 'small', 'compact' ].includes( size ) ||\r\n\t\t\t\t( size === 'default' && ! props.__next40pxDefaultSize )\r\n\t\t\t\t\t? 'small'\r\n\t\t\t\t\t: 'default'\r\n\t\t\t}\r\n\t\t\tunit={ unit }\r\n\t\t\tunits={ units }\r\n\t\t\tonFocus={ onFocusProp }\r\n\t\t\tonBlur={ unitControlProps.onBlur }\r\n\t\t/>\r\n\t) : null;\r\n\r\n\tlet step = props.step;\r\n\r\n\t/*\r\n\t * If no step prop has been passed, lookup the active unit and\r\n\t * try to get step from `units`, or default to a value of `1`\r\n\t */\r\n\tif ( ! step && units ) {\r\n\t\tconst activeUnit = units.find( ( option ) => option.value === unit );\r\n\t\tstep = activeUnit?.step ?? 1;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<ValueInput\r\n\t\t\t{ ...props }\r\n\t\t\tautoComplete={ autoComplete }\r\n\t\t\tclassName={ classes }\r\n\t\t\tdisabled={ disabled }\r\n\t\t\tspinControls=\"none\"\r\n\t\t\tisPressEnterToChange={ isPressEnterToChange }\r\n\t\t\tlabel={ label }\r\n\t\t\tonKeyDown={ handleOnKeyDown }\r\n\t\t\tonChange={ handleOnQuantityChange }\r\n\t\t\tref={ forwardedRef }\r\n\t\t\tsize={ size }\r\n\t\t\tsuffix={ inputSuffix }\r\n\t\t\ttype={ isPressEnterToChange ? 'text' : 'number' }\r\n\t\t\tvalue={ parsedQuantity ?? '' }\r\n\t\t\tstep={ step }\r\n\t\t\tonFocus={ onFocusProp }\r\n\t\t\t__unstableStateReducer={ __unstableStateReducer }\r\n\t\t/>\r\n\t);\r\n}\r\n\r\n/**\r\n * `UnitControl` allows the user to set a numeric quantity as well as a unit (e.g. `px`).\r\n *\r\n *\r\n * ```jsx\r\n * import { __experimentalUnitControl as UnitControl } from '@wordpress/components';\r\n * import { useState } from '@wordpress/element';\r\n *\r\n * const Example = () => {\r\n *   const [ value, setValue ] = useState( '10px' );\r\n *\r\n *   return <UnitControl onChange={ setValue } value={ value } />;\r\n * };\r\n * ```\r\n */\r\nexport const UnitControl = forwardRef( UnforwardedUnitControl );\r\n\r\nexport { parseQuantityAndUnitFromRawValue, useCustomUnits } from './utils';\r\nexport default UnitControl;\r\n"],"mappings":"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","ignoreList":[]}