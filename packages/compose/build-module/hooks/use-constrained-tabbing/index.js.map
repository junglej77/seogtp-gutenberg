{"version":3,"names":["focus","useRefEffect","useConstrainedTabbing","node","onKeyDown","event","key","shiftKey","target","action","nextElement","tabbable","contains","preventDefault","domAction","ownerDocument","trap","createElement","tabIndex","addEventListener","removeChild","removeEventListener"],"sources":["@wordpress/compose/src/hooks/use-constrained-tabbing/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { focus } from '@wordpress/dom';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport useRefEffect from '../use-ref-effect';\r\n\r\n/**\r\n * In Dialogs/modals, the tabbing must be constrained to the content of\r\n * the wrapper element. This hook adds the behavior to the returned ref.\r\n *\r\n * @return {import('react').RefCallback<Element>} Element Ref.\r\n *\r\n * @example\r\n * ```js\r\n * import { useConstrainedTabbing } from '@wordpress/compose';\r\n *\r\n * const ConstrainedTabbingExample = () => {\r\n *     const constrainedTabbingRef = useConstrainedTabbing()\r\n *     return (\r\n *         <div ref={ constrainedTabbingRef }>\r\n *             <Button />\r\n *             <Button />\r\n *         </div>\r\n *     );\r\n * }\r\n * ```\r\n */\r\nfunction useConstrainedTabbing() {\r\n\treturn useRefEffect( ( /** @type {HTMLElement} */ node ) => {\r\n\t\tfunction onKeyDown( /** @type {KeyboardEvent} */ event ) {\r\n\t\t\tconst { key, shiftKey, target } = event;\r\n\r\n\t\t\tif ( key !== 'Tab' ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst action = shiftKey ? 'findPrevious' : 'findNext';\r\n\t\t\tconst nextElement =\r\n\t\t\t\tfocus.tabbable[ action ](\r\n\t\t\t\t\t/** @type {HTMLElement} */ ( target )\r\n\t\t\t\t) || null;\r\n\r\n\t\t\t// When the target element contains the element that is about to\r\n\t\t\t// receive focus, for example when the target is a tabbable\r\n\t\t\t// container, browsers may disagree on where to move focus next.\r\n\t\t\t// In this case we can't rely on native browsers behavior. We need\r\n\t\t\t// to manage focus instead.\r\n\t\t\t// See https://github.com/WordPress/gutenberg/issues/46041.\r\n\t\t\tif (\r\n\t\t\t\t/** @type {HTMLElement} */ ( target ).contains( nextElement )\r\n\t\t\t) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tnextElement?.focus();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If the element that is about to receive focus is inside the\r\n\t\t\t// area, rely on native browsers behavior and let tabbing follow\r\n\t\t\t// the native tab sequence.\r\n\t\t\tif ( node.contains( nextElement ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If the element that is about to receive focus is outside the\r\n\t\t\t// area, move focus to a div and insert it at the start or end of\r\n\t\t\t// the area, depending on the direction. Without preventing default\r\n\t\t\t// behaviour, the browser will then move focus to the next element.\r\n\t\t\tconst domAction = shiftKey ? 'append' : 'prepend';\r\n\t\t\tconst { ownerDocument } = node;\r\n\t\t\tconst trap = ownerDocument.createElement( 'div' );\r\n\r\n\t\t\ttrap.tabIndex = -1;\r\n\t\t\tnode[ domAction ]( trap );\r\n\r\n\t\t\t// Remove itself when the trap loses focus.\r\n\t\t\ttrap.addEventListener( 'blur', () => node.removeChild( trap ) );\r\n\r\n\t\t\ttrap.focus();\r\n\t\t}\r\n\r\n\t\tnode.addEventListener( 'keydown', onKeyDown );\r\n\t\treturn () => {\r\n\t\t\tnode.removeEventListener( 'keydown', onKeyDown );\r\n\t\t};\r\n\t}, [] );\r\n}\r\n\r\nexport default useConstrainedTabbing;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,KAAK,QAAQ,gBAAgB;;AAEtC;AACA;AACA;AACA,OAAOC,YAAY,MAAM,mBAAmB;;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,qBAAqBA,CAAA,EAAG;EAChC,OAAOD,YAAY,CAAE,EAAE,0BAA2BE,IAAI,KAAM;IAC3D,SAASC,SAASA,CAAA,CAAE,4BAA6BC,KAAK,EAAG;MACxD,MAAM;QAAEC,GAAG;QAAEC,QAAQ;QAAEC;MAAO,CAAC,GAAGH,KAAK;MAEvC,IAAKC,GAAG,KAAK,KAAK,EAAG;QACpB;MACD;MAEA,MAAMG,MAAM,GAAGF,QAAQ,GAAG,cAAc,GAAG,UAAU;MACrD,MAAMG,WAAW,GAChBV,KAAK,CAACW,QAAQ,CAAEF,MAAM,CAAE,EACvB,0BAA6BD,MAC9B,CAAC,IAAI,IAAI;;MAEV;MACA;MACA;MACA;MACA;MACA;MACA,KACC,0BAA6BA,MAAM,CAAGI,QAAQ,CAAEF,WAAY,CAAC,EAC5D;QACDL,KAAK,CAACQ,cAAc,CAAC,CAAC;QACtBH,WAAW,EAAEV,KAAK,CAAC,CAAC;QACpB;MACD;;MAEA;MACA;MACA;MACA,IAAKG,IAAI,CAACS,QAAQ,CAAEF,WAAY,CAAC,EAAG;QACnC;MACD;;MAEA;MACA;MACA;MACA;MACA,MAAMI,SAAS,GAAGP,QAAQ,GAAG,QAAQ,GAAG,SAAS;MACjD,MAAM;QAAEQ;MAAc,CAAC,GAAGZ,IAAI;MAC9B,MAAMa,IAAI,GAAGD,aAAa,CAACE,aAAa,CAAE,KAAM,CAAC;MAEjDD,IAAI,CAACE,QAAQ,GAAG,CAAC,CAAC;MAClBf,IAAI,CAAEW,SAAS,CAAE,CAAEE,IAAK,CAAC;;MAEzB;MACAA,IAAI,CAACG,gBAAgB,CAAE,MAAM,EAAE,MAAMhB,IAAI,CAACiB,WAAW,CAAEJ,IAAK,CAAE,CAAC;MAE/DA,IAAI,CAAChB,KAAK,CAAC,CAAC;IACb;IAEAG,IAAI,CAACgB,gBAAgB,CAAE,SAAS,EAAEf,SAAU,CAAC;IAC7C,OAAO,MAAM;MACZD,IAAI,CAACkB,mBAAmB,CAAE,SAAS,EAAEjB,SAAU,CAAC;IACjD,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;AACR;AAEA,eAAeF,qBAAqB","ignoreList":[]}