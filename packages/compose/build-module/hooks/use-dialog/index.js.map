{"version":3,"names":["useRef","useEffect","useCallback","ESCAPE","useConstrainedTabbing","useFocusOnMount","useFocusReturn","useFocusOutside","useMergeRefs","useDialog","options","currentOptions","constrainTabbing","focusOnMount","current","Object","values","constrainedTabbingRef","focusOnMountRef","focusReturnRef","focusOutsideProps","event","__unstableOnClose","onClose","closeOnEscapeRef","node","addEventListener","keyCode","defaultPrevented","preventDefault","tabIndex"],"sources":["@wordpress/compose/src/hooks/use-dialog/index.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport type { RefCallback, SyntheticEvent } from 'react';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useRef, useEffect, useCallback } from '@wordpress/element';\r\nimport { ESCAPE } from '@wordpress/keycodes';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport useConstrainedTabbing from '../use-constrained-tabbing';\r\nimport useFocusOnMount from '../use-focus-on-mount';\r\nimport useFocusReturn from '../use-focus-return';\r\nimport useFocusOutside from '../use-focus-outside';\r\nimport useMergeRefs from '../use-merge-refs';\r\n\r\ntype DialogOptions = {\r\n\t/**\r\n\t * Determines whether focus should be automatically moved to the popover\r\n\t * when it mounts. `false` causes no focus shift, `true` causes the popover\r\n\t * itself to gain focus, and `firstElement` focuses the first focusable\r\n\t * element within the popover.\r\n\t *\r\n\t * @default 'firstElement'\r\n\t */\r\n\tfocusOnMount?: Parameters< typeof useFocusOnMount >[ 0 ];\r\n\t/**\r\n\t * Determines whether tabbing is constrained to within the popover,\r\n\t * preventing keyboard focus from leaving the popover content without\r\n\t * explicit focus elsewhere, or whether the popover remains part of the\r\n\t * wider tab order.\r\n\t * If no value is passed, it will be derived from `focusOnMount`.\r\n\t *\r\n\t * @see focusOnMount\r\n\t * @default `focusOnMount` !== false\r\n\t */\r\n\tconstrainTabbing?: boolean;\r\n\tonClose?: () => void;\r\n\t/**\r\n\t * Use the `onClose` prop instead.\r\n\t *\r\n\t * @deprecated\r\n\t */\r\n\t__unstableOnClose?: (\r\n\t\ttype: string | undefined,\r\n\t\tevent: SyntheticEvent\r\n\t) => void;\r\n};\r\n\r\ntype useDialogReturn = [\r\n\tRefCallback< HTMLElement >,\r\n\tReturnType< typeof useFocusOutside > & Pick< HTMLElement, 'tabIndex' >,\r\n];\r\n\r\n/**\r\n * Returns a ref and props to apply to a dialog wrapper to enable the following behaviors:\r\n *  - constrained tabbing.\r\n *  - focus on mount.\r\n *  - return focus on unmount.\r\n *  - focus outside.\r\n *\r\n * @param options Dialog Options.\r\n */\r\nfunction useDialog( options: DialogOptions ): useDialogReturn {\r\n\tconst currentOptions = useRef< DialogOptions | undefined >();\r\n\tconst { constrainTabbing = options.focusOnMount !== false } = options;\r\n\tuseEffect( () => {\r\n\t\tcurrentOptions.current = options;\r\n\t}, Object.values( options ) );\r\n\tconst constrainedTabbingRef = useConstrainedTabbing();\r\n\tconst focusOnMountRef = useFocusOnMount( options.focusOnMount );\r\n\tconst focusReturnRef = useFocusReturn();\r\n\tconst focusOutsideProps = useFocusOutside( ( event ) => {\r\n\t\t// This unstable prop  is here only to manage backward compatibility\r\n\t\t// for the Popover component otherwise, the onClose should be enough.\r\n\t\tif ( currentOptions.current?.__unstableOnClose ) {\r\n\t\t\tcurrentOptions.current.__unstableOnClose( 'focus-outside', event );\r\n\t\t} else if ( currentOptions.current?.onClose ) {\r\n\t\t\tcurrentOptions.current.onClose();\r\n\t\t}\r\n\t} );\r\n\tconst closeOnEscapeRef = useCallback( ( node: HTMLElement ) => {\r\n\t\tif ( ! node ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnode.addEventListener( 'keydown', ( event: KeyboardEvent ) => {\r\n\t\t\t// Close on escape.\r\n\t\t\tif (\r\n\t\t\t\tevent.keyCode === ESCAPE &&\r\n\t\t\t\t! event.defaultPrevented &&\r\n\t\t\t\tcurrentOptions.current?.onClose\r\n\t\t\t) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tcurrentOptions.current.onClose();\r\n\t\t\t}\r\n\t\t} );\r\n\t}, [] );\r\n\r\n\treturn [\r\n\t\tuseMergeRefs( [\r\n\t\t\tconstrainTabbing ? constrainedTabbingRef : null,\r\n\t\t\toptions.focusOnMount !== false ? focusReturnRef : null,\r\n\t\t\toptions.focusOnMount !== false ? focusOnMountRef : null,\r\n\t\t\tcloseOnEscapeRef,\r\n\t\t] ),\r\n\t\t{\r\n\t\t\t...focusOutsideProps,\r\n\t\t\ttabIndex: -1,\r\n\t\t},\r\n\t];\r\n}\r\n\r\nexport default useDialog;\r\n"],"mappings":"AAAA;AACA;AACA;;AAGA;AACA;AACA;AACA,SAASA,MAAM,EAAEC,SAAS,EAAEC,WAAW,QAAQ,oBAAoB;AACnE,SAASC,MAAM,QAAQ,qBAAqB;;AAE5C;AACA;AACA;AACA,OAAOC,qBAAqB,MAAM,4BAA4B;AAC9D,OAAOC,eAAe,MAAM,uBAAuB;AACnD,OAAOC,cAAc,MAAM,qBAAqB;AAChD,OAAOC,eAAe,MAAM,sBAAsB;AAClD,OAAOC,YAAY,MAAM,mBAAmB;AAwC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,SAASA,CAAEC,OAAsB,EAAoB;EAC7D,MAAMC,cAAc,GAAGX,MAAM,CAA8B,CAAC;EAC5D,MAAM;IAAEY,gBAAgB,GAAGF,OAAO,CAACG,YAAY,KAAK;EAAM,CAAC,GAAGH,OAAO;EACrET,SAAS,CAAE,MAAM;IAChBU,cAAc,CAACG,OAAO,GAAGJ,OAAO;EACjC,CAAC,EAAEK,MAAM,CAACC,MAAM,CAAEN,OAAQ,CAAE,CAAC;EAC7B,MAAMO,qBAAqB,GAAGb,qBAAqB,CAAC,CAAC;EACrD,MAAMc,eAAe,GAAGb,eAAe,CAAEK,OAAO,CAACG,YAAa,CAAC;EAC/D,MAAMM,cAAc,GAAGb,cAAc,CAAC,CAAC;EACvC,MAAMc,iBAAiB,GAAGb,eAAe,CAAIc,KAAK,IAAM;IACvD;IACA;IACA,IAAKV,cAAc,CAACG,OAAO,EAAEQ,iBAAiB,EAAG;MAChDX,cAAc,CAACG,OAAO,CAACQ,iBAAiB,CAAE,eAAe,EAAED,KAAM,CAAC;IACnE,CAAC,MAAM,IAAKV,cAAc,CAACG,OAAO,EAAES,OAAO,EAAG;MAC7CZ,cAAc,CAACG,OAAO,CAACS,OAAO,CAAC,CAAC;IACjC;EACD,CAAE,CAAC;EACH,MAAMC,gBAAgB,GAAGtB,WAAW,CAAIuB,IAAiB,IAAM;IAC9D,IAAK,CAAEA,IAAI,EAAG;MACb;IACD;IAEAA,IAAI,CAACC,gBAAgB,CAAE,SAAS,EAAIL,KAAoB,IAAM;MAC7D;MACA,IACCA,KAAK,CAACM,OAAO,KAAKxB,MAAM,IACxB,CAAEkB,KAAK,CAACO,gBAAgB,IACxBjB,cAAc,CAACG,OAAO,EAAES,OAAO,EAC9B;QACDF,KAAK,CAACQ,cAAc,CAAC,CAAC;QACtBlB,cAAc,CAACG,OAAO,CAACS,OAAO,CAAC,CAAC;MACjC;IACD,CAAE,CAAC;EACJ,CAAC,EAAE,EAAG,CAAC;EAEP,OAAO,CACNf,YAAY,CAAE,CACbI,gBAAgB,GAAGK,qBAAqB,GAAG,IAAI,EAC/CP,OAAO,CAACG,YAAY,KAAK,KAAK,GAAGM,cAAc,GAAG,IAAI,EACtDT,OAAO,CAACG,YAAY,KAAK,KAAK,GAAGK,eAAe,GAAG,IAAI,EACvDM,gBAAgB,CACf,CAAC,EACH;IACC,GAAGJ,iBAAiB;IACpBU,QAAQ,EAAE,CAAC;EACZ,CAAC,CACD;AACF;AAEA,eAAerB,SAAS","ignoreList":[]}