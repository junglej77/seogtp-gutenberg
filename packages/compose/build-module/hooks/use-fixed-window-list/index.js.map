{"version":3,"names":["useState","useLayoutEffect","getScrollContainer","PAGEUP","PAGEDOWN","HOME","END","debounce","DEFAULT_INIT_WINDOW_SIZE","useFixedWindowList","elementRef","itemHeight","totalItems","options","_options$initWindowSi","_options$useWindowing","initWindowSize","useWindowing","fixedListWindow","setFixedListWindow","visibleItems","start","end","itemInView","index","scrollContainer","current","measureWindow","initRender","_options$windowOversc","Math","ceil","clientHeight","windowOverscan","firstViewableIndex","floor","scrollTop","max","min","lastWindow","nextWindow","debounceMeasureList","addEventListener","ownerDocument","defaultView","removeEventListener","expandedState","handleKeyDown","event","keyCode","scrollTo","top"],"sources":["@wordpress/compose/src/hooks/use-fixed-window-list/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useState, useLayoutEffect } from '@wordpress/element';\r\nimport { getScrollContainer } from '@wordpress/dom';\r\nimport { PAGEUP, PAGEDOWN, HOME, END } from '@wordpress/keycodes';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { debounce } from '../../utils/debounce';\r\n\r\nconst DEFAULT_INIT_WINDOW_SIZE = 30;\r\n\r\n/**\r\n * @typedef {Object} WPFixedWindowList\r\n *\r\n * @property {number}                  visibleItems Items visible in the current viewport\r\n * @property {number}                  start        Start index of the window\r\n * @property {number}                  end          End index of the window\r\n * @property {(index:number)=>boolean} itemInView   Returns true if item is in the window\r\n */\r\n\r\n/**\r\n * @typedef {Object} WPFixedWindowListOptions\r\n *\r\n * @property {number}  [windowOverscan] Renders windowOverscan number of items before and after the calculated visible window.\r\n * @property {boolean} [useWindowing]   When false avoids calculating the window size\r\n * @property {number}  [initWindowSize] Initial window size to use on first render before we can calculate the window size.\r\n * @property {any}     [expandedState]  Used to recalculate the window size when the expanded state of a list changes.\r\n */\r\n\r\n/**\r\n *\r\n * @param {import('react').RefObject<HTMLElement>} elementRef Used to find the closest scroll container that contains element.\r\n * @param { number }                               itemHeight Fixed item height in pixels\r\n * @param { number }                               totalItems Total items in list\r\n * @param { WPFixedWindowListOptions }             [options]  Options object\r\n * @return {[ WPFixedWindowList, setFixedListWindow:(nextWindow:WPFixedWindowList)=>void]} Array with the fixed window list and setter\r\n */\r\nexport default function useFixedWindowList(\r\n\telementRef,\r\n\titemHeight,\r\n\ttotalItems,\r\n\toptions\r\n) {\r\n\tconst initWindowSize = options?.initWindowSize ?? DEFAULT_INIT_WINDOW_SIZE;\r\n\tconst useWindowing = options?.useWindowing ?? true;\r\n\r\n\tconst [ fixedListWindow, setFixedListWindow ] = useState( {\r\n\t\tvisibleItems: initWindowSize,\r\n\t\tstart: 0,\r\n\t\tend: initWindowSize,\r\n\t\titemInView: ( /** @type {number} */ index ) => {\r\n\t\t\treturn index >= 0 && index <= initWindowSize;\r\n\t\t},\r\n\t} );\r\n\r\n\tuseLayoutEffect( () => {\r\n\t\tif ( ! useWindowing ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst scrollContainer = getScrollContainer( elementRef.current );\r\n\t\tconst measureWindow = (\r\n\t\t\t/** @type {boolean | undefined} */ initRender\r\n\t\t) => {\r\n\t\t\tif ( ! scrollContainer ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst visibleItems = Math.ceil(\r\n\t\t\t\tscrollContainer.clientHeight / itemHeight\r\n\t\t\t);\r\n\t\t\t// Aim to keep opening list view fast, afterward we can optimize for scrolling.\r\n\t\t\tconst windowOverscan = initRender\r\n\t\t\t\t? visibleItems\r\n\t\t\t\t: options?.windowOverscan ?? visibleItems;\r\n\t\t\tconst firstViewableIndex = Math.floor(\r\n\t\t\t\tscrollContainer.scrollTop / itemHeight\r\n\t\t\t);\r\n\t\t\tconst start = Math.max( 0, firstViewableIndex - windowOverscan );\r\n\t\t\tconst end = Math.min(\r\n\t\t\t\ttotalItems - 1,\r\n\t\t\t\tfirstViewableIndex + visibleItems + windowOverscan\r\n\t\t\t);\r\n\t\t\tsetFixedListWindow( ( lastWindow ) => {\r\n\t\t\t\tconst nextWindow = {\r\n\t\t\t\t\tvisibleItems,\r\n\t\t\t\t\tstart,\r\n\t\t\t\t\tend,\r\n\t\t\t\t\titemInView: ( /** @type {number} */ index ) => {\r\n\t\t\t\t\t\treturn start <= index && index <= end;\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t\tif (\r\n\t\t\t\t\tlastWindow.start !== nextWindow.start ||\r\n\t\t\t\t\tlastWindow.end !== nextWindow.end ||\r\n\t\t\t\t\tlastWindow.visibleItems !== nextWindow.visibleItems\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn nextWindow;\r\n\t\t\t\t}\r\n\t\t\t\treturn lastWindow;\r\n\t\t\t} );\r\n\t\t};\r\n\r\n\t\tmeasureWindow( true );\r\n\t\tconst debounceMeasureList = debounce( () => {\r\n\t\t\tmeasureWindow();\r\n\t\t}, 16 );\r\n\t\tscrollContainer?.addEventListener( 'scroll', debounceMeasureList );\r\n\t\tscrollContainer?.ownerDocument?.defaultView?.addEventListener(\r\n\t\t\t'resize',\r\n\t\t\tdebounceMeasureList\r\n\t\t);\r\n\t\tscrollContainer?.ownerDocument?.defaultView?.addEventListener(\r\n\t\t\t'resize',\r\n\t\t\tdebounceMeasureList\r\n\t\t);\r\n\r\n\t\treturn () => {\r\n\t\t\tscrollContainer?.removeEventListener(\r\n\t\t\t\t'scroll',\r\n\t\t\t\tdebounceMeasureList\r\n\t\t\t);\r\n\t\t\tscrollContainer?.ownerDocument?.defaultView?.removeEventListener(\r\n\t\t\t\t'resize',\r\n\t\t\t\tdebounceMeasureList\r\n\t\t\t);\r\n\t\t};\r\n\t}, [\r\n\t\titemHeight,\r\n\t\telementRef,\r\n\t\ttotalItems,\r\n\t\toptions?.expandedState,\r\n\t\toptions?.windowOverscan,\r\n\t\tuseWindowing,\r\n\t] );\r\n\r\n\tuseLayoutEffect( () => {\r\n\t\tif ( ! useWindowing ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst scrollContainer = getScrollContainer( elementRef.current );\r\n\t\tconst handleKeyDown = ( /** @type {KeyboardEvent} */ event ) => {\r\n\t\t\tswitch ( event.keyCode ) {\r\n\t\t\t\tcase HOME: {\r\n\t\t\t\t\treturn scrollContainer?.scrollTo( { top: 0 } );\r\n\t\t\t\t}\r\n\t\t\t\tcase END: {\r\n\t\t\t\t\treturn scrollContainer?.scrollTo( {\r\n\t\t\t\t\t\ttop: totalItems * itemHeight,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t\tcase PAGEUP: {\r\n\t\t\t\t\treturn scrollContainer?.scrollTo( {\r\n\t\t\t\t\t\ttop:\r\n\t\t\t\t\t\t\tscrollContainer.scrollTop -\r\n\t\t\t\t\t\t\tfixedListWindow.visibleItems * itemHeight,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t\tcase PAGEDOWN: {\r\n\t\t\t\t\treturn scrollContainer?.scrollTo( {\r\n\t\t\t\t\t\ttop:\r\n\t\t\t\t\t\t\tscrollContainer.scrollTop +\r\n\t\t\t\t\t\t\tfixedListWindow.visibleItems * itemHeight,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tscrollContainer?.ownerDocument?.defaultView?.addEventListener(\r\n\t\t\t'keydown',\r\n\t\t\thandleKeyDown\r\n\t\t);\r\n\t\treturn () => {\r\n\t\t\tscrollContainer?.ownerDocument?.defaultView?.removeEventListener(\r\n\t\t\t\t'keydown',\r\n\t\t\t\thandleKeyDown\r\n\t\t\t);\r\n\t\t};\r\n\t}, [\r\n\t\ttotalItems,\r\n\t\titemHeight,\r\n\t\telementRef,\r\n\t\tfixedListWindow.visibleItems,\r\n\t\tuseWindowing,\r\n\t\toptions?.expandedState,\r\n\t] );\r\n\r\n\treturn [ fixedListWindow, setFixedListWindow ];\r\n}\r\n"],"mappings":"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","ignoreList":[]}