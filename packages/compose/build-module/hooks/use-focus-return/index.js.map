{"version":3,"names":["useRef","useEffect","useCallback","origin","useFocusReturn","onFocusReturn","ref","focusedBeforeMount","onFocusReturnRef","current","node","ownerDocument","activeElement","isFocused","contains","isConnected","_origin","focus"],"sources":["@wordpress/compose/src/hooks/use-focus-return/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useRef, useEffect, useCallback } from '@wordpress/element';\r\n\r\n/** @type {Element|null} */\r\nlet origin = null;\r\n\r\n/**\r\n * Adds the unmount behavior of returning focus to the element which had it\r\n * previously as is expected for roles like menus or dialogs.\r\n *\r\n * @param {() => void} [onFocusReturn] Overrides the default return behavior.\r\n * @return {import('react').RefCallback<HTMLElement>} Element Ref.\r\n *\r\n * @example\r\n * ```js\r\n * import { useFocusReturn } from '@wordpress/compose';\r\n *\r\n * const WithFocusReturn = () => {\r\n *     const ref = useFocusReturn()\r\n *     return (\r\n *         <div ref={ ref }>\r\n *             <Button />\r\n *             <Button />\r\n *         </div>\r\n *     );\r\n * }\r\n * ```\r\n */\r\nfunction useFocusReturn( onFocusReturn ) {\r\n\t/** @type {import('react').MutableRefObject<null | HTMLElement>} */\r\n\tconst ref = useRef( null );\r\n\t/** @type {import('react').MutableRefObject<null | Element>} */\r\n\tconst focusedBeforeMount = useRef( null );\r\n\tconst onFocusReturnRef = useRef( onFocusReturn );\r\n\tuseEffect( () => {\r\n\t\tonFocusReturnRef.current = onFocusReturn;\r\n\t}, [ onFocusReturn ] );\r\n\r\n\treturn useCallback( ( node ) => {\r\n\t\tif ( node ) {\r\n\t\t\t// Set ref to be used when unmounting.\r\n\t\t\tref.current = node;\r\n\r\n\t\t\t// Only set when the node mounts.\r\n\t\t\tif ( focusedBeforeMount.current ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfocusedBeforeMount.current = node.ownerDocument.activeElement;\r\n\t\t} else if ( focusedBeforeMount.current ) {\r\n\t\t\tconst isFocused = ref.current?.contains(\r\n\t\t\t\tref.current?.ownerDocument.activeElement\r\n\t\t\t);\r\n\r\n\t\t\tif ( ref.current?.isConnected && ! isFocused ) {\r\n\t\t\t\torigin ??= focusedBeforeMount.current;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Defer to the component's own explicit focus return behavior, if\r\n\t\t\t// specified. This allows for support that the `onFocusReturn`\r\n\t\t\t// decides to allow the default behavior to occur under some\r\n\t\t\t// conditions.\r\n\t\t\tif ( onFocusReturnRef.current ) {\r\n\t\t\t\tonFocusReturnRef.current();\r\n\t\t\t} else {\r\n\t\t\t\t/** @type {null|HTMLElement} */ (\r\n\t\t\t\t\t! focusedBeforeMount.current.isConnected\r\n\t\t\t\t\t\t? origin\r\n\t\t\t\t\t\t: focusedBeforeMount.current\r\n\t\t\t\t)?.focus();\r\n\t\t\t}\r\n\t\t\torigin = null;\r\n\t\t}\r\n\t}, [] );\r\n}\r\n\r\nexport default useFocusReturn;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAM,EAAEC,SAAS,EAAEC,WAAW,QAAQ,oBAAoB;;AAEnE;AACA,IAAIC,MAAM,GAAG,IAAI;;AAEjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,cAAcA,CAAEC,aAAa,EAAG;EACxC;EACA,MAAMC,GAAG,GAAGN,MAAM,CAAE,IAAK,CAAC;EAC1B;EACA,MAAMO,kBAAkB,GAAGP,MAAM,CAAE,IAAK,CAAC;EACzC,MAAMQ,gBAAgB,GAAGR,MAAM,CAAEK,aAAc,CAAC;EAChDJ,SAAS,CAAE,MAAM;IAChBO,gBAAgB,CAACC,OAAO,GAAGJ,aAAa;EACzC,CAAC,EAAE,CAAEA,aAAa,CAAG,CAAC;EAEtB,OAAOH,WAAW,CAAIQ,IAAI,IAAM;IAC/B,IAAKA,IAAI,EAAG;MACX;MACAJ,GAAG,CAACG,OAAO,GAAGC,IAAI;;MAElB;MACA,IAAKH,kBAAkB,CAACE,OAAO,EAAG;QACjC;MACD;MAEAF,kBAAkB,CAACE,OAAO,GAAGC,IAAI,CAACC,aAAa,CAACC,aAAa;IAC9D,CAAC,MAAM,IAAKL,kBAAkB,CAACE,OAAO,EAAG;MACxC,MAAMI,SAAS,GAAGP,GAAG,CAACG,OAAO,EAAEK,QAAQ,CACtCR,GAAG,CAACG,OAAO,EAAEE,aAAa,CAACC,aAC5B,CAAC;MAED,IAAKN,GAAG,CAACG,OAAO,EAAEM,WAAW,IAAI,CAAEF,SAAS,EAAG;QAAA,IAAAG,OAAA;QAC9C,CAAAA,OAAA,GAAAb,MAAM,cAAAa,OAAA,cAAAA,OAAA,GAANb,MAAM,GAAKI,kBAAkB,CAACE,OAAO;QACrC;MACD;;MAEA;MACA;MACA;MACA;MACA,IAAKD,gBAAgB,CAACC,OAAO,EAAG;QAC/BD,gBAAgB,CAACC,OAAO,CAAC,CAAC;MAC3B,CAAC,MAAM;QACN,+BAAgC,CAC/B,CAAEF,kBAAkB,CAACE,OAAO,CAACM,WAAW,GACrCZ,MAAM,GACNI,kBAAkB,CAACE,OAAO,GAC3BQ,KAAK,CAAC,CAAC;MACX;MACAd,MAAM,GAAG,IAAI;IACd;EACD,CAAC,EAAE,EAAG,CAAC;AACR;AAEA,eAAeC,cAAc","ignoreList":[]}