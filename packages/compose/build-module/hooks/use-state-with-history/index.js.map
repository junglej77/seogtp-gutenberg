{"version":3,"names":["createUndoManager","useCallback","useReducer","undoRedoReducer","state","action","type","undoRecord","manager","undo","value","changes","prop","from","redoRecord","redo","to","addRecord","id","isStaged","initReducer","useStateWithHistory","initialValue","dispatch","setValue","newValue","hasUndo","hasRedo"],"sources":["@wordpress/compose/src/hooks/use-state-with-history/index.ts"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createUndoManager } from '@wordpress/undo-manager';\r\nimport { useCallback, useReducer } from '@wordpress/element';\r\nimport type { UndoManager } from '@wordpress/undo-manager';\r\n\r\ntype UndoRedoState< T > = {\r\n\tmanager: UndoManager;\r\n\tvalue: T;\r\n};\r\n\r\nfunction undoRedoReducer< T >(\r\n\tstate: UndoRedoState< T >,\r\n\taction:\r\n\t\t| { type: 'UNDO' }\r\n\t\t| { type: 'REDO' }\r\n\t\t| { type: 'RECORD'; value: T; isStaged: boolean }\r\n): UndoRedoState< T > {\r\n\tswitch ( action.type ) {\r\n\t\tcase 'UNDO': {\r\n\t\t\tconst undoRecord = state.manager.undo();\r\n\t\t\tif ( undoRecord ) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tvalue: undoRecord[ 0 ].changes.prop.from,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn state;\r\n\t\t}\r\n\t\tcase 'REDO': {\r\n\t\t\tconst redoRecord = state.manager.redo();\r\n\t\t\tif ( redoRecord ) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...state,\r\n\t\t\t\t\tvalue: redoRecord[ 0 ].changes.prop.to,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn state;\r\n\t\t}\r\n\t\tcase 'RECORD': {\r\n\t\t\tstate.manager.addRecord(\r\n\t\t\t\t[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: 'object',\r\n\t\t\t\t\t\tchanges: {\r\n\t\t\t\t\t\t\tprop: { from: state.value, to: action.value },\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\taction.isStaged\r\n\t\t\t);\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tvalue: action.value,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\treturn state;\r\n}\r\n\r\nfunction initReducer< T >( value: T ) {\r\n\treturn {\r\n\t\tmanager: createUndoManager(),\r\n\t\tvalue,\r\n\t};\r\n}\r\n\r\n/**\r\n * useState with undo/redo history.\r\n *\r\n * @param initialValue Initial value.\r\n * @return Value, setValue, hasUndo, hasRedo, undo, redo.\r\n */\r\nexport default function useStateWithHistory< T >( initialValue: T ) {\r\n\tconst [ state, dispatch ] = useReducer(\r\n\t\tundoRedoReducer,\r\n\t\tinitialValue,\r\n\t\tinitReducer\r\n\t);\r\n\r\n\treturn {\r\n\t\tvalue: state.value,\r\n\t\tsetValue: useCallback( ( newValue: T, isStaged: boolean ) => {\r\n\t\t\tdispatch( {\r\n\t\t\t\ttype: 'RECORD',\r\n\t\t\t\tvalue: newValue,\r\n\t\t\t\tisStaged,\r\n\t\t\t} );\r\n\t\t}, [] ),\r\n\t\thasUndo: state.manager.hasUndo(),\r\n\t\thasRedo: state.manager.hasRedo(),\r\n\t\tundo: useCallback( () => {\r\n\t\t\tdispatch( { type: 'UNDO' } );\r\n\t\t}, [] ),\r\n\t\tredo: useCallback( () => {\r\n\t\t\tdispatch( { type: 'REDO' } );\r\n\t\t}, [] ),\r\n\t};\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,iBAAiB,QAAQ,yBAAyB;AAC3D,SAASC,WAAW,EAAEC,UAAU,QAAQ,oBAAoB;AAQ5D,SAASC,eAAeA,CACvBC,KAAyB,EACzBC,MAGkD,EAC7B;EACrB,QAASA,MAAM,CAACC,IAAI;IACnB,KAAK,MAAM;MAAE;QACZ,MAAMC,UAAU,GAAGH,KAAK,CAACI,OAAO,CAACC,IAAI,CAAC,CAAC;QACvC,IAAKF,UAAU,EAAG;UACjB,OAAO;YACN,GAAGH,KAAK;YACRM,KAAK,EAAEH,UAAU,CAAE,CAAC,CAAE,CAACI,OAAO,CAACC,IAAI,CAACC;UACrC,CAAC;QACF;QACA,OAAOT,KAAK;MACb;IACA,KAAK,MAAM;MAAE;QACZ,MAAMU,UAAU,GAAGV,KAAK,CAACI,OAAO,CAACO,IAAI,CAAC,CAAC;QACvC,IAAKD,UAAU,EAAG;UACjB,OAAO;YACN,GAAGV,KAAK;YACRM,KAAK,EAAEI,UAAU,CAAE,CAAC,CAAE,CAACH,OAAO,CAACC,IAAI,CAACI;UACrC,CAAC;QACF;QACA,OAAOZ,KAAK;MACb;IACA,KAAK,QAAQ;MAAE;QACdA,KAAK,CAACI,OAAO,CAACS,SAAS,CACtB,CACC;UACCC,EAAE,EAAE,QAAQ;UACZP,OAAO,EAAE;YACRC,IAAI,EAAE;cAAEC,IAAI,EAAET,KAAK,CAACM,KAAK;cAAEM,EAAE,EAAEX,MAAM,CAACK;YAAM;UAC7C;QACD,CAAC,CACD,EACDL,MAAM,CAACc,QACR,CAAC;QACD,OAAO;UACN,GAAGf,KAAK;UACRM,KAAK,EAAEL,MAAM,CAACK;QACf,CAAC;MACF;EACD;EAEA,OAAON,KAAK;AACb;AAEA,SAASgB,WAAWA,CAAOV,KAAQ,EAAG;EACrC,OAAO;IACNF,OAAO,EAAER,iBAAiB,CAAC,CAAC;IAC5BU;EACD,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASW,mBAAmBA,CAAOC,YAAe,EAAG;EACnE,MAAM,CAAElB,KAAK,EAAEmB,QAAQ,CAAE,GAAGrB,UAAU,CACrCC,eAAe,EACfmB,YAAY,EACZF,WACD,CAAC;EAED,OAAO;IACNV,KAAK,EAAEN,KAAK,CAACM,KAAK;IAClBc,QAAQ,EAAEvB,WAAW,CAAE,CAAEwB,QAAW,EAAEN,QAAiB,KAAM;MAC5DI,QAAQ,CAAE;QACTjB,IAAI,EAAE,QAAQ;QACdI,KAAK,EAAEe,QAAQ;QACfN;MACD,CAAE,CAAC;IACJ,CAAC,EAAE,EAAG,CAAC;IACPO,OAAO,EAAEtB,KAAK,CAACI,OAAO,CAACkB,OAAO,CAAC,CAAC;IAChCC,OAAO,EAAEvB,KAAK,CAACI,OAAO,CAACmB,OAAO,CAAC,CAAC;IAChClB,IAAI,EAAER,WAAW,CAAE,MAAM;MACxBsB,QAAQ,CAAE;QAAEjB,IAAI,EAAE;MAAO,CAAE,CAAC;IAC7B,CAAC,EAAE,EAAG,CAAC;IACPS,IAAI,EAAEd,WAAW,CAAE,MAAM;MACxBsB,QAAQ,CAAE;QAAEjB,IAAI,EAAE;MAAO,CAAE,CAAC;IAC7B,CAAC,EAAE,EAAG;EACP,CAAC;AACF","ignoreList":[]}