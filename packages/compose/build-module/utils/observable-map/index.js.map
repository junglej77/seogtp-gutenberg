{"version":3,"names":["observableMap","map","Map","listeners","callListeners","name","list","get","listener","set","value","delete","subscribe","Set","add","size"],"sources":["@wordpress/compose/src/utils/observable-map/index.ts"],"sourcesContent":["export type ObservableMap< K, V > = {\r\n\tget: ( name: K ) => V | undefined;\r\n\tset: ( name: K, value: V ) => void;\r\n\tdelete: ( name: K ) => void;\r\n\tsubscribe: ( name: K, listener: () => void ) => () => void;\r\n};\r\n\r\n/**\r\n * A constructor (factory) for `ObservableMap`, a map-like key/value data structure\r\n * where the individual entries are observable: using the `subscribe` method, you can\r\n * subscribe to updates for a particular keys. Each subscriber always observes one\r\n * specific key and is not notified about any unrelated changes (for different keys)\r\n * in the `ObservableMap`.\r\n *\r\n * @template K The type of the keys in the map.\r\n * @template V The type of the values in the map.\r\n * @return   A new instance of the `ObservableMap` type.\r\n */\r\nexport function observableMap< K, V >(): ObservableMap< K, V > {\r\n\tconst map = new Map< K, V >();\r\n\tconst listeners = new Map< K, Set< () => void > >();\r\n\r\n\tfunction callListeners( name: K ) {\r\n\t\tconst list = listeners.get( name );\r\n\t\tif ( ! list ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor ( const listener of list ) {\r\n\t\t\tlistener();\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tget( name ) {\r\n\t\t\treturn map.get( name );\r\n\t\t},\r\n\t\tset( name, value ) {\r\n\t\t\tmap.set( name, value );\r\n\t\t\tcallListeners( name );\r\n\t\t},\r\n\t\tdelete( name ) {\r\n\t\t\tmap.delete( name );\r\n\t\t\tcallListeners( name );\r\n\t\t},\r\n\t\tsubscribe( name, listener ) {\r\n\t\t\tlet list = listeners.get( name );\r\n\t\t\tif ( ! list ) {\r\n\t\t\t\tlist = new Set();\r\n\t\t\t\tlisteners.set( name, list );\r\n\t\t\t}\r\n\t\t\tlist.add( listener );\r\n\r\n\t\t\treturn () => {\r\n\t\t\t\tlist.delete( listener );\r\n\t\t\t\tif ( list.size === 0 ) {\r\n\t\t\t\t\tlisteners.delete( name );\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t};\r\n}\r\n"],"mappings":"AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASA,aAAaA,CAAA,EAAkC;EAC9D,MAAMC,GAAG,GAAG,IAAIC,GAAG,CAAS,CAAC;EAC7B,MAAMC,SAAS,GAAG,IAAID,GAAG,CAAyB,CAAC;EAEnD,SAASE,aAAaA,CAAEC,IAAO,EAAG;IACjC,MAAMC,IAAI,GAAGH,SAAS,CAACI,GAAG,CAAEF,IAAK,CAAC;IAClC,IAAK,CAAEC,IAAI,EAAG;MACb;IACD;IACA,KAAM,MAAME,QAAQ,IAAIF,IAAI,EAAG;MAC9BE,QAAQ,CAAC,CAAC;IACX;EACD;EAEA,OAAO;IACND,GAAGA,CAAEF,IAAI,EAAG;MACX,OAAOJ,GAAG,CAACM,GAAG,CAAEF,IAAK,CAAC;IACvB,CAAC;IACDI,GAAGA,CAAEJ,IAAI,EAAEK,KAAK,EAAG;MAClBT,GAAG,CAACQ,GAAG,CAAEJ,IAAI,EAAEK,KAAM,CAAC;MACtBN,aAAa,CAAEC,IAAK,CAAC;IACtB,CAAC;IACDM,MAAMA,CAAEN,IAAI,EAAG;MACdJ,GAAG,CAACU,MAAM,CAAEN,IAAK,CAAC;MAClBD,aAAa,CAAEC,IAAK,CAAC;IACtB,CAAC;IACDO,SAASA,CAAEP,IAAI,EAAEG,QAAQ,EAAG;MAC3B,IAAIF,IAAI,GAAGH,SAAS,CAACI,GAAG,CAAEF,IAAK,CAAC;MAChC,IAAK,CAAEC,IAAI,EAAG;QACbA,IAAI,GAAG,IAAIO,GAAG,CAAC,CAAC;QAChBV,SAAS,CAACM,GAAG,CAAEJ,IAAI,EAAEC,IAAK,CAAC;MAC5B;MACAA,IAAI,CAACQ,GAAG,CAAEN,QAAS,CAAC;MAEpB,OAAO,MAAM;QACZF,IAAI,CAACK,MAAM,CAAEH,QAAS,CAAC;QACvB,IAAKF,IAAI,CAACS,IAAI,KAAK,CAAC,EAAG;UACtBZ,SAAS,CAACQ,MAAM,CAAEN,IAAK,CAAC;QACzB;MACD,CAAC;IACF;EACD,CAAC;AACF","ignoreList":[]}