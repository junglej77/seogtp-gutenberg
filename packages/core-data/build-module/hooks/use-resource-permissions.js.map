{"version":3,"names":["deprecated","warning","store","coreStore","Status","useQuerySelect","useResourcePermissions","resource","id","isEntity","resourceAsString","JSON","stringify","globalThis","SCRIPT_DEBUG","resolve","hasId","canUser","create","kind","name","read","isResolving","hasResolved","status","Idle","Resolving","Success","canCreate","data","canRead","update","_delete","canUpdate","canDelete","__experimentalUseResourcePermissions","alternative","since"],"sources":["@wordpress/core-data/src/hooks/use-resource-permissions.ts"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport deprecated from '@wordpress/deprecated';\r\nimport warning from '@wordpress/warning';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as coreStore } from '../';\r\nimport { Status } from './constants';\r\nimport useQuerySelect from './use-query-select';\r\n\r\ninterface GlobalResourcePermissionsResolution {\r\n\t/** Can the current user create new resources of this type? */\r\n\tcanCreate: boolean;\r\n}\r\ninterface SpecificResourcePermissionsResolution {\r\n\t/** Can the current user update resources of this type? */\r\n\tcanUpdate: boolean;\r\n\t/** Can the current user delete resources of this type? */\r\n\tcanDelete: boolean;\r\n}\r\ninterface ResolutionDetails {\r\n\t/** Resolution status */\r\n\tstatus: Status;\r\n\t/**\r\n\t * Is the data still being resolved?\r\n\t */\r\n\tisResolving: boolean;\r\n}\r\n\r\n/**\r\n * Is the data resolved by now?\r\n */\r\ntype HasResolved = boolean;\r\n\r\ntype ResourcePermissionsResolution< IdType > = [\r\n\tHasResolved,\r\n\tResolutionDetails &\r\n\t\tGlobalResourcePermissionsResolution &\r\n\t\t( IdType extends void ? SpecificResourcePermissionsResolution : {} ),\r\n];\r\n\r\ntype EntityResource = { kind: string; name: string; id?: string | number };\r\n\r\nfunction useResourcePermissions< IdType = void >(\r\n\tresource: string,\r\n\tid?: IdType\r\n): ResourcePermissionsResolution< IdType >;\r\n\r\nfunction useResourcePermissions< IdType = void >(\r\n\tresource: EntityResource,\r\n\tid?: never\r\n): ResourcePermissionsResolution< IdType >;\r\n\r\n/**\r\n * Resolves resource permissions.\r\n *\r\n * @since 6.1.0 Introduced in WordPress core.\r\n *\r\n * @param    resource Entity resource to check. Accepts entity object `{ kind: 'root', name: 'media', id: 1 }`\r\n *                    or REST base as a string - `media`.\r\n * @param    id       Optional ID of the resource to check, e.g. 10. Note: This argument is discouraged\r\n *                    when using an entity object as a resource to check permissions and will be ignored.\r\n *\r\n * @example\r\n * ```js\r\n * import { useResourcePermissions } from '@wordpress/core-data';\r\n *\r\n * function PagesList() {\r\n *   const { canCreate, isResolving } = useResourcePermissions( { kind: 'postType', name: 'page' } );\r\n *\r\n *   if ( isResolving ) {\r\n *     return 'Loading ...';\r\n *   }\r\n *\r\n *   return (\r\n *     <div>\r\n *       {canCreate ? (<button>+ Create a new page</button>) : false}\r\n *       // ...\r\n *     </div>\r\n *   );\r\n * }\r\n *\r\n * // Rendered in the application:\r\n * // <PagesList />\r\n * ```\r\n *\r\n * @example\r\n * ```js\r\n * import { useResourcePermissions } from '@wordpress/core-data';\r\n *\r\n * function Page({ pageId }) {\r\n *   const {\r\n *     canCreate,\r\n *     canUpdate,\r\n *     canDelete,\r\n *     isResolving\r\n *   } = useResourcePermissions( { kind: 'postType', name: 'page', id: pageId } );\r\n *\r\n *   if ( isResolving ) {\r\n *     return 'Loading ...';\r\n *   }\r\n *\r\n *   return (\r\n *     <div>\r\n *       {canCreate ? (<button>+ Create a new page</button>) : false}\r\n *       {canUpdate ? (<button>Edit page</button>) : false}\r\n *       {canDelete ? (<button>Delete page</button>) : false}\r\n *       // ...\r\n *     </div>\r\n *   );\r\n * }\r\n *\r\n * // Rendered in the application:\r\n * // <Page pageId={ 15 } />\r\n * ```\r\n *\r\n * In the above example, when `PagesList` is rendered into an\r\n * application, the appropriate permissions and the resolution details will be retrieved from\r\n * the store state using `canUser()`, or resolved if missing.\r\n *\r\n * @return Entity records data.\r\n * @template IdType\r\n */\r\nfunction useResourcePermissions< IdType = void >(\r\n\tresource: string | EntityResource,\r\n\tid?: IdType\r\n): ResourcePermissionsResolution< IdType > {\r\n\t// Serialize `resource` to a string that can be safely used as a React dep.\r\n\t// We can't just pass `resource` as one of the deps, because if it is passed\r\n\t// as an object literal, then it will be a different object on each call even\r\n\t// if the values remain the same.\r\n\tconst isEntity = typeof resource === 'object';\r\n\tconst resourceAsString = isEntity ? JSON.stringify( resource ) : resource;\r\n\r\n\tif ( isEntity && typeof id !== 'undefined' ) {\r\n\t\twarning(\r\n\t\t\t`When 'resource' is an entity object, passing 'id' as a separate argument isn't supported.`\r\n\t\t);\r\n\t}\r\n\r\n\treturn useQuerySelect(\r\n\t\t( resolve ) => {\r\n\t\t\tconst hasId = isEntity ? !! resource.id : !! id;\r\n\t\t\tconst { canUser } = resolve( coreStore );\r\n\t\t\tconst create = canUser(\r\n\t\t\t\t'create',\r\n\t\t\t\tisEntity\r\n\t\t\t\t\t? { kind: resource.kind, name: resource.name }\r\n\t\t\t\t\t: resource\r\n\t\t\t);\r\n\r\n\t\t\tif ( ! hasId ) {\r\n\t\t\t\tconst read = canUser( 'read', resource );\r\n\r\n\t\t\t\tconst isResolving = create.isResolving || read.isResolving;\r\n\t\t\t\tconst hasResolved = create.hasResolved && read.hasResolved;\r\n\t\t\t\tlet status = Status.Idle;\r\n\t\t\t\tif ( isResolving ) {\r\n\t\t\t\t\tstatus = Status.Resolving;\r\n\t\t\t\t} else if ( hasResolved ) {\r\n\t\t\t\t\tstatus = Status.Success;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstatus,\r\n\t\t\t\t\tisResolving,\r\n\t\t\t\t\thasResolved,\r\n\t\t\t\t\tcanCreate: create.hasResolved && create.data,\r\n\t\t\t\t\tcanRead: read.hasResolved && read.data,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tconst read = canUser( 'read', resource, id );\r\n\t\t\tconst update = canUser( 'update', resource, id );\r\n\t\t\tconst _delete = canUser( 'delete', resource, id );\r\n\t\t\tconst isResolving =\r\n\t\t\t\tread.isResolving ||\r\n\t\t\t\tcreate.isResolving ||\r\n\t\t\t\tupdate.isResolving ||\r\n\t\t\t\t_delete.isResolving;\r\n\t\t\tconst hasResolved =\r\n\t\t\t\tread.hasResolved &&\r\n\t\t\t\tcreate.hasResolved &&\r\n\t\t\t\tupdate.hasResolved &&\r\n\t\t\t\t_delete.hasResolved;\r\n\r\n\t\t\tlet status = Status.Idle;\r\n\t\t\tif ( isResolving ) {\r\n\t\t\t\tstatus = Status.Resolving;\r\n\t\t\t} else if ( hasResolved ) {\r\n\t\t\t\tstatus = Status.Success;\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tstatus,\r\n\t\t\t\tisResolving,\r\n\t\t\t\thasResolved,\r\n\t\t\t\tcanRead: hasResolved && read.data,\r\n\t\t\t\tcanCreate: hasResolved && create.data,\r\n\t\t\t\tcanUpdate: hasResolved && update.data,\r\n\t\t\t\tcanDelete: hasResolved && _delete.data,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ resourceAsString, id ]\r\n\t);\r\n}\r\n\r\nexport default useResourcePermissions;\r\n\r\nexport function __experimentalUseResourcePermissions(\r\n\tresource: string,\r\n\tid?: unknown\r\n) {\r\n\tdeprecated( `wp.data.__experimentalUseResourcePermissions`, {\r\n\t\talternative: 'wp.data.useResourcePermissions',\r\n\t\tsince: '6.1',\r\n\t} );\r\n\treturn useResourcePermissions( resource, id );\r\n}\r\n"],"mappings":"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","ignoreList":[]}