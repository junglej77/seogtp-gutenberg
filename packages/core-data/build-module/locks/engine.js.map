{"version":3,"names":["reducer","isLockAvailable","getPendingLockRequests","createLocks","state","undefined","type","processPendingLockRequests","request","store","path","exclusive","notifyAcquired","lock","acquire","Promise","resolve","release"],"sources":["@wordpress/core-data/src/locks/engine.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport reducer from './reducer';\r\nimport { isLockAvailable, getPendingLockRequests } from './selectors';\r\n\r\nexport default function createLocks() {\r\n\tlet state = reducer( undefined, { type: '@@INIT' } );\r\n\r\n\tfunction processPendingLockRequests() {\r\n\t\tfor ( const request of getPendingLockRequests( state ) ) {\r\n\t\t\tconst { store, path, exclusive, notifyAcquired } = request;\r\n\t\t\tif ( isLockAvailable( state, store, path, { exclusive } ) ) {\r\n\t\t\t\tconst lock = { store, path, exclusive };\r\n\t\t\t\tstate = reducer( state, {\r\n\t\t\t\t\ttype: 'GRANT_LOCK_REQUEST',\r\n\t\t\t\t\tlock,\r\n\t\t\t\t\trequest,\r\n\t\t\t\t} );\r\n\t\t\t\tnotifyAcquired( lock );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction acquire( store, path, exclusive ) {\r\n\t\treturn new Promise( ( resolve ) => {\r\n\t\t\tstate = reducer( state, {\r\n\t\t\t\ttype: 'ENQUEUE_LOCK_REQUEST',\r\n\t\t\t\trequest: { store, path, exclusive, notifyAcquired: resolve },\r\n\t\t\t} );\r\n\t\t\tprocessPendingLockRequests();\r\n\t\t} );\r\n\t}\r\n\tfunction release( lock ) {\r\n\t\tstate = reducer( state, {\r\n\t\t\ttype: 'RELEASE_LOCK',\r\n\t\t\tlock,\r\n\t\t} );\r\n\t\tprocessPendingLockRequests();\r\n\t}\r\n\r\n\treturn { acquire, release };\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,OAAO,MAAM,WAAW;AAC/B,SAASC,eAAe,EAAEC,sBAAsB,QAAQ,aAAa;AAErE,eAAe,SAASC,WAAWA,CAAA,EAAG;EACrC,IAAIC,KAAK,GAAGJ,OAAO,CAAEK,SAAS,EAAE;IAAEC,IAAI,EAAE;EAAS,CAAE,CAAC;EAEpD,SAASC,0BAA0BA,CAAA,EAAG;IACrC,KAAM,MAAMC,OAAO,IAAIN,sBAAsB,CAAEE,KAAM,CAAC,EAAG;MACxD,MAAM;QAAEK,KAAK;QAAEC,IAAI;QAAEC,SAAS;QAAEC;MAAe,CAAC,GAAGJ,OAAO;MAC1D,IAAKP,eAAe,CAAEG,KAAK,EAAEK,KAAK,EAAEC,IAAI,EAAE;QAAEC;MAAU,CAAE,CAAC,EAAG;QAC3D,MAAME,IAAI,GAAG;UAAEJ,KAAK;UAAEC,IAAI;UAAEC;QAAU,CAAC;QACvCP,KAAK,GAAGJ,OAAO,CAAEI,KAAK,EAAE;UACvBE,IAAI,EAAE,oBAAoB;UAC1BO,IAAI;UACJL;QACD,CAAE,CAAC;QACHI,cAAc,CAAEC,IAAK,CAAC;MACvB;IACD;EACD;EAEA,SAASC,OAAOA,CAAEL,KAAK,EAAEC,IAAI,EAAEC,SAAS,EAAG;IAC1C,OAAO,IAAII,OAAO,CAAIC,OAAO,IAAM;MAClCZ,KAAK,GAAGJ,OAAO,CAAEI,KAAK,EAAE;QACvBE,IAAI,EAAE,sBAAsB;QAC5BE,OAAO,EAAE;UAAEC,KAAK;UAAEC,IAAI;UAAEC,SAAS;UAAEC,cAAc,EAAEI;QAAQ;MAC5D,CAAE,CAAC;MACHT,0BAA0B,CAAC,CAAC;IAC7B,CAAE,CAAC;EACJ;EACA,SAASU,OAAOA,CAAEJ,IAAI,EAAG;IACxBT,KAAK,GAAGJ,OAAO,CAAEI,KAAK,EAAE;MACvBE,IAAI,EAAE,cAAc;MACpBO;IACD,CAAE,CAAC;IACHN,0BAA0B,CAAC,CAAC;EAC7B;EAEA,OAAO;IAAEO,OAAO;IAAEG;EAAQ,CAAC;AAC5B","ignoreList":[]}