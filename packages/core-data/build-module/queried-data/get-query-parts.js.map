{"version":3,"names":["addQueryArgs","withWeakMapCache","getNormalizedCommaSeparable","getQueryParts","query","parts","stableKey","page","perPage","fields","include","context","keys","Object","sort","i","length","key","value","Number","_getNormalizedCommaSe","join","_getNormalizedCommaSe2","toString","map","slice"],"sources":["@wordpress/core-data/src/queried-data/get-query-parts.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { addQueryArgs } from '@wordpress/url';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { withWeakMapCache, getNormalizedCommaSeparable } from '../utils';\r\n\r\n/**\r\n * An object of properties describing a specific query.\r\n *\r\n * @typedef {Object} WPQueriedDataQueryParts\r\n *\r\n * @property {number}      page      The query page (1-based index, default 1).\r\n * @property {number}      perPage   Items per page for query (default 10).\r\n * @property {string}      stableKey An encoded stable string of all non-\r\n *                                   pagination, non-fields query parameters.\r\n * @property {?(string[])} fields    Target subset of fields to derive from\r\n *                                   item objects.\r\n * @property {?(number[])} include   Specific item IDs to include.\r\n * @property {string}      context   Scope under which the request is made;\r\n *                                   determines returned fields in response.\r\n */\r\n\r\n/**\r\n * Given a query object, returns an object of parts, including pagination\r\n * details (`page` and `perPage`, or default values). All other properties are\r\n * encoded into a stable (idempotent) `stableKey` value.\r\n *\r\n * @param {Object} query Optional query object.\r\n *\r\n * @return {WPQueriedDataQueryParts} Query parts.\r\n */\r\nexport function getQueryParts( query ) {\r\n\t/**\r\n\t * @type {WPQueriedDataQueryParts}\r\n\t */\r\n\tconst parts = {\r\n\t\tstableKey: '',\r\n\t\tpage: 1,\r\n\t\tperPage: 10,\r\n\t\tfields: null,\r\n\t\tinclude: null,\r\n\t\tcontext: 'default',\r\n\t};\r\n\r\n\t// Ensure stable key by sorting keys. Also more efficient for iterating.\r\n\tconst keys = Object.keys( query ).sort();\r\n\r\n\tfor ( let i = 0; i < keys.length; i++ ) {\r\n\t\tconst key = keys[ i ];\r\n\t\tlet value = query[ key ];\r\n\r\n\t\tswitch ( key ) {\r\n\t\t\tcase 'page':\r\n\t\t\t\tparts[ key ] = Number( value );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'per_page':\r\n\t\t\t\tparts.perPage = Number( value );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'context':\r\n\t\t\t\tparts.context = value;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\t// While in theory, we could exclude \"_fields\" from the stableKey\r\n\t\t\t\t// because two request with different fields have the same results\r\n\t\t\t\t// We're not able to ensure that because the server can decide to omit\r\n\t\t\t\t// fields from the response even if we explicitly asked for it.\r\n\t\t\t\t// Example: Asking for titles in posts without title support.\r\n\t\t\t\tif ( key === '_fields' ) {\r\n\t\t\t\t\tparts.fields = getNormalizedCommaSeparable( value ) ?? [];\r\n\t\t\t\t\t// Make sure to normalize value for `stableKey`\r\n\t\t\t\t\tvalue = parts.fields.join();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Two requests with different include values cannot have same results.\r\n\t\t\t\tif ( key === 'include' ) {\r\n\t\t\t\t\tif ( typeof value === 'number' ) {\r\n\t\t\t\t\t\tvalue = value.toString();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparts.include = (\r\n\t\t\t\t\t\tgetNormalizedCommaSeparable( value ) ?? []\r\n\t\t\t\t\t).map( Number );\r\n\t\t\t\t\t// Normalize value for `stableKey`.\r\n\t\t\t\t\tvalue = parts.include.join();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// While it could be any deterministic string, for simplicity's\r\n\t\t\t\t// sake mimic querystring encoding for stable key.\r\n\t\t\t\t//\r\n\t\t\t\t// TODO: For consistency with PHP implementation, addQueryArgs\r\n\t\t\t\t// should accept a key value pair, which may optimize its\r\n\t\t\t\t// implementation for our use here, vs. iterating an object\r\n\t\t\t\t// with only a single key.\r\n\t\t\t\tparts.stableKey +=\r\n\t\t\t\t\t( parts.stableKey ? '&' : '' ) +\r\n\t\t\t\t\taddQueryArgs( '', { [ key ]: value } ).slice( 1 );\r\n\t\t}\r\n\t}\r\n\r\n\treturn parts;\r\n}\r\n\r\nexport default withWeakMapCache( getQueryParts );\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,YAAY,QAAQ,gBAAgB;;AAE7C;AACA;AACA;AACA,SAASC,gBAAgB,EAAEC,2BAA2B,QAAQ,UAAU;;AAExE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,aAAaA,CAAEC,KAAK,EAAG;EACtC;AACD;AACA;EACC,MAAMC,KAAK,GAAG;IACbC,SAAS,EAAE,EAAE;IACbC,IAAI,EAAE,CAAC;IACPC,OAAO,EAAE,EAAE;IACXC,MAAM,EAAE,IAAI;IACZC,OAAO,EAAE,IAAI;IACbC,OAAO,EAAE;EACV,CAAC;;EAED;EACA,MAAMC,IAAI,GAAGC,MAAM,CAACD,IAAI,CAAER,KAAM,CAAC,CAACU,IAAI,CAAC,CAAC;EAExC,KAAM,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,IAAI,CAACI,MAAM,EAAED,CAAC,EAAE,EAAG;IACvC,MAAME,GAAG,GAAGL,IAAI,CAAEG,CAAC,CAAE;IACrB,IAAIG,KAAK,GAAGd,KAAK,CAAEa,GAAG,CAAE;IAExB,QAASA,GAAG;MACX,KAAK,MAAM;QACVZ,KAAK,CAAEY,GAAG,CAAE,GAAGE,MAAM,CAAED,KAAM,CAAC;QAC9B;MAED,KAAK,UAAU;QACdb,KAAK,CAACG,OAAO,GAAGW,MAAM,CAAED,KAAM,CAAC;QAC/B;MAED,KAAK,SAAS;QACbb,KAAK,CAACM,OAAO,GAAGO,KAAK;QACrB;MAED;QACC;QACA;QACA;QACA;QACA;QACA,IAAKD,GAAG,KAAK,SAAS,EAAG;UAAA,IAAAG,qBAAA;UACxBf,KAAK,CAACI,MAAM,IAAAW,qBAAA,GAAGlB,2BAA2B,CAAEgB,KAAM,CAAC,cAAAE,qBAAA,cAAAA,qBAAA,GAAI,EAAE;UACzD;UACAF,KAAK,GAAGb,KAAK,CAACI,MAAM,CAACY,IAAI,CAAC,CAAC;QAC5B;;QAEA;QACA,IAAKJ,GAAG,KAAK,SAAS,EAAG;UAAA,IAAAK,sBAAA;UACxB,IAAK,OAAOJ,KAAK,KAAK,QAAQ,EAAG;YAChCA,KAAK,GAAGA,KAAK,CAACK,QAAQ,CAAC,CAAC;UACzB;UACAlB,KAAK,CAACK,OAAO,GAAG,EAAAY,sBAAA,GACfpB,2BAA2B,CAAEgB,KAAM,CAAC,cAAAI,sBAAA,cAAAA,sBAAA,GAAI,EAAE,EACzCE,GAAG,CAAEL,MAAO,CAAC;UACf;UACAD,KAAK,GAAGb,KAAK,CAACK,OAAO,CAACW,IAAI,CAAC,CAAC;QAC7B;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACAhB,KAAK,CAACC,SAAS,IACd,CAAED,KAAK,CAACC,SAAS,GAAG,GAAG,GAAG,EAAE,IAC5BN,YAAY,CAAE,EAAE,EAAE;UAAE,CAAEiB,GAAG,GAAIC;QAAM,CAAE,CAAC,CAACO,KAAK,CAAE,CAAE,CAAC;IACpD;EACD;EAEA,OAAOpB,KAAK;AACb;AAEA,eAAeJ,gBAAgB,CAAEE,aAAc,CAAC","ignoreList":[]}