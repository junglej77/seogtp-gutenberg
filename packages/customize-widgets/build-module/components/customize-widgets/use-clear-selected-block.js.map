{"version":3,"names":["useEffect","useDispatch","useSelect","store","blockEditorStore","useClearSelectedBlock","sidebarControl","popoverRef","hasSelectedBlock","hasMultiSelection","clearSelectedBlock","current","inspector","container","ownerDocument","ownerWindow","defaultView","handleClearSelectedBlock","element","contains","closest","expanded","handleMouseDown","event","target","handleBlur","activeElement","addEventListener","removeEventListener"],"sources":["@wordpress/customize-widgets/src/components/customize-widgets/use-clear-selected-block.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useEffect } from '@wordpress/element';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { store as blockEditorStore } from '@wordpress/block-editor';\r\n\r\n/**\r\n * We can't just use <BlockSelectionClearer> because the customizer has\r\n * many root nodes rather than just one in the post editor.\r\n * We need to listen to the focus events in all those roots, and also in\r\n * the preview iframe.\r\n * This hook will clear the selected block when focusing outside the editor,\r\n * with a few exceptions:\r\n * 1. Focusing on popovers.\r\n * 2. Focusing on the inspector.\r\n * 3. Focusing on any modals/dialogs.\r\n * These cases are normally triggered by user interactions from the editor,\r\n * not by explicitly focusing outside the editor, hence no need for clearing.\r\n *\r\n * @param {Object} sidebarControl The sidebar control instance.\r\n * @param {Object} popoverRef     The ref object of the popover node container.\r\n */\r\nexport default function useClearSelectedBlock( sidebarControl, popoverRef ) {\r\n\tconst { hasSelectedBlock, hasMultiSelection } =\r\n\t\tuseSelect( blockEditorStore );\r\n\tconst { clearSelectedBlock } = useDispatch( blockEditorStore );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( popoverRef.current && sidebarControl ) {\r\n\t\t\tconst inspector = sidebarControl.inspector;\r\n\t\t\tconst container = sidebarControl.container[ 0 ];\r\n\t\t\tconst ownerDocument = container.ownerDocument;\r\n\t\t\tconst ownerWindow = ownerDocument.defaultView;\r\n\r\n\t\t\tfunction handleClearSelectedBlock( element ) {\r\n\t\t\t\tif (\r\n\t\t\t\t\t// 1. Make sure there are blocks being selected.\r\n\t\t\t\t\t( hasSelectedBlock() || hasMultiSelection() ) &&\r\n\t\t\t\t\t// 2. The element should exist in the DOM (not deleted).\r\n\t\t\t\t\telement &&\r\n\t\t\t\t\townerDocument.contains( element ) &&\r\n\t\t\t\t\t// 3. It should also not exist in the container, the popover, nor the dialog.\r\n\t\t\t\t\t! container.contains( element ) &&\r\n\t\t\t\t\t! popoverRef.current.contains( element ) &&\r\n\t\t\t\t\t! element.closest( '[role=\"dialog\"]' ) &&\r\n\t\t\t\t\t// 4. The inspector should not be opened.\r\n\t\t\t\t\t! inspector.expanded()\r\n\t\t\t\t) {\r\n\t\t\t\t\tclearSelectedBlock();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Handle mouse down in the same document.\r\n\t\t\tfunction handleMouseDown( event ) {\r\n\t\t\t\thandleClearSelectedBlock( event.target );\r\n\t\t\t}\r\n\t\t\t// Handle focusing outside the current document, like to iframes.\r\n\t\t\tfunction handleBlur() {\r\n\t\t\t\thandleClearSelectedBlock( ownerDocument.activeElement );\r\n\t\t\t}\r\n\r\n\t\t\townerDocument.addEventListener( 'mousedown', handleMouseDown );\r\n\t\t\townerWindow.addEventListener( 'blur', handleBlur );\r\n\r\n\t\t\treturn () => {\r\n\t\t\t\townerDocument.removeEventListener(\r\n\t\t\t\t\t'mousedown',\r\n\t\t\t\t\thandleMouseDown\r\n\t\t\t\t);\r\n\t\t\t\townerWindow.removeEventListener( 'blur', handleBlur );\r\n\t\t\t};\r\n\t\t}\r\n\t}, [\r\n\t\tpopoverRef,\r\n\t\tsidebarControl,\r\n\t\thasSelectedBlock,\r\n\t\thasMultiSelection,\r\n\t\tclearSelectedBlock,\r\n\t] );\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,QAAQ,oBAAoB;AAC9C,SAASC,WAAW,EAAEC,SAAS,QAAQ,iBAAiB;AACxD,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,yBAAyB;;AAEnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,qBAAqBA,CAAEC,cAAc,EAAEC,UAAU,EAAG;EAC3E,MAAM;IAAEC,gBAAgB;IAAEC;EAAkB,CAAC,GAC5CP,SAAS,CAAEE,gBAAiB,CAAC;EAC9B,MAAM;IAAEM;EAAmB,CAAC,GAAGT,WAAW,CAAEG,gBAAiB,CAAC;EAE9DJ,SAAS,CAAE,MAAM;IAChB,IAAKO,UAAU,CAACI,OAAO,IAAIL,cAAc,EAAG;MAC3C,MAAMM,SAAS,GAAGN,cAAc,CAACM,SAAS;MAC1C,MAAMC,SAAS,GAAGP,cAAc,CAACO,SAAS,CAAE,CAAC,CAAE;MAC/C,MAAMC,aAAa,GAAGD,SAAS,CAACC,aAAa;MAC7C,MAAMC,WAAW,GAAGD,aAAa,CAACE,WAAW;MAE7C,SAASC,wBAAwBA,CAAEC,OAAO,EAAG;QAC5C;QACC;QACA,CAAEV,gBAAgB,CAAC,CAAC,IAAIC,iBAAiB,CAAC,CAAC;QAC3C;QACAS,OAAO,IACPJ,aAAa,CAACK,QAAQ,CAAED,OAAQ,CAAC;QACjC;QACA,CAAEL,SAAS,CAACM,QAAQ,CAAED,OAAQ,CAAC,IAC/B,CAAEX,UAAU,CAACI,OAAO,CAACQ,QAAQ,CAAED,OAAQ,CAAC,IACxC,CAAEA,OAAO,CAACE,OAAO,CAAE,iBAAkB,CAAC;QACtC;QACA,CAAER,SAAS,CAACS,QAAQ,CAAC,CAAC,EACrB;UACDX,kBAAkB,CAAC,CAAC;QACrB;MACD;;MAEA;MACA,SAASY,eAAeA,CAAEC,KAAK,EAAG;QACjCN,wBAAwB,CAAEM,KAAK,CAACC,MAAO,CAAC;MACzC;MACA;MACA,SAASC,UAAUA,CAAA,EAAG;QACrBR,wBAAwB,CAAEH,aAAa,CAACY,aAAc,CAAC;MACxD;MAEAZ,aAAa,CAACa,gBAAgB,CAAE,WAAW,EAAEL,eAAgB,CAAC;MAC9DP,WAAW,CAACY,gBAAgB,CAAE,MAAM,EAAEF,UAAW,CAAC;MAElD,OAAO,MAAM;QACZX,aAAa,CAACc,mBAAmB,CAChC,WAAW,EACXN,eACD,CAAC;QACDP,WAAW,CAACa,mBAAmB,CAAE,MAAM,EAAEH,UAAW,CAAC;MACtD,CAAC;IACF;EACD,CAAC,EAAE,CACFlB,UAAU,EACVD,cAAc,EACdE,gBAAgB,EAChBC,iBAAiB,EACjBC,kBAAkB,CACjB,CAAC;AACJ","ignoreList":[]}