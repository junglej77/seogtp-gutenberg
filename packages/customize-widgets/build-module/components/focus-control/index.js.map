{"version":3,"names":["createContext","useState","useEffect","useContext","useCallback","useMemo","settingIdToWidgetId","jsx","_jsx","FocusControlContext","FocusControl","api","sidebarControls","children","focusedWidgetIdRef","setFocusedWidgetIdRef","current","focusWidget","widgetId","sidebarControl","widgets","setting","get","includes","sectionInstance","expand","completeCallback","handleFocus","settingId","previewBound","handleReady","previewer","preview","bind","unbind","context","Provider","value","useFocusControl"],"sources":["@wordpress/customize-widgets/src/components/focus-control/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tcreateContext,\r\n\tuseState,\r\n\tuseEffect,\r\n\tuseContext,\r\n\tuseCallback,\r\n\tuseMemo,\r\n} from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { settingIdToWidgetId } from '../../utils';\r\n\r\nconst FocusControlContext = createContext();\r\n\r\nexport default function FocusControl( { api, sidebarControls, children } ) {\r\n\tconst [ focusedWidgetIdRef, setFocusedWidgetIdRef ] = useState( {\r\n\t\tcurrent: null,\r\n\t} );\r\n\r\n\tconst focusWidget = useCallback(\r\n\t\t( widgetId ) => {\r\n\t\t\tfor ( const sidebarControl of sidebarControls ) {\r\n\t\t\t\tconst widgets = sidebarControl.setting.get();\r\n\r\n\t\t\t\tif ( widgets.includes( widgetId ) ) {\r\n\t\t\t\t\tsidebarControl.sectionInstance.expand( {\r\n\t\t\t\t\t\t// Schedule it after the complete callback so that\r\n\t\t\t\t\t\t// it won't be overridden by the \"Back\" button focus.\r\n\t\t\t\t\t\tcompleteCallback() {\r\n\t\t\t\t\t\t\t// Create a \"ref-like\" object every time to ensure\r\n\t\t\t\t\t\t\t// the same widget id can also triggers the focus control.\r\n\t\t\t\t\t\t\tsetFocusedWidgetIdRef( { current: widgetId } );\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t[ sidebarControls ]\r\n\t);\r\n\r\n\tuseEffect( () => {\r\n\t\tfunction handleFocus( settingId ) {\r\n\t\t\tconst widgetId = settingIdToWidgetId( settingId );\r\n\r\n\t\t\tfocusWidget( widgetId );\r\n\t\t}\r\n\r\n\t\tlet previewBound = false;\r\n\r\n\t\tfunction handleReady() {\r\n\t\t\tapi.previewer.preview.bind(\r\n\t\t\t\t'focus-control-for-setting',\r\n\t\t\t\thandleFocus\r\n\t\t\t);\r\n\t\t\tpreviewBound = true;\r\n\t\t}\r\n\r\n\t\tapi.previewer.bind( 'ready', handleReady );\r\n\r\n\t\treturn () => {\r\n\t\t\tapi.previewer.unbind( 'ready', handleReady );\r\n\t\t\tif ( previewBound ) {\r\n\t\t\t\tapi.previewer.preview.unbind(\r\n\t\t\t\t\t'focus-control-for-setting',\r\n\t\t\t\t\thandleFocus\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\t}, [ api, focusWidget ] );\r\n\r\n\tconst context = useMemo(\r\n\t\t() => [ focusedWidgetIdRef, focusWidget ],\r\n\t\t[ focusedWidgetIdRef, focusWidget ]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<FocusControlContext.Provider value={ context }>\r\n\t\t\t{ children }\r\n\t\t</FocusControlContext.Provider>\r\n\t);\r\n}\r\n\r\nexport const useFocusControl = () => useContext( FocusControlContext );\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SACCA,aAAa,EACbC,QAAQ,EACRC,SAAS,EACTC,UAAU,EACVC,WAAW,EACXC,OAAO,QACD,oBAAoB;;AAE3B;AACA;AACA;AACA,SAASC,mBAAmB,QAAQ,aAAa;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAElD,MAAMC,mBAAmB,GAAGT,aAAa,CAAC,CAAC;AAE3C,eAAe,SAASU,YAAYA,CAAE;EAAEC,GAAG;EAAEC,eAAe;EAAEC;AAAS,CAAC,EAAG;EAC1E,MAAM,CAAEC,kBAAkB,EAAEC,qBAAqB,CAAE,GAAGd,QAAQ,CAAE;IAC/De,OAAO,EAAE;EACV,CAAE,CAAC;EAEH,MAAMC,WAAW,GAAGb,WAAW,CAC5Bc,QAAQ,IAAM;IACf,KAAM,MAAMC,cAAc,IAAIP,eAAe,EAAG;MAC/C,MAAMQ,OAAO,GAAGD,cAAc,CAACE,OAAO,CAACC,GAAG,CAAC,CAAC;MAE5C,IAAKF,OAAO,CAACG,QAAQ,CAAEL,QAAS,CAAC,EAAG;QACnCC,cAAc,CAACK,eAAe,CAACC,MAAM,CAAE;UACtC;UACA;UACAC,gBAAgBA,CAAA,EAAG;YAClB;YACA;YACAX,qBAAqB,CAAE;cAAEC,OAAO,EAAEE;YAAS,CAAE,CAAC;UAC/C;QACD,CAAE,CAAC;QAEH;MACD;IACD;EACD,CAAC,EACD,CAAEN,eAAe,CAClB,CAAC;EAEDV,SAAS,CAAE,MAAM;IAChB,SAASyB,WAAWA,CAAEC,SAAS,EAAG;MACjC,MAAMV,QAAQ,GAAGZ,mBAAmB,CAAEsB,SAAU,CAAC;MAEjDX,WAAW,CAAEC,QAAS,CAAC;IACxB;IAEA,IAAIW,YAAY,GAAG,KAAK;IAExB,SAASC,WAAWA,CAAA,EAAG;MACtBnB,GAAG,CAACoB,SAAS,CAACC,OAAO,CAACC,IAAI,CACzB,2BAA2B,EAC3BN,WACD,CAAC;MACDE,YAAY,GAAG,IAAI;IACpB;IAEAlB,GAAG,CAACoB,SAAS,CAACE,IAAI,CAAE,OAAO,EAAEH,WAAY,CAAC;IAE1C,OAAO,MAAM;MACZnB,GAAG,CAACoB,SAAS,CAACG,MAAM,CAAE,OAAO,EAAEJ,WAAY,CAAC;MAC5C,IAAKD,YAAY,EAAG;QACnBlB,GAAG,CAACoB,SAAS,CAACC,OAAO,CAACE,MAAM,CAC3B,2BAA2B,EAC3BP,WACD,CAAC;MACF;IACD,CAAC;EACF,CAAC,EAAE,CAAEhB,GAAG,EAAEM,WAAW,CAAG,CAAC;EAEzB,MAAMkB,OAAO,GAAG9B,OAAO,CACtB,MAAM,CAAES,kBAAkB,EAAEG,WAAW,CAAE,EACzC,CAAEH,kBAAkB,EAAEG,WAAW,CAClC,CAAC;EAED,oBACCT,IAAA,CAACC,mBAAmB,CAAC2B,QAAQ;IAACC,KAAK,EAAGF,OAAS;IAAAtB,QAAA,EAC5CA;EAAQ,CACmB,CAAC;AAEjC;AAEA,OAAO,MAAMyB,eAAe,GAAGA,CAAA,KAAMnC,UAAU,CAAEM,mBAAoB,CAAC","ignoreList":[]}