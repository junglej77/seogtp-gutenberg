{"version":3,"names":["settingIdToWidgetId","wp","window","parseWidgetId","widgetId","matches","match","idBase","number","parseInt","widgetIdToSettingId","debounce","leading","callback","timeout","isLeading","timerID","debounced","args","result","apply","clearTimeout","setTimeout","cancel","SidebarAdapter","constructor","setting","api","locked","widgetsCache","WeakMap","subscribers","Set","history","_getWidgetIds","map","getWidget","historyIndex","historySubscribers","_debounceSetHistory","_pushHistory","_replaceHistory","bind","_handleSettingChange","_handleAllSettingsChange","undo","redo","save","subscribe","add","delete","getWidgets","_emit","get","slice","forEach","listener","prevWidgets","id","startsWith","includes","_createWidget","widget","widgetModel","customize","Widgets","availableWidgets","findWhere","id_base","set","settingId","settingArgs","transport","data","selectiveRefreshableWidgets","previewer","create","instance","_removeWidget","remove","_updateWidget","prevWidget","has","_updateWidgets","nextWidgets","addedWidgetIds","nextWidgetIds","nextWidget","push","deletedWidgets","filter","setWidgets","hasUndo","hasRedo","length","_seek","currentWidgets","widgets","subscribeHistory"],"sources":["@wordpress/customize-widgets/src/components/sidebar-block-editor/sidebar-adapter.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport { settingIdToWidgetId } from '../../utils';\r\n\r\nconst { wp } = window;\r\n\r\nfunction parseWidgetId( widgetId ) {\r\n\tconst matches = widgetId.match( /^(.+)-(\\d+)$/ );\r\n\tif ( matches ) {\r\n\t\treturn {\r\n\t\t\tidBase: matches[ 1 ],\r\n\t\t\tnumber: parseInt( matches[ 2 ], 10 ),\r\n\t\t};\r\n\t}\r\n\r\n\t// Likely an old single widget.\r\n\treturn { idBase: widgetId };\r\n}\r\n\r\nfunction widgetIdToSettingId( widgetId ) {\r\n\tconst { idBase, number } = parseWidgetId( widgetId );\r\n\tif ( number ) {\r\n\t\treturn `widget_${ idBase }[${ number }]`;\r\n\t}\r\n\r\n\treturn `widget_${ idBase }`;\r\n}\r\n\r\n/**\r\n * This is a custom debounce function to call different callbacks depending on\r\n * whether it's the _leading_ call or not.\r\n *\r\n * @param {Function} leading  The callback that gets called first.\r\n * @param {Function} callback The callback that gets called after the first time.\r\n * @param {number}   timeout  The debounced time in milliseconds.\r\n * @return {Function} The debounced function.\r\n */\r\nfunction debounce( leading, callback, timeout ) {\r\n\tlet isLeading = false;\r\n\tlet timerID;\r\n\r\n\tfunction debounced( ...args ) {\r\n\t\tconst result = ( isLeading ? callback : leading ).apply( this, args );\r\n\r\n\t\tisLeading = true;\r\n\r\n\t\tclearTimeout( timerID );\r\n\r\n\t\ttimerID = setTimeout( () => {\r\n\t\t\tisLeading = false;\r\n\t\t}, timeout );\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdebounced.cancel = () => {\r\n\t\tisLeading = false;\r\n\t\tclearTimeout( timerID );\r\n\t};\r\n\r\n\treturn debounced;\r\n}\r\n\r\nexport default class SidebarAdapter {\r\n\tconstructor( setting, api ) {\r\n\t\tthis.setting = setting;\r\n\t\tthis.api = api;\r\n\r\n\t\tthis.locked = false;\r\n\t\tthis.widgetsCache = new WeakMap();\r\n\t\tthis.subscribers = new Set();\r\n\r\n\t\tthis.history = [\r\n\t\t\tthis._getWidgetIds().map( ( widgetId ) =>\r\n\t\t\t\tthis.getWidget( widgetId )\r\n\t\t\t),\r\n\t\t];\r\n\t\tthis.historyIndex = 0;\r\n\t\tthis.historySubscribers = new Set();\r\n\t\t// Debounce the input for 1 second.\r\n\t\tthis._debounceSetHistory = debounce(\r\n\t\t\tthis._pushHistory,\r\n\t\t\tthis._replaceHistory,\r\n\t\t\t1000\r\n\t\t);\r\n\r\n\t\tthis.setting.bind( this._handleSettingChange.bind( this ) );\r\n\t\tthis.api.bind( 'change', this._handleAllSettingsChange.bind( this ) );\r\n\r\n\t\tthis.undo = this.undo.bind( this );\r\n\t\tthis.redo = this.redo.bind( this );\r\n\t\tthis.save = this.save.bind( this );\r\n\t}\r\n\r\n\tsubscribe( callback ) {\r\n\t\tthis.subscribers.add( callback );\r\n\r\n\t\treturn () => {\r\n\t\t\tthis.subscribers.delete( callback );\r\n\t\t};\r\n\t}\r\n\r\n\tgetWidgets() {\r\n\t\treturn this.history[ this.historyIndex ];\r\n\t}\r\n\r\n\t_emit( ...args ) {\r\n\t\tfor ( const callback of this.subscribers ) {\r\n\t\t\tcallback( ...args );\r\n\t\t}\r\n\t}\r\n\r\n\t_getWidgetIds() {\r\n\t\treturn this.setting.get();\r\n\t}\r\n\r\n\t_pushHistory() {\r\n\t\tthis.history = [\r\n\t\t\t...this.history.slice( 0, this.historyIndex + 1 ),\r\n\t\t\tthis._getWidgetIds().map( ( widgetId ) =>\r\n\t\t\t\tthis.getWidget( widgetId )\r\n\t\t\t),\r\n\t\t];\r\n\t\tthis.historyIndex += 1;\r\n\r\n\t\tthis.historySubscribers.forEach( ( listener ) => listener() );\r\n\t}\r\n\r\n\t_replaceHistory() {\r\n\t\tthis.history[ this.historyIndex ] = this._getWidgetIds().map(\r\n\t\t\t( widgetId ) => this.getWidget( widgetId )\r\n\t\t);\r\n\t}\r\n\r\n\t_handleSettingChange() {\r\n\t\tif ( this.locked ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst prevWidgets = this.getWidgets();\r\n\r\n\t\tthis._pushHistory();\r\n\r\n\t\tthis._emit( prevWidgets, this.getWidgets() );\r\n\t}\r\n\r\n\t_handleAllSettingsChange( setting ) {\r\n\t\tif ( this.locked ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( ! setting.id.startsWith( 'widget_' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst widgetId = settingIdToWidgetId( setting.id );\r\n\t\tif ( ! this.setting.get().includes( widgetId ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst prevWidgets = this.getWidgets();\r\n\r\n\t\tthis._pushHistory();\r\n\r\n\t\tthis._emit( prevWidgets, this.getWidgets() );\r\n\t}\r\n\r\n\t_createWidget( widget ) {\r\n\t\tconst widgetModel = wp.customize.Widgets.availableWidgets.findWhere( {\r\n\t\t\tid_base: widget.idBase,\r\n\t\t} );\r\n\r\n\t\tlet number = widget.number;\r\n\t\tif ( widgetModel.get( 'is_multi' ) && ! number ) {\r\n\t\t\twidgetModel.set(\r\n\t\t\t\t'multi_number',\r\n\t\t\t\twidgetModel.get( 'multi_number' ) + 1\r\n\t\t\t);\r\n\t\t\tnumber = widgetModel.get( 'multi_number' );\r\n\t\t}\r\n\r\n\t\tconst settingId = number\r\n\t\t\t? `widget_${ widget.idBase }[${ number }]`\r\n\t\t\t: `widget_${ widget.idBase }`;\r\n\r\n\t\tconst settingArgs = {\r\n\t\t\ttransport: wp.customize.Widgets.data.selectiveRefreshableWidgets[\r\n\t\t\t\twidgetModel.get( 'id_base' )\r\n\t\t\t]\r\n\t\t\t\t? 'postMessage'\r\n\t\t\t\t: 'refresh',\r\n\t\t\tpreviewer: this.setting.previewer,\r\n\t\t};\r\n\t\tconst setting = this.api.create(\r\n\t\t\tsettingId,\r\n\t\t\tsettingId,\r\n\t\t\t'',\r\n\t\t\tsettingArgs\r\n\t\t);\r\n\t\tsetting.set( widget.instance );\r\n\r\n\t\tconst widgetId = settingIdToWidgetId( settingId );\r\n\r\n\t\treturn widgetId;\r\n\t}\r\n\r\n\t_removeWidget( widget ) {\r\n\t\tconst settingId = widgetIdToSettingId( widget.id );\r\n\t\tconst setting = this.api( settingId );\r\n\r\n\t\tif ( setting ) {\r\n\t\t\tconst instance = setting.get();\r\n\t\t\tthis.widgetsCache.delete( instance );\r\n\t\t}\r\n\r\n\t\tthis.api.remove( settingId );\r\n\t}\r\n\r\n\t_updateWidget( widget ) {\r\n\t\tconst prevWidget = this.getWidget( widget.id );\r\n\r\n\t\t// Bail out update if nothing changed.\r\n\t\tif ( prevWidget === widget ) {\r\n\t\t\treturn widget.id;\r\n\t\t}\r\n\r\n\t\t// Update existing setting if only the widget's instance changed.\r\n\t\tif (\r\n\t\t\tprevWidget.idBase &&\r\n\t\t\twidget.idBase &&\r\n\t\t\tprevWidget.idBase === widget.idBase\r\n\t\t) {\r\n\t\t\tconst settingId = widgetIdToSettingId( widget.id );\r\n\t\t\tthis.api( settingId ).set( widget.instance );\r\n\t\t\treturn widget.id;\r\n\t\t}\r\n\r\n\t\t// Otherwise delete and re-create.\r\n\t\tthis._removeWidget( widget );\r\n\t\treturn this._createWidget( widget );\r\n\t}\r\n\r\n\tgetWidget( widgetId ) {\r\n\t\tif ( ! widgetId ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst { idBase, number } = parseWidgetId( widgetId );\r\n\t\tconst settingId = widgetIdToSettingId( widgetId );\r\n\t\tconst setting = this.api( settingId );\r\n\r\n\t\tif ( ! setting ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst instance = setting.get();\r\n\r\n\t\tif ( this.widgetsCache.has( instance ) ) {\r\n\t\t\treturn this.widgetsCache.get( instance );\r\n\t\t}\r\n\r\n\t\tconst widget = {\r\n\t\t\tid: widgetId,\r\n\t\t\tidBase,\r\n\t\t\tnumber,\r\n\t\t\tinstance,\r\n\t\t};\r\n\r\n\t\tthis.widgetsCache.set( instance, widget );\r\n\r\n\t\treturn widget;\r\n\t}\r\n\r\n\t_updateWidgets( nextWidgets ) {\r\n\t\tthis.locked = true;\r\n\r\n\t\tconst addedWidgetIds = [];\r\n\r\n\t\tconst nextWidgetIds = nextWidgets.map( ( nextWidget ) => {\r\n\t\t\tif ( nextWidget.id && this.getWidget( nextWidget.id ) ) {\r\n\t\t\t\taddedWidgetIds.push( null );\r\n\r\n\t\t\t\treturn this._updateWidget( nextWidget );\r\n\t\t\t}\r\n\r\n\t\t\tconst widgetId = this._createWidget( nextWidget );\r\n\r\n\t\t\taddedWidgetIds.push( widgetId );\r\n\r\n\t\t\treturn widgetId;\r\n\t\t} );\r\n\r\n\t\tconst deletedWidgets = this.getWidgets().filter(\r\n\t\t\t( widget ) => ! nextWidgetIds.includes( widget.id )\r\n\t\t);\r\n\t\tdeletedWidgets.forEach( ( widget ) => this._removeWidget( widget ) );\r\n\r\n\t\tthis.setting.set( nextWidgetIds );\r\n\r\n\t\tthis.locked = false;\r\n\r\n\t\treturn addedWidgetIds;\r\n\t}\r\n\r\n\tsetWidgets( nextWidgets ) {\r\n\t\tconst addedWidgetIds = this._updateWidgets( nextWidgets );\r\n\r\n\t\tthis._debounceSetHistory();\r\n\r\n\t\treturn addedWidgetIds;\r\n\t}\r\n\r\n\t/**\r\n\t * Undo/Redo related features\r\n\t */\r\n\thasUndo() {\r\n\t\treturn this.historyIndex > 0;\r\n\t}\r\n\r\n\thasRedo() {\r\n\t\treturn this.historyIndex < this.history.length - 1;\r\n\t}\r\n\r\n\t_seek( historyIndex ) {\r\n\t\tconst currentWidgets = this.getWidgets();\r\n\r\n\t\tthis.historyIndex = historyIndex;\r\n\r\n\t\tconst widgets = this.history[ this.historyIndex ];\r\n\r\n\t\tthis._updateWidgets( widgets );\r\n\r\n\t\tthis._emit( currentWidgets, this.getWidgets() );\r\n\r\n\t\tthis.historySubscribers.forEach( ( listener ) => listener() );\r\n\t\tthis._debounceSetHistory.cancel();\r\n\t}\r\n\r\n\tundo() {\r\n\t\tif ( ! this.hasUndo() ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._seek( this.historyIndex - 1 );\r\n\t}\r\n\r\n\tredo() {\r\n\t\tif ( ! this.hasRedo() ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._seek( this.historyIndex + 1 );\r\n\t}\r\n\r\n\tsubscribeHistory( listener ) {\r\n\t\tthis.historySubscribers.add( listener );\r\n\r\n\t\treturn () => {\r\n\t\t\tthis.historySubscribers.delete( listener );\r\n\t\t};\r\n\t}\r\n\r\n\tsave() {\r\n\t\tthis.api.previewer.save();\r\n\t}\r\n}\r\n"],"mappings":"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","ignoreList":[]}