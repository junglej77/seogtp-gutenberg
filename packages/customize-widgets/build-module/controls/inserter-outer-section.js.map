{"version":3,"names":["ESCAPE","focus","dispatch","store","customizeWidgetsStore","getInserterOuterSection","wp","customize","window","OuterSection","onChangeExpanded","expanded","args","section","each","params","type","id","collapse","sectionConstructor","outer","InserterOuterSection","constructor","activeElementBeforeExpanded","ownerWindow","contentContainer","ownerDocument","defaultView","addEventListener","event","keyCode","code","defaultPrevented","preventDefault","stopPropagation","setIsInserterOpened","addClass","isFromInternalAction","bind","open","activeElement","expand","completeCallback","searchBox","tabbable","find","close","contains"],"sources":["@wordpress/customize-widgets/src/controls/inserter-outer-section.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { ESCAPE } from '@wordpress/keycodes';\r\nimport { focus } from '@wordpress/dom';\r\nimport { dispatch } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as customizeWidgetsStore } from '../store';\r\n\r\nexport default function getInserterOuterSection() {\r\n\tconst {\r\n\t\twp: { customize },\r\n\t} = window;\r\n\r\n\tconst OuterSection = customize.OuterSection;\r\n\t// Override the OuterSection class to handle multiple outer sections.\r\n\t// It closes all the other outer sections whenever one is opened.\r\n\t// The result is that at most one outer section can be opened at the same time.\r\n\tcustomize.OuterSection = class extends OuterSection {\r\n\t\tonChangeExpanded( expanded, args ) {\r\n\t\t\tif ( expanded ) {\r\n\t\t\t\tcustomize.section.each( ( section ) => {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tsection.params.type === 'outer' &&\r\n\t\t\t\t\t\tsection.id !== this.id\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tif ( section.expanded() ) {\r\n\t\t\t\t\t\t\tsection.collapse();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\treturn super.onChangeExpanded( expanded, args );\r\n\t\t}\r\n\t};\r\n\t// Handle constructor so that \"params.type\" can be correctly pointed to \"outer\".\r\n\tcustomize.sectionConstructor.outer = customize.OuterSection;\r\n\r\n\treturn class InserterOuterSection extends customize.OuterSection {\r\n\t\tconstructor( ...args ) {\r\n\t\t\tsuper( ...args );\r\n\r\n\t\t\t// This is necessary since we're creating a new class which is not identical to the original OuterSection.\r\n\t\t\t// @See https://github.com/WordPress/wordpress-develop/blob/42b05c397c50d9dc244083eff52991413909d4bd/src/js/_enqueues/wp/customize/controls.js#L1427-L1436\r\n\t\t\tthis.params.type = 'outer';\r\n\r\n\t\t\tthis.activeElementBeforeExpanded = null;\r\n\r\n\t\t\tconst ownerWindow =\r\n\t\t\t\tthis.contentContainer[ 0 ].ownerDocument.defaultView;\r\n\r\n\t\t\t// Handle closing the inserter when pressing the Escape key.\r\n\t\t\townerWindow.addEventListener(\r\n\t\t\t\t'keydown',\r\n\t\t\t\t( event ) => {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tthis.expanded() &&\r\n\t\t\t\t\t\t( event.keyCode === ESCAPE ||\r\n\t\t\t\t\t\t\tevent.code === 'Escape' ) &&\r\n\t\t\t\t\t\t! event.defaultPrevented\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\t\tdispatch( customizeWidgetsStore ).setIsInserterOpened(\r\n\t\t\t\t\t\t\tfalse\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t// Use capture mode to make this run before other event listeners.\r\n\t\t\t\ttrue\r\n\t\t\t);\r\n\r\n\t\t\tthis.contentContainer.addClass( 'widgets-inserter' );\r\n\r\n\t\t\t// Set a flag if the state is being changed from open() or close().\r\n\t\t\t// Don't propagate the event if it's an internal action to prevent infinite loop.\r\n\t\t\tthis.isFromInternalAction = false;\r\n\t\t\tthis.expanded.bind( () => {\r\n\t\t\t\tif ( ! this.isFromInternalAction ) {\r\n\t\t\t\t\t// Propagate the event to React to sync the state.\r\n\t\t\t\t\tdispatch( customizeWidgetsStore ).setIsInserterOpened(\r\n\t\t\t\t\t\tthis.expanded()\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tthis.isFromInternalAction = false;\r\n\t\t\t} );\r\n\t\t}\r\n\t\topen() {\r\n\t\t\tif ( ! this.expanded() ) {\r\n\t\t\t\tconst contentContainer = this.contentContainer[ 0 ];\r\n\t\t\t\tthis.activeElementBeforeExpanded =\r\n\t\t\t\t\tcontentContainer.ownerDocument.activeElement;\r\n\r\n\t\t\t\tthis.isFromInternalAction = true;\r\n\r\n\t\t\t\tthis.expand( {\r\n\t\t\t\t\tcompleteCallback() {\r\n\t\t\t\t\t\t// We have to do this in a \"completeCallback\" or else the elements will not yet be visible/tabbable.\r\n\t\t\t\t\t\t// The first one should be the close button,\r\n\t\t\t\t\t\t// we want to skip it and choose the second one instead, which is the search box.\r\n\t\t\t\t\t\tconst searchBox =\r\n\t\t\t\t\t\t\tfocus.tabbable.find( contentContainer )[ 1 ];\r\n\t\t\t\t\t\tif ( searchBox ) {\r\n\t\t\t\t\t\t\tsearchBox.focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t\tclose() {\r\n\t\t\tif ( this.expanded() ) {\r\n\t\t\t\tconst contentContainer = this.contentContainer[ 0 ];\r\n\t\t\t\tconst activeElement =\r\n\t\t\t\t\tcontentContainer.ownerDocument.activeElement;\r\n\r\n\t\t\t\tthis.isFromInternalAction = true;\r\n\r\n\t\t\t\tthis.collapse( {\r\n\t\t\t\t\tcompleteCallback() {\r\n\t\t\t\t\t\t// Return back the focus when closing the inserter.\r\n\t\t\t\t\t\t// Only do this if the active element which triggers the action is inside the inserter,\r\n\t\t\t\t\t\t// (the close button for instance). In that case the focus will be lost.\r\n\t\t\t\t\t\t// Otherwise, we don't hijack the focus when the user is focusing on other elements\r\n\t\t\t\t\t\t// (like the quick inserter).\r\n\t\t\t\t\t\tif ( contentContainer.contains( activeElement ) ) {\r\n\t\t\t\t\t\t\t// Return back the focus when closing the inserter.\r\n\t\t\t\t\t\t\tif ( this.activeElementBeforeExpanded ) {\r\n\t\t\t\t\t\t\t\tthis.activeElementBeforeExpanded.focus();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n"],"mappings":"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","ignoreList":[]}