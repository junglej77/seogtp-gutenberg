{"version":3,"names":["BlockControls","store","blockEditorStore","createHigherOrderComponent","useSelect","useDispatch","addFilter","MoveToWidgetArea","getWidgetIdFromBlock","useSidebarControls","useActiveSidebarControl","useFocusControl","blockToWidget","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","withMoveToSidebarToolbarItem","BlockEdit","props","widgetId","sidebarControls","activeSidebarControl","hasMultipleSidebars","length","blockName","name","clientId","canInsertBlockInSidebar","select","canInsertBlockType","block","getBlock","removeBlock","focusWidget","moveToSidebar","sidebarControlId","newSidebarControl","find","sidebarControl","id","oldSetting","setting","newSetting","filter","sidebarAdapter","addedWidgetIds","setWidgets","getWidgets","reverse","children","widgetAreas","map","params","label","description","currentWidgetAreaId","onSelect"],"sources":["@wordpress/customize-widgets/src/filters/move-to-sidebar.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tBlockControls,\r\n\tstore as blockEditorStore,\r\n} from '@wordpress/block-editor';\r\nimport { createHigherOrderComponent } from '@wordpress/compose';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { addFilter } from '@wordpress/hooks';\r\nimport { MoveToWidgetArea, getWidgetIdFromBlock } from '@wordpress/widgets';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport {\r\n\tuseSidebarControls,\r\n\tuseActiveSidebarControl,\r\n} from '../components/sidebar-controls';\r\nimport { useFocusControl } from '../components/focus-control';\r\nimport { blockToWidget } from '../utils';\r\n\r\nconst withMoveToSidebarToolbarItem = createHigherOrderComponent(\r\n\t( BlockEdit ) => ( props ) => {\r\n\t\tlet widgetId = getWidgetIdFromBlock( props );\r\n\t\tconst sidebarControls = useSidebarControls();\r\n\t\tconst activeSidebarControl = useActiveSidebarControl();\r\n\t\tconst hasMultipleSidebars = sidebarControls?.length > 1;\r\n\t\tconst blockName = props.name;\r\n\t\tconst clientId = props.clientId;\r\n\t\tconst canInsertBlockInSidebar = useSelect(\r\n\t\t\t( select ) => {\r\n\t\t\t\t// Use an empty string to represent the root block list, which\r\n\t\t\t\t// in the customizer editor represents a sidebar/widget area.\r\n\t\t\t\treturn select( blockEditorStore ).canInsertBlockType(\r\n\t\t\t\t\tblockName,\r\n\t\t\t\t\t''\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t[ blockName ]\r\n\t\t);\r\n\t\tconst block = useSelect(\r\n\t\t\t( select ) => select( blockEditorStore ).getBlock( clientId ),\r\n\t\t\t[ clientId ]\r\n\t\t);\r\n\t\tconst { removeBlock } = useDispatch( blockEditorStore );\r\n\t\tconst [ , focusWidget ] = useFocusControl();\r\n\r\n\t\tfunction moveToSidebar( sidebarControlId ) {\r\n\t\t\tconst newSidebarControl = sidebarControls.find(\r\n\t\t\t\t( sidebarControl ) => sidebarControl.id === sidebarControlId\r\n\t\t\t);\r\n\r\n\t\t\tif ( widgetId ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * If there's a widgetId, move it to the other sidebar.\r\n\t\t\t\t */\r\n\t\t\t\tconst oldSetting = activeSidebarControl.setting;\r\n\t\t\t\tconst newSetting = newSidebarControl.setting;\r\n\r\n\t\t\t\toldSetting( oldSetting().filter( ( id ) => id !== widgetId ) );\r\n\t\t\t\tnewSetting( [ ...newSetting(), widgetId ] );\r\n\t\t\t} else {\r\n\t\t\t\t/**\r\n\t\t\t\t * If there isn't a widgetId, it's most likely a inner block.\r\n\t\t\t\t * First, remove the block in the original sidebar,\r\n\t\t\t\t * then, create a new widget in the new sidebar and get back its widgetId.\r\n\t\t\t\t */\r\n\t\t\t\tconst sidebarAdapter = newSidebarControl.sidebarAdapter;\r\n\r\n\t\t\t\tremoveBlock( clientId );\r\n\t\t\t\tconst addedWidgetIds = sidebarAdapter.setWidgets( [\r\n\t\t\t\t\t...sidebarAdapter.getWidgets(),\r\n\t\t\t\t\tblockToWidget( block ),\r\n\t\t\t\t] );\r\n\t\t\t\t// The last non-null id is the added widget's id.\r\n\t\t\t\twidgetId = addedWidgetIds.reverse().find( ( id ) => !! id );\r\n\t\t\t}\r\n\r\n\t\t\t// Move focus to the moved widget and expand the sidebar.\r\n\t\t\tfocusWidget( widgetId );\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<BlockEdit key=\"edit\" { ...props } />\r\n\t\t\t\t{ hasMultipleSidebars && canInsertBlockInSidebar && (\r\n\t\t\t\t\t<BlockControls>\r\n\t\t\t\t\t\t<MoveToWidgetArea\r\n\t\t\t\t\t\t\twidgetAreas={ sidebarControls.map(\r\n\t\t\t\t\t\t\t\t( sidebarControl ) => ( {\r\n\t\t\t\t\t\t\t\t\tid: sidebarControl.id,\r\n\t\t\t\t\t\t\t\t\tname: sidebarControl.params.label,\r\n\t\t\t\t\t\t\t\t\tdescription:\r\n\t\t\t\t\t\t\t\t\t\tsidebarControl.params.description,\r\n\t\t\t\t\t\t\t\t} )\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\tcurrentWidgetAreaId={ activeSidebarControl?.id }\r\n\t\t\t\t\t\t\tonSelect={ moveToSidebar }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</BlockControls>\r\n\t\t\t\t) }\r\n\t\t\t</>\r\n\t\t);\r\n\t},\r\n\t'withMoveToSidebarToolbarItem'\r\n);\r\n\r\naddFilter(\r\n\t'editor.BlockEdit',\r\n\t'core/customize-widgets/block-edit',\r\n\twithMoveToSidebarToolbarItem\r\n);\r\n"],"mappings":"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","ignoreList":[]}