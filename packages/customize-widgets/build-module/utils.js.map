{"version":3,"names":["serialize","parse","createBlock","addWidgetIdToBlock","settingIdToWidgetId","settingId","matches","match","idBase","number","parseInt","blockToWidget","block","existingWidget","widget","isValidLegacyWidgetBlock","name","attributes","id","instance","encoded","hash","raw","rest","is_widget_customizer_js_value","encoded_serialized_instance","instance_hash_key","raw_instance","content","widgetClass","form","rendered","restExistingWidget","widgetToBlock","_raw$content","parsedBlocks","__unstableSkipAutop","length"],"sources":["@wordpress/customize-widgets/src/utils.js"],"sourcesContent":["// @ts-check\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { serialize, parse, createBlock } from '@wordpress/blocks';\r\nimport { addWidgetIdToBlock } from '@wordpress/widgets';\r\n\r\n/**\r\n * Convert settingId to widgetId.\r\n *\r\n * @param {string} settingId The setting id.\r\n * @return {string} The widget id.\r\n */\r\nexport function settingIdToWidgetId( settingId ) {\r\n\tconst matches = settingId.match( /^widget_(.+)(?:\\[(\\d+)\\])$/ );\r\n\r\n\tif ( matches ) {\r\n\t\tconst idBase = matches[ 1 ];\r\n\t\tconst number = parseInt( matches[ 2 ], 10 );\r\n\r\n\t\treturn `${ idBase }-${ number }`;\r\n\t}\r\n\r\n\treturn settingId;\r\n}\r\n\r\n/**\r\n * Transform a block to a customizable widget.\r\n *\r\n * @param {WPBlock} block          The block to be transformed from.\r\n * @param {Object}  existingWidget The widget to be extended from.\r\n * @return {Object} The transformed widget.\r\n */\r\nexport function blockToWidget( block, existingWidget = null ) {\r\n\tlet widget;\r\n\r\n\tconst isValidLegacyWidgetBlock =\r\n\t\tblock.name === 'core/legacy-widget' &&\r\n\t\t( block.attributes.id || block.attributes.instance );\r\n\r\n\tif ( isValidLegacyWidgetBlock ) {\r\n\t\tif ( block.attributes.id ) {\r\n\t\t\t// Widget that does not extend WP_Widget.\r\n\t\t\twidget = {\r\n\t\t\t\tid: block.attributes.id,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconst { encoded, hash, raw, ...rest } = block.attributes.instance;\r\n\r\n\t\t\t// Widget that extends WP_Widget.\r\n\t\t\twidget = {\r\n\t\t\t\tidBase: block.attributes.idBase,\r\n\t\t\t\tinstance: {\r\n\t\t\t\t\t...existingWidget?.instance,\r\n\t\t\t\t\t// Required only for the customizer.\r\n\t\t\t\t\tis_widget_customizer_js_value: true,\r\n\t\t\t\t\tencoded_serialized_instance: encoded,\r\n\t\t\t\t\tinstance_hash_key: hash,\r\n\t\t\t\t\traw_instance: raw,\r\n\t\t\t\t\t...rest,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t}\r\n\t} else {\r\n\t\tconst instance = {\r\n\t\t\tcontent: serialize( block ),\r\n\t\t};\r\n\t\twidget = {\r\n\t\t\tidBase: 'block',\r\n\t\t\twidgetClass: 'WP_Widget_Block',\r\n\t\t\tinstance: {\r\n\t\t\t\traw_instance: instance,\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tconst { form, rendered, ...restExistingWidget } = existingWidget || {};\r\n\r\n\treturn {\r\n\t\t...restExistingWidget,\r\n\t\t...widget,\r\n\t};\r\n}\r\n\r\n/**\r\n * Transform a widget to a block.\r\n *\r\n * @param {Object} widget          The widget to be transformed from.\r\n * @param {string} widget.id       The widget id.\r\n * @param {string} widget.idBase   The id base of the widget.\r\n * @param {number} widget.number   The number/index of the widget.\r\n * @param {Object} widget.instance The instance of the widget.\r\n * @return {WPBlock} The transformed block.\r\n */\r\nexport function widgetToBlock( { id, idBase, number, instance } ) {\r\n\tlet block;\r\n\r\n\tconst {\r\n\t\tencoded_serialized_instance: encoded,\r\n\t\tinstance_hash_key: hash,\r\n\t\traw_instance: raw,\r\n\t\t...rest\r\n\t} = instance;\r\n\r\n\tif ( idBase === 'block' ) {\r\n\t\tconst parsedBlocks = parse( raw.content ?? '', {\r\n\t\t\t__unstableSkipAutop: true,\r\n\t\t} );\r\n\t\tblock = parsedBlocks.length\r\n\t\t\t? parsedBlocks[ 0 ]\r\n\t\t\t: createBlock( 'core/paragraph', {} );\r\n\t} else if ( number ) {\r\n\t\t// Widget that extends WP_Widget.\r\n\t\tblock = createBlock( 'core/legacy-widget', {\r\n\t\t\tidBase,\r\n\t\t\tinstance: {\r\n\t\t\t\tencoded,\r\n\t\t\t\thash,\r\n\t\t\t\traw,\r\n\t\t\t\t...rest,\r\n\t\t\t},\r\n\t\t} );\r\n\t} else {\r\n\t\t// Widget that does not extend WP_Widget.\r\n\t\tblock = createBlock( 'core/legacy-widget', {\r\n\t\t\tid,\r\n\t\t} );\r\n\t}\r\n\r\n\treturn addWidgetIdToBlock( block, id );\r\n}\r\n"],"mappings":"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","ignoreList":[]}