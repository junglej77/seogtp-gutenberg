{"version":3,"names":["EquivalentKeyMap","selectorArgsToStateKey","onSubKey","subKeysIsResolved","state","action","type","nextState","set","args","status","error","resolutionArgs","forEach","idx","resolutionState","undefined","errors","delete","isResolved","selectorName","removedSelector","restState"],"sources":["@wordpress/data/src/redux-store/metadata/reducer.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport EquivalentKeyMap from 'equivalent-key-map';\r\nimport type { Reducer } from 'redux';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { selectorArgsToStateKey, onSubKey } from './utils';\r\n\r\ntype Action =\r\n\t| ReturnType< typeof import('./actions').startResolution >\r\n\t| ReturnType< typeof import('./actions').finishResolution >\r\n\t| ReturnType< typeof import('./actions').failResolution >\r\n\t| ReturnType< typeof import('./actions').startResolutions >\r\n\t| ReturnType< typeof import('./actions').finishResolutions >\r\n\t| ReturnType< typeof import('./actions').failResolutions >\r\n\t| ReturnType< typeof import('./actions').invalidateResolution >\r\n\t| ReturnType< typeof import('./actions').invalidateResolutionForStore >\r\n\t| ReturnType<\r\n\t\t\ttypeof import('./actions').invalidateResolutionForStoreSelector\r\n\t  >;\r\n\r\ntype StateKey = unknown[] | unknown;\r\nexport type StateValue =\r\n\t| { status: 'resolving' | 'finished' }\r\n\t| { status: 'error'; error: Error | unknown };\r\n\r\nexport type Status = StateValue[ 'status' ];\r\nexport type State = EquivalentKeyMap< StateKey, StateValue >;\r\n\r\n/**\r\n * Reducer function returning next state for selector resolution of\r\n * subkeys, object form:\r\n *\r\n *  selectorName -> EquivalentKeyMap<Array,boolean>\r\n */\r\nconst subKeysIsResolved: Reducer< Record< string, State >, Action > = onSubKey<\r\n\tState,\r\n\tAction\r\n>( 'selectorName' )( ( state = new EquivalentKeyMap(), action: Action ) => {\r\n\tswitch ( action.type ) {\r\n\t\tcase 'START_RESOLUTION': {\r\n\t\t\tconst nextState = new EquivalentKeyMap( state );\r\n\t\t\tnextState.set( selectorArgsToStateKey( action.args ), {\r\n\t\t\t\tstatus: 'resolving',\r\n\t\t\t} );\r\n\t\t\treturn nextState;\r\n\t\t}\r\n\t\tcase 'FINISH_RESOLUTION': {\r\n\t\t\tconst nextState = new EquivalentKeyMap( state );\r\n\t\t\tnextState.set( selectorArgsToStateKey( action.args ), {\r\n\t\t\t\tstatus: 'finished',\r\n\t\t\t} );\r\n\t\t\treturn nextState;\r\n\t\t}\r\n\t\tcase 'FAIL_RESOLUTION': {\r\n\t\t\tconst nextState = new EquivalentKeyMap( state );\r\n\t\t\tnextState.set( selectorArgsToStateKey( action.args ), {\r\n\t\t\t\tstatus: 'error',\r\n\t\t\t\terror: action.error,\r\n\t\t\t} );\r\n\t\t\treturn nextState;\r\n\t\t}\r\n\t\tcase 'START_RESOLUTIONS': {\r\n\t\t\tconst nextState = new EquivalentKeyMap( state );\r\n\t\t\tfor ( const resolutionArgs of action.args ) {\r\n\t\t\t\tnextState.set( selectorArgsToStateKey( resolutionArgs ), {\r\n\t\t\t\t\tstatus: 'resolving',\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t\treturn nextState;\r\n\t\t}\r\n\t\tcase 'FINISH_RESOLUTIONS': {\r\n\t\t\tconst nextState = new EquivalentKeyMap( state );\r\n\t\t\tfor ( const resolutionArgs of action.args ) {\r\n\t\t\t\tnextState.set( selectorArgsToStateKey( resolutionArgs ), {\r\n\t\t\t\t\tstatus: 'finished',\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t\treturn nextState;\r\n\t\t}\r\n\t\tcase 'FAIL_RESOLUTIONS': {\r\n\t\t\tconst nextState = new EquivalentKeyMap( state );\r\n\t\t\taction.args.forEach( ( resolutionArgs, idx ) => {\r\n\t\t\t\tconst resolutionState: StateValue = {\r\n\t\t\t\t\tstatus: 'error',\r\n\t\t\t\t\terror: undefined,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst error = action.errors[ idx ];\r\n\t\t\t\tif ( error ) {\r\n\t\t\t\t\tresolutionState.error = error;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnextState.set(\r\n\t\t\t\t\tselectorArgsToStateKey( resolutionArgs as unknown[] ),\r\n\t\t\t\t\tresolutionState\r\n\t\t\t\t);\r\n\t\t\t} );\r\n\t\t\treturn nextState;\r\n\t\t}\r\n\t\tcase 'INVALIDATE_RESOLUTION': {\r\n\t\t\tconst nextState = new EquivalentKeyMap( state );\r\n\t\t\tnextState.delete( selectorArgsToStateKey( action.args ) );\r\n\t\t\treturn nextState;\r\n\t\t}\r\n\t}\r\n\treturn state;\r\n} );\r\n\r\n/**\r\n * Reducer function returning next state for selector resolution, object form:\r\n *\r\n *   selectorName -> EquivalentKeyMap<Array, boolean>\r\n *\r\n * @param state  Current state.\r\n * @param action Dispatched action.\r\n *\r\n * @return Next state.\r\n */\r\nconst isResolved = ( state: Record< string, State > = {}, action: Action ) => {\r\n\tswitch ( action.type ) {\r\n\t\tcase 'INVALIDATE_RESOLUTION_FOR_STORE':\r\n\t\t\treturn {};\r\n\t\tcase 'INVALIDATE_RESOLUTION_FOR_STORE_SELECTOR': {\r\n\t\t\tif ( action.selectorName in state ) {\r\n\t\t\t\tconst {\r\n\t\t\t\t\t[ action.selectorName ]: removedSelector,\r\n\t\t\t\t\t...restState\r\n\t\t\t\t} = state;\r\n\t\t\t\treturn restState;\r\n\t\t\t}\r\n\t\t\treturn state;\r\n\t\t}\r\n\t\tcase 'START_RESOLUTION':\r\n\t\tcase 'FINISH_RESOLUTION':\r\n\t\tcase 'FAIL_RESOLUTION':\r\n\t\tcase 'START_RESOLUTIONS':\r\n\t\tcase 'FINISH_RESOLUTIONS':\r\n\t\tcase 'FAIL_RESOLUTIONS':\r\n\t\tcase 'INVALIDATE_RESOLUTION':\r\n\t\t\treturn subKeysIsResolved( state, action );\r\n\t}\r\n\treturn state;\r\n};\r\n\r\nexport default isResolved;\r\n"],"mappings":"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","ignoreList":[]}