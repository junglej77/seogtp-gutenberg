{"version":3,"names":["memo","useContext","useRef","useMemo","useCallback","__experimentalHStack","HStack","Button","funnel","__","FilterSummary","default","AddFilter","AddFilterDropdownMenu","ResetFilters","DataViewsContext","sanitizeOperators","ALL_OPERATORS","OPERATOR_IS","OPERATOR_IS_NOT","jsx","_jsx","jsxs","_jsxs","useFilters","fields","view","filters","forEach","field","elements","length","operators","isPrimary","filterBy","push","id","name","label","singleSelection","some","op","includes","isVisible","f","operator","sort","a","b","localeCompare","FilterVisibilityToggle","onChangeView","setOpenedFilter","isShowingFilter","setIsShowingFilter","onChangeViewWithFilterVisibility","_view","visibleFilters","filter","hasVisibleFilters","trigger","className","size","icon","isPressed","children","onClick","Filters","openedFilter","addFilterRef","addFilter","ref","filterComponents","map","justify","style","width","wrap"],"sources":["@wordpress/dataviews/src/components/dataviews-filters/index.tsx"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tmemo,\r\n\tuseContext,\r\n\tuseRef,\r\n\tuseMemo,\r\n\tuseCallback,\r\n} from '@wordpress/element';\r\nimport { __experimentalHStack as HStack, Button } from '@wordpress/components';\r\nimport { funnel } from '@wordpress/icons';\r\nimport { __ } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport FilterSummary from './filter-summary';\r\nimport { default as AddFilter, AddFilterDropdownMenu } from './add-filter';\r\nimport ResetFilters from './reset-filters';\r\nimport DataViewsContext from '../dataviews-context';\r\nimport { sanitizeOperators } from '../../utils';\r\nimport { ALL_OPERATORS, OPERATOR_IS, OPERATOR_IS_NOT } from '../../constants';\r\nimport type { NormalizedFilter, NormalizedField, View } from '../../types';\r\n\r\nexport function useFilters( fields: NormalizedField< any >[], view: View ) {\r\n\treturn useMemo( () => {\r\n\t\tconst filters: NormalizedFilter[] = [];\r\n\t\tfields.forEach( ( field ) => {\r\n\t\t\tif ( ! field.elements?.length ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst operators = sanitizeOperators( field );\r\n\t\t\tif ( operators.length === 0 ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst isPrimary = !! field.filterBy?.isPrimary;\r\n\t\t\tfilters.push( {\r\n\t\t\t\tfield: field.id,\r\n\t\t\t\tname: field.label,\r\n\t\t\t\telements: field.elements,\r\n\t\t\t\tsingleSelection: operators.some( ( op ) =>\r\n\t\t\t\t\t[ OPERATOR_IS, OPERATOR_IS_NOT ].includes( op )\r\n\t\t\t\t),\r\n\t\t\t\toperators,\r\n\t\t\t\tisVisible:\r\n\t\t\t\t\tisPrimary ||\r\n\t\t\t\t\t!! view.filters?.some(\r\n\t\t\t\t\t\t( f ) =>\r\n\t\t\t\t\t\t\tf.field === field.id &&\r\n\t\t\t\t\t\t\tALL_OPERATORS.includes( f.operator )\r\n\t\t\t\t\t),\r\n\t\t\t\tisPrimary,\r\n\t\t\t} );\r\n\t\t} );\r\n\t\t// Sort filters by primary property. We need the primary filters to be first.\r\n\t\t// Then we sort by name.\r\n\t\tfilters.sort( ( a, b ) => {\r\n\t\t\tif ( a.isPrimary && ! b.isPrimary ) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tif ( ! a.isPrimary && b.isPrimary ) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\treturn a.name.localeCompare( b.name );\r\n\t\t} );\r\n\t\treturn filters;\r\n\t}, [ fields, view ] );\r\n}\r\n\r\nexport function FilterVisibilityToggle( {\r\n\tfilters,\r\n\tview,\r\n\tonChangeView,\r\n\tsetOpenedFilter,\r\n\tisShowingFilter,\r\n\tsetIsShowingFilter,\r\n}: {\r\n\tfilters: NormalizedFilter[];\r\n\tview: View;\r\n\tonChangeView: ( view: View ) => void;\r\n\tsetOpenedFilter: ( filter: string | null ) => void;\r\n\tisShowingFilter: boolean;\r\n\tsetIsShowingFilter: React.Dispatch< React.SetStateAction< boolean > >;\r\n} ) {\r\n\tconst onChangeViewWithFilterVisibility = useCallback(\r\n\t\t( _view: View ) => {\r\n\t\t\tonChangeView( _view );\r\n\t\t\tsetIsShowingFilter( true );\r\n\t\t},\r\n\t\t[ onChangeView, setIsShowingFilter ]\r\n\t);\r\n\tconst visibleFilters = filters.filter( ( filter ) => filter.isVisible );\r\n\r\n\tconst hasVisibleFilters = !! visibleFilters.length;\r\n\tif ( filters.length === 0 ) {\r\n\t\treturn null;\r\n\t}\r\n\tif ( ! hasVisibleFilters ) {\r\n\t\treturn (\r\n\t\t\t<AddFilterDropdownMenu\r\n\t\t\t\tfilters={ filters }\r\n\t\t\t\tview={ view }\r\n\t\t\t\tonChangeView={ onChangeViewWithFilterVisibility }\r\n\t\t\t\tsetOpenedFilter={ setOpenedFilter }\r\n\t\t\t\ttrigger={\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tclassName=\"dataviews-filters__visibility-toggle\"\r\n\t\t\t\t\t\tsize=\"compact\"\r\n\t\t\t\t\t\ticon={ funnel }\r\n\t\t\t\t\t\tlabel={ __( 'Add filter' ) }\r\n\t\t\t\t\t\tisPressed={ false }\r\n\t\t\t\t\t\taria-expanded={ false }\r\n\t\t\t\t\t/>\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\treturn (\r\n\t\t<div className=\"dataviews-filters__container-visibility-toggle\">\r\n\t\t\t<Button\r\n\t\t\t\tclassName=\"dataviews-filters__visibility-toggle\"\r\n\t\t\t\tsize=\"compact\"\r\n\t\t\t\ticon={ funnel }\r\n\t\t\t\tlabel={ __( 'Toggle filter display' ) }\r\n\t\t\t\tonClick={ () => {\r\n\t\t\t\t\tif ( ! isShowingFilter ) {\r\n\t\t\t\t\t\tsetOpenedFilter( null );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetIsShowingFilter( ! isShowingFilter );\r\n\t\t\t\t} }\r\n\t\t\t\tisPressed={ isShowingFilter }\r\n\t\t\t\taria-expanded={ isShowingFilter }\r\n\t\t\t/>\r\n\t\t\t{ hasVisibleFilters && !! view.filters?.length && (\r\n\t\t\t\t<span className=\"dataviews-filters-toggle__count\">\r\n\t\t\t\t\t{ view.filters?.length }\r\n\t\t\t\t</span>\r\n\t\t\t) }\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Filters() {\r\n\tconst { fields, view, onChangeView, openedFilter, setOpenedFilter } =\r\n\t\tuseContext( DataViewsContext );\r\n\tconst addFilterRef = useRef< HTMLButtonElement >( null );\r\n\tconst filters = useFilters( fields, view );\r\n\tconst addFilter = (\r\n\t\t<AddFilter\r\n\t\t\tkey=\"add-filter\"\r\n\t\t\tfilters={ filters }\r\n\t\t\tview={ view }\r\n\t\t\tonChangeView={ onChangeView }\r\n\t\t\tref={ addFilterRef }\r\n\t\t\tsetOpenedFilter={ setOpenedFilter }\r\n\t\t/>\r\n\t);\r\n\tconst visibleFilters = filters.filter( ( filter ) => filter.isVisible );\r\n\tif ( visibleFilters.length === 0 ) {\r\n\t\treturn null;\r\n\t}\r\n\tconst filterComponents = [\r\n\t\t...visibleFilters.map( ( filter ) => {\r\n\t\t\treturn (\r\n\t\t\t\t<FilterSummary\r\n\t\t\t\t\tkey={ filter.field }\r\n\t\t\t\t\tfilter={ filter }\r\n\t\t\t\t\tview={ view }\r\n\t\t\t\t\tonChangeView={ onChangeView }\r\n\t\t\t\t\taddFilterRef={ addFilterRef }\r\n\t\t\t\t\topenedFilter={ openedFilter }\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t} ),\r\n\t\taddFilter,\r\n\t];\r\n\r\n\tfilterComponents.push(\r\n\t\t<ResetFilters\r\n\t\t\tkey=\"reset-filters\"\r\n\t\t\tfilters={ filters }\r\n\t\t\tview={ view }\r\n\t\t\tonChangeView={ onChangeView }\r\n\t\t/>\r\n\t);\r\n\r\n\treturn (\r\n\t\t<HStack\r\n\t\t\tjustify=\"flex-start\"\r\n\t\t\tstyle={ { width: 'fit-content' } }\r\n\t\t\tclassName=\"dataviews-filters__container\"\r\n\t\t\twrap\r\n\t\t>\r\n\t\t\t{ filterComponents }\r\n\t\t</HStack>\r\n\t);\r\n}\r\n\r\nexport default memo( Filters );\r\n"],"mappings":"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","ignoreList":[]}