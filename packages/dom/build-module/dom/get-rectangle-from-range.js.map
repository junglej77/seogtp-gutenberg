{"version":3,"names":["assertIsDefined","getRectangleFromRange","range","collapsed","rects","Array","from","getClientRects","length","filteredRects","filter","width","getBoundingClientRect","top","furthestTop","bottom","furthestBottom","left","furthestLeft","right","furthestRight","window","DOMRect","startContainer","ownerDocument","nodeName","parentNode","index","childNodes","indexOf","createRange","setStart","setEnd","rect","height","padNode","createTextNode","cloneRange","insertNode","removeChild"],"sources":["@wordpress/dom/src/dom/get-rectangle-from-range.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport { assertIsDefined } from '../utils/assert-is-defined';\r\n\r\n/**\r\n * Get the rectangle of a given Range. Returns `null` if no suitable rectangle\r\n * can be found.\r\n *\r\n * @param {Range} range The range.\r\n *\r\n * @return {DOMRect?} The rectangle.\r\n */\r\nexport default function getRectangleFromRange( range ) {\r\n\t// For uncollapsed ranges, get the rectangle that bounds the contents of the\r\n\t// range; this a rectangle enclosing the union of the bounding rectangles\r\n\t// for all the elements in the range.\r\n\tif ( ! range.collapsed ) {\r\n\t\tconst rects = Array.from( range.getClientRects() );\r\n\r\n\t\t// If there's just a single rect, return it.\r\n\t\tif ( rects.length === 1 ) {\r\n\t\t\treturn rects[ 0 ];\r\n\t\t}\r\n\r\n\t\t// Ignore tiny selection at the edge of a range.\r\n\t\tconst filteredRects = rects.filter( ( { width } ) => width > 1 );\r\n\r\n\t\t// If it's full of tiny selections, return browser default.\r\n\t\tif ( filteredRects.length === 0 ) {\r\n\t\t\treturn range.getBoundingClientRect();\r\n\t\t}\r\n\r\n\t\tif ( filteredRects.length === 1 ) {\r\n\t\t\treturn filteredRects[ 0 ];\r\n\t\t}\r\n\r\n\t\tlet {\r\n\t\t\ttop: furthestTop,\r\n\t\t\tbottom: furthestBottom,\r\n\t\t\tleft: furthestLeft,\r\n\t\t\tright: furthestRight,\r\n\t\t} = filteredRects[ 0 ];\r\n\r\n\t\tfor ( const { top, bottom, left, right } of filteredRects ) {\r\n\t\t\tif ( top < furthestTop ) {\r\n\t\t\t\tfurthestTop = top;\r\n\t\t\t}\r\n\t\t\tif ( bottom > furthestBottom ) {\r\n\t\t\t\tfurthestBottom = bottom;\r\n\t\t\t}\r\n\t\t\tif ( left < furthestLeft ) {\r\n\t\t\t\tfurthestLeft = left;\r\n\t\t\t}\r\n\t\t\tif ( right > furthestRight ) {\r\n\t\t\t\tfurthestRight = right;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new window.DOMRect(\r\n\t\t\tfurthestLeft,\r\n\t\t\tfurthestTop,\r\n\t\t\tfurthestRight - furthestLeft,\r\n\t\t\tfurthestBottom - furthestTop\r\n\t\t);\r\n\t}\r\n\r\n\tconst { startContainer } = range;\r\n\tconst { ownerDocument } = startContainer;\r\n\r\n\t// Correct invalid \"BR\" ranges. The cannot contain any children.\r\n\tif ( startContainer.nodeName === 'BR' ) {\r\n\t\tconst { parentNode } = startContainer;\r\n\t\tassertIsDefined( parentNode, 'parentNode' );\r\n\t\tconst index = /** @type {Node[]} */ (\r\n\t\t\tArray.from( parentNode.childNodes )\r\n\t\t).indexOf( startContainer );\r\n\r\n\t\tassertIsDefined( ownerDocument, 'ownerDocument' );\r\n\t\trange = ownerDocument.createRange();\r\n\t\trange.setStart( parentNode, index );\r\n\t\trange.setEnd( parentNode, index );\r\n\t}\r\n\r\n\tconst rects = range.getClientRects();\r\n\r\n\t// If we have multiple rectangles for a collapsed range, there's no way to\r\n\t// know which it is, so don't return anything.\r\n\tif ( rects.length > 1 ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tlet rect = rects[ 0 ];\r\n\r\n\t// If the collapsed range starts (and therefore ends) at an element node,\r\n\t// `getClientRects` can be empty in some browsers. This can be resolved\r\n\t// by adding a temporary text node with zero-width space to the range.\r\n\t//\r\n\t// See: https://stackoverflow.com/a/6847328/995445\r\n\tif ( ! rect || rect.height === 0 ) {\r\n\t\tassertIsDefined( ownerDocument, 'ownerDocument' );\r\n\t\tconst padNode = ownerDocument.createTextNode( '\\u200b' );\r\n\t\t// Do not modify the live range.\r\n\t\trange = range.cloneRange();\r\n\t\trange.insertNode( padNode );\r\n\t\trect = range.getClientRects()[ 0 ];\r\n\t\tassertIsDefined( padNode.parentNode, 'padNode.parentNode' );\r\n\t\tpadNode.parentNode.removeChild( padNode );\r\n\t}\r\n\r\n\treturn rect;\r\n}\r\n"],"mappings":"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","ignoreList":[]}