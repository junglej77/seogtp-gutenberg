{"version":3,"names":["rest","batch","menusEndpoint","menuItemsEndpoint","menuItemObjectRequests","post","menuItem","path","method","data","title","status","page","menuItemObjectMatchers","raw","deleteAllMenus","menus","map","menu","id","createMenu","menuItems","menuResponse","length","objectRequests","getRequest","object","undefined","filter","request","objectResponses","objectRequest","objectResponse","push","menuItemsResponse","objectMatcher","find","body","object_id","url","link","parent","index","fixtureParentIndex","responses","menuItemResponse","menuItemId"],"sources":["@wordpress/e2e-test-utils/src/menus.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport { rest, batch } from './rest-api';\r\n\r\nconst menusEndpoint = '/wp/v2/menus';\r\nconst menuItemsEndpoint = '/wp/v2/menu-items';\r\n\r\nconst menuItemObjectRequests = {\r\n\tpost: ( menuItem ) => ( {\r\n\t\tpath: '/wp/v2/posts',\r\n\t\tmethod: 'POST',\r\n\t\tdata: {\r\n\t\t\ttitle: menuItem.title,\r\n\t\t\tstatus: 'publish',\r\n\t\t},\r\n\t} ),\r\n\tpage: ( menuItem ) => ( {\r\n\t\tpath: '/wp/v2/pages',\r\n\t\tmethod: 'POST',\r\n\t\tdata: {\r\n\t\t\ttitle: menuItem.title,\r\n\t\t\tstatus: 'publish',\r\n\t\t},\r\n\t} ),\r\n};\r\n\r\nconst menuItemObjectMatchers = {\r\n\tpost: ( menuItem, post ) => menuItem.title === post.title.raw,\r\n\tpage: ( menuItem, page ) => menuItem.title === page.title.raw,\r\n};\r\n\r\n/**\r\n * Delete all menus using the REST API\r\n */\r\nexport async function deleteAllMenus() {\r\n\tconst menus = await rest( { path: menusEndpoint } );\r\n\r\n\tawait batch(\r\n\t\tmenus.map( ( menu ) => ( {\r\n\t\t\tmethod: 'DELETE',\r\n\t\t\tpath: `${ menusEndpoint }/${ menu.id }?force=true`,\r\n\t\t} ) )\r\n\t);\r\n}\r\n\r\n/**\r\n * Create menus and all linked resources for the menu using the REST API.\r\n *\r\n * @param {Object} menu      Rest payload for the menu\r\n * @param {?Array} menuItems Data for any menu items to be created.\r\n */\r\nexport async function createMenu( menu, menuItems ) {\r\n\t// Step 1. Create the menu.\r\n\tconst menuResponse = await rest( {\r\n\t\tmethod: 'POST',\r\n\t\tpath: menusEndpoint,\r\n\t\tdata: menu,\r\n\t} );\r\n\r\n\tif ( ! menuItems?.length ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Step 2. Create all the pages/posts/categories etc. that menu items\r\n\t// are linked to. These items don't support rest batching so create them\r\n\t// using individual requests.\r\n\tconst objectRequests = menuItems\r\n\t\t.map( ( menuItem ) => {\r\n\t\t\tconst getRequest = menuItemObjectRequests[ menuItem.object ];\r\n\t\t\treturn getRequest ? getRequest( menuItem ) : undefined;\r\n\t\t} )\r\n\t\t.filter( ( request ) => !! request );\r\n\tconst objectResponses = [];\r\n\tfor ( const objectRequest of objectRequests ) {\r\n\t\tconst objectResponse = await rest( objectRequest );\r\n\t\tobjectResponses.push( objectResponse );\r\n\t}\r\n\r\n\t// Step 3. Create the initial menu items without assigned parents. We need\r\n\t// the ids of all the menu items first before being able to assign the\r\n\t// correct id of the parent.\r\n\tconst menuItemsResponse = await batch(\r\n\t\tmenuItems.map( ( menuItem ) => {\r\n\t\t\t// If the menu item is linked to an 'object', get the id for that\r\n\t\t\t// object.\r\n\t\t\tconst objectMatcher = menuItemObjectMatchers[ menuItem.object ];\r\n\t\t\tlet object;\r\n\t\t\tif ( objectMatcher ) {\r\n\t\t\t\tobject = objectResponses.find( ( objectResponse ) =>\r\n\t\t\t\t\tobjectMatcher( menuItem, objectResponse )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tpath: menuItemsEndpoint,\r\n\t\t\t\tbody: {\r\n\t\t\t\t\tmenus: menuResponse.id,\r\n\t\t\t\t\tobject_id: object?.id,\r\n\t\t\t\t\turl: object?.link,\r\n\t\t\t\t\t...menuItem,\r\n\t\t\t\t\tparent: undefined,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t} )\r\n\t);\r\n\r\n\t// Step 4. Make another menu item request to assign parents.\r\n\tawait batch(\r\n\t\tmenuItems\r\n\t\t\t.map( ( menuItem, index ) => {\r\n\t\t\t\t// In the fixture data, the parent corresponds to the\r\n\t\t\t\t// index in the array, dereference that to find the actual\r\n\t\t\t\t// menu item id.\r\n\t\t\t\tconst fixtureParentIndex = menuItem?.parent !== undefined;\r\n\r\n\t\t\t\t// Skip any menu items that are top level.\r\n\t\t\t\tif ( ! fixtureParentIndex ) {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst parent =\r\n\t\t\t\t\tmenuItemsResponse.responses[ menuItem.parent ].body.id;\r\n\t\t\t\tconst menuItemResponse = menuItemsResponse.responses[ index ];\r\n\t\t\t\tconst menuItemId = menuItemResponse.body.id;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tmethod: 'PUT',\r\n\t\t\t\t\tpath: `${ menuItemsEndpoint }/${ menuItemId }`,\r\n\t\t\t\t\tbody: { ...menuItemResponse.body, parent },\r\n\t\t\t\t};\r\n\t\t\t} )\r\n\t\t\t.filter( ( request ) => !! request )\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}