{"version":3,"names":["fetch","getJSONResponse","mockOrTransform","mockCheck","mock","responseObjectTransform","obj","request","response","url","headers","method","body","postData","responseObject","json","respond"],"sources":["@wordpress/e2e-test-utils/src/mocks/mock-or-transform.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport fetch from 'node-fetch';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { getJSONResponse } from '../shared/get-json-response';\r\n\r\n/**\r\n * Mocks a request with the supplied mock object, or allows it to run with an optional transform, based on the\r\n * deserialised JSON response for the request.\r\n *\r\n * @param {Function}           mockCheck               function that returns true if the request should be mocked.\r\n * @param {Object}             mock                    A mock object to wrap in a JSON response, if the request should be mocked.\r\n * @param {Function|undefined} responseObjectTransform An optional function that transforms the response's object before the response is used.\r\n * @return {Promise} Promise that uses `mockCheck` to see if a request should be mocked with `mock`, and optionally transforms the response with `responseObjectTransform`.\r\n */\r\nexport function mockOrTransform(\r\n\tmockCheck,\r\n\tmock,\r\n\tresponseObjectTransform = ( obj ) => obj\r\n) {\r\n\treturn async ( request ) => {\r\n\t\t// Because we can't get the responses to requests and modify them on the fly,\r\n\t\t// we have to make our own request and get the response, then apply the\r\n\t\t// optional transform to the json encoded object.\r\n\t\tconst response = await fetch( request.url(), {\r\n\t\t\theaders: request.headers(),\r\n\t\t\tmethod: request.method(),\r\n\t\t\tbody: request.postData(),\r\n\t\t} );\r\n\t\tconst responseObject = await response.json();\r\n\t\tif ( mockCheck( responseObject ) ) {\r\n\t\t\trequest.respond( getJSONResponse( mock ) );\r\n\t\t} else {\r\n\t\t\trequest.respond(\r\n\t\t\t\tgetJSONResponse( responseObjectTransform( responseObject ) )\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,KAAK,MAAM,YAAY;;AAE9B;AACA;AACA;AACA,SAASC,eAAe,QAAQ,6BAA6B;;AAE7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,eAAeA,CAC9BC,SAAS,EACTC,IAAI,EACJC,uBAAuB,GAAKC,GAAG,IAAMA,GAAG,EACvC;EACD,OAAO,MAAQC,OAAO,IAAM;IAC3B;IACA;IACA;IACA,MAAMC,QAAQ,GAAG,MAAMR,KAAK,CAAEO,OAAO,CAACE,GAAG,CAAC,CAAC,EAAE;MAC5CC,OAAO,EAAEH,OAAO,CAACG,OAAO,CAAC,CAAC;MAC1BC,MAAM,EAAEJ,OAAO,CAACI,MAAM,CAAC,CAAC;MACxBC,IAAI,EAAEL,OAAO,CAACM,QAAQ,CAAC;IACxB,CAAE,CAAC;IACH,MAAMC,cAAc,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;IAC5C,IAAKZ,SAAS,CAAEW,cAAe,CAAC,EAAG;MAClCP,OAAO,CAACS,OAAO,CAAEf,eAAe,CAAEG,IAAK,CAAE,CAAC;IAC3C,CAAC,MAAM;MACNG,OAAO,CAACS,OAAO,CACdf,eAAe,CAAEI,uBAAuB,CAAES,cAAe,CAAE,CAC5D,CAAC;IACF;EACD,CAAC;AACF","ignoreList":[]}