{"version":3,"names":["capitalCase","modifiers","SHIFT","ALT","CTRL","emulateSelectAll","page","evaluate","_document$activeEleme","isMac","test","window","navigator","platform","canvasDoc","document","activeElement","contentDocument","dispatchEvent","KeyboardEvent","bubbles","cancelable","key","code","location","DOM_KEY_LOCATION_LEFT","getModifierState","keyArg","ctrlKey","metaKey","charCode","keyCode","which","preventableEvent","DOM_KEY_LOCATION_STANDARD","wasPrevented","defaultPrevented","execCommand","setClipboardData","plainText","html","_plainText","_html","_clipboardData","DataTransfer","setData","emulateClipboard","type","_type","_document$activeEleme2","selection","defaultView","getSelection","toString","rangeCount","range","getRangeAt","fragment","cloneContents","Array","from","childNodes","map","node","outerHTML","nodeValue","join","ClipboardEvent","clipboardData","pressKeyWithModifier","modifier","toLowerCase","isAppleOS","process","overWrittenModifiers","shiftAlt","_isApple","mappedModifiers","ctrlSwap","mod","Promise","all","capitalizedMod","keyboard","down","press","up"],"sources":["@wordpress/e2e-test-utils/src/press-key-with-modifier.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport { capitalCase } from 'change-case';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { modifiers, SHIFT, ALT, CTRL } from '@wordpress/keycodes';\r\n\r\n/**\r\n * Emulates a Ctrl+A SelectAll key combination by dispatching custom keyboard\r\n * events and using the results of those events to determine whether to call\r\n * `document.execCommand( 'selectall' );`. This is necessary because Puppeteer\r\n * does not emulate Ctrl+A SelectAll in macOS. Events are dispatched to ensure\r\n * that any `Event#preventDefault` which would have normally occurred in the\r\n * application as a result of Ctrl+A is respected.\r\n *\r\n * @see https://github.com/GoogleChrome/puppeteer/issues/1313\r\n * @see https://w3c.github.io/uievents/tools/key-event-viewer.html\r\n *\r\n * @return {Promise} Promise resolving once the SelectAll emulation completes.\r\n */\r\nasync function emulateSelectAll() {\r\n\tawait page.evaluate( () => {\r\n\t\tconst isMac = /Mac|iPod|iPhone|iPad/.test( window.navigator.platform );\r\n\t\tconst canvasDoc = document.activeElement.contentDocument ?? document;\r\n\r\n\t\tcanvasDoc.activeElement.dispatchEvent(\r\n\t\t\tnew KeyboardEvent( 'keydown', {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcancelable: true,\r\n\t\t\t\tkey: isMac ? 'Meta' : 'Control',\r\n\t\t\t\tcode: isMac ? 'MetaLeft' : 'ControlLeft',\r\n\t\t\t\tlocation: window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,\r\n\t\t\t\tgetModifierState: ( keyArg ) =>\r\n\t\t\t\t\tkeyArg === ( isMac ? 'Meta' : 'Control' ),\r\n\t\t\t\tctrlKey: ! isMac,\r\n\t\t\t\tmetaKey: isMac,\r\n\t\t\t\tcharCode: 0,\r\n\t\t\t\tkeyCode: isMac ? 93 : 17,\r\n\t\t\t\twhich: isMac ? 93 : 17,\r\n\t\t\t} )\r\n\t\t);\r\n\r\n\t\tconst preventableEvent = new KeyboardEvent( 'keydown', {\r\n\t\t\tbubbles: true,\r\n\t\t\tcancelable: true,\r\n\t\t\tkey: 'a',\r\n\t\t\tcode: 'KeyA',\r\n\t\t\tlocation: window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,\r\n\t\t\tgetModifierState: ( keyArg ) =>\r\n\t\t\t\tkeyArg === ( isMac ? 'Meta' : 'Control' ),\r\n\t\t\tctrlKey: ! isMac,\r\n\t\t\tmetaKey: isMac,\r\n\t\t\tcharCode: 0,\r\n\t\t\tkeyCode: 65,\r\n\t\t\twhich: 65,\r\n\t\t} );\r\n\r\n\t\tconst wasPrevented =\r\n\t\t\t! canvasDoc.activeElement.dispatchEvent( preventableEvent ) ||\r\n\t\t\tpreventableEvent.defaultPrevented;\r\n\r\n\t\tif ( ! wasPrevented ) {\r\n\t\t\tcanvasDoc.execCommand( 'selectall', false, null );\r\n\t\t}\r\n\r\n\t\tcanvasDoc.activeElement.dispatchEvent(\r\n\t\t\tnew KeyboardEvent( 'keyup', {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcancelable: true,\r\n\t\t\t\tkey: isMac ? 'Meta' : 'Control',\r\n\t\t\t\tcode: isMac ? 'MetaLeft' : 'ControlLeft',\r\n\t\t\t\tlocation: window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,\r\n\t\t\t\tgetModifierState: () => false,\r\n\t\t\t\tcharCode: 0,\r\n\t\t\t\tkeyCode: isMac ? 93 : 17,\r\n\t\t\t\twhich: isMac ? 93 : 17,\r\n\t\t\t} )\r\n\t\t);\r\n\t} );\r\n}\r\n\r\n/**\r\n * Sets the clipboard data that can be pasted with\r\n * `pressKeyWithModifier( 'primary', 'v' )`.\r\n *\r\n * @param {Object} $1           Options.\r\n * @param {string} $1.plainText Plain text to set.\r\n * @param {string} $1.html      HTML to set.\r\n */\r\nexport async function setClipboardData( { plainText = '', html = '' } ) {\r\n\tawait page.evaluate(\r\n\t\t( _plainText, _html ) => {\r\n\t\t\twindow._clipboardData = new DataTransfer();\r\n\t\t\twindow._clipboardData.setData( 'text/plain', _plainText );\r\n\t\t\twindow._clipboardData.setData( 'text/html', _html );\r\n\t\t},\r\n\t\tplainText,\r\n\t\thtml\r\n\t);\r\n}\r\n\r\nasync function emulateClipboard( type ) {\r\n\tawait page.evaluate( ( _type ) => {\r\n\t\tconst canvasDoc = document.activeElement.contentDocument ?? document;\r\n\r\n\t\tif ( _type !== 'paste' ) {\r\n\t\t\twindow._clipboardData = new DataTransfer();\r\n\r\n\t\t\tconst selection = canvasDoc.defaultView.getSelection();\r\n\t\t\tconst plainText = selection.toString();\r\n\t\t\tlet html = plainText;\r\n\r\n\t\t\tif ( selection.rangeCount ) {\r\n\t\t\t\tconst range = selection.getRangeAt( 0 );\r\n\t\t\t\tconst fragment = range.cloneContents();\r\n\r\n\t\t\t\thtml = Array.from( fragment.childNodes )\r\n\t\t\t\t\t.map( ( node ) => node.outerHTML || node.nodeValue )\r\n\t\t\t\t\t.join( '' );\r\n\t\t\t}\r\n\r\n\t\t\twindow._clipboardData.setData( 'text/plain', plainText );\r\n\t\t\twindow._clipboardData.setData( 'text/html', html );\r\n\t\t}\r\n\r\n\t\tcanvasDoc.activeElement.dispatchEvent(\r\n\t\t\tnew ClipboardEvent( _type, {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcancelable: true,\r\n\t\t\t\tclipboardData: window._clipboardData,\r\n\t\t\t} )\r\n\t\t);\r\n\t}, type );\r\n}\r\n\r\n/**\r\n * Performs a key press with modifier (Shift, Control, Meta, Alt), where each modifier\r\n * is normalized to platform-specific modifier.\r\n *\r\n * @param {string} modifier Modifier key.\r\n * @param {string} key      Key to press while modifier held.\r\n */\r\nexport async function pressKeyWithModifier( modifier, key ) {\r\n\tif ( modifier.toLowerCase() === 'primary' && key.toLowerCase() === 'a' ) {\r\n\t\treturn await emulateSelectAll();\r\n\t}\r\n\r\n\tif ( modifier.toLowerCase() === 'primary' && key.toLowerCase() === 'c' ) {\r\n\t\treturn await emulateClipboard( 'copy' );\r\n\t}\r\n\r\n\tif ( modifier.toLowerCase() === 'primary' && key.toLowerCase() === 'x' ) {\r\n\t\treturn await emulateClipboard( 'cut' );\r\n\t}\r\n\r\n\tif ( modifier.toLowerCase() === 'primary' && key.toLowerCase() === 'v' ) {\r\n\t\treturn await emulateClipboard( 'paste' );\r\n\t}\r\n\r\n\tconst isAppleOS = () => process.platform === 'darwin';\r\n\tconst overWrittenModifiers = {\r\n\t\t...modifiers,\r\n\t\tshiftAlt: ( _isApple ) =>\r\n\t\t\t_isApple() ? [ SHIFT, ALT ] : [ SHIFT, CTRL ],\r\n\t};\r\n\tconst mappedModifiers = overWrittenModifiers[ modifier ]( isAppleOS );\r\n\tconst ctrlSwap = ( mod ) => ( mod === CTRL ? 'control' : mod );\r\n\r\n\tawait Promise.all(\r\n\t\tmappedModifiers.map( async ( mod ) => {\r\n\t\t\tconst capitalizedMod = capitalCase( ctrlSwap( mod ) );\r\n\t\t\treturn page.keyboard.down( capitalizedMod );\r\n\t\t} )\r\n\t);\r\n\r\n\tawait page.keyboard.press( key );\r\n\r\n\tawait Promise.all(\r\n\t\tmappedModifiers.map( async ( mod ) => {\r\n\t\t\tconst capitalizedMod = capitalCase( ctrlSwap( mod ) );\r\n\t\t\treturn page.keyboard.up( capitalizedMod );\r\n\t\t} )\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}