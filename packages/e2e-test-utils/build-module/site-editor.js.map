{"version":3,"names":["canvas","visitAdminPage","addQueryArgs","SELECTORS","visualEditor","canvasLoader","disableSiteEditorWelcomeGuide","page","evaluate","window","wp","data","dispatch","set","getCurrentSiteEditorContent","postId","select","getEditedPostId","postType","getEditedPostType","record","getEditedEntityRecord","content","blocks","__unstableSerializeAndClean","visitSiteEditor","query","skipWelcomeGuide","slice","waitForSelector","hidden","toggleGlobalStyles","click","openGlobalStylesPanel","panelName","selector","waitForXPath","openPreviousGlobalStylesPanel","enterEditMode","timeout"],"sources":["@wordpress/e2e-test-utils/src/site-editor.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { canvas, visitAdminPage } from '@wordpress/e2e-test-utils';\r\nimport { addQueryArgs } from '@wordpress/url';\r\n\r\n/**\r\n * @typedef {import('puppeteer-core').ElementHandle} ElementHandle\r\n */\r\n\r\nconst SELECTORS = {\r\n\tvisualEditor: '.edit-site-visual-editor iframe',\r\n\tcanvasLoader: '.edit-site-canvas-loader',\r\n};\r\n\r\n/**\r\n * Skips the welcome guide popping up to first time users of the site editor\r\n */\r\nexport async function disableSiteEditorWelcomeGuide() {\r\n\tawait page.evaluate( () => {\r\n\t\twindow.wp.data\r\n\t\t\t.dispatch( 'core/preferences' )\r\n\t\t\t.set( 'core/edit-site', 'welcomeGuide', false );\r\n\r\n\t\twindow.wp.data\r\n\t\t\t.dispatch( 'core/preferences' )\r\n\t\t\t.set( 'core/edit-site', 'welcomeGuideStyles', false );\r\n\r\n\t\twindow.wp.data\r\n\t\t\t.dispatch( 'core/preferences' )\r\n\t\t\t.set( 'core/edit-site', 'welcomeGuidePage', false );\r\n\r\n\t\twindow.wp.data\r\n\t\t\t.dispatch( 'core/preferences' )\r\n\t\t\t.set( 'core/edit-site', 'welcomeGuideTemplate', false );\r\n\t} );\r\n}\r\n\r\n/**\r\n * Returns a promise which resolves with the edited post content (HTML string).\r\n *\r\n * @return {Promise<string>} Promise resolving with post content markup.\r\n */\r\nexport function getCurrentSiteEditorContent() {\r\n\treturn page.evaluate( () => {\r\n\t\tconst postId = window.wp.data\r\n\t\t\t.select( 'core/edit-site' )\r\n\t\t\t.getEditedPostId();\r\n\t\tconst postType = window.wp.data\r\n\t\t\t.select( 'core/edit-site' )\r\n\t\t\t.getEditedPostType();\r\n\t\tconst record = window.wp.data\r\n\t\t\t.select( 'core' )\r\n\t\t\t.getEditedEntityRecord( 'postType', postType, postId );\r\n\t\tif ( record ) {\r\n\t\t\tif ( typeof record.content === 'function' ) {\r\n\t\t\t\treturn record.content( record );\r\n\t\t\t} else if ( record.blocks ) {\r\n\t\t\t\treturn window.wp.blocks.__unstableSerializeAndClean(\r\n\t\t\t\t\trecord.blocks\r\n\t\t\t\t);\r\n\t\t\t} else if ( record.content ) {\r\n\t\t\t\treturn record.content;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn '';\r\n\t} );\r\n}\r\n\r\n/**\r\n * Visits the Site Editor main page\r\n *\r\n * By default, it also skips the welcome guide. The option can be disabled if need be.\r\n *\r\n * @see disableSiteEditorWelcomeGuide\r\n *\r\n * @param {string}  query                   String to be serialized as query portion of URL.\r\n * @param {boolean} [skipWelcomeGuide=true] Whether to skip the welcome guide as part of the navigation.\r\n */\r\nexport async function visitSiteEditor( query, skipWelcomeGuide = true ) {\r\n\tquery = addQueryArgs( '', {\r\n\t\t...query,\r\n\t} ).slice( 1 );\r\n\r\n\tawait visitAdminPage( 'site-editor.php', query );\r\n\tawait page.waitForSelector( SELECTORS.visualEditor );\r\n\tawait page.waitForSelector( SELECTORS.canvasLoader, {\r\n\t\thidden: true,\r\n\t} );\r\n\r\n\tif ( skipWelcomeGuide ) {\r\n\t\tawait disableSiteEditorWelcomeGuide();\r\n\t}\r\n}\r\n\r\n/**\r\n * Toggles the global styles sidebar (opens it if closed and closes it if open).\r\n */\r\nexport async function toggleGlobalStyles() {\r\n\tawait page.click( '.editor-header__settings button[aria-label=\"Styles\"]' );\r\n}\r\n\r\n/**\r\n * Opens a global styles panel.\r\n *\r\n * @param {string} panelName Name of the panel that is going to be opened.\r\n */\r\nexport async function openGlobalStylesPanel( panelName ) {\r\n\tconst selector = `//div[@aria-label=\"Editor settings\"]//button[.//*[text()=\"${ panelName }\"]]`;\r\n\tawait ( await page.waitForXPath( selector ) ).click();\r\n}\r\n\r\n/**\r\n * Opens the previous global styles panel.\r\n */\r\nexport async function openPreviousGlobalStylesPanel() {\r\n\tawait page.click(\r\n\t\t'div[aria-label=\"Editor settings\"] button[aria-label=\"Back\"]'\r\n\t);\r\n}\r\n\r\n/**\r\n * Enters edit mode.\r\n */\r\nexport async function enterEditMode() {\r\n\ttry {\r\n\t\tawait page.waitForSelector(\r\n\t\t\t'.edit-site-visual-editor__editor-canvas[role=\"button\"]',\r\n\t\t\t{ timeout: 3000 }\r\n\t\t);\r\n\r\n\t\tawait canvas().click( 'body' );\r\n\t} catch {\r\n\t\t// This catch is necessary for the performance tests in old branches\r\n\t\t// where the site editor toggle was not implemented yet.\r\n\t}\r\n}\r\n"],"mappings":"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","ignoreList":[]}