{"version":3,"names":["memize","I18nManager","GestureHandlerRootView","Component","EditorProvider","ErrorBoundary","store","editorStore","parse","serialize","withDispatch","withSelect","compose","subscribeSetFocusOnTitle","subscribeFeaturedImageIdNativeUpdated","SlotFillProvider","coreStore","Layout","jsx","_jsx","Editor","constructor","props","arguments","initialHtmlModeEnabled","mode","switchEditorMode","getEditorSettings","maxSize","setTitleRef","bind","settings","isRTL","componentDidMount","editEntityRecord","postType","postId","subscriptionParentSetFocusOnTitle","postTitleRef","focus","focusTitleWhenAvailable","subscriptionParentFeaturedImageIdNativeUpdated","payload","featured_media","featuredImageId","undoIgnore","componentWillUnmount","remove","titleRef","render","initialEdits","post","initialHtml","editorSettings","normalizedPost","id","title","raw","initialTitle","content","type","status","meta","style","flex","children","useSubRegistry","select","getEditorMode","dispatch"],"sources":["@wordpress/edit-post/src/editor.native.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport memize from 'memize';\r\nimport { I18nManager } from 'react-native';\r\nimport { GestureHandlerRootView } from 'react-native-gesture-handler';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { Component } from '@wordpress/element';\r\nimport {\r\n\tEditorProvider,\r\n\tErrorBoundary,\r\n\tstore as editorStore,\r\n} from '@wordpress/editor';\r\nimport { parse, serialize } from '@wordpress/blocks';\r\nimport { withDispatch, withSelect } from '@wordpress/data';\r\nimport { compose } from '@wordpress/compose';\r\nimport {\r\n\tsubscribeSetFocusOnTitle,\r\n\tsubscribeFeaturedImageIdNativeUpdated,\r\n} from '@wordpress/react-native-bridge';\r\nimport { SlotFillProvider } from '@wordpress/components';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport Layout from './components/layout';\r\n\r\nclass Editor extends Component {\r\n\tconstructor( props ) {\r\n\t\tsuper( ...arguments );\r\n\r\n\t\tif ( props.initialHtmlModeEnabled && props.mode === 'visual' ) {\r\n\t\t\t// Enable html mode if the initial mode the parent wants it but we're not already in it.\r\n\t\t\tthis.props.switchEditorMode( 'text' );\r\n\t\t}\r\n\r\n\t\tthis.getEditorSettings = memize( this.getEditorSettings, {\r\n\t\t\tmaxSize: 1,\r\n\t\t} );\r\n\r\n\t\tthis.setTitleRef = this.setTitleRef.bind( this );\r\n\t}\r\n\r\n\tgetEditorSettings( settings ) {\r\n\t\tsettings = {\r\n\t\t\t...settings,\r\n\t\t\tisRTL: I18nManager.isRTL,\r\n\t\t};\r\n\r\n\t\treturn settings;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tconst { editEntityRecord, postType, postId } = this.props;\r\n\r\n\t\tthis.subscriptionParentSetFocusOnTitle = subscribeSetFocusOnTitle(\r\n\t\t\t() => {\r\n\t\t\t\tif ( this.postTitleRef ) {\r\n\t\t\t\t\tthis.postTitleRef.focus();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If the post title ref is not available, we postpone setting focus to when it's available.\r\n\t\t\t\t\tthis.focusTitleWhenAvailable = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.subscriptionParentFeaturedImageIdNativeUpdated =\r\n\t\t\tsubscribeFeaturedImageIdNativeUpdated( ( payload ) => {\r\n\t\t\t\teditEntityRecord(\r\n\t\t\t\t\t'postType',\r\n\t\t\t\t\tpostType,\r\n\t\t\t\t\tpostId,\r\n\t\t\t\t\t{ featured_media: payload.featuredImageId },\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tundoIgnore: true,\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} );\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tif ( this.subscriptionParentSetFocusOnTitle ) {\r\n\t\t\tthis.subscriptionParentSetFocusOnTitle.remove();\r\n\t\t}\r\n\r\n\t\tif ( this.subscribeFeaturedImageIdNativeUpdated ) {\r\n\t\t\tthis.subscribeFeaturedImageIdNativeUpdated.remove();\r\n\t\t}\r\n\t}\r\n\r\n\tsetTitleRef( titleRef ) {\r\n\t\tif ( this.focusTitleWhenAvailable && ! this.postTitleRef ) {\r\n\t\t\tthis.focusTitleWhenAvailable = false;\r\n\t\t\ttitleRef.focus();\r\n\t\t}\r\n\r\n\t\tthis.postTitleRef = titleRef;\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tsettings,\r\n\t\t\tinitialEdits,\r\n\t\t\tpost,\r\n\t\t\tpostId,\r\n\t\t\tpostType,\r\n\t\t\tfeaturedImageId,\r\n\t\t\tinitialHtml,\r\n\t\t\t...props\r\n\t\t} = this.props;\r\n\r\n\t\tconst editorSettings = this.getEditorSettings( settings );\r\n\r\n\t\tconst normalizedPost = post || {\r\n\t\t\tid: postId,\r\n\t\t\ttitle: {\r\n\t\t\t\traw: props.initialTitle || '',\r\n\t\t\t},\r\n\t\t\tfeatured_media: featuredImageId,\r\n\t\t\tcontent: {\r\n\t\t\t\t// Make sure the post content is in sync with gutenberg store\r\n\t\t\t\t// to avoid marking the post as modified when simply loaded\r\n\t\t\t\t// For now, let's assume: serialize( parse( html ) ) !== html.\r\n\t\t\t\traw: serialize( parse( initialHtml || '' ) ),\r\n\t\t\t},\r\n\t\t\ttype: postType,\r\n\t\t\tstatus: 'draft',\r\n\t\t\tmeta: [],\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<GestureHandlerRootView style={ { flex: 1 } }>\r\n\t\t\t\t<SlotFillProvider>\r\n\t\t\t\t\t<EditorProvider\r\n\t\t\t\t\t\tsettings={ editorSettings }\r\n\t\t\t\t\t\tpost={ normalizedPost }\r\n\t\t\t\t\t\tinitialEdits={ initialEdits }\r\n\t\t\t\t\t\tuseSubRegistry={ false }\r\n\t\t\t\t\t\t{ ...props }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t\t<Layout setTitleRef={ this.setTitleRef } />\r\n\t\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t\t</EditorProvider>\r\n\t\t\t\t</SlotFillProvider>\r\n\t\t\t</GestureHandlerRootView>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default compose( [\r\n\twithSelect( ( select ) => {\r\n\t\tconst { getEditorMode } = select( editorStore );\r\n\r\n\t\treturn {\r\n\t\t\tmode: getEditorMode(),\r\n\t\t};\r\n\t} ),\r\n\twithDispatch( ( dispatch ) => {\r\n\t\tconst { switchEditorMode } = dispatch( editorStore );\r\n\t\tconst { editEntityRecord } = dispatch( coreStore );\r\n\t\treturn {\r\n\t\t\tswitchEditorMode,\r\n\t\t\teditEntityRecord,\r\n\t\t};\r\n\t} ),\r\n] )( Editor );\r\n"],"mappings":"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","ignoreList":[]}