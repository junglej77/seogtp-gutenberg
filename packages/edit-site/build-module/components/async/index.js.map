{"version":3,"names":["useEffect","useState","flushSync","createQueue","blockPreviewQueue","Async","children","placeholder","shouldRender","setShouldRender","context","add","cancel"],"sources":["@wordpress/edit-site/src/components/async/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useEffect, useState, flushSync } from '@wordpress/element';\r\nimport { createQueue } from '@wordpress/priority-queue';\r\n\r\nconst blockPreviewQueue = createQueue();\r\n\r\n/**\r\n * Renders a component at the next idle time.\r\n * @param {*} props\r\n */\r\nexport function Async( { children, placeholder } ) {\r\n\tconst [ shouldRender, setShouldRender ] = useState( false );\r\n\r\n\t// In the future, we could try to use startTransition here, but currently\r\n\t// react will batch all transitions, which means all previews will be\r\n\t// rendered at the same time.\r\n\t// https://react.dev/reference/react/startTransition#caveats\r\n\t// > If there are multiple ongoing Transitions, React currently batches them\r\n\t// > together. This is a limitation that will likely be removed in a future\r\n\t// > release.\r\n\r\n\tuseEffect( () => {\r\n\t\tconst context = {};\r\n\t\tblockPreviewQueue.add( context, () => {\r\n\t\t\t// Synchronously run all renders so it consumes timeRemaining.\r\n\t\t\t// See https://github.com/WordPress/gutenberg/pull/48238\r\n\t\t\tflushSync( () => {\r\n\t\t\t\tsetShouldRender( true );\r\n\t\t\t} );\r\n\t\t} );\r\n\t\treturn () => {\r\n\t\t\tblockPreviewQueue.cancel( context );\r\n\t\t};\r\n\t}, [] );\r\n\r\n\tif ( ! shouldRender ) {\r\n\t\treturn placeholder;\r\n\t}\r\n\r\n\treturn children;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,oBAAoB;AACnE,SAASC,WAAW,QAAQ,2BAA2B;AAEvD,MAAMC,iBAAiB,GAAGD,WAAW,CAAC,CAAC;;AAEvC;AACA;AACA;AACA;AACA,OAAO,SAASE,KAAKA,CAAE;EAAEC,QAAQ;EAAEC;AAAY,CAAC,EAAG;EAClD,MAAM,CAAEC,YAAY,EAAEC,eAAe,CAAE,GAAGR,QAAQ,CAAE,KAAM,CAAC;;EAE3D;EACA;EACA;EACA;EACA;EACA;EACA;;EAEAD,SAAS,CAAE,MAAM;IAChB,MAAMU,OAAO,GAAG,CAAC,CAAC;IAClBN,iBAAiB,CAACO,GAAG,CAAED,OAAO,EAAE,MAAM;MACrC;MACA;MACAR,SAAS,CAAE,MAAM;QAChBO,eAAe,CAAE,IAAK,CAAC;MACxB,CAAE,CAAC;IACJ,CAAE,CAAC;IACH,OAAO,MAAM;MACZL,iBAAiB,CAACQ,MAAM,CAAEF,OAAQ,CAAC;IACpC,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,IAAK,CAAEF,YAAY,EAAG;IACrB,OAAOD,WAAW;EACnB;EAEA,OAAOD,QAAQ;AAChB","ignoreList":[]}