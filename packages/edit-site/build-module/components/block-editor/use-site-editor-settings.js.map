{"version":3,"names":["useSelect","useMemo","privateApis","routerPrivateApis","usePrevious","store","editSiteStore","unlock","useNavigateToEntityRecord","FOCUSABLE_ENTITIES","useLocation","useHistory","useNavigateToPreviousEntityRecord","location","previousLocation","history","goBack","isFocusMode","params","focusMode","postId","includes","postType","didComeFromEditorCanvas","canvas","showBackButton","back","undefined","useSpecificEditorSettings","onNavigateToEntityRecord","canvasMode","settings","shouldUseTemplateAsDefaultRenderingMode","select","getEditedPostContext","getCanvasMode","getSettings","_context","defaultRenderingMode","onNavigateToPreviousEntityRecord","defaultEditorSettings","richEditingEnabled","supportsTemplateMode","__unstableIsPreviewMode"],"sources":["@wordpress/edit-site/src/components/block-editor/use-site-editor-settings.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useMemo } from '@wordpress/element';\r\nimport { privateApis as routerPrivateApis } from '@wordpress/router';\r\nimport { usePrevious } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editSiteStore } from '../../store';\r\nimport { unlock } from '../../lock-unlock';\r\nimport useNavigateToEntityRecord from './use-navigate-to-entity-record';\r\nimport { FOCUSABLE_ENTITIES } from '../../utils/constants';\r\n\r\nconst { useLocation, useHistory } = unlock( routerPrivateApis );\r\n\r\nfunction useNavigateToPreviousEntityRecord() {\r\n\tconst location = useLocation();\r\n\tconst previousLocation = usePrevious( location );\r\n\tconst history = useHistory();\r\n\tconst goBack = useMemo( () => {\r\n\t\tconst isFocusMode =\r\n\t\t\tlocation.params.focusMode ||\r\n\t\t\t( location.params.postId &&\r\n\t\t\t\tFOCUSABLE_ENTITIES.includes( location.params.postType ) );\r\n\t\tconst didComeFromEditorCanvas =\r\n\t\t\tpreviousLocation?.params.canvas === 'edit';\r\n\t\tconst showBackButton = isFocusMode && didComeFromEditorCanvas;\r\n\t\treturn showBackButton ? () => history.back() : undefined;\r\n\t\t// Disable reason: previousLocation changes when the component updates for any reason, not\r\n\t\t// just when location changes. Until this is fixed we can't add it to deps. See\r\n\t\t// https://github.com/WordPress/gutenberg/pull/58710#discussion_r1479219465.\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [ location, history ] );\r\n\treturn goBack;\r\n}\r\n\r\nexport function useSpecificEditorSettings() {\r\n\tconst onNavigateToEntityRecord = useNavigateToEntityRecord();\r\n\tconst { canvasMode, settings, shouldUseTemplateAsDefaultRenderingMode } =\r\n\t\tuseSelect( ( select ) => {\r\n\t\t\tconst { getEditedPostContext, getCanvasMode, getSettings } = unlock(\r\n\t\t\t\tselect( editSiteStore )\r\n\t\t\t);\r\n\t\t\tconst _context = getEditedPostContext();\r\n\t\t\treturn {\r\n\t\t\t\tcanvasMode: getCanvasMode(),\r\n\t\t\t\tsettings: getSettings(),\r\n\t\t\t\t// TODO: The `postType` check should be removed when the default rendering mode per post type is merged.\r\n\t\t\t\t// @see https://github.com/WordPress/gutenberg/pull/62304/\r\n\t\t\t\tshouldUseTemplateAsDefaultRenderingMode:\r\n\t\t\t\t\t_context?.postId && _context?.postType !== 'post',\r\n\t\t\t};\r\n\t\t}, [] );\r\n\tconst defaultRenderingMode = shouldUseTemplateAsDefaultRenderingMode\r\n\t\t? 'template-locked'\r\n\t\t: 'post-only';\r\n\tconst onNavigateToPreviousEntityRecord =\r\n\t\tuseNavigateToPreviousEntityRecord();\r\n\tconst defaultEditorSettings = useMemo( () => {\r\n\t\treturn {\r\n\t\t\t...settings,\r\n\r\n\t\t\trichEditingEnabled: true,\r\n\t\t\tsupportsTemplateMode: true,\r\n\t\t\tfocusMode: canvasMode !== 'view',\r\n\t\t\tdefaultRenderingMode,\r\n\t\t\tonNavigateToEntityRecord,\r\n\t\t\tonNavigateToPreviousEntityRecord,\r\n\t\t\t__unstableIsPreviewMode: canvasMode === 'view',\r\n\t\t};\r\n\t}, [\r\n\t\tsettings,\r\n\t\tcanvasMode,\r\n\t\tdefaultRenderingMode,\r\n\t\tonNavigateToEntityRecord,\r\n\t\tonNavigateToPreviousEntityRecord,\r\n\t] );\r\n\r\n\treturn defaultEditorSettings;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,OAAO,QAAQ,oBAAoB;AAC5C,SAASC,WAAW,IAAIC,iBAAiB,QAAQ,mBAAmB;AACpE,SAASC,WAAW,QAAQ,oBAAoB;;AAEhD;AACA;AACA;AACA,SAASC,KAAK,IAAIC,aAAa,QAAQ,aAAa;AACpD,SAASC,MAAM,QAAQ,mBAAmB;AAC1C,OAAOC,yBAAyB,MAAM,iCAAiC;AACvE,SAASC,kBAAkB,QAAQ,uBAAuB;AAE1D,MAAM;EAAEC,WAAW;EAAEC;AAAW,CAAC,GAAGJ,MAAM,CAAEJ,iBAAkB,CAAC;AAE/D,SAASS,iCAAiCA,CAAA,EAAG;EAC5C,MAAMC,QAAQ,GAAGH,WAAW,CAAC,CAAC;EAC9B,MAAMI,gBAAgB,GAAGV,WAAW,CAAES,QAAS,CAAC;EAChD,MAAME,OAAO,GAAGJ,UAAU,CAAC,CAAC;EAC5B,MAAMK,MAAM,GAAGf,OAAO,CAAE,MAAM;IAC7B,MAAMgB,WAAW,GAChBJ,QAAQ,CAACK,MAAM,CAACC,SAAS,IACvBN,QAAQ,CAACK,MAAM,CAACE,MAAM,IACvBX,kBAAkB,CAACY,QAAQ,CAAER,QAAQ,CAACK,MAAM,CAACI,QAAS,CAAG;IAC3D,MAAMC,uBAAuB,GAC5BT,gBAAgB,EAAEI,MAAM,CAACM,MAAM,KAAK,MAAM;IAC3C,MAAMC,cAAc,GAAGR,WAAW,IAAIM,uBAAuB;IAC7D,OAAOE,cAAc,GAAG,MAAMV,OAAO,CAACW,IAAI,CAAC,CAAC,GAAGC,SAAS;IACxD;IACA;IACA;IACA;EACD,CAAC,EAAE,CAAEd,QAAQ,EAAEE,OAAO,CAAG,CAAC;EAC1B,OAAOC,MAAM;AACd;AAEA,OAAO,SAASY,yBAAyBA,CAAA,EAAG;EAC3C,MAAMC,wBAAwB,GAAGrB,yBAAyB,CAAC,CAAC;EAC5D,MAAM;IAAEsB,UAAU;IAAEC,QAAQ;IAAEC;EAAwC,CAAC,GACtEhC,SAAS,CAAIiC,MAAM,IAAM;IACxB,MAAM;MAAEC,oBAAoB;MAAEC,aAAa;MAAEC;IAAY,CAAC,GAAG7B,MAAM,CAClE0B,MAAM,CAAE3B,aAAc,CACvB,CAAC;IACD,MAAM+B,QAAQ,GAAGH,oBAAoB,CAAC,CAAC;IACvC,OAAO;MACNJ,UAAU,EAAEK,aAAa,CAAC,CAAC;MAC3BJ,QAAQ,EAAEK,WAAW,CAAC,CAAC;MACvB;MACA;MACAJ,uCAAuC,EACtCK,QAAQ,EAAEjB,MAAM,IAAIiB,QAAQ,EAAEf,QAAQ,KAAK;IAC7C,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EACR,MAAMgB,oBAAoB,GAAGN,uCAAuC,GACjE,iBAAiB,GACjB,WAAW;EACd,MAAMO,gCAAgC,GACrC3B,iCAAiC,CAAC,CAAC;EACpC,MAAM4B,qBAAqB,GAAGvC,OAAO,CAAE,MAAM;IAC5C,OAAO;MACN,GAAG8B,QAAQ;MAEXU,kBAAkB,EAAE,IAAI;MACxBC,oBAAoB,EAAE,IAAI;MAC1BvB,SAAS,EAAEW,UAAU,KAAK,MAAM;MAChCQ,oBAAoB;MACpBT,wBAAwB;MACxBU,gCAAgC;MAChCI,uBAAuB,EAAEb,UAAU,KAAK;IACzC,CAAC;EACF,CAAC,EAAE,CACFC,QAAQ,EACRD,UAAU,EACVQ,oBAAoB,EACpBT,wBAAwB,EACxBU,gCAAgC,CAC/B,CAAC;EAEH,OAAOC,qBAAqB;AAC7B","ignoreList":[]}