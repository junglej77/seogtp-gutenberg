{"version":3,"names":["__experimentalText","Text","useContext","useEffect","useState","useRef","FontLibraryContext","getFacePreviewStyle","getFamilyPreviewStyle","jsx","_jsx","getPreviewUrl","fontFace","preview","src","Array","isArray","getDisplayFontFace","font","fontStyle","fontWeight","length","find","face","fontFamily","fake","FontDemo","text","ref","style","name","customPreviewUrl","isIntersecting","setIsIntersecting","isAssetLoaded","setIsAssetLoaded","loadFontFaceAsset","previewUrl","isPreviewImage","match","faceStyles","textDemoStyle","fontSize","lineHeight","opacity","observer","window","IntersectionObserver","entry","observe","current","disconnect","loadAsset","children","loading","alt","className"],"sources":["@wordpress/edit-site/src/components/global-styles/font-library-modal/font-demo.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __experimentalText as Text } from '@wordpress/components';\r\nimport { useContext, useEffect, useState, useRef } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { FontLibraryContext } from './context';\r\nimport {\r\n\tgetFacePreviewStyle,\r\n\tgetFamilyPreviewStyle,\r\n} from './utils/preview-styles';\r\n\r\nfunction getPreviewUrl( fontFace ) {\r\n\tif ( fontFace.preview ) {\r\n\t\treturn fontFace.preview;\r\n\t}\r\n\tif ( fontFace.src ) {\r\n\t\treturn Array.isArray( fontFace.src ) ? fontFace.src[ 0 ] : fontFace.src;\r\n\t}\r\n}\r\n\r\nfunction getDisplayFontFace( font ) {\r\n\t// if this IS a font face return it\r\n\tif ( font.fontStyle || font.fontWeight ) {\r\n\t\treturn font;\r\n\t}\r\n\t// if this is a font family with a collection of font faces\r\n\t// return the first one that is normal and 400 OR just the first one\r\n\tif ( font.fontFace && font.fontFace.length ) {\r\n\t\treturn (\r\n\t\t\tfont.fontFace.find(\r\n\t\t\t\t( face ) =>\r\n\t\t\t\t\tface.fontStyle === 'normal' && face.fontWeight === '400'\r\n\t\t\t) || font.fontFace[ 0 ]\r\n\t\t);\r\n\t}\r\n\t// This must be a font family with no font faces\r\n\t// return a fake font face\r\n\treturn {\r\n\t\tfontStyle: 'normal',\r\n\t\tfontWeight: '400',\r\n\t\tfontFamily: font.fontFamily,\r\n\t\tfake: true,\r\n\t};\r\n}\r\n\r\nfunction FontDemo( { font, text } ) {\r\n\tconst ref = useRef( null );\r\n\r\n\tconst fontFace = getDisplayFontFace( font );\r\n\tconst style = getFamilyPreviewStyle( font );\r\n\ttext = text || font.name;\r\n\tconst customPreviewUrl = font.preview;\r\n\r\n\tconst [ isIntersecting, setIsIntersecting ] = useState( false );\r\n\tconst [ isAssetLoaded, setIsAssetLoaded ] = useState( false );\r\n\tconst { loadFontFaceAsset } = useContext( FontLibraryContext );\r\n\r\n\tconst previewUrl = customPreviewUrl ?? getPreviewUrl( fontFace );\r\n\tconst isPreviewImage =\r\n\t\tpreviewUrl && previewUrl.match( /\\.(png|jpg|jpeg|gif|svg)$/i );\r\n\r\n\tconst faceStyles = getFacePreviewStyle( fontFace );\r\n\tconst textDemoStyle = {\r\n\t\tfontSize: '18px',\r\n\t\tlineHeight: 1,\r\n\t\topacity: isAssetLoaded ? '1' : '0',\r\n\t\t...style,\r\n\t\t...faceStyles,\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tconst observer = new window.IntersectionObserver( ( [ entry ] ) => {\r\n\t\t\tsetIsIntersecting( entry.isIntersecting );\r\n\t\t}, {} );\r\n\t\tobserver.observe( ref.current );\r\n\t\treturn () => observer.disconnect();\r\n\t}, [ ref ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tconst loadAsset = async () => {\r\n\t\t\tif ( isIntersecting ) {\r\n\t\t\t\tif ( ! isPreviewImage && fontFace.src ) {\r\n\t\t\t\t\tawait loadFontFaceAsset( fontFace );\r\n\t\t\t\t}\r\n\t\t\t\tsetIsAssetLoaded( true );\r\n\t\t\t}\r\n\t\t};\r\n\t\tloadAsset();\r\n\t}, [ fontFace, isIntersecting, loadFontFaceAsset, isPreviewImage ] );\r\n\r\n\treturn (\r\n\t\t<div ref={ ref }>\r\n\t\t\t{ isPreviewImage ? (\r\n\t\t\t\t<img\r\n\t\t\t\t\tsrc={ previewUrl }\r\n\t\t\t\t\tloading=\"lazy\"\r\n\t\t\t\t\talt={ text }\r\n\t\t\t\t\tclassName=\"font-library-modal__font-variant_demo-image\"\r\n\t\t\t\t/>\r\n\t\t\t) : (\r\n\t\t\t\t<Text\r\n\t\t\t\t\tstyle={ textDemoStyle }\r\n\t\t\t\t\tclassName=\"font-library-modal__font-variant_demo-text\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{ text }\r\n\t\t\t\t</Text>\r\n\t\t\t) }\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default FontDemo;\r\n"],"mappings":"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","ignoreList":[]}