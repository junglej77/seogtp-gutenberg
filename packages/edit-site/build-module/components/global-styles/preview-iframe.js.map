{"version":3,"names":["__unstableIframe","Iframe","__unstableEditorStyles","EditorStyles","privateApis","blockEditorPrivateApis","__unstableMotion","motion","useThrottle","useReducedMotion","useResizeObserver","useLayoutEffect","useState","useMemo","unlock","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","useGlobalStyle","useGlobalStylesOutput","normalizedWidth","normalizedHeight","THROTTLE_OPTIONS","leading","trailing","PreviewIframe","children","label","isFocused","withHoverView","backgroundColor","gradientValue","styles","disableMotion","isHovered","setIsHovered","containerResizeListener","width","throttledWidth","setThrottledWidthState","ratioState","setRatioState","setThrottledWidth","newRatio","ratioDiff","isRatioDiffBigEnough","Math","abs","fallbackRatio","ratio","editorStyles","css","isGlobalStyles","isReady","style","position","className","height","onMouseEnter","onMouseLeave","tabIndex","div","background","cursor","undefined","initial","animate","concat","map","child","key"],"sources":["@wordpress/edit-site/src/components/global-styles/preview-iframe.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\t__unstableIframe as Iframe,\r\n\t__unstableEditorStyles as EditorStyles,\r\n\tprivateApis as blockEditorPrivateApis,\r\n} from '@wordpress/block-editor';\r\nimport { __unstableMotion as motion } from '@wordpress/components';\r\nimport {\r\n\tuseThrottle,\r\n\tuseReducedMotion,\r\n\tuseResizeObserver,\r\n} from '@wordpress/compose';\r\nimport { useLayoutEffect, useState, useMemo } from '@wordpress/element';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { unlock } from '../../lock-unlock';\r\n\r\nconst { useGlobalStyle, useGlobalStylesOutput } = unlock(\r\n\tblockEditorPrivateApis\r\n);\r\n\r\nconst normalizedWidth = 248;\r\nconst normalizedHeight = 152;\r\n\r\n// Throttle options for useThrottle. Must be defined outside of the component,\r\n// so that the object reference is the same on each render.\r\nconst THROTTLE_OPTIONS = {\r\n\tleading: true,\r\n\ttrailing: true,\r\n};\r\n\r\nexport default function PreviewIframe( {\r\n\tchildren,\r\n\tlabel,\r\n\tisFocused,\r\n\twithHoverView,\r\n} ) {\r\n\tconst [ backgroundColor = 'white' ] = useGlobalStyle( 'color.background' );\r\n\tconst [ gradientValue ] = useGlobalStyle( 'color.gradient' );\r\n\tconst [ styles ] = useGlobalStylesOutput();\r\n\tconst disableMotion = useReducedMotion();\r\n\tconst [ isHovered, setIsHovered ] = useState( false );\r\n\tconst [ containerResizeListener, { width } ] = useResizeObserver();\r\n\tconst [ throttledWidth, setThrottledWidthState ] = useState( width );\r\n\tconst [ ratioState, setRatioState ] = useState();\r\n\r\n\tconst setThrottledWidth = useThrottle(\r\n\t\tsetThrottledWidthState,\r\n\t\t250,\r\n\t\tTHROTTLE_OPTIONS\r\n\t);\r\n\r\n\t// Must use useLayoutEffect to avoid a flash of the iframe at the wrong\r\n\t// size before the width is set.\r\n\tuseLayoutEffect( () => {\r\n\t\tif ( width ) {\r\n\t\t\tsetThrottledWidth( width );\r\n\t\t}\r\n\t}, [ width, setThrottledWidth ] );\r\n\r\n\t// Must use useLayoutEffect to avoid a flash of the iframe at the wrong\r\n\t// size before the width is set.\r\n\tuseLayoutEffect( () => {\r\n\t\tconst newRatio = throttledWidth ? throttledWidth / normalizedWidth : 1;\r\n\t\tconst ratioDiff = newRatio - ( ratioState || 0 );\r\n\r\n\t\t// Only update the ratio state if the difference is big enough\r\n\t\t// or if the ratio state is not yet set. This is to avoid an\r\n\t\t// endless loop of updates at particular viewport heights when the\r\n\t\t// presence of a scrollbar causes the width to change slightly.\r\n\t\tconst isRatioDiffBigEnough = Math.abs( ratioDiff ) > 0.1;\r\n\r\n\t\tif ( isRatioDiffBigEnough || ! ratioState ) {\r\n\t\t\tsetRatioState( newRatio );\r\n\t\t}\r\n\t}, [ throttledWidth, ratioState ] );\r\n\r\n\t// Set a fallbackRatio to use before the throttled ratio has been set.\r\n\tconst fallbackRatio = width ? width / normalizedWidth : 1;\r\n\t/*\r\n\t * Use the throttled ratio if it has been calculated, otherwise\r\n\t * use the fallback ratio. The throttled ratio is used to avoid\r\n\t * an endless loop of updates at particular viewport heights.\r\n\t * See: https://github.com/WordPress/gutenberg/issues/55112\r\n\t */\r\n\tconst ratio = ratioState ? ratioState : fallbackRatio;\r\n\r\n\t/*\r\n\t * Reset leaked styles from WP common.css and remove main content layout padding and border.\r\n\t * Add pointer cursor to the body to indicate the iframe is interactive,\r\n\t * similar to Typography variation previews.\r\n\t */\r\n\tconst editorStyles = useMemo( () => {\r\n\t\tif ( styles ) {\r\n\t\t\treturn [\r\n\t\t\t\t...styles,\r\n\t\t\t\t{\r\n\t\t\t\t\tcss: 'html{overflow:hidden}body{min-width: 0;padding: 0;border: none;cursor: pointer;}',\r\n\t\t\t\t\tisGlobalStyles: true,\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\treturn styles;\r\n\t}, [ styles ] );\r\n\tconst isReady = !! width;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div style={ { position: 'relative' } }>\r\n\t\t\t\t{ containerResizeListener }\r\n\t\t\t</div>\r\n\t\t\t{ isReady && (\r\n\t\t\t\t<Iframe\r\n\t\t\t\t\tclassName=\"edit-site-global-styles-preview__iframe\"\r\n\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\theight: normalizedHeight * ratio,\r\n\t\t\t\t\t} }\r\n\t\t\t\t\tonMouseEnter={ () => setIsHovered( true ) }\r\n\t\t\t\t\tonMouseLeave={ () => setIsHovered( false ) }\r\n\t\t\t\t\ttabIndex={ -1 }\r\n\t\t\t\t>\r\n\t\t\t\t\t<EditorStyles styles={ editorStyles } />\r\n\t\t\t\t\t<motion.div\r\n\t\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\t\theight: normalizedHeight * ratio,\r\n\t\t\t\t\t\t\twidth: '100%',\r\n\t\t\t\t\t\t\tbackground: gradientValue ?? backgroundColor,\r\n\t\t\t\t\t\t\tcursor: withHoverView ? 'pointer' : undefined,\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tinitial=\"start\"\r\n\t\t\t\t\t\tanimate={\r\n\t\t\t\t\t\t\t( isHovered || isFocused ) &&\r\n\t\t\t\t\t\t\t! disableMotion &&\r\n\t\t\t\t\t\t\tlabel\r\n\t\t\t\t\t\t\t\t? 'hover'\r\n\t\t\t\t\t\t\t\t: 'start'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ []\r\n\t\t\t\t\t\t\t.concat( children ) // This makes sure children is always an array.\r\n\t\t\t\t\t\t\t.map( ( child, key ) => child( { ratio, key } ) ) }\r\n\t\t\t\t\t</motion.div>\r\n\t\t\t\t</Iframe>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}