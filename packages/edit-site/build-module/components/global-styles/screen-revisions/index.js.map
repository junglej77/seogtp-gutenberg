{"version":3,"names":["__","sprintf","__experimentalUseNavigator","useNavigator","__experimentalConfirmDialog","ConfirmDialog","Spinner","useSelect","useDispatch","useContext","useState","useEffect","privateApis","blockEditorPrivateApis","store","blockEditorStore","ScreenHeader","unlock","Revisions","editSiteStore","useGlobalStylesRevisions","RevisionsButtons","StyleBook","Pagination","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","GlobalStylesContext","areGlobalStyleConfigsEqual","PAGE_SIZE","ScreenRevisions","goTo","user","currentEditorGlobalStyles","setUserConfig","blocks","editorCanvasContainerView","select","getEditorCanvasContainerView","getBlocks","currentPage","setCurrentPage","currentRevisions","setCurrentRevisions","revisions","isLoading","hasUnsavedChanges","revisionsCount","query","per_page","page","numPages","Math","ceil","currentlySelectedRevision","setCurrentlySelectedRevision","isLoadingRevisionWithUnsavedChanges","setIsLoadingRevisionWithUnsavedChanges","setEditorCanvasContainerView","selectedRevisionMatchesEditorStyles","onCloseRevisions","canvasContainerView","undefined","restoreRevision","revision","startsWith","length","firstRevision","currentlySelectedRevisionId","id","shouldSelectFirstItem","isLoadButtonEnabled","hasRevisions","children","title","description","onBack","className","userConfig","isSelected","onClose","closeButtonLabel","onChange","selectedRevisionId","userRevisions","canApplyRevision","onApplyRevision","changePage","totalItems","disabled","label","isOpen","confirmButtonText","onConfirm","onCancel","size"],"sources":["@wordpress/edit-site/src/components/global-styles/screen-revisions/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport {\r\n\t__experimentalUseNavigator as useNavigator,\r\n\t__experimentalConfirmDialog as ConfirmDialog,\r\n\tSpinner,\r\n} from '@wordpress/components';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useContext, useState, useEffect } from '@wordpress/element';\r\nimport {\r\n\tprivateApis as blockEditorPrivateApis,\r\n\tstore as blockEditorStore,\r\n} from '@wordpress/block-editor';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport ScreenHeader from '../header';\r\nimport { unlock } from '../../../lock-unlock';\r\nimport Revisions from '../../revisions';\r\nimport { store as editSiteStore } from '../../../store';\r\nimport useGlobalStylesRevisions from './use-global-styles-revisions';\r\nimport RevisionsButtons from './revisions-buttons';\r\nimport StyleBook from '../../style-book';\r\nimport Pagination from '../../pagination';\r\n\r\nconst { GlobalStylesContext, areGlobalStyleConfigsEqual } = unlock(\r\n\tblockEditorPrivateApis\r\n);\r\n\r\nconst PAGE_SIZE = 10;\r\n\r\nfunction ScreenRevisions() {\r\n\tconst { goTo } = useNavigator();\r\n\tconst { user: currentEditorGlobalStyles, setUserConfig } =\r\n\t\tuseContext( GlobalStylesContext );\r\n\tconst { blocks, editorCanvasContainerView } = useSelect(\r\n\t\t( select ) => ( {\r\n\t\t\teditorCanvasContainerView: unlock(\r\n\t\t\t\tselect( editSiteStore )\r\n\t\t\t).getEditorCanvasContainerView(),\r\n\t\t\tblocks: select( blockEditorStore ).getBlocks(),\r\n\t\t} ),\r\n\t\t[]\r\n\t);\r\n\tconst [ currentPage, setCurrentPage ] = useState( 1 );\r\n\tconst [ currentRevisions, setCurrentRevisions ] = useState( [] );\r\n\tconst { revisions, isLoading, hasUnsavedChanges, revisionsCount } =\r\n\t\tuseGlobalStylesRevisions( {\r\n\t\t\tquery: {\r\n\t\t\t\tper_page: PAGE_SIZE,\r\n\t\t\t\tpage: currentPage,\r\n\t\t\t},\r\n\t\t} );\r\n\r\n\tconst numPages = Math.ceil( revisionsCount / PAGE_SIZE );\r\n\r\n\tconst [ currentlySelectedRevision, setCurrentlySelectedRevision ] =\r\n\t\tuseState( currentEditorGlobalStyles );\r\n\tconst [\r\n\t\tisLoadingRevisionWithUnsavedChanges,\r\n\t\tsetIsLoadingRevisionWithUnsavedChanges,\r\n\t] = useState( false );\r\n\tconst { setEditorCanvasContainerView } = unlock(\r\n\t\tuseDispatch( editSiteStore )\r\n\t);\r\n\tconst selectedRevisionMatchesEditorStyles = areGlobalStyleConfigsEqual(\r\n\t\tcurrentlySelectedRevision,\r\n\t\tcurrentEditorGlobalStyles\r\n\t);\r\n\r\n\tconst onCloseRevisions = () => {\r\n\t\tgoTo( '/' ); // Return to global styles main panel.\r\n\t\tconst canvasContainerView =\r\n\t\t\teditorCanvasContainerView === 'global-styles-revisions:style-book'\r\n\t\t\t\t? 'style-book'\r\n\t\t\t\t: undefined;\r\n\t\tsetEditorCanvasContainerView( canvasContainerView );\r\n\t};\r\n\r\n\tconst restoreRevision = ( revision ) => {\r\n\t\tsetUserConfig( () => revision );\r\n\t\tsetIsLoadingRevisionWithUnsavedChanges( false );\r\n\t\tonCloseRevisions();\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tif (\r\n\t\t\t! editorCanvasContainerView ||\r\n\t\t\t! editorCanvasContainerView.startsWith( 'global-styles-revisions' )\r\n\t\t) {\r\n\t\t\tgoTo( '/' ); // Return to global styles main panel.\r\n\t\t}\r\n\t}, [ editorCanvasContainerView ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! isLoading && revisions.length ) {\r\n\t\t\tsetCurrentRevisions( revisions );\r\n\t\t}\r\n\t}, [ revisions, isLoading ] );\r\n\r\n\tconst firstRevision = revisions[ 0 ];\r\n\tconst currentlySelectedRevisionId = currentlySelectedRevision?.id;\r\n\tconst shouldSelectFirstItem =\r\n\t\t!! firstRevision?.id &&\r\n\t\t! selectedRevisionMatchesEditorStyles &&\r\n\t\t! currentlySelectedRevisionId;\r\n\r\n\tuseEffect( () => {\r\n\t\t/*\r\n\t\t * Ensure that the first item is selected and loaded into the preview pane\r\n\t\t * when no revision is selected and the selected styles don't match the current editor styles.\r\n\t\t * This is required in case editor styles are changed outside the revisions panel,\r\n\t\t * e.g., via the reset styles function of useGlobalStylesReset().\r\n\t\t * See: https://github.com/WordPress/gutenberg/issues/55866\r\n\t\t */\r\n\t\tif ( shouldSelectFirstItem ) {\r\n\t\t\tsetCurrentlySelectedRevision( firstRevision );\r\n\t\t}\r\n\t}, [ shouldSelectFirstItem, firstRevision ] );\r\n\r\n\t// Only display load button if there is a revision to load,\r\n\t// and it is different from the current editor styles.\r\n\tconst isLoadButtonEnabled =\r\n\t\t!! currentlySelectedRevisionId &&\r\n\t\tcurrentlySelectedRevisionId !== 'unsaved' &&\r\n\t\t! selectedRevisionMatchesEditorStyles;\r\n\tconst hasRevisions = !! currentRevisions.length;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<ScreenHeader\r\n\t\t\t\ttitle={\r\n\t\t\t\t\trevisionsCount &&\r\n\t\t\t\t\t// translators: %s: number of revisions.\r\n\t\t\t\t\tsprintf( __( '所有版本 (%s)' ), revisionsCount )\r\n\t\t\t\t}\r\n\t\t\t\tdescription={ __(\r\n\t\t\t\t\t'点击以前保存的样式预览它们。要将选定的版本恢复到编辑器，请点击“应用”。准备好后，使用Save按钮保存更改。'\r\n\t\t\t\t) }\r\n\t\t\t\tonBack={ onCloseRevisions }\r\n\t\t\t/>\r\n\t\t\t{ ! hasRevisions && (\r\n\t\t\t\t<Spinner className=\"edit-site-global-styles-screen-revisions__loading\" />\r\n\t\t\t) }\r\n\t\t\t{ hasRevisions &&\r\n\t\t\t\t( editorCanvasContainerView ===\r\n\t\t\t\t'global-styles-revisions:style-book' ? (\r\n\t\t\t\t\t<StyleBook\r\n\t\t\t\t\t\tuserConfig={ currentlySelectedRevision }\r\n\t\t\t\t\t\tisSelected={ () => {} }\r\n\t\t\t\t\t\tonClose={ () => {\r\n\t\t\t\t\t\t\tsetEditorCanvasContainerView(\r\n\t\t\t\t\t\t\t\t'global-styles-revisions'\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t/>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<Revisions\r\n\t\t\t\t\t\tblocks={ blocks }\r\n\t\t\t\t\t\tuserConfig={ currentlySelectedRevision }\r\n\t\t\t\t\t\tcloseButtonLabel={ __( 'Close revisions' ) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t) ) }\r\n\t\t\t<RevisionsButtons\r\n\t\t\t\tonChange={ setCurrentlySelectedRevision }\r\n\t\t\t\tselectedRevisionId={ currentlySelectedRevisionId }\r\n\t\t\t\tuserRevisions={ currentRevisions }\r\n\t\t\t\tcanApplyRevision={ isLoadButtonEnabled }\r\n\t\t\t\tonApplyRevision={ () =>\r\n\t\t\t\t\thasUnsavedChanges\r\n\t\t\t\t\t\t? setIsLoadingRevisionWithUnsavedChanges( true )\r\n\t\t\t\t\t\t: restoreRevision( currentlySelectedRevision )\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t\t{ numPages > 1 && (\r\n\t\t\t\t<div className=\"edit-site-global-styles-screen-revisions__footer\">\r\n\t\t\t\t\t<Pagination\r\n\t\t\t\t\t\tclassName=\"edit-site-global-styles-screen-revisions__pagination\"\r\n\t\t\t\t\t\tcurrentPage={ currentPage }\r\n\t\t\t\t\t\tnumPages={ numPages }\r\n\t\t\t\t\t\tchangePage={ setCurrentPage }\r\n\t\t\t\t\t\ttotalItems={ revisionsCount }\r\n\t\t\t\t\t\tdisabled={ isLoading }\r\n\t\t\t\t\t\tlabel={ __( 'Global Styles pagination navigation' ) }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t\t{ isLoadingRevisionWithUnsavedChanges && (\r\n\t\t\t\t<ConfirmDialog\r\n\t\t\t\t\tisOpen={ isLoadingRevisionWithUnsavedChanges }\r\n\t\t\t\t\tconfirmButtonText={ __( '应用' ) }\r\n\t\t\t\t\tonConfirm={ () =>\r\n\t\t\t\t\t\trestoreRevision( currentlySelectedRevision )\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonCancel={ () =>\r\n\t\t\t\t\t\tsetIsLoadingRevisionWithUnsavedChanges( false )\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsize=\"medium\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t'你确定要应用这个修改吗?任何未保存的更改都将丢失。'\r\n\t\t\t\t\t) }\r\n\t\t\t\t</ConfirmDialog>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default ScreenRevisions;\r\n"],"mappings":"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","ignoreList":[]}