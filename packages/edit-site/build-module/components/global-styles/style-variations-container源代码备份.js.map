{"version":3,"names":["store","coreStore","useSelect","useContext","useEffect","useMemo","useState","__experimentalGrid","Grid","__","privateApis","blockEditorPrivateApis","PreviewStyles","Variation","isVariationWithProperties","unlock","jsx","_jsx","GlobalStylesContext","StyleVariationsContainer","gap","user","currentUserStyles","setCurrentUserStyles","userStyles","styles","variations","select","__experimentalGetCurrentThemeGlobalStylesVariations","fullStyleVariations","filter","variation","themeVariations","withEmptyVariation","title","settings","map","_variation$settings","blockStyles","blocks","Object","keys","forEach","blockName","css","variationBlockStyles","customCSS","trim","length","columns","className","children","index","isFocused","label","withHoverView"],"sources":["@wordpress/edit-site/src/components/global-styles/style-variations-container源代码备份.js"],"sourcesContent":["// 导入WordPress核心数据存储\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n// 导入数据选择器\r\nimport { useSelect } from '@wordpress/data';\r\n// 导入React相关钩子\r\nimport { useContext, useEffect, useMemo, useState } from '@wordpress/element';\r\n// 导入Grid组件\r\nimport { __experimentalGrid as Grid } from '@wordpress/components';\r\n// 导入国际化函数\r\nimport { __ } from '@wordpress/i18n';\r\n// 导入区块编辑器的私有API\r\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/block-editor';\r\n\r\n// 导入内部依赖组件和工具函数\r\nimport PreviewStyles from './preview-styles';\r\nimport Variation from './variations/variation';\r\nimport { isVariationWithProperties } from '../../hooks/use-theme-style-variations/use-theme-style-variations-by-property';\r\nimport { unlock } from '../../lock-unlock';\r\n\r\n// 解锁并获取GlobalStylesContext\r\nconst { GlobalStylesContext } = unlock( blockEditorPrivateApis );\r\n\r\n// 定义StyleVariationsContainer组件\r\nexport default function StyleVariationsContainer( { gap = 2 } ) {\r\n\t// 从GlobalStylesContext中获取当前用户信息\r\n\tconst { user } = useContext( GlobalStylesContext );\r\n\t// 使用state保存当前用户的样式\r\n\tconst [ currentUserStyles, setCurrentUserStyles ] = useState( user );\r\n\tconst userStyles = currentUserStyles?.styles;\r\n\r\n\t// 当用户信息变化时，更新当前用户的样式\r\n\tuseEffect( () => {\r\n\t\tsetCurrentUserStyles( user );\r\n\t}, [ user ] );\r\n\r\n\t// 从coreStore中获取当前主题的全局样式变体\r\n\tconst variations = useSelect( ( select ) => {\r\n\t\treturn select(\r\n\t\t\tcoreStore\r\n\t\t).__experimentalGetCurrentThemeGlobalStylesVariations();\r\n\t}, [] );\r\n\r\n\t// 过滤掉颜色和排版相关的变体\r\n\tconst fullStyleVariations = variations?.filter( ( variation ) => {\r\n\t\treturn (\r\n\t\t\t! isVariationWithProperties( variation, [ 'color' ] ) &&\r\n\t\t\t! isVariationWithProperties( variation, [\r\n\t\t\t\t'typography',\r\n\t\t\t\t'spacing',\r\n\t\t\t] )\r\n\t\t);\r\n\t} );\r\n\r\n\t// 使用useMemo缓存主题变体数据\r\n\tconst themeVariations = useMemo( () => {\r\n\t\t// 添加默认变体\r\n\t\tconst withEmptyVariation = [\r\n\t\t\t{\r\n\t\t\t\ttitle: __( 'Default' ),\r\n\t\t\t\tsettings: {},\r\n\t\t\t\tstyles: {},\r\n\t\t\t},\r\n\t\t\t...( fullStyleVariations ?? [] ),\r\n\t\t];\r\n\t\treturn [\r\n\t\t\t...withEmptyVariation.map( ( variation ) => {\r\n\t\t\t\tconst blockStyles = { ...variation?.styles?.blocks } || {};\r\n\r\n\t\t\t\t// 将用户自定义的CSS合并到变体中，以防止切换变体时丢失\r\n\t\t\t\tif ( userStyles?.blocks ) {\r\n\t\t\t\t\tObject.keys( userStyles.blocks ).forEach( ( blockName ) => {\r\n\t\t\t\t\t\tif ( userStyles.blocks[ blockName ].css ) {\r\n\t\t\t\t\t\t\tconst variationBlockStyles =\r\n\t\t\t\t\t\t\t\tblockStyles[ blockName ] || {};\r\n\t\t\t\t\t\t\tconst customCSS = {\r\n\t\t\t\t\t\t\t\tcss: `${\r\n\t\t\t\t\t\t\t\t\tblockStyles[ blockName ]?.css || ''\r\n\t\t\t\t\t\t\t\t} ${\r\n\t\t\t\t\t\t\t\t\tuserStyles.blocks[ blockName ].css.trim() ||\r\n\t\t\t\t\t\t\t\t\t''\r\n\t\t\t\t\t\t\t\t}`,\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tblockStyles[ blockName ] = {\r\n\t\t\t\t\t\t\t\t...variationBlockStyles,\r\n\t\t\t\t\t\t\t\t...customCSS,\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 合并全局自定义CSS\r\n\t\t\t\tconst css =\r\n\t\t\t\t\tuserStyles?.css || variation.styles?.css\r\n\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\tcss: `${ variation.styles?.css || '' } ${\r\n\t\t\t\t\t\t\t\t\tuserStyles?.css || ''\r\n\t\t\t\t\t\t\t\t}`,\r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t: {};\r\n\r\n\t\t\t\tconst blocks =\r\n\t\t\t\t\tObject.keys( blockStyles ).length > 0\r\n\t\t\t\t\t\t? { blocks: blockStyles }\r\n\t\t\t\t\t\t: {};\r\n\r\n\t\t\t\tconst styles = {\r\n\t\t\t\t\t...variation.styles,\r\n\t\t\t\t\t...css,\r\n\t\t\t\t\t...blocks,\r\n\t\t\t\t};\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...variation,\r\n\t\t\t\t\tsettings: variation.settings ?? {},\r\n\t\t\t\t\tstyles,\r\n\t\t\t\t};\r\n\t\t\t} ),\r\n\t\t];\r\n\t}, [ fullStyleVariations, userStyles?.blocks, userStyles?.css ] );\r\n\r\n\t// 如果没有变体数据，返回null\r\n\tif ( ! fullStyleVariations || fullStyleVariations?.length < 1 ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// 渲染Grid组件，展示主题变体\r\n\treturn (\r\n\t\t<Grid\r\n\t\t\tcolumns={ 2 }\r\n\t\t\tclassName=\"edit-site-global-styles-style-variations-container\"\r\n\t\t\tgap={ gap }\r\n\t\t>\r\n\t\t\t{ themeVariations.map( ( variation, index ) => (\r\n\t\t\t\t<Variation key={ index } variation={ variation }>\r\n\t\t\t\t\t{ ( isFocused ) => (\r\n\t\t\t\t\t\t<PreviewStyles\r\n\t\t\t\t\t\t\tlabel={ variation?.title }\r\n\t\t\t\t\t\t\twithHoverView\r\n\t\t\t\t\t\t\tisFocused={ isFocused }\r\n\t\t\t\t\t\t\tvariation={ variation }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</Variation>\r\n\t\t\t) ) }\r\n\t\t</Grid>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}