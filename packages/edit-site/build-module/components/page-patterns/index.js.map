{"version":3,"names":["__","useState","useMemo","useId","useEffect","privateApis","blockEditorPrivateApis","DataViews","filterSortAndPaginate","usePrevious","useEntityRecords","editorPrivateApis","routerPrivateApis","Page","LAYOUT_GRID","LAYOUT_TABLE","PATTERN_TYPES","TEMPLATE_PART_POST_TYPE","PATTERN_DEFAULT_CATEGORY","usePatternSettings","unlock","usePatterns","useAugmentPatternsWithPermissions","PatternsHeader","useEditPostAction","patternStatusField","previewField","titleField","templatePartAuthorField","jsx","_jsx","jsxs","_jsxs","ExperimentalBlockEditorProvider","usePostActions","useLocation","EMPTY_ARRAY","defaultLayouts","layout","primaryField","styles","preview","width","author","mediaField","badgeFields","DEFAULT_VIEW","type","search","page","perPage","fields","filters","DataviewsPatterns","params","postType","categoryId","categoryIdFromURL","user","view","setView","previousCategoryId","viewSyncStatus","find","field","value","patterns","isResolving","syncStatus","records","per_page","authors","authorsSet","Set","forEach","template","add","author_text","Array","from","map","label","_fields","push","elements","prevView","data","paginationInfo","viewWithoutFilters","dataWithPermissions","templatePartActions","context","patternActions","editAction","actions","filter","Boolean","id","settings","children","title","className","hideTitleFromUI","titleId","descriptionId","getItemId","item","_item$name","name","isLoading","onChangeView"],"sources":["@wordpress/edit-site/src/components/page-patterns/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useState, useMemo, useId, useEffect } from '@wordpress/element';\r\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/block-editor';\r\nimport { DataViews, filterSortAndPaginate } from '@wordpress/dataviews';\r\nimport { usePrevious } from '@wordpress/compose';\r\nimport { useEntityRecords } from '@wordpress/core-data';\r\nimport { privateApis as editorPrivateApis } from '@wordpress/editor';\r\nimport { privateApis as routerPrivateApis } from '@wordpress/router';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport Page from '../page';\r\nimport {\r\n\tLAYOUT_GRID,\r\n\tLAYOUT_TABLE,\r\n\tPATTERN_TYPES,\r\n\tTEMPLATE_PART_POST_TYPE,\r\n\tPATTERN_DEFAULT_CATEGORY,\r\n} from '../../utils/constants';\r\nimport usePatternSettings from './use-pattern-settings';\r\nimport { unlock } from '../../lock-unlock';\r\nimport usePatterns, { useAugmentPatternsWithPermissions } from './use-patterns';\r\nimport PatternsHeader from './header';\r\nimport { useEditPostAction } from '../dataviews-actions';\r\nimport {\r\n\tpatternStatusField,\r\n\tpreviewField,\r\n\ttitleField,\r\n\ttemplatePartAuthorField,\r\n} from './fields';\r\n\r\nconst { ExperimentalBlockEditorProvider } = unlock( blockEditorPrivateApis );\r\nconst { usePostActions } = unlock( editorPrivateApis );\r\nconst { useLocation } = unlock( routerPrivateApis );\r\n\r\nconst EMPTY_ARRAY = [];\r\nconst defaultLayouts = {\r\n\t[ LAYOUT_TABLE ]: {\r\n\t\tlayout: {\r\n\t\t\tprimaryField: 'title',\r\n\t\t\tstyles: {\r\n\t\t\t\tpreview: {\r\n\t\t\t\t\twidth: '1%',\r\n\t\t\t\t},\r\n\t\t\t\tauthor: {\r\n\t\t\t\t\twidth: '1%',\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\t[ LAYOUT_GRID ]: {\r\n\t\tlayout: {\r\n\t\t\tmediaField: 'preview',\r\n\t\t\tprimaryField: 'title',\r\n\t\t\tbadgeFields: [ 'sync-status' ],\r\n\t\t},\r\n\t},\r\n};\r\nconst DEFAULT_VIEW = {\r\n\ttype: LAYOUT_GRID,\r\n\tsearch: '',\r\n\tpage: 1,\r\n\tperPage: 20,\r\n\tlayout: defaultLayouts[ LAYOUT_GRID ].layout,\r\n\tfields: [ 'title', 'sync-status' ],\r\n\tfilters: [],\r\n};\r\n\r\nexport default function DataviewsPatterns() {\r\n\tconst {\r\n\t\tparams: { postType, categoryId: categoryIdFromURL },\r\n\t} = useLocation();\r\n\tconst type = postType || PATTERN_TYPES.user;\r\n\tconst categoryId = categoryIdFromURL || PATTERN_DEFAULT_CATEGORY;\r\n\tconst [ view, setView ] = useState( DEFAULT_VIEW );\r\n\tconst previousCategoryId = usePrevious( categoryId );\r\n\tconst viewSyncStatus = view.filters?.find(\r\n\t\t( { field } ) => field === 'sync-status'\r\n\t)?.value;\r\n\tconst { patterns, isResolving } = usePatterns( type, categoryId, {\r\n\t\tsearch: view.search,\r\n\t\tsyncStatus: viewSyncStatus,\r\n\t} );\r\n\r\n\tconst { records } = useEntityRecords( 'postType', TEMPLATE_PART_POST_TYPE, {\r\n\t\tper_page: -1,\r\n\t} );\r\n\r\n\tconst authors = useMemo( () => {\r\n\t\tif ( ! records ) {\r\n\t\t\treturn EMPTY_ARRAY;\r\n\t\t}\r\n\t\tconst authorsSet = new Set();\r\n\t\trecords.forEach( ( template ) => {\r\n\t\t\tauthorsSet.add( template.author_text );\r\n\t\t} );\r\n\t\treturn Array.from( authorsSet ).map( ( author ) => ( {\r\n\t\t\tvalue: author,\r\n\t\t\tlabel: author,\r\n\t\t} ) );\r\n\t}, [ records ] );\r\n\r\n\tconst fields = useMemo( () => {\r\n\t\tconst _fields = [ previewField, titleField ];\r\n\r\n\t\tif ( type === PATTERN_TYPES.user ) {\r\n\t\t\t_fields.push( patternStatusField );\r\n\t\t} else if ( type === TEMPLATE_PART_POST_TYPE ) {\r\n\t\t\t_fields.push( {\r\n\t\t\t\t...templatePartAuthorField,\r\n\t\t\t\telements: authors,\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\treturn _fields;\r\n\t}, [ type, authors ] );\r\n\r\n\t// Reset the page number when the category changes.\r\n\tuseEffect( () => {\r\n\t\tif ( previousCategoryId !== categoryId ) {\r\n\t\t\tsetView( ( prevView ) => ( { ...prevView, page: 1 } ) );\r\n\t\t}\r\n\t}, [ categoryId, previousCategoryId ] );\r\n\tconst { data, paginationInfo } = useMemo( () => {\r\n\t\t// Search is managed server-side as well as filters for patterns.\r\n\t\t// However, the author filter in template parts is done client-side.\r\n\t\tconst viewWithoutFilters = { ...view };\r\n\t\tdelete viewWithoutFilters.search;\r\n\t\tif ( type !== TEMPLATE_PART_POST_TYPE ) {\r\n\t\t\tviewWithoutFilters.filters = [];\r\n\t\t}\r\n\t\treturn filterSortAndPaginate( patterns, viewWithoutFilters, fields );\r\n\t}, [ patterns, view, fields, type ] );\r\n\r\n\tconst dataWithPermissions = useAugmentPatternsWithPermissions( data );\r\n\r\n\tconst templatePartActions = usePostActions( {\r\n\t\tpostType: TEMPLATE_PART_POST_TYPE,\r\n\t\tcontext: 'list',\r\n\t} );\r\n\tconst patternActions = usePostActions( {\r\n\t\tpostType: PATTERN_TYPES.user,\r\n\t\tcontext: 'list',\r\n\t} );\r\n\tconst editAction = useEditPostAction();\r\n\r\n\tconst actions = useMemo( () => {\r\n\t\tif ( type === TEMPLATE_PART_POST_TYPE ) {\r\n\t\t\treturn [ editAction, ...templatePartActions ].filter( Boolean );\r\n\t\t}\r\n\t\treturn [ editAction, ...patternActions ].filter( Boolean );\r\n\t}, [ editAction, type, templatePartActions, patternActions ] );\r\n\tconst id = useId();\r\n\tconst settings = usePatternSettings();\r\n\t// Wrap everything in a block editor provider.\r\n\t// This ensures 'styles' that are needed for the previews are synced\r\n\t// from the site editor store to the block editor store.\r\n\treturn (\r\n\t\t<ExperimentalBlockEditorProvider settings={ settings }>\r\n\t\t\t<Page\r\n\t\t\t\ttitle={ __( 'Patterns content' ) }\r\n\t\t\t\tclassName=\"edit-site-page-patterns-dataviews\"\r\n\t\t\t\thideTitleFromUI\r\n\t\t\t>\r\n\t\t\t\t<PatternsHeader\r\n\t\t\t\t\tcategoryId={ categoryId }\r\n\t\t\t\t\ttype={ type }\r\n\t\t\t\t\ttitleId={ `${ id }-title` }\r\n\t\t\t\t\tdescriptionId={ `${ id }-description` }\r\n\t\t\t\t/>\r\n\t\t\t\t<DataViews\r\n\t\t\t\t\tkey={ categoryId + postType }\r\n\t\t\t\t\tpaginationInfo={ paginationInfo }\r\n\t\t\t\t\tfields={ fields }\r\n\t\t\t\t\tactions={ actions }\r\n\t\t\t\t\tdata={ dataWithPermissions || EMPTY_ARRAY }\r\n\t\t\t\t\tgetItemId={ ( item ) => item.name ?? item.id }\r\n\t\t\t\t\tisLoading={ isResolving }\r\n\t\t\t\t\tview={ view }\r\n\t\t\t\t\tonChangeView={ setView }\r\n\t\t\t\t\tdefaultLayouts={ defaultLayouts }\r\n\t\t\t\t/>\r\n\t\t\t</Page>\r\n\t\t</ExperimentalBlockEditorProvider>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}