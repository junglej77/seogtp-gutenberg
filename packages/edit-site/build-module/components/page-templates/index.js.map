{"version":3,"names":["__","useState","useMemo","useCallback","useEffect","privateApis","corePrivateApis","DataViews","filterSortAndPaginate","routerPrivateApis","editorPrivateApis","Page","AddNewTemplate","TEMPLATE_POST_TYPE","OPERATOR_IS_ANY","LAYOUT_GRID","LAYOUT_TABLE","LAYOUT_LIST","unlock","useEditPostAction","authorField","descriptionField","previewField","titleField","jsx","_jsx","usePostActions","useHistory","useLocation","useEntityRecordsWithPermissions","EMPTY_ARRAY","defaultLayouts","fields","layout","primaryField","combinedFields","id","label","children","direction","styles","template","maxWidth","minWidth","preview","width","author","mediaField","columnFields","DEFAULT_VIEW","type","search","page","perPage","sort","field","filters","PageTemplates","params","activeView","postId","selection","setSelection","defaultView","usedType","operator","value","view","setView","currentView","records","isResolving","isLoadingData","per_page","history","onChangeSelection","items","push","length","undefined","authors","authorsSet","Set","forEach","add","author_text","Array","from","map","elements","data","paginationInfo","postTypeActions","postType","context","editAction","actions","onChangeView","newView","className","title","isLoading"],"sources":["@wordpress/edit-site/src/components/page-templates/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useState, useMemo, useCallback, useEffect } from '@wordpress/element';\r\nimport { privateApis as corePrivateApis } from '@wordpress/core-data';\r\nimport { DataViews, filterSortAndPaginate } from '@wordpress/dataviews';\r\nimport { privateApis as routerPrivateApis } from '@wordpress/router';\r\nimport { privateApis as editorPrivateApis } from '@wordpress/editor';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport Page from '../page';\r\nimport AddNewTemplate from '../add-new-template';\r\nimport {\r\n\tTEMPLATE_POST_TYPE,\r\n\tOPERATOR_IS_ANY,\r\n\tLAYOUT_GRID,\r\n\tLAYOUT_TABLE,\r\n\tLAYOUT_LIST,\r\n} from '../../utils/constants';\r\nimport { unlock } from '../../lock-unlock';\r\nimport { useEditPostAction } from '../dataviews-actions';\r\nimport {\r\n\tauthorField,\r\n\tdescriptionField,\r\n\tpreviewField,\r\n\ttitleField,\r\n} from './fields';\r\n\r\nconst { usePostActions } = unlock( editorPrivateApis );\r\nconst { useHistory, useLocation } = unlock( routerPrivateApis );\r\nconst { useEntityRecordsWithPermissions } = unlock( corePrivateApis );\r\n\r\nconst EMPTY_ARRAY = [];\r\n\r\nconst defaultLayouts = {\r\n\t[ LAYOUT_TABLE ]: {\r\n\t\tfields: [ 'template', 'author' ],\r\n\t\tlayout: {\r\n\t\t\tprimaryField: 'title',\r\n\t\t\tcombinedFields: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: 'template',\r\n\t\t\t\t\tlabel: __( 'Template' ),\r\n\t\t\t\t\tchildren: [ 'title', 'description' ],\r\n\t\t\t\t\tdirection: 'vertical',\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\tstyles: {\r\n\t\t\t\ttemplate: {\r\n\t\t\t\t\tmaxWidth: 400,\r\n\t\t\t\t\tminWidth: 320,\r\n\t\t\t\t},\r\n\t\t\t\tpreview: {\r\n\t\t\t\t\twidth: '1%',\r\n\t\t\t\t},\r\n\t\t\t\tauthor: {\r\n\t\t\t\t\twidth: '1%',\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\t[ LAYOUT_GRID ]: {\r\n\t\tfields: [ 'title', 'description', 'author' ],\r\n\t\tlayout: {\r\n\t\t\tmediaField: 'preview',\r\n\t\t\tprimaryField: 'title',\r\n\t\t\tcolumnFields: [ 'description' ],\r\n\t\t},\r\n\t},\r\n\t[ LAYOUT_LIST ]: {\r\n\t\tfields: [ 'title', 'description', 'author' ],\r\n\t\tlayout: {\r\n\t\t\tprimaryField: 'title',\r\n\t\t\tmediaField: 'preview',\r\n\t\t},\r\n\t},\r\n};\r\n\r\nconst DEFAULT_VIEW = {\r\n\ttype: LAYOUT_GRID,\r\n\tsearch: '',\r\n\tpage: 1,\r\n\tperPage: 20,\r\n\tsort: {\r\n\t\tfield: 'title',\r\n\t\tdirection: 'asc',\r\n\t},\r\n\tfields: defaultLayouts[ LAYOUT_GRID ].fields,\r\n\tlayout: defaultLayouts[ LAYOUT_GRID ].layout,\r\n\tfilters: [],\r\n};\r\n\r\nexport default function PageTemplates() {\r\n\tconst { params } = useLocation();\r\n\tconst { activeView = 'all', layout, postId } = params;\r\n\tconst [ selection, setSelection ] = useState( [ postId ] );\r\n\r\n\tconst defaultView = useMemo( () => {\r\n\t\tconst usedType = layout ?? DEFAULT_VIEW.type;\r\n\t\treturn {\r\n\t\t\t...DEFAULT_VIEW,\r\n\t\t\ttype: usedType,\r\n\t\t\tlayout: defaultLayouts[ usedType ].layout,\r\n\t\t\tfields: defaultLayouts[ usedType ].fields,\r\n\t\t\tfilters:\r\n\t\t\t\tactiveView !== 'all'\r\n\t\t\t\t\t? [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfield: 'author',\r\n\t\t\t\t\t\t\t\toperator: 'isAny',\r\n\t\t\t\t\t\t\t\tvalue: [ activeView ],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t  ]\r\n\t\t\t\t\t: [],\r\n\t\t};\r\n\t}, [ layout, activeView ] );\r\n\tconst [ view, setView ] = useState( defaultView );\r\n\tuseEffect( () => {\r\n\t\tsetView( ( currentView ) => ( {\r\n\t\t\t...currentView,\r\n\t\t\tfilters:\r\n\t\t\t\tactiveView !== 'all'\r\n\t\t\t\t\t? [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfield: 'author',\r\n\t\t\t\t\t\t\t\toperator: OPERATOR_IS_ANY,\r\n\t\t\t\t\t\t\t\tvalue: [ activeView ],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t  ]\r\n\t\t\t\t\t: [],\r\n\t\t} ) );\r\n\t}, [ activeView ] );\r\n\r\n\tconst { records, isResolving: isLoadingData } =\r\n\t\tuseEntityRecordsWithPermissions( 'postType', TEMPLATE_POST_TYPE, {\r\n\t\t\tper_page: -1,\r\n\t\t} );\r\n\tconst history = useHistory();\r\n\tconst onChangeSelection = useCallback(\r\n\t\t( items ) => {\r\n\t\t\tsetSelection( items );\r\n\t\t\tif ( view?.type === LAYOUT_LIST ) {\r\n\t\t\t\thistory.push( {\r\n\t\t\t\t\t...params,\r\n\t\t\t\t\tpostId: items.length === 1 ? items[ 0 ] : undefined,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t},\r\n\t\t[ history, params, view?.type ]\r\n\t);\r\n\r\n\tconst authors = useMemo( () => {\r\n\t\tif ( ! records ) {\r\n\t\t\treturn EMPTY_ARRAY;\r\n\t\t}\r\n\t\tconst authorsSet = new Set();\r\n\t\trecords.forEach( ( template ) => {\r\n\t\t\tauthorsSet.add( template.author_text );\r\n\t\t} );\r\n\t\treturn Array.from( authorsSet ).map( ( author ) => ( {\r\n\t\t\tvalue: author,\r\n\t\t\tlabel: author,\r\n\t\t} ) );\r\n\t}, [ records ] );\r\n\r\n\tconst fields = useMemo(\r\n\t\t() => [\r\n\t\t\tpreviewField,\r\n\t\t\ttitleField,\r\n\t\t\tdescriptionField,\r\n\t\t\t{\r\n\t\t\t\t...authorField,\r\n\t\t\t\telements: authors,\r\n\t\t\t},\r\n\t\t],\r\n\t\t[ authors ]\r\n\t);\r\n\r\n\tconst { data, paginationInfo } = useMemo( () => {\r\n\t\treturn filterSortAndPaginate( records, view, fields );\r\n\t}, [ records, view, fields ] );\r\n\r\n\tconst postTypeActions = usePostActions( {\r\n\t\tpostType: TEMPLATE_POST_TYPE,\r\n\t\tcontext: 'list',\r\n\t} );\r\n\tconst editAction = useEditPostAction();\r\n\tconst actions = useMemo(\r\n\t\t() => [ editAction, ...postTypeActions ],\r\n\t\t[ postTypeActions, editAction ]\r\n\t);\r\n\r\n\tconst onChangeView = useCallback(\r\n\t\t( newView ) => {\r\n\t\t\tif ( newView.type !== view.type ) {\r\n\t\t\t\thistory.push( {\r\n\t\t\t\t\t...params,\r\n\t\t\t\t\tlayout: newView.type,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\tsetView( newView );\r\n\t\t},\r\n\t\t[ view.type, setView, history, params ]\r\n\t);\r\n\r\n\treturn (\r\n\t\t<Page\r\n\t\t\tclassName=\"edit-site-page-templates\"\r\n\t\t\ttitle={ __( 'Templates' ) }\r\n\t\t\tactions={ <AddNewTemplate /> }\r\n\t\t>\r\n\t\t\t<DataViews\r\n\t\t\t\tkey={ activeView }\r\n\t\t\t\tpaginationInfo={ paginationInfo }\r\n\t\t\t\tfields={ fields }\r\n\t\t\t\tactions={ actions }\r\n\t\t\t\tdata={ data }\r\n\t\t\t\tisLoading={ isLoadingData }\r\n\t\t\t\tview={ view }\r\n\t\t\t\tonChangeView={ onChangeView }\r\n\t\t\t\tonChangeSelection={ onChangeSelection }\r\n\t\t\t\tselection={ selection }\r\n\t\t\t\tdefaultLayouts={ defaultLayouts }\r\n\t\t\t/>\r\n\t\t</Page>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}