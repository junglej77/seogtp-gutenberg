{"version":3,"names":["clsx","Button","Modal","EntitiesSavedStates","useEntitiesSavedStatesIsDirty","privateApis","useDispatch","useSelect","__","sprintf","store","coreStore","editSiteStore","unlock","useActivateTheme","useActualCurrentTheme","isPreviewingTheme","jsx","_jsx","jsxs","_jsxs","EntitiesSavedStatesExtensible","NavigableRegion","EntitiesSavedStatesForPreview","onClose","_currentTheme$name$re","_previewingTheme$name","isDirtyProps","activateSaveLabel","isDirty","currentTheme","previewingTheme","select","getCurrentTheme","additionalPrompt","children","name","rendered","activateTheme","onSave","values","close","saveEnabled","saveLabel","_EntitiesSavedStates","renderDialog","undefined","SavePanel","isSaveViewOpen","canvasMode","isSaving","__experimentalGetDirtyEntityRecords","isSavingEntityRecord","isResolving","dirtyEntityRecords","isActivatingTheme","isSaveViewOpened","getCanvasMode","length","some","record","kind","key","setIsSaveViewOpened","className","onRequestClose","__experimentalHideHeader","contentLabel","activateSaveEnabled","disabled","ariaLabel","__next40pxDefaultSize","variant","onClick","accessibleWhenDisabled"],"sources":["@wordpress/edit-site/src/components/save-panel/index.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { Button, Modal } from '@wordpress/components';\r\nimport {\r\n\tEntitiesSavedStates,\r\n\tuseEntitiesSavedStatesIsDirty,\r\n\tprivateApis,\r\n} from '@wordpress/editor';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editSiteStore } from '../../store';\r\nimport { unlock } from '../../lock-unlock';\r\nimport { useActivateTheme } from '../../utils/use-activate-theme';\r\nimport { useActualCurrentTheme } from '../../utils/use-actual-current-theme';\r\nimport { isPreviewingTheme } from '../../utils/is-previewing-theme';\r\n\r\nconst { EntitiesSavedStatesExtensible, NavigableRegion } =\r\n\tunlock( privateApis );\r\n\r\nconst EntitiesSavedStatesForPreview = ( { onClose } ) => {\r\n\tconst isDirtyProps = useEntitiesSavedStatesIsDirty();\r\n\tlet activateSaveLabel;\r\n\tif ( isDirtyProps.isDirty ) {\r\n\t\tactivateSaveLabel = __( 'Activate & Save' );\r\n\t} else {\r\n\t\tactivateSaveLabel = __( 'Activate' );\r\n\t}\r\n\r\n\tconst currentTheme = useActualCurrentTheme();\r\n\r\n\tconst previewingTheme = useSelect(\r\n\t\t( select ) => select( coreStore ).getCurrentTheme(),\r\n\t\t[]\r\n\t);\r\n\r\n\tconst additionalPrompt = (\r\n\t\t<p>\r\n\t\t\t{ sprintf(\r\n\t\t\t\t/* translators: %1$s: The name of active theme, %2$s: The name of theme to be activated. */\r\n\t\t\t\t__(\r\n\t\t\t\t\t'Saving your changes will change your active theme from %1$s to %2$s.'\r\n\t\t\t\t),\r\n\t\t\t\tcurrentTheme?.name?.rendered ?? '...',\r\n\t\t\t\tpreviewingTheme?.name?.rendered ?? '...'\r\n\t\t\t) }\r\n\t\t</p>\r\n\t);\r\n\r\n\tconst activateTheme = useActivateTheme();\r\n\tconst onSave = async ( values ) => {\r\n\t\tawait activateTheme();\r\n\t\treturn values;\r\n\t};\r\n\r\n\treturn (\r\n\t\t<EntitiesSavedStatesExtensible\r\n\t\t\t{ ...{\r\n\t\t\t\t...isDirtyProps,\r\n\t\t\t\tadditionalPrompt,\r\n\t\t\t\tclose: onClose,\r\n\t\t\t\tonSave,\r\n\t\t\t\tsaveEnabled: true,\r\n\t\t\t\tsaveLabel: activateSaveLabel,\r\n\t\t\t} }\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nconst _EntitiesSavedStates = ( { onClose, renderDialog = undefined } ) => {\r\n\tif ( isPreviewingTheme() ) {\r\n\t\treturn <EntitiesSavedStatesForPreview onClose={ onClose } />;\r\n\t}\r\n\treturn (\r\n\t\t<EntitiesSavedStates close={ onClose } renderDialog={ renderDialog } />\r\n\t);\r\n};\r\n\r\nexport default function SavePanel() {\r\n\tconst { isSaveViewOpen, canvasMode, isDirty, isSaving } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst {\r\n\t\t\t\t__experimentalGetDirtyEntityRecords,\r\n\t\t\t\tisSavingEntityRecord,\r\n\t\t\t\tisResolving,\r\n\t\t\t} = select( coreStore );\r\n\t\t\tconst dirtyEntityRecords = __experimentalGetDirtyEntityRecords();\r\n\t\t\tconst isActivatingTheme = isResolving( 'activateTheme' );\r\n\t\t\tconst { isSaveViewOpened, getCanvasMode } = unlock(\r\n\t\t\t\tselect( editSiteStore )\r\n\t\t\t);\r\n\r\n\t\t\t// The currently selected entity to display.\r\n\t\t\t// Typically template or template part in the site editor.\r\n\t\t\treturn {\r\n\t\t\t\tisSaveViewOpen: isSaveViewOpened(),\r\n\t\t\t\tcanvasMode: getCanvasMode(),\r\n\t\t\t\tisDirty: dirtyEntityRecords.length > 0,\r\n\t\t\t\tisSaving:\r\n\t\t\t\t\tdirtyEntityRecords.some( ( record ) =>\r\n\t\t\t\t\t\tisSavingEntityRecord(\r\n\t\t\t\t\t\t\trecord.kind,\r\n\t\t\t\t\t\t\trecord.name,\r\n\t\t\t\t\t\t\trecord.key\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) || isActivatingTheme,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\tconst { setIsSaveViewOpened } = useDispatch( editSiteStore );\r\n\tconst onClose = () => setIsSaveViewOpened( false );\r\n\r\n\tif ( canvasMode === 'view' ) {\r\n\t\treturn isSaveViewOpen ? (\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"edit-site-save-panel__modal\"\r\n\t\t\t\tonRequestClose={ onClose }\r\n\t\t\t\t__experimentalHideHeader\r\n\t\t\t\tcontentLabel={ __(\r\n\t\t\t\t\t'Save site, content, and template changes'\r\n\t\t\t\t) }\r\n\t\t\t>\r\n\t\t\t\t<_EntitiesSavedStates onClose={ onClose } />\r\n\t\t\t</Modal>\r\n\t\t) : null;\r\n\t}\r\n\tconst activateSaveEnabled = isPreviewingTheme() || isDirty;\r\n\tconst disabled = isSaving || ! activateSaveEnabled;\r\n\treturn (\r\n\t\t<NavigableRegion\r\n\t\t\tclassName={ clsx( 'edit-site-layout__actions', {\r\n\t\t\t\t'is-entity-save-view-open': isSaveViewOpen,\r\n\t\t\t} ) }\r\n\t\t\tariaLabel={ __( 'Save panel' ) }\r\n\t\t>\r\n\t\t\t<div\r\n\t\t\t\tclassName={ clsx( 'edit-site-editor__toggle-save-panel', {\r\n\t\t\t\t\t'screen-reader-text': isSaveViewOpen,\r\n\t\t\t\t} ) }\r\n\t\t\t>\r\n\t\t\t\t<Button\r\n\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\tvariant=\"secondary\"\r\n\t\t\t\t\tclassName=\"edit-site-editor__toggle-save-panel-button\"\r\n\t\t\t\t\tonClick={ () => setIsSaveViewOpened( true ) }\r\n\t\t\t\t\taria-haspopup=\"dialog\"\r\n\t\t\t\t\tdisabled={ disabled }\r\n\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t>\r\n\t\t\t\t\t{ __( 'Open save panel' ) }\r\n\t\t\t\t</Button>\r\n\t\t\t</div>\r\n\t\t\t{ isSaveViewOpen && (\r\n\t\t\t\t<_EntitiesSavedStates onClose={ onClose } renderDialog />\r\n\t\t\t) }\r\n\t\t</NavigableRegion>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}