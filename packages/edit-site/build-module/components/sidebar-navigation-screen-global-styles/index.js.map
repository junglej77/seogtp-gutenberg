{"version":3,"names":["__","edit","seen","useSelect","useDispatch","store","coreStore","useViewportMatch","useCallback","editorStore","preferencesStore","SidebarNavigationScreen","unlock","editSiteStore","SidebarButton","SidebarNavigationItem","StyleBook","useGlobalStylesRevisions","SidebarNavigationScreenDetailsFooter","SidebarNavigationScreenGlobalStylesContent","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","SidebarNavigationItemGlobalStyles","props","openGeneralSidebar","setCanvasMode","hasGlobalStyleVariations","select","__experimentalGetCurrentThemeGlobalStylesVariations","length","params","path","uid","onClick","SidebarNavigationScreenGlobalStyles","backPath","revisions","isLoading","isLoadingRevisions","setIsListViewOpened","isMobileViewport","setEditorCanvasContainerView","isViewMode","isStyleBookOpened","revisionsCount","_globalStyles$_links$","getCanvasMode","getEditorCanvasContainerView","getEntityRecord","__experimentalGetCurrentGlobalStylesId","globalStylesId","globalStyles","undefined","_links","count","set","setPreference","openGlobalStyles","Promise","all","openStyleBook","openRevisions","hasRevisions","modifiedDateTime","modified","shouldShowGlobalStylesFooter","children","title","description","content","footer","record","actions","icon","label","isPressed","enableResizing","isSelected","onSelect","showCloseButton","showTabs"],"sources":["@wordpress/edit-site/src/components/sidebar-navigation-screen-global-styles/index.js"],"sourcesContent":["/**\r\n * WordPress 依赖\r\n */\r\nimport { __ } from '@wordpress/i18n'; // 用于文本的国际化处理。\r\nimport { edit, seen } from '@wordpress/icons'; // 提供编辑和查看图标。\r\nimport { useSelect, useDispatch } from '@wordpress/data'; // 用于访问和操作 Redux 存储。\r\nimport { store as coreStore } from '@wordpress/core-data'; // 访问 WordPress 核心数据的存储。\r\nimport { useViewportMatch } from '@wordpress/compose'; // 用于根据视口尺寸来决定渲染逻辑。\r\nimport { useCallback } from '@wordpress/element'; // 用于定义回调函数，优化性能。\r\nimport { store as editorStore } from '@wordpress/editor'; // 访问编辑器功能的存储。\r\nimport { store as preferencesStore } from '@wordpress/preferences'; // 访问用户偏好设置的存储。\r\n\r\n/**\r\n * 内部依赖\r\n */\r\nimport SidebarNavigationScreen from '../sidebar-navigation-screen'; // 侧边栏导航屏幕组件。\r\nimport { unlock } from '../../lock-unlock'; // 可能是一个功能解锁工具。\r\nimport { store as editSiteStore } from '../../store'; // 用于编辑站点的 Redux 存储。\r\nimport SidebarButton from '../sidebar-button'; // 自定义的侧边栏按钮组件。\r\nimport SidebarNavigationItem from '../sidebar-navigation-item'; // 侧边栏导航项组件。\r\nimport StyleBook from '../style-book'; // 样式书组件。\r\nimport useGlobalStylesRevisions from '../global-styles/screen-revisions/use-global-styles-revisions'; // 自定义钩子，用于获取全局样式的修订版本信息。\r\nimport SidebarNavigationScreenDetailsFooter from '../sidebar-navigation-screen-details-footer'; // 侧边导航屏幕详细信息的底部组件。\r\nimport SidebarNavigationScreenGlobalStylesContent from './content'; // 全局样式内容组件的实现。\r\n\r\n/**\r\n * 定义一个展示全局样式选项的组件。\r\n */\r\nexport function SidebarNavigationItemGlobalStyles(props) {\r\n    // 使用 useDispatch 钩子获取 dispatch 方法。\r\n    const { openGeneralSidebar } = useDispatch(editSiteStore);\r\n    const { setCanvasMode } = unlock(useDispatch(editSiteStore));\r\n\r\n    // 使用 useSelect 钩子选择全局样式变体的存在状态。\r\n    const hasGlobalStyleVariations = useSelect(\r\n        (select) =>\r\n            !!select(coreStore).__experimentalGetCurrentThemeGlobalStylesVariations()?.length,\r\n        []\r\n    );\r\n\r\n    // 根据全局样式变体的存在与否，渲染不同的组件。\r\n    if (hasGlobalStyleVariations) {\r\n        return (\r\n            <SidebarNavigationItem\r\n                {...props}\r\n                params={{ path: '/wp_global_styles' }}\r\n                uid=\"global-styles-navigation-item\"\r\n            />\r\n        );\r\n    }\r\n    return (\r\n        <SidebarNavigationItem\r\n            {...props}\r\n            onClick={() => {\r\n                // 切换到编辑模式。\r\n                setCanvasMode('edit');\r\n                // 打开全局样式的侧边栏。\r\n                openGeneralSidebar('edit-site/global-styles');\r\n            }}\r\n        />\r\n    );\r\n}\r\n\r\n/**\r\n * 定义一个用于全局样式管理的侧边栏导航屏幕组件。\r\n */\r\nexport default function SidebarNavigationScreenGlobalStyles({ backPath }) {\r\n    // 使用自定义钩子获取全局样式修订版本信息。\r\n    const { revisions, isLoading: isLoadingRevisions } = useGlobalStylesRevisions();\r\n    const { openGeneralSidebar } = useDispatch(editSiteStore);\r\n    const { setIsListViewOpened } = useDispatch(editorStore);\r\n    const isMobileViewport = useViewportMatch('medium', '<');\r\n    const { setCanvasMode, setEditorCanvasContainerView } = unlock(useDispatch(editSiteStore));\r\n    const { isViewMode, isStyleBookOpened, revisionsCount } = useSelect((select) => {\r\n        const { getCanvasMode, getEditorCanvasContainerView } = unlock(select(editSiteStore));\r\n        const { getEntityRecord, __experimentalGetCurrentGlobalStylesId } = select(coreStore);\r\n        const globalStylesId = __experimentalGetCurrentGlobalStylesId();\r\n        const globalStyles = globalStylesId ? getEntityRecord('root', 'globalStyles', globalStylesId) : undefined;\r\n        return {\r\n            isViewMode: 'view' === getCanvasMode(),\r\n            isStyleBookOpened: 'style-book' === getEditorCanvasContainerView(),\r\n            revisionsCount: globalStyles?._links?.['version-history']?.[0]?.count ?? 0,\r\n        };\r\n    });\r\n\r\n    const { set: setPreference } = useDispatch(preferencesStore);\r\n\r\n    // 定义打开全局样式编辑器的函数。\r\n    const openGlobalStyles = useCallback(async () => {\r\n        return Promise.all([\r\n            setPreference('core', 'distractionFree', false),\r\n            setCanvasMode('edit'),\r\n            openGeneralSidebar('edit-site/global-styles'),\r\n        ]);\r\n    }, [setCanvasMode, openGeneralSidebar, setPreference]);\r\n\r\n    // 定义打开样式书的函数。\r\n    const openStyleBook = useCallback(async () => {\r\n        await openGlobalStyles();\r\n        // 打开样式书，确保不会过早关闭。\r\n        setEditorCanvasContainerView('style-book');\r\n        setIsListViewOpened(false);\r\n    }, [openGlobalStyles, setEditorCanvasContainerView, setIsListViewOpened]);\r\n\r\n    // 定义打开全局样式修订历史的函数。\r\n    const openRevisions = useCallback(async () => {\r\n        await openGlobalStyles();\r\n        // 打开全球样式修订历史。\r\n        setEditorCanvasContainerView('global-styles-revisions');\r\n    }, [openGlobalStyles, setEditorCanvasContainerView]);\r\n\r\n    // 判断是否显示全球样式底部栏。\r\n    const hasRevisions = revisionsCount > 0;\r\n    const modifiedDateTime = revisions?.[0]?.modified;\r\n    const shouldShowGlobalStylesFooter = hasRevisions && !isLoadingRevisions && modifiedDateTime;\r\n\r\n    // 渲染组件。\r\n    return (\r\n        <>\r\n            <SidebarNavigationScreen\r\n                title={__('风格展示！')}\r\n                description={__('为你的当前主题选择不同的风格！')}\r\n                backPath={backPath}\r\n                content={<SidebarNavigationScreenGlobalStylesContent />}\r\n                footer={\r\n                    shouldShowGlobalStylesFooter && (\r\n                        <SidebarNavigationScreenDetailsFooter\r\n                            record={revisions?.[0]}\r\n                            onClick={openRevisions}\r\n                        />\r\n                    )\r\n                }\r\n                actions={\r\n                    <>\r\n                        {!isMobileViewport && (\r\n                            <SidebarButton\r\n                                icon={seen}\r\n                                label={__('Style Book')}\r\n                                onClick={() =>\r\n                                    setEditorCanvasContainerView(\r\n                                        !isStyleBookOpened ? 'style-book' : undefined\r\n                                    )\r\n                                }\r\n                                isPressed={isStyleBookOpened}\r\n                            />\r\n                        )}\r\n                        <SidebarButton\r\n                            icon={edit}\r\n                            label={__('Edit styles')}\r\n                            onClick={async () => await openGlobalStyles()}\r\n                        />\r\n                    </>\r\n                }\r\n            />\r\n            {isStyleBookOpened && !isMobileViewport && isViewMode && (\r\n                <StyleBook\r\n                    enableResizing={false}\r\n                    isSelected={() => false}\r\n                    onClick={openStyleBook}\r\n                    onSelect={openStyleBook}\r\n                    showCloseButton={false}\r\n                    showTabs={false}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAE,QAAQ,iBAAiB,CAAC,CAAC;AACtC,SAASC,IAAI,EAAEC,IAAI,QAAQ,kBAAkB,CAAC,CAAC;AAC/C,SAASC,SAAS,EAAEC,WAAW,QAAQ,iBAAiB,CAAC,CAAC;AAC1D,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB,CAAC,CAAC;AAC3D,SAASC,gBAAgB,QAAQ,oBAAoB,CAAC,CAAC;AACvD,SAASC,WAAW,QAAQ,oBAAoB,CAAC,CAAC;AAClD,SAASH,KAAK,IAAII,WAAW,QAAQ,mBAAmB,CAAC,CAAC;AAC1D,SAASJ,KAAK,IAAIK,gBAAgB,QAAQ,wBAAwB,CAAC,CAAC;;AAEpE;AACA;AACA;AACA,OAAOC,uBAAuB,MAAM,8BAA8B,CAAC,CAAC;AACpE,SAASC,MAAM,QAAQ,mBAAmB,CAAC,CAAC;AAC5C,SAASP,KAAK,IAAIQ,aAAa,QAAQ,aAAa,CAAC,CAAC;AACtD,OAAOC,aAAa,MAAM,mBAAmB,CAAC,CAAC;AAC/C,OAAOC,qBAAqB,MAAM,4BAA4B,CAAC,CAAC;AAChE,OAAOC,SAAS,MAAM,eAAe,CAAC,CAAC;AACvC,OAAOC,wBAAwB,MAAM,+DAA+D,CAAC,CAAC;AACtG,OAAOC,oCAAoC,MAAM,6CAA6C,CAAC,CAAC;AAChG,OAAOC,0CAA0C,MAAM,WAAW,CAAC,CAAC;;AAEpE;AACA;AACA;AAFA,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAGA,OAAO,SAASC,iCAAiCA,CAACC,KAAK,EAAE;EACrD;EACA,MAAM;IAAEC;EAAmB,CAAC,GAAGxB,WAAW,CAACS,aAAa,CAAC;EACzD,MAAM;IAAEgB;EAAc,CAAC,GAAGjB,MAAM,CAACR,WAAW,CAACS,aAAa,CAAC,CAAC;;EAE5D;EACA,MAAMiB,wBAAwB,GAAG3B,SAAS,CACrC4B,MAAM,IACH,CAAC,CAACA,MAAM,CAACzB,SAAS,CAAC,CAAC0B,mDAAmD,CAAC,CAAC,EAAEC,MAAM,EACrF,EACJ,CAAC;;EAED;EACA,IAAIH,wBAAwB,EAAE;IAC1B,oBACIT,IAAA,CAACN,qBAAqB;MAAA,GACdY,KAAK;MACTO,MAAM,EAAE;QAAEC,IAAI,EAAE;MAAoB,CAAE;MACtCC,GAAG,EAAC;IAA+B,CACtC,CAAC;EAEV;EACA,oBACIf,IAAA,CAACN,qBAAqB;IAAA,GACdY,KAAK;IACTU,OAAO,EAAEA,CAAA,KAAM;MACX;MACAR,aAAa,CAAC,MAAM,CAAC;MACrB;MACAD,kBAAkB,CAAC,yBAAyB,CAAC;IACjD;EAAE,CACL,CAAC;AAEV;;AAEA;AACA;AACA;AACA,eAAe,SAASU,mCAAmCA,CAAC;EAAEC;AAAS,CAAC,EAAE;EACtE;EACA,MAAM;IAAEC,SAAS;IAAEC,SAAS,EAAEC;EAAmB,CAAC,GAAGzB,wBAAwB,CAAC,CAAC;EAC/E,MAAM;IAAEW;EAAmB,CAAC,GAAGxB,WAAW,CAACS,aAAa,CAAC;EACzD,MAAM;IAAE8B;EAAoB,CAAC,GAAGvC,WAAW,CAACK,WAAW,CAAC;EACxD,MAAMmC,gBAAgB,GAAGrC,gBAAgB,CAAC,QAAQ,EAAE,GAAG,CAAC;EACxD,MAAM;IAAEsB,aAAa;IAAEgB;EAA6B,CAAC,GAAGjC,MAAM,CAACR,WAAW,CAACS,aAAa,CAAC,CAAC;EAC1F,MAAM;IAAEiC,UAAU;IAAEC,iBAAiB;IAAEC;EAAe,CAAC,GAAG7C,SAAS,CAAE4B,MAAM,IAAK;IAAA,IAAAkB,qBAAA;IAC5E,MAAM;MAAEC,aAAa;MAAEC;IAA6B,CAAC,GAAGvC,MAAM,CAACmB,MAAM,CAAClB,aAAa,CAAC,CAAC;IACrF,MAAM;MAAEuC,eAAe;MAAEC;IAAuC,CAAC,GAAGtB,MAAM,CAACzB,SAAS,CAAC;IACrF,MAAMgD,cAAc,GAAGD,sCAAsC,CAAC,CAAC;IAC/D,MAAME,YAAY,GAAGD,cAAc,GAAGF,eAAe,CAAC,MAAM,EAAE,cAAc,EAAEE,cAAc,CAAC,GAAGE,SAAS;IACzG,OAAO;MACHV,UAAU,EAAE,MAAM,KAAKI,aAAa,CAAC,CAAC;MACtCH,iBAAiB,EAAE,YAAY,KAAKI,4BAA4B,CAAC,CAAC;MAClEH,cAAc,GAAAC,qBAAA,GAAEM,YAAY,EAAEE,MAAM,GAAG,iBAAiB,CAAC,GAAG,CAAC,CAAC,EAAEC,KAAK,cAAAT,qBAAA,cAAAA,qBAAA,GAAI;IAC7E,CAAC;EACL,CAAC,CAAC;EAEF,MAAM;IAAEU,GAAG,EAAEC;EAAc,CAAC,GAAGxD,WAAW,CAACM,gBAAgB,CAAC;;EAE5D;EACA,MAAMmD,gBAAgB,GAAGrD,WAAW,CAAC,YAAY;IAC7C,OAAOsD,OAAO,CAACC,GAAG,CAAC,CACfH,aAAa,CAAC,MAAM,EAAE,iBAAiB,EAAE,KAAK,CAAC,EAC/C/B,aAAa,CAAC,MAAM,CAAC,EACrBD,kBAAkB,CAAC,yBAAyB,CAAC,CAChD,CAAC;EACN,CAAC,EAAE,CAACC,aAAa,EAAED,kBAAkB,EAAEgC,aAAa,CAAC,CAAC;;EAEtD;EACA,MAAMI,aAAa,GAAGxD,WAAW,CAAC,YAAY;IAC1C,MAAMqD,gBAAgB,CAAC,CAAC;IACxB;IACAhB,4BAA4B,CAAC,YAAY,CAAC;IAC1CF,mBAAmB,CAAC,KAAK,CAAC;EAC9B,CAAC,EAAE,CAACkB,gBAAgB,EAAEhB,4BAA4B,EAAEF,mBAAmB,CAAC,CAAC;;EAEzE;EACA,MAAMsB,aAAa,GAAGzD,WAAW,CAAC,YAAY;IAC1C,MAAMqD,gBAAgB,CAAC,CAAC;IACxB;IACAhB,4BAA4B,CAAC,yBAAyB,CAAC;EAC3D,CAAC,EAAE,CAACgB,gBAAgB,EAAEhB,4BAA4B,CAAC,CAAC;;EAEpD;EACA,MAAMqB,YAAY,GAAGlB,cAAc,GAAG,CAAC;EACvC,MAAMmB,gBAAgB,GAAG3B,SAAS,GAAG,CAAC,CAAC,EAAE4B,QAAQ;EACjD,MAAMC,4BAA4B,GAAGH,YAAY,IAAI,CAACxB,kBAAkB,IAAIyB,gBAAgB;;EAE5F;EACA,oBACI1C,KAAA,CAAAF,SAAA;IAAA+C,QAAA,gBACIjD,IAAA,CAACV,uBAAuB;MACpB4D,KAAK,EAAEvE,EAAE,CAAC,OAAO,CAAE;MACnBwE,WAAW,EAAExE,EAAE,CAAC,iBAAiB,CAAE;MACnCuC,QAAQ,EAAEA,QAAS;MACnBkC,OAAO,eAAEpD,IAAA,CAACF,0CAA0C,IAAE,CAAE;MACxDuD,MAAM,EACFL,4BAA4B,iBACxBhD,IAAA,CAACH,oCAAoC;QACjCyD,MAAM,EAAEnC,SAAS,GAAG,CAAC,CAAE;QACvBH,OAAO,EAAE4B;MAAc,CAC1B,CAER;MACDW,OAAO,eACHnD,KAAA,CAAAF,SAAA;QAAA+C,QAAA,GACK,CAAC1B,gBAAgB,iBACdvB,IAAA,CAACP,aAAa;UACV+D,IAAI,EAAE3E,IAAK;UACX4E,KAAK,EAAE9E,EAAE,CAAC,YAAY,CAAE;UACxBqC,OAAO,EAAEA,CAAA,KACLQ,4BAA4B,CACxB,CAACE,iBAAiB,GAAG,YAAY,GAAGS,SACxC,CACH;UACDuB,SAAS,EAAEhC;QAAkB,CAChC,CACJ,eACD1B,IAAA,CAACP,aAAa;UACV+D,IAAI,EAAE5E,IAAK;UACX6E,KAAK,EAAE9E,EAAE,CAAC,aAAa,CAAE;UACzBqC,OAAO,EAAE,MAAAA,CAAA,KAAY,MAAMwB,gBAAgB,CAAC;QAAE,CACjD,CAAC;MAAA,CACJ;IACL,CACJ,CAAC,EACDd,iBAAiB,IAAI,CAACH,gBAAgB,IAAIE,UAAU,iBACjDzB,IAAA,CAACL,SAAS;MACNgE,cAAc,EAAE,KAAM;MACtBC,UAAU,EAAEA,CAAA,KAAM,KAAM;MACxB5C,OAAO,EAAE2B,aAAc;MACvBkB,QAAQ,EAAElB,aAAc;MACxBmB,eAAe,EAAE,KAAM;MACvBC,QAAQ,EAAE;IAAM,CACnB,CACJ;EAAA,CACH,CAAC;AAEX","ignoreList":[]}