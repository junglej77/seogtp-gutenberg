{"version":3,"names":["__","sprintf","useEntityRecords","store","coreStore","useSelect","decodeEntities","__experimentalItemGroup","ItemGroup","Spinner","navigation","SidebarNavigationScreen","SidebarNavigationItem","PRELOADED_NAVIGATION_MENUS_QUERY","useLink","SingleNavigationMenu","useNavigationMenuHandlers","unlock","NAVIGATION_POST_TYPE","jsx","_jsx","buildMenuLabel","title","id","status","hasCreatedFallback","SidebarNavigationScreenNavigationMenus","backPath","records","navigationMenus","isResolving","isResolvingNavigationMenus","hasResolved","hasResolvedNavigationMenus","isLoading","getNavigationFallbackId","firstNavigationMenu","handleSave","handleDelete","handleDuplicate","hasNavigationMenus","length","SidebarNavigationScreenWrapper","children","className","description","navigationMenu","edits","map","index","NavMenuItem","postId","withChevron","icon","rendered","actions","content","props","linkInfo","postType"],"sources":["@wordpress/edit-site/src/components/sidebar-navigation-screen-navigation-menus/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { useEntityRecords, store as coreStore } from '@wordpress/core-data';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\nimport { decodeEntities } from '@wordpress/html-entities';\r\nimport {\r\n\t__experimentalItemGroup as ItemGroup,\r\n\tSpinner,\r\n} from '@wordpress/components';\r\nimport { navigation } from '@wordpress/icons';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport SidebarNavigationScreen from '../sidebar-navigation-screen';\r\nimport SidebarNavigationItem from '../sidebar-navigation-item';\r\nimport { PRELOADED_NAVIGATION_MENUS_QUERY } from './constants';\r\nimport { useLink } from '../routes/link';\r\nimport SingleNavigationMenu from '../sidebar-navigation-screen-navigation-menu/single-navigation-menu';\r\nimport useNavigationMenuHandlers from '../sidebar-navigation-screen-navigation-menu/use-navigation-menu-handlers';\r\nimport { unlock } from '../../lock-unlock';\r\nimport { NAVIGATION_POST_TYPE } from '../../utils/constants';\r\n\r\n// Copied from packages/block-library/src/navigation/edit/navigation-menu-selector.js.\r\nfunction buildMenuLabel( title, id, status ) {\r\n\tif ( ! title ) {\r\n\t\t/* translators: %s is the index of the menu in the list of menus. */\r\n\t\treturn sprintf( __( '(no title %s)' ), id );\r\n\t}\r\n\r\n\tif ( status === 'publish' ) {\r\n\t\treturn decodeEntities( title );\r\n\t}\r\n\r\n\treturn sprintf(\r\n\t\t// translators: %1s: title of the menu; %2s: status of the menu (draft, pending, etc.).\r\n\t\t__( '%1$s (%2$s)' ),\r\n\t\tdecodeEntities( title ),\r\n\t\tstatus\r\n\t);\r\n}\r\n\r\n// Save a boolean to prevent us creating a fallback more than once per session.\r\nlet hasCreatedFallback = false;\r\n\r\nexport default function SidebarNavigationScreenNavigationMenus( { backPath } ) {\r\n\tconst {\r\n\t\trecords: navigationMenus,\r\n\t\tisResolving: isResolvingNavigationMenus,\r\n\t\thasResolved: hasResolvedNavigationMenus,\r\n\t} = useEntityRecords(\r\n\t\t'postType',\r\n\t\tNAVIGATION_POST_TYPE,\r\n\t\tPRELOADED_NAVIGATION_MENUS_QUERY\r\n\t);\r\n\r\n\tconst isLoading =\r\n\t\tisResolvingNavigationMenus && ! hasResolvedNavigationMenus;\r\n\r\n\tconst { getNavigationFallbackId } = unlock( useSelect( coreStore ) );\r\n\r\n\tconst firstNavigationMenu = navigationMenus?.[ 0 ];\r\n\r\n\t// Save a boolean to prevent us creating a fallback more than once per session.\r\n\tif ( firstNavigationMenu ) {\r\n\t\thasCreatedFallback = true;\r\n\t}\r\n\r\n\t// If there is no navigation menu found\r\n\t// then trigger fallback algorithm to create one.\r\n\tif (\r\n\t\t! firstNavigationMenu &&\r\n\t\t! isResolvingNavigationMenus &&\r\n\t\thasResolvedNavigationMenus &&\r\n\t\t! hasCreatedFallback\r\n\t) {\r\n\t\tgetNavigationFallbackId();\r\n\t}\r\n\r\n\tconst { handleSave, handleDelete, handleDuplicate } =\r\n\t\tuseNavigationMenuHandlers();\r\n\r\n\tconst hasNavigationMenus = !! navigationMenus?.length;\r\n\r\n\tif ( isLoading ) {\r\n\t\treturn (\r\n\t\t\t<SidebarNavigationScreenWrapper backPath={ backPath }>\r\n\t\t\t\t<Spinner className=\"edit-site-sidebar-navigation-screen-navigation-menus__loading\" />\r\n\t\t\t</SidebarNavigationScreenWrapper>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( ! isLoading && ! hasNavigationMenus ) {\r\n\t\treturn (\r\n\t\t\t<SidebarNavigationScreenWrapper\r\n\t\t\t\tdescription={ __( '暂无设置导航菜单' ) }\r\n\t\t\t\tbackPath={ backPath }\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\t// if single menu then render it\r\n\tif ( navigationMenus?.length === 1 ) {\r\n\t\treturn (\r\n\t\t\t<SingleNavigationMenu\r\n\t\t\t\tnavigationMenu={ firstNavigationMenu }\r\n\t\t\t\tbackPath={ backPath }\r\n\t\t\t\thandleDelete={ () => handleDelete( firstNavigationMenu ) }\r\n\t\t\t\thandleDuplicate={ () => handleDuplicate( firstNavigationMenu ) }\r\n\t\t\t\thandleSave={ ( edits ) =>\r\n\t\t\t\t\thandleSave( firstNavigationMenu, edits )\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<SidebarNavigationScreenWrapper backPath={ backPath }>\r\n\t\t\t<ItemGroup>\r\n\t\t\t\t{ navigationMenus?.map( ( { id, title, status }, index ) => (\r\n\t\t\t\t\t<NavMenuItem\r\n\t\t\t\t\t\tpostId={ id }\r\n\t\t\t\t\t\tkey={ id }\r\n\t\t\t\t\t\twithChevron\r\n\t\t\t\t\t\ticon={ navigation }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ buildMenuLabel( title?.rendered, index + 1, status ) }\r\n\t\t\t\t\t</NavMenuItem>\r\n\t\t\t\t) ) }\r\n\t\t\t</ItemGroup>\r\n\t\t</SidebarNavigationScreenWrapper>\r\n\t);\r\n}\r\n\r\nexport function SidebarNavigationScreenWrapper( {\r\n\tchildren,\r\n\tactions,\r\n\ttitle,\r\n\tdescription,\r\n\tbackPath,\r\n} ) {\r\n\treturn (\r\n\t\t<SidebarNavigationScreen\r\n\t\t\ttitle={ title || __( '导航菜单' ) }\r\n\t\t\tactions={ actions }\r\n\t\t\tdescription={ description || __( 'Manage your Navigation Menus.' ) }\r\n\t\t\tbackPath={ backPath }\r\n\t\t\tcontent={ children }\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nconst NavMenuItem = ( { postId, ...props } ) => {\r\n\tconst linkInfo = useLink( {\r\n\t\tpostId,\r\n\t\tpostType: 'wp_navigation',\r\n\t} );\r\n\treturn <SidebarNavigationItem { ...linkInfo } { ...props } />;\r\n};\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAE,EAAEC,OAAO,QAAQ,iBAAiB;AAC7C,SAASC,gBAAgB,EAAEC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;AAC3E,SAASC,SAAS,QAAQ,iBAAiB;AAE3C,SAASC,cAAc,QAAQ,0BAA0B;AACzD,SACCC,uBAAuB,IAAIC,SAAS,EACpCC,OAAO,QACD,uBAAuB;AAC9B,SAASC,UAAU,QAAQ,kBAAkB;;AAE7C;AACA;AACA;AACA,OAAOC,uBAAuB,MAAM,8BAA8B;AAClE,OAAOC,qBAAqB,MAAM,4BAA4B;AAC9D,SAASC,gCAAgC,QAAQ,aAAa;AAC9D,SAASC,OAAO,QAAQ,gBAAgB;AACxC,OAAOC,oBAAoB,MAAM,qEAAqE;AACtG,OAAOC,yBAAyB,MAAM,2EAA2E;AACjH,SAASC,MAAM,QAAQ,mBAAmB;AAC1C,SAASC,oBAAoB,QAAQ,uBAAuB;;AAE5D;AAAA,SAAAC,GAAA,IAAAC,IAAA;AACA,SAASC,cAAcA,CAAEC,KAAK,EAAEC,EAAE,EAAEC,MAAM,EAAG;EAC5C,IAAK,CAAEF,KAAK,EAAG;IACd;IACA,OAAOrB,OAAO,CAAED,EAAE,CAAE,eAAgB,CAAC,EAAEuB,EAAG,CAAC;EAC5C;EAEA,IAAKC,MAAM,KAAK,SAAS,EAAG;IAC3B,OAAOlB,cAAc,CAAEgB,KAAM,CAAC;EAC/B;EAEA,OAAOrB,OAAO;EACb;EACAD,EAAE,CAAE,aAAc,CAAC,EACnBM,cAAc,CAAEgB,KAAM,CAAC,EACvBE,MACD,CAAC;AACF;;AAEA;AACA,IAAIC,kBAAkB,GAAG,KAAK;AAE9B,eAAe,SAASC,sCAAsCA,CAAE;EAAEC;AAAS,CAAC,EAAG;EAC9E,MAAM;IACLC,OAAO,EAAEC,eAAe;IACxBC,WAAW,EAAEC,0BAA0B;IACvCC,WAAW,EAAEC;EACd,CAAC,GAAG/B,gBAAgB,CACnB,UAAU,EACVgB,oBAAoB,EACpBL,gCACD,CAAC;EAED,MAAMqB,SAAS,GACdH,0BAA0B,IAAI,CAAEE,0BAA0B;EAE3D,MAAM;IAAEE;EAAwB,CAAC,GAAGlB,MAAM,CAAEZ,SAAS,CAAED,SAAU,CAAE,CAAC;EAEpE,MAAMgC,mBAAmB,GAAGP,eAAe,GAAI,CAAC,CAAE;;EAElD;EACA,IAAKO,mBAAmB,EAAG;IAC1BX,kBAAkB,GAAG,IAAI;EAC1B;;EAEA;EACA;EACA,IACC,CAAEW,mBAAmB,IACrB,CAAEL,0BAA0B,IAC5BE,0BAA0B,IAC1B,CAAER,kBAAkB,EACnB;IACDU,uBAAuB,CAAC,CAAC;EAC1B;EAEA,MAAM;IAAEE,UAAU;IAAEC,YAAY;IAAEC;EAAgB,CAAC,GAClDvB,yBAAyB,CAAC,CAAC;EAE5B,MAAMwB,kBAAkB,GAAG,CAAC,CAAEX,eAAe,EAAEY,MAAM;EAErD,IAAKP,SAAS,EAAG;IAChB,oBACCd,IAAA,CAACsB,8BAA8B;MAACf,QAAQ,EAAGA,QAAU;MAAAgB,QAAA,eACpDvB,IAAA,CAACX,OAAO;QAACmC,SAAS,EAAC;MAA+D,CAAE;IAAC,CACtD,CAAC;EAEnC;EAEA,IAAK,CAAEV,SAAS,IAAI,CAAEM,kBAAkB,EAAG;IAC1C,oBACCpB,IAAA,CAACsB,8BAA8B;MAC9BG,WAAW,EAAG7C,EAAE,CAAE,UAAW,CAAG;MAChC2B,QAAQ,EAAGA;IAAU,CACrB,CAAC;EAEJ;;EAEA;EACA,IAAKE,eAAe,EAAEY,MAAM,KAAK,CAAC,EAAG;IACpC,oBACCrB,IAAA,CAACL,oBAAoB;MACpB+B,cAAc,EAAGV,mBAAqB;MACtCT,QAAQ,EAAGA,QAAU;MACrBW,YAAY,EAAGA,CAAA,KAAMA,YAAY,CAAEF,mBAAoB,CAAG;MAC1DG,eAAe,EAAGA,CAAA,KAAMA,eAAe,CAAEH,mBAAoB,CAAG;MAChEC,UAAU,EAAKU,KAAK,IACnBV,UAAU,CAAED,mBAAmB,EAAEW,KAAM;IACvC,CACD,CAAC;EAEJ;EAEA,oBACC3B,IAAA,CAACsB,8BAA8B;IAACf,QAAQ,EAAGA,QAAU;IAAAgB,QAAA,eACpDvB,IAAA,CAACZ,SAAS;MAAAmC,QAAA,EACPd,eAAe,EAAEmB,GAAG,CAAE,CAAE;QAAEzB,EAAE;QAAED,KAAK;QAAEE;MAAO,CAAC,EAAEyB,KAAK,kBACrD7B,IAAA,CAAC8B,WAAW;QACXC,MAAM,EAAG5B,EAAI;QAEb6B,WAAW;QACXC,IAAI,EAAG3C,UAAY;QAAAiC,QAAA,EAEjBtB,cAAc,CAAEC,KAAK,EAAEgC,QAAQ,EAAEL,KAAK,GAAG,CAAC,EAAEzB,MAAO;MAAC,GAJhDD,EAKM,CACZ;IAAC,CACO;EAAC,CACmB,CAAC;AAEnC;AAEA,OAAO,SAASmB,8BAA8BA,CAAE;EAC/CC,QAAQ;EACRY,OAAO;EACPjC,KAAK;EACLuB,WAAW;EACXlB;AACD,CAAC,EAAG;EACH,oBACCP,IAAA,CAACT,uBAAuB;IACvBW,KAAK,EAAGA,KAAK,IAAItB,EAAE,CAAE,MAAO,CAAG;IAC/BuD,OAAO,EAAGA,OAAS;IACnBV,WAAW,EAAGA,WAAW,IAAI7C,EAAE,CAAE,+BAAgC,CAAG;IACpE2B,QAAQ,EAAGA,QAAU;IACrB6B,OAAO,EAAGb;EAAU,CACpB,CAAC;AAEJ;AAEA,MAAMO,WAAW,GAAGA,CAAE;EAAEC,MAAM;EAAE,GAAGM;AAAM,CAAC,KAAM;EAC/C,MAAMC,QAAQ,GAAG5C,OAAO,CAAE;IACzBqC,MAAM;IACNQ,QAAQ,EAAE;EACX,CAAE,CAAC;EACH,oBAAOvC,IAAA,CAACR,qBAAqB;IAAA,GAAM8C,QAAQ;IAAA,GAAQD;EAAK,CAAI,CAAC;AAC9D,CAAC","ignoreList":[]}