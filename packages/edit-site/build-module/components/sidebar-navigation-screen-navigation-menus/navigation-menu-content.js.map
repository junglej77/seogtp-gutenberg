{"version":3,"names":["privateApis","blockEditorPrivateApis","store","blockEditorStore","BlockList","useDispatch","useSelect","createBlock","useCallback","coreStore","unlock","LeafMoreMenu","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","PrivateListView","MAX_PAGE_COUNT","PAGES_QUERY","per_page","_fields","orderby","order","NavigationMenuContent","rootClientId","listViewRootClientId","isLoading","select","areInnerBlocksControlled","getBlockName","getBlockCount","getBlockOrder","isResolving","blockClientIds","hasOnlyPageListBlock","length","pageListHasBlocks","isLoadingPages","replaceBlock","__unstableMarkNextChangeAsNotPersistent","offCanvasOnselect","block","name","attributes","url","clientId","children","onSelect","blockSettingsMenu","showAppender","className"],"sources":["@wordpress/edit-site/src/components/sidebar-navigation-screen-navigation-menus/navigation-menu-content.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tprivateApis as blockEditorPrivateApis,\r\n\tstore as blockEditorStore,\r\n\tBlockList,\r\n} from '@wordpress/block-editor';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { createBlock } from '@wordpress/blocks';\r\nimport { useCallback } from '@wordpress/element';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { unlock } from '../../lock-unlock';\r\nimport LeafMoreMenu from './leaf-more-menu';\r\n\r\nconst { PrivateListView } = unlock( blockEditorPrivateApis );\r\n\r\n// Needs to be kept in sync with the query used at packages/block-library/src/page-list/edit.js.\r\nconst MAX_PAGE_COUNT = 100;\r\nconst PAGES_QUERY = [\r\n\t'postType',\r\n\t'page',\r\n\t{\r\n\t\tper_page: MAX_PAGE_COUNT,\r\n\t\t_fields: [ 'id', 'link', 'menu_order', 'parent', 'title', 'type' ],\r\n\t\t// TODO: When https://core.trac.wordpress.org/ticket/39037 REST API support for multiple orderby\r\n\t\t// values is resolved, update 'orderby' to [ 'menu_order', 'post_title' ] to provide a consistent\r\n\t\t// sort.\r\n\t\torderby: 'menu_order',\r\n\t\torder: 'asc',\r\n\t},\r\n];\r\n\r\nexport default function NavigationMenuContent( { rootClientId } ) {\r\n\tconst { listViewRootClientId, isLoading } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst {\r\n\t\t\t\tareInnerBlocksControlled,\r\n\t\t\t\tgetBlockName,\r\n\t\t\t\tgetBlockCount,\r\n\t\t\t\tgetBlockOrder,\r\n\t\t\t} = select( blockEditorStore );\r\n\t\t\tconst { isResolving } = select( coreStore );\r\n\r\n\t\t\tconst blockClientIds = getBlockOrder( rootClientId );\r\n\r\n\t\t\tconst hasOnlyPageListBlock =\r\n\t\t\t\tblockClientIds.length === 1 &&\r\n\t\t\t\tgetBlockName( blockClientIds[ 0 ] ) === 'core/page-list';\r\n\t\t\tconst pageListHasBlocks =\r\n\t\t\t\thasOnlyPageListBlock &&\r\n\t\t\t\tgetBlockCount( blockClientIds[ 0 ] ) > 0;\r\n\r\n\t\t\tconst isLoadingPages = isResolving(\r\n\t\t\t\t'getEntityRecords',\r\n\t\t\t\tPAGES_QUERY\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tlistViewRootClientId: pageListHasBlocks\r\n\t\t\t\t\t? blockClientIds[ 0 ]\r\n\t\t\t\t\t: rootClientId,\r\n\t\t\t\t// This is a small hack to wait for the navigation block\r\n\t\t\t\t// to actually load its inner blocks.\r\n\t\t\t\tisLoading:\r\n\t\t\t\t\t! areInnerBlocksControlled( rootClientId ) ||\r\n\t\t\t\t\tisLoadingPages,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ rootClientId ]\r\n\t);\r\n\tconst { replaceBlock, __unstableMarkNextChangeAsNotPersistent } =\r\n\t\tuseDispatch( blockEditorStore );\r\n\r\n\tconst offCanvasOnselect = useCallback(\r\n\t\t( block ) => {\r\n\t\t\tif (\r\n\t\t\t\tblock.name === 'core/navigation-link' &&\r\n\t\t\t\t! block.attributes.url\r\n\t\t\t) {\r\n\t\t\t\t__unstableMarkNextChangeAsNotPersistent();\r\n\t\t\t\treplaceBlock(\r\n\t\t\t\t\tblock.clientId,\r\n\t\t\t\t\tcreateBlock( 'core/navigation-link', block.attributes )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[ __unstableMarkNextChangeAsNotPersistent, replaceBlock ]\r\n\t);\r\n\r\n\t// The hidden block is needed because it makes block edit side effects trigger.\r\n\t// For example a navigation page list load its items has an effect on edit to load its items.\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ ! isLoading && (\r\n\t\t\t\t<PrivateListView\r\n\t\t\t\t\trootClientId={ listViewRootClientId }\r\n\t\t\t\t\tonSelect={ offCanvasOnselect }\r\n\t\t\t\t\tblockSettingsMenu={ LeafMoreMenu }\r\n\t\t\t\t\tshowAppender={ false }\r\n\t\t\t\t/>\r\n\t\t\t) }\r\n\t\t\t<div className=\"edit-site-sidebar-navigation-screen-navigation-menus__helper-block-editor\">\r\n\t\t\t\t<BlockList />\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SACCA,WAAW,IAAIC,sBAAsB,EACrCC,KAAK,IAAIC,gBAAgB,EACzBC,SAAS,QACH,yBAAyB;AAChC,SAASC,WAAW,EAAEC,SAAS,QAAQ,iBAAiB;AACxD,SAASC,WAAW,QAAQ,mBAAmB;AAC/C,SAASC,WAAW,QAAQ,oBAAoB;AAChD,SAASN,KAAK,IAAIO,SAAS,QAAQ,sBAAsB;;AAEzD;AACA;AACA;AACA,SAASC,MAAM,QAAQ,mBAAmB;AAC1C,OAAOC,YAAY,MAAM,kBAAkB;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAE5C,MAAM;EAAEC;AAAgB,CAAC,GAAGR,MAAM,CAAET,sBAAuB,CAAC;;AAE5D;AACA,MAAMkB,cAAc,GAAG,GAAG;AAC1B,MAAMC,WAAW,GAAG,CACnB,UAAU,EACV,MAAM,EACN;EACCC,QAAQ,EAAEF,cAAc;EACxBG,OAAO,EAAE,CAAE,IAAI,EAAE,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,CAAE;EAClE;EACA;EACA;EACAC,OAAO,EAAE,YAAY;EACrBC,KAAK,EAAE;AACR,CAAC,CACD;AAED,eAAe,SAASC,qBAAqBA,CAAE;EAAEC;AAAa,CAAC,EAAG;EACjE,MAAM;IAAEC,oBAAoB;IAAEC;EAAU,CAAC,GAAGtB,SAAS,CAClDuB,MAAM,IAAM;IACb,MAAM;MACLC,wBAAwB;MACxBC,YAAY;MACZC,aAAa;MACbC;IACD,CAAC,GAAGJ,MAAM,CAAE1B,gBAAiB,CAAC;IAC9B,MAAM;MAAE+B;IAAY,CAAC,GAAGL,MAAM,CAAEpB,SAAU,CAAC;IAE3C,MAAM0B,cAAc,GAAGF,aAAa,CAAEP,YAAa,CAAC;IAEpD,MAAMU,oBAAoB,GACzBD,cAAc,CAACE,MAAM,KAAK,CAAC,IAC3BN,YAAY,CAAEI,cAAc,CAAE,CAAC,CAAG,CAAC,KAAK,gBAAgB;IACzD,MAAMG,iBAAiB,GACtBF,oBAAoB,IACpBJ,aAAa,CAAEG,cAAc,CAAE,CAAC,CAAG,CAAC,GAAG,CAAC;IAEzC,MAAMI,cAAc,GAAGL,WAAW,CACjC,kBAAkB,EAClBd,WACD,CAAC;IAED,OAAO;MACNO,oBAAoB,EAAEW,iBAAiB,GACpCH,cAAc,CAAE,CAAC,CAAE,GACnBT,YAAY;MACf;MACA;MACAE,SAAS,EACR,CAAEE,wBAAwB,CAAEJ,YAAa,CAAC,IAC1Ca;IACF,CAAC;EACF,CAAC,EACD,CAAEb,YAAY,CACf,CAAC;EACD,MAAM;IAAEc,YAAY;IAAEC;EAAwC,CAAC,GAC9DpC,WAAW,CAAEF,gBAAiB,CAAC;EAEhC,MAAMuC,iBAAiB,GAAGlC,WAAW,CAClCmC,KAAK,IAAM;IACZ,IACCA,KAAK,CAACC,IAAI,KAAK,sBAAsB,IACrC,CAAED,KAAK,CAACE,UAAU,CAACC,GAAG,EACrB;MACDL,uCAAuC,CAAC,CAAC;MACzCD,YAAY,CACXG,KAAK,CAACI,QAAQ,EACdxC,WAAW,CAAE,sBAAsB,EAAEoC,KAAK,CAACE,UAAW,CACvD,CAAC;IACF;EACD,CAAC,EACD,CAAEJ,uCAAuC,EAAED,YAAY,CACxD,CAAC;;EAED;EACA;EACA,oBACCvB,KAAA,CAAAF,SAAA;IAAAiC,QAAA,GACG,CAAEpB,SAAS,iBACZf,IAAA,CAACK,eAAe;MACfQ,YAAY,EAAGC,oBAAsB;MACrCsB,QAAQ,EAAGP,iBAAmB;MAC9BQ,iBAAiB,EAAGvC,YAAc;MAClCwC,YAAY,EAAG;IAAO,CACtB,CACD,eACDtC,IAAA;MAAKuC,SAAS,EAAC,2EAA2E;MAAAJ,QAAA,eACzFnC,IAAA,CAACT,SAAS,IAAE;IAAC,CACT,CAAC;EAAA,CACL,CAAC;AAEL","ignoreList":[]}