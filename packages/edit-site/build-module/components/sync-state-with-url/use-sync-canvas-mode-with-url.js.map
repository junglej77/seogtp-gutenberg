{"version":3,"names":["useEffect","useRef","useSelect","useDispatch","privateApis","routerPrivateApis","store","editSiteStore","unlock","useLocation","useHistory","useSyncCanvasModeWithURL","history","params","canvasMode","select","getCanvasMode","setCanvasMode","currentCanvasModeRef","canvas","canvasInUrl","currentCanvasInUrlRef","currentUrlParamsRef","current","push","undefined"],"sources":["@wordpress/edit-site/src/components/sync-state-with-url/use-sync-canvas-mode-with-url.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useEffect, useRef } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { privateApis as routerPrivateApis } from '@wordpress/router';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editSiteStore } from '../../store';\r\nimport { unlock } from '../../lock-unlock';\r\n\r\nconst { useLocation, useHistory } = unlock( routerPrivateApis );\r\n\r\nexport default function useSyncCanvasModeWithURL() {\r\n\tconst history = useHistory();\r\n\tconst { params } = useLocation();\r\n\tconst canvasMode = useSelect(\r\n\t\t( select ) => unlock( select( editSiteStore ) ).getCanvasMode(),\r\n\t\t[]\r\n\t);\r\n\tconst { setCanvasMode } = unlock( useDispatch( editSiteStore ) );\r\n\tconst currentCanvasModeRef = useRef( canvasMode );\r\n\tconst { canvas: canvasInUrl } = params;\r\n\tconst currentCanvasInUrlRef = useRef( canvasInUrl );\r\n\tconst currentUrlParamsRef = useRef( params );\r\n\tuseEffect( () => {\r\n\t\tcurrentUrlParamsRef.current = params;\r\n\t}, [ params ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tcurrentCanvasModeRef.current = canvasMode;\r\n\t\tif ( canvasMode === 'init' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tcanvasMode === 'edit' &&\r\n\t\t\tcurrentCanvasInUrlRef.current !== canvasMode\r\n\t\t) {\r\n\t\t\thistory.push( {\r\n\t\t\t\t...currentUrlParamsRef.current,\r\n\t\t\t\tcanvas: 'edit',\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tcanvasMode === 'view' &&\r\n\t\t\tcurrentCanvasInUrlRef.current !== undefined\r\n\t\t) {\r\n\t\t\thistory.push( {\r\n\t\t\t\t...currentUrlParamsRef.current,\r\n\t\t\t\tcanvas: undefined,\r\n\t\t\t} );\r\n\t\t}\r\n\t}, [ canvasMode, history ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tcurrentCanvasInUrlRef.current = canvasInUrl;\r\n\t\tif (\r\n\t\t\tcanvasInUrl !== 'edit' &&\r\n\t\t\tcurrentCanvasModeRef.current !== 'view'\r\n\t\t) {\r\n\t\t\tsetCanvasMode( 'view' );\r\n\t\t} else if (\r\n\t\t\tcanvasInUrl === 'edit' &&\r\n\t\t\tcurrentCanvasModeRef.current !== 'edit'\r\n\t\t) {\r\n\t\t\tsetCanvasMode( 'edit' );\r\n\t\t}\r\n\t}, [ canvasInUrl, setCanvasMode ] );\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,EAAEC,MAAM,QAAQ,oBAAoB;AACtD,SAASC,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACxD,SAASC,WAAW,IAAIC,iBAAiB,QAAQ,mBAAmB;;AAEpE;AACA;AACA;AACA,SAASC,KAAK,IAAIC,aAAa,QAAQ,aAAa;AACpD,SAASC,MAAM,QAAQ,mBAAmB;AAE1C,MAAM;EAAEC,WAAW;EAAEC;AAAW,CAAC,GAAGF,MAAM,CAAEH,iBAAkB,CAAC;AAE/D,eAAe,SAASM,wBAAwBA,CAAA,EAAG;EAClD,MAAMC,OAAO,GAAGF,UAAU,CAAC,CAAC;EAC5B,MAAM;IAAEG;EAAO,CAAC,GAAGJ,WAAW,CAAC,CAAC;EAChC,MAAMK,UAAU,GAAGZ,SAAS,CACzBa,MAAM,IAAMP,MAAM,CAAEO,MAAM,CAAER,aAAc,CAAE,CAAC,CAACS,aAAa,CAAC,CAAC,EAC/D,EACD,CAAC;EACD,MAAM;IAAEC;EAAc,CAAC,GAAGT,MAAM,CAAEL,WAAW,CAAEI,aAAc,CAAE,CAAC;EAChE,MAAMW,oBAAoB,GAAGjB,MAAM,CAAEa,UAAW,CAAC;EACjD,MAAM;IAAEK,MAAM,EAAEC;EAAY,CAAC,GAAGP,MAAM;EACtC,MAAMQ,qBAAqB,GAAGpB,MAAM,CAAEmB,WAAY,CAAC;EACnD,MAAME,mBAAmB,GAAGrB,MAAM,CAAEY,MAAO,CAAC;EAC5Cb,SAAS,CAAE,MAAM;IAChBsB,mBAAmB,CAACC,OAAO,GAAGV,MAAM;EACrC,CAAC,EAAE,CAAEA,MAAM,CAAG,CAAC;EAEfb,SAAS,CAAE,MAAM;IAChBkB,oBAAoB,CAACK,OAAO,GAAGT,UAAU;IACzC,IAAKA,UAAU,KAAK,MAAM,EAAG;MAC5B;IACD;IAEA,IACCA,UAAU,KAAK,MAAM,IACrBO,qBAAqB,CAACE,OAAO,KAAKT,UAAU,EAC3C;MACDF,OAAO,CAACY,IAAI,CAAE;QACb,GAAGF,mBAAmB,CAACC,OAAO;QAC9BJ,MAAM,EAAE;MACT,CAAE,CAAC;IACJ;IAEA,IACCL,UAAU,KAAK,MAAM,IACrBO,qBAAqB,CAACE,OAAO,KAAKE,SAAS,EAC1C;MACDb,OAAO,CAACY,IAAI,CAAE;QACb,GAAGF,mBAAmB,CAACC,OAAO;QAC9BJ,MAAM,EAAEM;MACT,CAAE,CAAC;IACJ;EACD,CAAC,EAAE,CAAEX,UAAU,EAAEF,OAAO,CAAG,CAAC;EAE5BZ,SAAS,CAAE,MAAM;IAChBqB,qBAAqB,CAACE,OAAO,GAAGH,WAAW;IAC3C,IACCA,WAAW,KAAK,MAAM,IACtBF,oBAAoB,CAACK,OAAO,KAAK,MAAM,EACtC;MACDN,aAAa,CAAE,MAAO,CAAC;IACxB,CAAC,MAAM,IACNG,WAAW,KAAK,MAAM,IACtBF,oBAAoB,CAACK,OAAO,KAAK,MAAM,EACtC;MACDN,aAAa,CAAE,MAAO,CAAC;IACxB;EACD,CAAC,EAAE,CAAEG,WAAW,EAAEH,aAAa,CAAG,CAAC;AACpC","ignoreList":[]}