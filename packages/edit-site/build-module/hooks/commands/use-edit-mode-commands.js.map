{"version":3,"names":["useSelect","useDispatch","__","sprintf","isRTL","trash","rotateLeft","rotateRight","layout","page","useCommandLoader","decodeEntities","privateApis","routerPrivateApis","store","editorStore","editSiteStore","useEditedEntityRecord","isTemplateRemovable","isTemplateRevertable","unlock","TEMPLATE_POST_TYPE","useLink","useHistory","usePageContentFocusCommands","record","template","isPage","canvasMode","templateId","currentPostType","select","_isPage","getCanvasMode","getCurrentPostType","getCurrentTemplateId","onClick","editTemplate","postType","postId","setRenderingMode","isLoading","commands","push","name","label","title","icon","callback","close","useManipulateDocumentCommands","isLoaded","removeTemplate","revertTemplate","history","isEditingPage","type","useEditModeCommands","hook","context"],"sources":["@wordpress/edit-site/src/hooks/commands/use-edit-mode-commands.js"],"sourcesContent":["/**\r\n * WordPress 依赖\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { __, sprintf, isRTL } from '@wordpress/i18n';\r\nimport { trash, rotateLeft, rotateRight, layout, page } from '@wordpress/icons';\r\nimport { useCommandLoader } from '@wordpress/commands';\r\nimport { decodeEntities } from '@wordpress/html-entities';\r\nimport { privateApis as routerPrivateApis } from '@wordpress/router';\r\nimport { store as editorStore } from '@wordpress/editor';\r\n\r\n/**\r\n * 内部依赖\r\n */\r\nimport { store as editSiteStore } from '../../store';\r\nimport useEditedEntityRecord from '../../components/use-edited-entity-record';\r\nimport isTemplateRemovable from '../../utils/is-template-removable';\r\nimport isTemplateRevertable from '../../utils/is-template-revertable';\r\nimport { unlock } from '../../lock-unlock';\r\nimport { TEMPLATE_POST_TYPE } from '../../utils/constants';\r\nimport { useLink } from '../../components/routes/link';\r\n\r\nconst { useHistory } = unlock( routerPrivateApis );\r\n\r\n/**\r\n * 使用页面内容焦点命令\r\n *\r\n * 该函数用于生成与页面内容焦点相关的命令，主要用于在编辑模式下切换模板和页面。\r\n */\r\nfunction usePageContentFocusCommands() {\r\n\tconst { record: template } = useEditedEntityRecord();\r\n\tconst { isPage, canvasMode, templateId, currentPostType } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { isPage: _isPage, getCanvasMode } = unlock(\r\n\t\t\t\tselect( editSiteStore )\r\n\t\t\t);\r\n\t\t\tconst { getCurrentPostType, getCurrentTemplateId } =\r\n\t\t\t\tselect( editorStore );\r\n\t\t\treturn {\r\n\t\t\t\tisPage: _isPage(),\r\n\t\t\t\tcanvasMode: getCanvasMode(),\r\n\t\t\t\ttemplateId: getCurrentTemplateId(),\r\n\t\t\t\tcurrentPostType: getCurrentPostType(),\r\n\t\t\t};\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\tconst { onClick: editTemplate } = useLink( {\r\n\t\tpostType: 'wp_template',\r\n\t\tpostId: templateId,\r\n\t} );\r\n\r\n\tconst { setRenderingMode } = useDispatch( editorStore );\r\n\r\n\t// 如果不在页面编辑模式下，返回空命令\r\n\tif ( ! isPage || canvasMode !== 'edit' ) {\r\n\t\treturn { isLoading: false, commands: [] };\r\n\t}\r\n\r\n\tconst commands = [];\r\n\r\n\t// 如果当前编辑的不是模板，添加切换到模板编辑的命令\r\n\tif ( currentPostType !== 'wp_template' ) {\r\n\t\tcommands.push( {\r\n\t\t\tname: 'core/switch-to-template-focus',\r\n\t\t\tlabel: sprintf(\r\n\t\t\t\t/* translators: %s: template title */\r\n\t\t\t\t__( 'Edit template: %s' ),\r\n\t\t\t\tdecodeEntities( template.title )\r\n\t\t\t),\r\n\t\t\ticon: layout,\r\n\t\t\tcallback: ( { close } ) => {\r\n\t\t\t\teditTemplate();\r\n\t\t\t\tclose();\r\n\t\t\t},\r\n\t\t} );\r\n\t} else {\r\n\t\t// 如果当前编辑的是模板，添加切换回页面编辑的命令\r\n\t\tcommands.push( {\r\n\t\t\tname: 'core/switch-to-page-focus',\r\n\t\t\tlabel: __( 'Back to page' ),\r\n\t\t\ticon: page,\r\n\t\t\tcallback: ( { close } ) => {\r\n\t\t\t\tsetRenderingMode( 'template-locked' );\r\n\t\t\t\tclose();\r\n\t\t\t},\r\n\t\t} );\r\n\t}\r\n\r\n\treturn { isLoading: false, commands };\r\n}\r\n\r\n/**\r\n * 使用文档操作命令\r\n *\r\n * 该函数用于生成与文档操作相关的命令，主要用于重置和删除模板。\r\n */\r\nfunction useManipulateDocumentCommands() {\r\n\tconst { isLoaded, record: template } = useEditedEntityRecord();\r\n\tconst { removeTemplate, revertTemplate } = useDispatch( editSiteStore );\r\n\tconst history = useHistory();\r\n\tconst isEditingPage = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( editSiteStore ).isPage() &&\r\n\t\t\tselect( editorStore ).getCurrentPostType() !== 'wp_template',\r\n\t\t[]\r\n\t);\r\n\r\n\t// 如果模板未加载，返回空命令\r\n\tif ( ! isLoaded ) {\r\n\t\treturn { isLoading: true, commands: [] };\r\n\t}\r\n\r\n\tconst commands = [];\r\n\r\n\t// 如果模板可重置且不在页面编辑模式下，添加重置模板的命令\r\n\tif ( isTemplateRevertable( template ) && ! isEditingPage ) {\r\n\t\tconst label =\r\n\t\t\ttemplate.type === TEMPLATE_POST_TYPE\r\n\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t/* translators: %s: template title */\r\n\t\t\t\t\t\t__( 'Reset template: %s' ),\r\n\t\t\t\t\t\tdecodeEntities( template.title )\r\n\t\t\t\t  )\r\n\t\t\t\t: sprintf(\r\n\t\t\t\t\t\t/* translators: %s: template part title */\r\n\t\t\t\t\t\t__( 'Reset template part: %s' ),\r\n\t\t\t\t\t\tdecodeEntities( template.title )\r\n\t\t\t\t  );\r\n\t\tcommands.push( {\r\n\t\t\tname: 'core/reset-template',\r\n\t\t\tlabel,\r\n\t\t\ticon: isRTL() ? rotateRight : rotateLeft,\r\n\t\t\tcallback: ( { close } ) => {\r\n\t\t\t\trevertTemplate( template );\r\n\t\t\t\tclose();\r\n\t\t\t},\r\n\t\t} );\r\n\t}\r\n\r\n\t// 如果模板可删除且不在页面编辑模式下，添加删除模板的命令\r\n\tif ( isTemplateRemovable( template ) && ! isEditingPage ) {\r\n\t\tconst label =\r\n\t\t\ttemplate.type === TEMPLATE_POST_TYPE\r\n\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t/* translators: %s: template title */\r\n\t\t\t\t\t\t__( 'Delete template: %s' ),\r\n\t\t\t\t\t\tdecodeEntities( template.title )\r\n\t\t\t\t  )\r\n\t\t\t\t: sprintf(\r\n\t\t\t\t\t\t/* translators: %s: template part title */\r\n\t\t\t\t\t\t__( 'Delete template part: %s' ),\r\n\t\t\t\t\t\tdecodeEntities( template.title )\r\n\t\t\t\t  );\r\n\t\tcommands.push( {\r\n\t\t\tname: 'core/remove-template',\r\n\t\t\tlabel,\r\n\t\t\ticon: trash,\r\n\t\t\tcallback: ( { close } ) => {\r\n\t\t\t\tremoveTemplate( template );\r\n\t\t\t\t// 导航到模板列表\r\n\t\t\t\thistory.push( {\r\n\t\t\t\t\tpostType: template.type,\r\n\t\t\t\t} );\r\n\t\t\t\tclose();\r\n\t\t\t},\r\n\t\t} );\r\n\t}\r\n\r\n\treturn {\r\n\t\tisLoading: ! isLoaded,\r\n\t\tcommands,\r\n\t};\r\n}\r\n\r\n/**\r\n * 使用编辑模式命令\r\n *\r\n * 该函数用于注册编辑模式下的命令加载器。\r\n */\r\nexport function useEditModeCommands() {\r\n\tuseCommandLoader( {\r\n\t\tname: 'core/edit-site/page-content-focus',\r\n\t\thook: usePageContentFocusCommands,\r\n\t\tcontext: 'entity-edit',\r\n\t} );\r\n\r\n\tuseCommandLoader( {\r\n\t\tname: 'core/edit-site/manipulate-document',\r\n\t\thook: useManipulateDocumentCommands,\r\n\t} );\r\n}\r\n"],"mappings":"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","ignoreList":[]}