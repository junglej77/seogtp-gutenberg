{"version":3,"names":["useEffect","useState","useCallback","useRef","useSelect","useDispatch","EntityProvider","__unstableDisclosureContent","DisclosureContent","Panel","PanelBody","WidgetAreaInnerBlocks","store","editWidgetsStore","useIsDraggingWithin","jsx","_jsx","WidgetAreaEdit","clientId","className","attributes","id","name","isOpen","select","getIsWidgetAreaOpen","setIsWidgetAreaOpen","wrapper","setOpen","openState","isDragging","useIsDragging","isDraggingWithin","openedWhileDragging","setOpenedWhileDragging","ref","children","title","opened","onToggle","scrollAfterOpen","visible","kind","type","elementRef","setIsDragging","ownerDocument","current","handleDragStart","handleDragEnd","addEventListener","removeEventListener"],"sources":["@wordpress/edit-widgets/src/blocks/widget-area/edit/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useEffect, useState, useCallback, useRef } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { EntityProvider } from '@wordpress/core-data';\r\nimport {\r\n\t__unstableDisclosureContent as DisclosureContent,\r\n\tPanel,\r\n\tPanelBody,\r\n} from '@wordpress/components';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport WidgetAreaInnerBlocks from './inner-blocks';\r\nimport { store as editWidgetsStore } from '../../../store';\r\nimport useIsDraggingWithin from './use-is-dragging-within';\r\n\r\n/** @typedef {import('@wordpress/element').RefObject} RefObject */\r\n\r\nexport default function WidgetAreaEdit( {\r\n\tclientId,\r\n\tclassName,\r\n\tattributes: { id, name },\r\n} ) {\r\n\tconst isOpen = useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( editWidgetsStore ).getIsWidgetAreaOpen( clientId ),\r\n\t\t[ clientId ]\r\n\t);\r\n\tconst { setIsWidgetAreaOpen } = useDispatch( editWidgetsStore );\r\n\r\n\tconst wrapper = useRef();\r\n\tconst setOpen = useCallback(\r\n\t\t( openState ) => setIsWidgetAreaOpen( clientId, openState ),\r\n\t\t[ clientId ]\r\n\t);\r\n\tconst isDragging = useIsDragging( wrapper );\r\n\tconst isDraggingWithin = useIsDraggingWithin( wrapper );\r\n\r\n\tconst [ openedWhileDragging, setOpenedWhileDragging ] = useState( false );\r\n\tuseEffect( () => {\r\n\t\tif ( ! isDragging ) {\r\n\t\t\tsetOpenedWhileDragging( false );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( isDraggingWithin && ! isOpen ) {\r\n\t\t\tsetOpen( true );\r\n\t\t\tsetOpenedWhileDragging( true );\r\n\t\t} else if ( ! isDraggingWithin && isOpen && openedWhileDragging ) {\r\n\t\t\tsetOpen( false );\r\n\t\t}\r\n\t}, [ isOpen, isDragging, isDraggingWithin, openedWhileDragging ] );\r\n\r\n\treturn (\r\n\t\t<Panel className={ className } ref={ wrapper }>\r\n\t\t\t<PanelBody\r\n\t\t\t\ttitle={ name }\r\n\t\t\t\topened={ isOpen }\r\n\t\t\t\tonToggle={ () => {\r\n\t\t\t\t\tsetIsWidgetAreaOpen( clientId, ! isOpen );\r\n\t\t\t\t} }\r\n\t\t\t\tscrollAfterOpen={ ! isDragging }\r\n\t\t\t>\r\n\t\t\t\t{ ( { opened } ) => (\r\n\t\t\t\t\t// This is required to ensure LegacyWidget blocks are not\r\n\t\t\t\t\t// unmounted when the panel is collapsed. Unmounting legacy\r\n\t\t\t\t\t// widgets may have unintended consequences (e.g.  TinyMCE\r\n\t\t\t\t\t// not being properly reinitialized)\r\n\t\t\t\t\t<DisclosureContent\r\n\t\t\t\t\t\tclassName=\"wp-block-widget-area__panel-body-content\"\r\n\t\t\t\t\t\tvisible={ opened }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<EntityProvider\r\n\t\t\t\t\t\t\tkind=\"root\"\r\n\t\t\t\t\t\t\ttype=\"postType\"\r\n\t\t\t\t\t\t\tid={ `widget-area-${ id }` }\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<WidgetAreaInnerBlocks id={ id } />\r\n\t\t\t\t\t\t</EntityProvider>\r\n\t\t\t\t\t</DisclosureContent>\r\n\t\t\t\t) }\r\n\t\t\t</PanelBody>\r\n\t\t</Panel>\r\n\t);\r\n}\r\n\r\n/**\r\n * A React hook to determine if dragging is active.\r\n *\r\n * @param {RefObject<HTMLElement>} elementRef The target elementRef object.\r\n *\r\n * @return {boolean} Is dragging within the entire document.\r\n */\r\nconst useIsDragging = ( elementRef ) => {\r\n\tconst [ isDragging, setIsDragging ] = useState( false );\r\n\r\n\tuseEffect( () => {\r\n\t\tconst { ownerDocument } = elementRef.current;\r\n\r\n\t\tfunction handleDragStart() {\r\n\t\t\tsetIsDragging( true );\r\n\t\t}\r\n\r\n\t\tfunction handleDragEnd() {\r\n\t\t\tsetIsDragging( false );\r\n\t\t}\r\n\r\n\t\townerDocument.addEventListener( 'dragstart', handleDragStart );\r\n\t\townerDocument.addEventListener( 'dragend', handleDragEnd );\r\n\r\n\t\treturn () => {\r\n\t\t\townerDocument.removeEventListener( 'dragstart', handleDragStart );\r\n\t\t\townerDocument.removeEventListener( 'dragend', handleDragEnd );\r\n\t\t};\r\n\t}, [] );\r\n\r\n\treturn isDragging;\r\n};\r\n"],"mappings":"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","ignoreList":[]}