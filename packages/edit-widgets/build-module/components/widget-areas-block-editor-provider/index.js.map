{"version":3,"names":["SlotFillProvider","useViewportMatch","uploadMedia","useDispatch","useSelect","useEntityBlockEditor","store","coreStore","useMemo","privateApis","blockEditorPrivateApis","editPatternsPrivateApis","preferencesStore","blockLibraryPrivateApis","KeyboardShortcuts","buildWidgetAreasPostId","KIND","POST_TYPE","useLastSelectedWidgetArea","editWidgetsStore","ALLOW_REUSABLE_BLOCKS","unlock","jsx","_jsx","jsxs","_jsxs","ExperimentalBlockEditorProvider","PatternsMenuItems","BlockKeyboardShortcuts","EMPTY_ARRAY","WidgetAreasBlockEditorProvider","blockEditorSettings","children","props","isLargeViewport","hasUploadPermissions","reusableBlocks","isFixedToolbarActive","keepCaretInsideBlock","pageOnFront","pageForPosts","select","_canUser","canUser","getEntityRecord","getEntityRecords","siteSettings","kind","name","undefined","get","page_on_front","page_for_posts","setIsInserterOpened","settings","mediaUploadBlockEditor","onError","argumentsObject","wpAllowedMimeTypes","allowedMimeTypes","message","__experimentalReusableBlocks","hasFixedToolbar","mediaUpload","templateLock","__experimentalSetIsInserterOpened","widgetAreaId","blocks","onInput","onChange","id","Register","value","useSubRegistry","rootClientId"],"sources":["@wordpress/edit-widgets/src/components/widget-areas-block-editor-provider/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { SlotFillProvider } from '@wordpress/components';\r\nimport { useViewportMatch } from '@wordpress/compose';\r\nimport { uploadMedia } from '@wordpress/media-utils';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { useEntityBlockEditor, store as coreStore } from '@wordpress/core-data';\r\nimport { useMemo } from '@wordpress/element';\r\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/block-editor';\r\nimport { privateApis as editPatternsPrivateApis } from '@wordpress/patterns';\r\nimport { store as preferencesStore } from '@wordpress/preferences';\r\nimport { privateApis as blockLibraryPrivateApis } from '@wordpress/block-library';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport KeyboardShortcuts from '../keyboard-shortcuts';\r\nimport { buildWidgetAreasPostId, KIND, POST_TYPE } from '../../store/utils';\r\nimport useLastSelectedWidgetArea from '../../hooks/use-last-selected-widget-area';\r\nimport { store as editWidgetsStore } from '../../store';\r\nimport { ALLOW_REUSABLE_BLOCKS } from '../../constants';\r\nimport { unlock } from '../../lock-unlock';\r\n\r\nconst { ExperimentalBlockEditorProvider } = unlock( blockEditorPrivateApis );\r\nconst { PatternsMenuItems } = unlock( editPatternsPrivateApis );\r\nconst { BlockKeyboardShortcuts } = unlock( blockLibraryPrivateApis );\r\n\r\nconst EMPTY_ARRAY = [];\r\n\r\nexport default function WidgetAreasBlockEditorProvider( {\r\n\tblockEditorSettings,\r\n\tchildren,\r\n\t...props\r\n} ) {\r\n\tconst isLargeViewport = useViewportMatch( 'medium' );\r\n\tconst {\r\n\t\thasUploadPermissions,\r\n\t\treusableBlocks,\r\n\t\tisFixedToolbarActive,\r\n\t\tkeepCaretInsideBlock,\r\n\t\tpageOnFront,\r\n\t\tpageForPosts,\r\n\t} = useSelect( ( select ) => {\r\n\t\tconst { canUser, getEntityRecord, getEntityRecords } =\r\n\t\t\tselect( coreStore );\r\n\t\tconst siteSettings = canUser( 'read', {\r\n\t\t\tkind: 'root',\r\n\t\t\tname: 'site',\r\n\t\t} )\r\n\t\t\t? getEntityRecord( 'root', 'site' )\r\n\t\t\t: undefined;\r\n\t\treturn {\r\n\t\t\thasUploadPermissions:\r\n\t\t\t\tcanUser( 'create', {\r\n\t\t\t\t\tkind: 'root',\r\n\t\t\t\t\tname: 'media',\r\n\t\t\t\t} ) ?? true,\r\n\t\t\treusableBlocks: ALLOW_REUSABLE_BLOCKS\r\n\t\t\t\t? getEntityRecords( 'postType', 'wp_block' )\r\n\t\t\t\t: EMPTY_ARRAY,\r\n\t\t\tisFixedToolbarActive: !! select( preferencesStore ).get(\r\n\t\t\t\t'core/edit-widgets',\r\n\t\t\t\t'fixedToolbar'\r\n\t\t\t),\r\n\t\t\tkeepCaretInsideBlock: !! select( preferencesStore ).get(\r\n\t\t\t\t'core/edit-widgets',\r\n\t\t\t\t'keepCaretInsideBlock'\r\n\t\t\t),\r\n\t\t\tpageOnFront: siteSettings?.page_on_front,\r\n\t\t\tpageForPosts: siteSettings?.page_for_posts,\r\n\t\t};\r\n\t}, [] );\r\n\tconst { setIsInserterOpened } = useDispatch( editWidgetsStore );\r\n\r\n\tconst settings = useMemo( () => {\r\n\t\tlet mediaUploadBlockEditor;\r\n\t\tif ( hasUploadPermissions ) {\r\n\t\t\tmediaUploadBlockEditor = ( { onError, ...argumentsObject } ) => {\r\n\t\t\t\tuploadMedia( {\r\n\t\t\t\t\twpAllowedMimeTypes: blockEditorSettings.allowedMimeTypes,\r\n\t\t\t\t\tonError: ( { message } ) => onError( message ),\r\n\t\t\t\t\t...argumentsObject,\r\n\t\t\t\t} );\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn {\r\n\t\t\t...blockEditorSettings,\r\n\t\t\t__experimentalReusableBlocks: reusableBlocks,\r\n\t\t\thasFixedToolbar: isFixedToolbarActive || ! isLargeViewport,\r\n\t\t\tkeepCaretInsideBlock,\r\n\t\t\tmediaUpload: mediaUploadBlockEditor,\r\n\t\t\ttemplateLock: 'all',\r\n\t\t\t__experimentalSetIsInserterOpened: setIsInserterOpened,\r\n\t\t\tpageOnFront,\r\n\t\t\tpageForPosts,\r\n\t\t};\r\n\t}, [\r\n\t\thasUploadPermissions,\r\n\t\tblockEditorSettings,\r\n\t\tisFixedToolbarActive,\r\n\t\tisLargeViewport,\r\n\t\tkeepCaretInsideBlock,\r\n\t\treusableBlocks,\r\n\t\tsetIsInserterOpened,\r\n\t\tpageOnFront,\r\n\t\tpageForPosts,\r\n\t] );\r\n\r\n\tconst widgetAreaId = useLastSelectedWidgetArea();\r\n\r\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\r\n\t\tKIND,\r\n\t\tPOST_TYPE,\r\n\t\t{ id: buildWidgetAreasPostId() }\r\n\t);\r\n\r\n\treturn (\r\n\t\t<SlotFillProvider>\r\n\t\t\t<KeyboardShortcuts.Register />\r\n\t\t\t<BlockKeyboardShortcuts />\r\n\t\t\t<ExperimentalBlockEditorProvider\r\n\t\t\t\tvalue={ blocks }\r\n\t\t\t\tonInput={ onInput }\r\n\t\t\t\tonChange={ onChange }\r\n\t\t\t\tsettings={ settings }\r\n\t\t\t\tuseSubRegistry={ false }\r\n\t\t\t\t{ ...props }\r\n\t\t\t>\r\n\t\t\t\t{ children }\r\n\t\t\t\t<PatternsMenuItems rootClientId={ widgetAreaId } />\r\n\t\t\t</ExperimentalBlockEditorProvider>\r\n\t\t</SlotFillProvider>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}