{"version":3,"names":["createBlock","parse","serialize","addWidgetIdToBlock","transformWidgetToBlock","widget","id_base","parsedBlocks","instance","raw","content","__unstableSkipAutop","length","id","attributes","_embedded","about","is_multi","idBase","transformBlockToWidget","block","relatedWidget","isValidLegacyWidgetBlock","name","_block$attributes$id","_block$attributes$idB","_block$attributes$ins","rendered","rendered_form"],"sources":["@wordpress/edit-widgets/src/store/transformers.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { createBlock, parse, serialize } from '@wordpress/blocks';\r\nimport { addWidgetIdToBlock } from '@wordpress/widgets';\r\n\r\n/**\r\n * Converts a widget entity record into a block.\r\n *\r\n * @param {Object} widget The widget entity record.\r\n * @return {Object} a block (converted from the entity record).\r\n */\r\nexport function transformWidgetToBlock( widget ) {\r\n\tif ( widget.id_base === 'block' ) {\r\n\t\tconst parsedBlocks = parse( widget.instance.raw.content, {\r\n\t\t\t__unstableSkipAutop: true,\r\n\t\t} );\r\n\t\tif ( ! parsedBlocks.length ) {\r\n\t\t\treturn addWidgetIdToBlock(\r\n\t\t\t\tcreateBlock( 'core/paragraph', {}, [] ),\r\n\t\t\t\twidget.id\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn addWidgetIdToBlock( parsedBlocks[ 0 ], widget.id );\r\n\t}\r\n\r\n\tlet attributes;\r\n\tif ( widget._embedded.about[ 0 ].is_multi ) {\r\n\t\tattributes = {\r\n\t\t\tidBase: widget.id_base,\r\n\t\t\tinstance: widget.instance,\r\n\t\t};\r\n\t} else {\r\n\t\tattributes = {\r\n\t\t\tid: widget.id,\r\n\t\t};\r\n\t}\r\n\r\n\treturn addWidgetIdToBlock(\r\n\t\tcreateBlock( 'core/legacy-widget', attributes, [] ),\r\n\t\twidget.id\r\n\t);\r\n}\r\n\r\n/**\r\n * Converts a block to a widget entity record.\r\n *\r\n * @param {Object}  block         The block.\r\n * @param {Object?} relatedWidget A related widget entity record from the API (optional).\r\n * @return {Object} the widget object (converted from block).\r\n */\r\nexport function transformBlockToWidget( block, relatedWidget = {} ) {\r\n\tlet widget;\r\n\r\n\tconst isValidLegacyWidgetBlock =\r\n\t\tblock.name === 'core/legacy-widget' &&\r\n\t\t( block.attributes.id || block.attributes.instance );\r\n\r\n\tif ( isValidLegacyWidgetBlock ) {\r\n\t\twidget = {\r\n\t\t\t...relatedWidget,\r\n\t\t\tid: block.attributes.id ?? relatedWidget.id,\r\n\t\t\tid_base: block.attributes.idBase ?? relatedWidget.id_base,\r\n\t\t\tinstance: block.attributes.instance ?? relatedWidget.instance,\r\n\t\t};\r\n\t} else {\r\n\t\twidget = {\r\n\t\t\t...relatedWidget,\r\n\t\t\tid_base: 'block',\r\n\t\t\tinstance: {\r\n\t\t\t\traw: {\r\n\t\t\t\t\tcontent: serialize( block ),\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\t// Delete read-only properties.\r\n\tdelete widget.rendered;\r\n\tdelete widget.rendered_form;\r\n\r\n\treturn widget;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,WAAW,EAAEC,KAAK,EAAEC,SAAS,QAAQ,mBAAmB;AACjE,SAASC,kBAAkB,QAAQ,oBAAoB;;AAEvD;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,sBAAsBA,CAAEC,MAAM,EAAG;EAChD,IAAKA,MAAM,CAACC,OAAO,KAAK,OAAO,EAAG;IACjC,MAAMC,YAAY,GAAGN,KAAK,CAAEI,MAAM,CAACG,QAAQ,CAACC,GAAG,CAACC,OAAO,EAAE;MACxDC,mBAAmB,EAAE;IACtB,CAAE,CAAC;IACH,IAAK,CAAEJ,YAAY,CAACK,MAAM,EAAG;MAC5B,OAAOT,kBAAkB,CACxBH,WAAW,CAAE,gBAAgB,EAAE,CAAC,CAAC,EAAE,EAAG,CAAC,EACvCK,MAAM,CAACQ,EACR,CAAC;IACF;IACA,OAAOV,kBAAkB,CAAEI,YAAY,CAAE,CAAC,CAAE,EAAEF,MAAM,CAACQ,EAAG,CAAC;EAC1D;EAEA,IAAIC,UAAU;EACd,IAAKT,MAAM,CAACU,SAAS,CAACC,KAAK,CAAE,CAAC,CAAE,CAACC,QAAQ,EAAG;IAC3CH,UAAU,GAAG;MACZI,MAAM,EAAEb,MAAM,CAACC,OAAO;MACtBE,QAAQ,EAAEH,MAAM,CAACG;IAClB,CAAC;EACF,CAAC,MAAM;IACNM,UAAU,GAAG;MACZD,EAAE,EAAER,MAAM,CAACQ;IACZ,CAAC;EACF;EAEA,OAAOV,kBAAkB,CACxBH,WAAW,CAAE,oBAAoB,EAAEc,UAAU,EAAE,EAAG,CAAC,EACnDT,MAAM,CAACQ,EACR,CAAC;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASM,sBAAsBA,CAAEC,KAAK,EAAEC,aAAa,GAAG,CAAC,CAAC,EAAG;EACnE,IAAIhB,MAAM;EAEV,MAAMiB,wBAAwB,GAC7BF,KAAK,CAACG,IAAI,KAAK,oBAAoB,KACjCH,KAAK,CAACN,UAAU,CAACD,EAAE,IAAIO,KAAK,CAACN,UAAU,CAACN,QAAQ,CAAE;EAErD,IAAKc,wBAAwB,EAAG;IAAA,IAAAE,oBAAA,EAAAC,qBAAA,EAAAC,qBAAA;IAC/BrB,MAAM,GAAG;MACR,GAAGgB,aAAa;MAChBR,EAAE,GAAAW,oBAAA,GAAEJ,KAAK,CAACN,UAAU,CAACD,EAAE,cAAAW,oBAAA,cAAAA,oBAAA,GAAIH,aAAa,CAACR,EAAE;MAC3CP,OAAO,GAAAmB,qBAAA,GAAEL,KAAK,CAACN,UAAU,CAACI,MAAM,cAAAO,qBAAA,cAAAA,qBAAA,GAAIJ,aAAa,CAACf,OAAO;MACzDE,QAAQ,GAAAkB,qBAAA,GAAEN,KAAK,CAACN,UAAU,CAACN,QAAQ,cAAAkB,qBAAA,cAAAA,qBAAA,GAAIL,aAAa,CAACb;IACtD,CAAC;EACF,CAAC,MAAM;IACNH,MAAM,GAAG;MACR,GAAGgB,aAAa;MAChBf,OAAO,EAAE,OAAO;MAChBE,QAAQ,EAAE;QACTC,GAAG,EAAE;UACJC,OAAO,EAAER,SAAS,CAAEkB,KAAM;QAC3B;MACD;IACD,CAAC;EACF;;EAEA;EACA,OAAOf,MAAM,CAACsB,QAAQ;EACtB,OAAOtB,MAAM,CAACuB,aAAa;EAE3B,OAAOvB,MAAM;AACd","ignoreList":[]}