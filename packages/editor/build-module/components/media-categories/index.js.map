{"version":3,"names":["__","sprintf","_x","resolveSelect","decodeEntities","store","coreStore","getExternalLink","url","text","getExternalLinkAttributes","getOpenverseLicense","license","licenseVersion","licenseName","trim","toUpperCase","replace","includes","getOpenverseCaption","item","title","foreign_landing_url","foreignLandingUrl","creator","creator_url","creatorUrl","license_version","license_url","licenseUrl","fullLicense","_creator","_caption","coreMediaFetch","query","mediaItems","getMediaItems","orderBy","search","map","mediaItem","alt","alt_text","source_url","previewUrl","media_details","sizes","medium","caption","raw","inserterMediaCategories","name","labels","search_items","mediaType","fetch","media_type","defaultArgs","mature","excluded_source","finalQuery","mapFromInserterMediaRequest","per_page","URL","Object","entries","forEach","key","value","queryKey","searchParams","set","response","window","headers","jsonResponse","json","results","result","toLowerCase","startsWith","slice","sourceId","id","undefined","thumbnail","getReportUrl","isExternalResource"],"sources":["@wordpress/editor/src/components/media-categories/index.js"],"sourcesContent":["/**\r\n * The `editor` settings here need to be in sync with the corresponding ones in `editor` package.\r\n * See `packages/editor/src/components/media-categories/index.js`.\r\n *\r\n * In the future we could consider creating an Openvese package that can be used in both `editor` and `site-editor`.\r\n * The rest of the settings would still need to be in sync though.\r\n */\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { __, sprintf, _x } from '@wordpress/i18n';\r\nimport { resolveSelect } from '@wordpress/data';\r\nimport { decodeEntities } from '@wordpress/html-entities';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/** @typedef {import('@wordpress/block-editor').InserterMediaRequest} InserterMediaRequest */\r\n/** @typedef {import('@wordpress/block-editor').InserterMediaItem} InserterMediaItem */\r\n/** @typedef {import('@wordpress/block-editor').InserterMediaCategory} InserterMediaCategory */\r\n\r\nconst getExternalLink = ( url, text ) =>\r\n\t`<a ${ getExternalLinkAttributes( url ) }>${ text }</a>`;\r\n\r\nconst getExternalLinkAttributes = ( url ) =>\r\n\t`href=\"${ url }\" target=\"_blank\" rel=\"noreferrer noopener\"`;\r\n\r\nconst getOpenverseLicense = ( license, licenseVersion ) => {\r\n\tlet licenseName = license.trim();\r\n\t// PDM has no abbreviation\r\n\tif ( license !== 'pdm' ) {\r\n\t\tlicenseName = license.toUpperCase().replace( 'SAMPLING', 'Sampling' );\r\n\t}\r\n\t// If version is known, append version to the name.\r\n\t// The license has to have a version to be valid. Only\r\n\t// PDM (public domain mark) doesn't have a version.\r\n\tif ( licenseVersion ) {\r\n\t\tlicenseName += ` ${ licenseVersion }`;\r\n\t}\r\n\t// For licenses other than public-domain marks, prepend 'CC' to the name.\r\n\tif ( ! [ 'pdm', 'cc0' ].includes( license ) ) {\r\n\t\tlicenseName = `CC ${ licenseName }`;\r\n\t}\r\n\treturn licenseName;\r\n};\r\n\r\nconst getOpenverseCaption = ( item ) => {\r\n\tconst {\r\n\t\ttitle,\r\n\t\tforeign_landing_url: foreignLandingUrl,\r\n\t\tcreator,\r\n\t\tcreator_url: creatorUrl,\r\n\t\tlicense,\r\n\t\tlicense_version: licenseVersion,\r\n\t\tlicense_url: licenseUrl,\r\n\t} = item;\r\n\tconst fullLicense = getOpenverseLicense( license, licenseVersion );\r\n\tconst _creator = decodeEntities( creator );\r\n\tlet _caption;\r\n\tif ( _creator ) {\r\n\t\t_caption = title\r\n\t\t\t? sprintf(\r\n\t\t\t\t\t// translators: %1s: Title of a media work from Openverse; %2s: Name of the work's creator; %3s: Work's licence e.g: \"CC0 1.0\".\r\n\t\t\t\t\t_x( '\"%1$s\" by %2$s/ %3$s', 'caption' ),\r\n\t\t\t\t\tgetExternalLink(\r\n\t\t\t\t\t\tforeignLandingUrl,\r\n\t\t\t\t\t\tdecodeEntities( title )\r\n\t\t\t\t\t),\r\n\t\t\t\t\tcreatorUrl\r\n\t\t\t\t\t\t? getExternalLink( creatorUrl, _creator )\r\n\t\t\t\t\t\t: _creator,\r\n\t\t\t\t\tlicenseUrl\r\n\t\t\t\t\t\t? getExternalLink(\r\n\t\t\t\t\t\t\t\t`${ licenseUrl }?ref=openverse`,\r\n\t\t\t\t\t\t\t\tfullLicense\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: fullLicense\r\n\t\t\t  )\r\n\t\t\t: sprintf(\r\n\t\t\t\t\t// translators: %1s: Link attributes for a given Openverse media work; %2s: Name of the work's creator; %3s: Works's licence e.g: \"CC0 1.0\".\r\n\t\t\t\t\t_x( '<a %1$s>Work</a> by %2$s/ %3$s', 'caption' ),\r\n\t\t\t\t\tgetExternalLinkAttributes( foreignLandingUrl ),\r\n\t\t\t\t\tcreatorUrl\r\n\t\t\t\t\t\t? getExternalLink( creatorUrl, _creator )\r\n\t\t\t\t\t\t: _creator,\r\n\t\t\t\t\tlicenseUrl\r\n\t\t\t\t\t\t? getExternalLink(\r\n\t\t\t\t\t\t\t\t`${ licenseUrl }?ref=openverse`,\r\n\t\t\t\t\t\t\t\tfullLicense\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: fullLicense\r\n\t\t\t  );\r\n\t} else {\r\n\t\t_caption = title\r\n\t\t\t? sprintf(\r\n\t\t\t\t\t// translators: %1s: Title of a media work from Openverse; %2s: Work's licence e.g: \"CC0 1.0\".\r\n\t\t\t\t\t_x( '\"%1$s\"/ %2$s', 'caption' ),\r\n\t\t\t\t\tgetExternalLink(\r\n\t\t\t\t\t\tforeignLandingUrl,\r\n\t\t\t\t\t\tdecodeEntities( title )\r\n\t\t\t\t\t),\r\n\t\t\t\t\tlicenseUrl\r\n\t\t\t\t\t\t? getExternalLink(\r\n\t\t\t\t\t\t\t\t`${ licenseUrl }?ref=openverse`,\r\n\t\t\t\t\t\t\t\tfullLicense\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: fullLicense\r\n\t\t\t  )\r\n\t\t\t: sprintf(\r\n\t\t\t\t\t// translators: %1s: Link attributes for a given Openverse media work; %2s: Works's licence e.g: \"CC0 1.0\".\r\n\t\t\t\t\t_x( '<a %1$s>Work</a>/ %2$s', 'caption' ),\r\n\t\t\t\t\tgetExternalLinkAttributes( foreignLandingUrl ),\r\n\t\t\t\t\tlicenseUrl\r\n\t\t\t\t\t\t? getExternalLink(\r\n\t\t\t\t\t\t\t\t`${ licenseUrl }?ref=openverse`,\r\n\t\t\t\t\t\t\t\tfullLicense\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: fullLicense\r\n\t\t\t  );\r\n\t}\r\n\treturn _caption.replace( /\\s{2}/g, ' ' );\r\n};\r\n\r\nconst coreMediaFetch = async ( query = {} ) => {\r\n\tconst mediaItems = await resolveSelect( coreStore ).getMediaItems( {\r\n\t\t...query,\r\n\t\torderBy: !! query?.search ? 'relevance' : 'date',\r\n\t} );\r\n\treturn mediaItems.map( ( mediaItem ) => ( {\r\n\t\t...mediaItem,\r\n\t\talt: mediaItem.alt_text,\r\n\t\turl: mediaItem.source_url,\r\n\t\tpreviewUrl: mediaItem.media_details?.sizes?.medium?.source_url,\r\n\t\tcaption: mediaItem.caption?.raw,\r\n\t} ) );\r\n};\r\n\r\n/** @type {InserterMediaCategory[]} */\r\nconst inserterMediaCategories = [\r\n\t{\r\n\t\tname: 'images',\r\n\t\tlabels: {\r\n\t\t\tname: __( 'Images' ),\r\n\t\t\tsearch_items: __( 'Search images' ),\r\n\t\t},\r\n\t\tmediaType: 'image',\r\n\t\tasync fetch( query = {} ) {\r\n\t\t\treturn coreMediaFetch( { ...query, media_type: 'image' } );\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tname: 'videos',\r\n\t\tlabels: {\r\n\t\t\tname: __( 'Videos' ),\r\n\t\t\tsearch_items: __( 'Search videos' ),\r\n\t\t},\r\n\t\tmediaType: 'video',\r\n\t\tasync fetch( query = {} ) {\r\n\t\t\treturn coreMediaFetch( { ...query, media_type: 'video' } );\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tname: 'audio',\r\n\t\tlabels: {\r\n\t\t\tname: __( 'Audio' ),\r\n\t\t\tsearch_items: __( 'Search audio' ),\r\n\t\t},\r\n\t\tmediaType: 'audio',\r\n\t\tasync fetch( query = {} ) {\r\n\t\t\treturn coreMediaFetch( { ...query, media_type: 'audio' } );\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tname: 'openverse',\r\n\t\tlabels: {\r\n\t\t\tname: __( 'Openverse' ),\r\n\t\t\tsearch_items: __( 'Search Openverse' ),\r\n\t\t},\r\n\t\tmediaType: 'image',\r\n\t\tasync fetch( query = {} ) {\r\n\t\t\tconst defaultArgs = {\r\n\t\t\t\tmature: false,\r\n\t\t\t\texcluded_source: 'flickr,inaturalist,wikimedia',\r\n\t\t\t\tlicense: 'pdm,cc0',\r\n\t\t\t};\r\n\t\t\tconst finalQuery = { ...query, ...defaultArgs };\r\n\t\t\tconst mapFromInserterMediaRequest = {\r\n\t\t\t\tper_page: 'page_size',\r\n\t\t\t\tsearch: 'q',\r\n\t\t\t};\r\n\t\t\tconst url = new URL( 'https://api.openverse.org/v1/images/' );\r\n\t\t\tObject.entries( finalQuery ).forEach( ( [ key, value ] ) => {\r\n\t\t\t\tconst queryKey = mapFromInserterMediaRequest[ key ] || key;\r\n\t\t\t\turl.searchParams.set( queryKey, value );\r\n\t\t\t} );\r\n\t\t\tconst response = await window.fetch( url, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'User-Agent': 'WordPress/inserter-media-fetch',\r\n\t\t\t\t},\r\n\t\t\t} );\r\n\t\t\tconst jsonResponse = await response.json();\r\n\t\t\tconst results = jsonResponse.results;\r\n\t\t\treturn results.map( ( result ) => ( {\r\n\t\t\t\t...result,\r\n\t\t\t\t// This is a temp solution for better titles, until Openverse API\r\n\t\t\t\t// completes the cleaning up of some titles of their upstream data.\r\n\t\t\t\ttitle: result.title?.toLowerCase().startsWith( 'file:' )\r\n\t\t\t\t\t? result.title.slice( 5 )\r\n\t\t\t\t\t: result.title,\r\n\t\t\t\tsourceId: result.id,\r\n\t\t\t\tid: undefined,\r\n\t\t\t\tcaption: getOpenverseCaption( result ),\r\n\t\t\t\tpreviewUrl: result.thumbnail,\r\n\t\t\t} ) );\r\n\t\t},\r\n\t\tgetReportUrl: ( { sourceId } ) =>\r\n\t\t\t`https://wordpress.org/openverse/image/${ sourceId }/report/`,\r\n\t\tisExternalResource: true,\r\n\t},\r\n];\r\n\r\nexport default inserterMediaCategories;\r\n"],"mappings":"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","ignoreList":[]}