{"version":3,"names":["renderToString","Button","Path","SVG","VisuallyHidden","__","_x","useSelect","useDispatch","applyFilters","store","coreStore","editorStore","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","writeInterstitialMessage","targetDocument","markup","className","children","xmlns","viewBox","d","fill","write","title","close","PostPreviewButton","textContent","forceIsAutosaveable","role","onPreview","postId","currentPostLink","previewLink","isSaveable","isViewable","select","_postType$viewable","editor","core","postType","getPostType","getCurrentPostType","getCurrentPostId","getCurrentPostAttribute","getEditedPostPreviewLink","isEditedPostSaveable","viewable","__unstableSaveForPreview","targetId","openPreviewWindow","event","preventDefault","previewWindow","window","open","focus","document","link","location","href","variant","undefined","target","accessibleWhenDisabled","disabled","onClick","size","as"],"sources":["@wordpress/editor/src/components/post-preview-button/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { renderToString } from '@wordpress/element';\r\nimport { Button, Path, SVG, VisuallyHidden } from '@wordpress/components';\r\nimport { __, _x } from '@wordpress/i18n';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { applyFilters } from '@wordpress/hooks';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editorStore } from '../../store';\r\n\r\nfunction writeInterstitialMessage( targetDocument ) {\r\n\tlet markup = renderToString(\r\n\t\t<div className=\"editor-post-preview-button__interstitial-message\">\r\n\t\t\t<SVG xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 96 96\">\r\n\t\t\t\t<Path\r\n\t\t\t\t\tclassName=\"outer\"\r\n\t\t\t\t\td=\"M48 12c19.9 0 36 16.1 36 36S67.9 84 48 84 12 67.9 12 48s16.1-36 36-36\"\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t/>\r\n\t\t\t\t<Path\r\n\t\t\t\t\tclassName=\"inner\"\r\n\t\t\t\t\td=\"M69.5 46.4c0-3.9-1.4-6.7-2.6-8.8-1.6-2.6-3.1-4.9-3.1-7.5 0-2.9 2.2-5.7 5.4-5.7h.4C63.9 19.2 56.4 16 48 16c-11.2 0-21 5.7-26.7 14.4h2.1c3.3 0 8.5-.4 8.5-.4 1.7-.1 1.9 2.4.2 2.6 0 0-1.7.2-3.7.3L40 67.5l7-20.9L42 33c-1.7-.1-3.3-.3-3.3-.3-1.7-.1-1.5-2.7.2-2.6 0 0 5.3.4 8.4.4 3.3 0 8.5-.4 8.5-.4 1.7-.1 1.9 2.4.2 2.6 0 0-1.7.2-3.7.3l11.5 34.3 3.3-10.4c1.6-4.5 2.4-7.8 2.4-10.5zM16.1 48c0 12.6 7.3 23.5 18 28.7L18.8 35c-1.7 4-2.7 8.4-2.7 13zm32.5 2.8L39 78.6c2.9.8 5.9 1.3 9 1.3 3.7 0 7.3-.6 10.6-1.8-.1-.1-.2-.3-.2-.4l-9.8-26.9zM76.2 36c0 3.2-.6 6.9-2.4 11.4L64 75.6c9.5-5.5 15.9-15.8 15.9-27.6 0-5.5-1.4-10.8-3.9-15.3.1 1 .2 2.1.2 3.3z\"\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t/>\r\n\t\t\t</SVG>\r\n\t\t\t<p>{ __( 'Generating preview…' ) }</p>\r\n\t\t</div>\r\n\t);\r\n\r\n\tmarkup += `\r\n\t\t<style>\r\n\t\t\tbody {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t}\r\n\t\t\t.editor-post-preview-button__interstitial-message {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\theight: 100vh;\r\n\t\t\t\twidth: 100vw;\r\n\t\t\t}\r\n\t\t\t@-webkit-keyframes paint {\r\n\t\t\t\t0% {\r\n\t\t\t\t\tstroke-dashoffset: 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t@-moz-keyframes paint {\r\n\t\t\t\t0% {\r\n\t\t\t\t\tstroke-dashoffset: 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t@-o-keyframes paint {\r\n\t\t\t\t0% {\r\n\t\t\t\t\tstroke-dashoffset: 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t@keyframes paint {\r\n\t\t\t\t0% {\r\n\t\t\t\t\tstroke-dashoffset: 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.editor-post-preview-button__interstitial-message svg {\r\n\t\t\t\twidth: 192px;\r\n\t\t\t\theight: 192px;\r\n\t\t\t\tstroke: #555d66;\r\n\t\t\t\tstroke-width: 0.75;\r\n\t\t\t}\r\n\t\t\t.editor-post-preview-button__interstitial-message svg .outer,\r\n\t\t\t.editor-post-preview-button__interstitial-message svg .inner {\r\n\t\t\t\tstroke-dasharray: 280;\r\n\t\t\t\tstroke-dashoffset: 280;\r\n\t\t\t\t-webkit-animation: paint 1.5s ease infinite alternate;\r\n\t\t\t\t-moz-animation: paint 1.5s ease infinite alternate;\r\n\t\t\t\t-o-animation: paint 1.5s ease infinite alternate;\r\n\t\t\t\tanimation: paint 1.5s ease infinite alternate;\r\n\t\t\t}\r\n\t\t\tp {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tfont-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif;\r\n\t\t\t}\r\n\t\t</style>\r\n\t`;\r\n\r\n\t/**\r\n\t * Filters the interstitial message shown when generating previews.\r\n\t *\r\n\t * @param {string} markup The preview interstitial markup.\r\n\t */\r\n\tmarkup = applyFilters( 'editor.PostPreview.interstitialMarkup', markup );\r\n\r\n\ttargetDocument.write( markup );\r\n\ttargetDocument.title = __( 'Generating preview…' );\r\n\ttargetDocument.close();\r\n}\r\n\r\n/**\r\n * Renders a button that opens a new window or tab for the preview,\r\n * writes the interstitial message to this window, and then navigates\r\n * to the actual preview link. The button is not rendered if the post\r\n * is not viewable and disabled if the post is not saveable.\r\n *\r\n * @param {Object}   props                     The component props.\r\n * @param {string}   props.className           The class name for the button.\r\n * @param {string}   props.textContent         The text content for the button.\r\n * @param {boolean}  props.forceIsAutosaveable Whether to force autosave.\r\n * @param {string}   props.role                The role attribute for the button.\r\n * @param {Function} props.onPreview           The callback function for preview event.\r\n *\r\n * @return {JSX.Element|null} The rendered button component.\r\n */\r\nexport default function PostPreviewButton( {\r\n\tclassName,\r\n\ttextContent,\r\n\tforceIsAutosaveable,\r\n\trole,\r\n\tonPreview,\r\n} ) {\r\n\tconst { postId, currentPostLink, previewLink, isSaveable, isViewable } =\r\n\t\tuseSelect( ( select ) => {\r\n\t\t\tconst editor = select( editorStore );\r\n\t\t\tconst core = select( coreStore );\r\n\r\n\t\t\tconst postType = core.getPostType(\r\n\t\t\t\teditor.getCurrentPostType( 'type' )\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tpostId: editor.getCurrentPostId(),\r\n\t\t\t\tcurrentPostLink: editor.getCurrentPostAttribute( 'link' ),\r\n\t\t\t\tpreviewLink: editor.getEditedPostPreviewLink(),\r\n\t\t\t\tisSaveable: editor.isEditedPostSaveable(),\r\n\t\t\t\tisViewable: postType?.viewable ?? false,\r\n\t\t\t};\r\n\t\t}, [] );\r\n\r\n\tconst { __unstableSaveForPreview } = useDispatch( editorStore );\r\n\r\n\tif ( ! isViewable ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst targetId = `wp-preview-${ postId }`;\r\n\r\n\tconst openPreviewWindow = async ( event ) => {\r\n\t\t// Our Preview button has its 'href' and 'target' set correctly for a11y\r\n\t\t// purposes. Unfortunately, though, we can't rely on the default 'click'\r\n\t\t// handler since sometimes it incorrectly opens a new tab instead of reusing\r\n\t\t// the existing one.\r\n\t\t// https://github.com/WordPress/gutenberg/pull/8330\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// Open up a Preview tab if needed. This is where we'll show the preview.\r\n\t\tconst previewWindow = window.open( '', targetId );\r\n\r\n\t\t// Focus the Preview tab. This might not do anything, depending on the browser's\r\n\t\t// and user's preferences.\r\n\t\t// https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus\r\n\t\tpreviewWindow.focus();\r\n\r\n\t\twriteInterstitialMessage( previewWindow.document );\r\n\r\n\t\tconst link = await __unstableSaveForPreview( { forceIsAutosaveable } );\r\n\r\n\t\tpreviewWindow.location = link;\r\n\r\n\t\tonPreview?.();\r\n\t};\r\n\r\n\t// Link to the `?preview=true` URL if we have it, since this lets us see\r\n\t// changes that were autosaved since the post was last published. Otherwise,\r\n\t// just link to the post's URL.\r\n\tconst href = previewLink || currentPostLink;\r\n\r\n\treturn (\r\n\t\t<Button\r\n\t\t\tvariant={ ! className ? 'tertiary' : undefined }\r\n\t\t\tclassName={ className || 'editor-post-preview' }\r\n\t\t\thref={ href }\r\n\t\t\ttarget={ targetId }\r\n\t\t\taccessibleWhenDisabled\r\n\t\t\tdisabled={ ! isSaveable }\r\n\t\t\tonClick={ openPreviewWindow }\r\n\t\t\trole={ role }\r\n\t\t\tsize=\"compact\"\r\n\t\t>\r\n\t\t\t{ textContent || (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{ _x( 'Preview', 'imperative verb' ) }\r\n\t\t\t\t\t<VisuallyHidden as=\"span\">\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t/* translators: accessibility text */\r\n\t\t\t\t\t\t\t__( '(opens in a new tab)' )\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</VisuallyHidden>\r\n\t\t\t\t</>\r\n\t\t\t) }\r\n\t\t</Button>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}