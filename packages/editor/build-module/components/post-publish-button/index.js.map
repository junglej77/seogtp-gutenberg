{"version":3,"names":["Button","Component","createRef","withSelect","withDispatch","compose","PublishButtonLabel","store","editorStore","jsx","_jsx","Fragment","_Fragment","noop","PostPublishButton","constructor","props","buttonNode","createOnClick","bind","closeEntitiesSavedStates","state","entitiesSavedStatesCallback","componentDidMount","focusOnMount","timeoutID","setTimeout","current","focus","componentWillUnmount","clearTimeout","callback","args","hasNonPostEntityChanges","setEntitiesSavedStatesCallback","setState","savedEntities","postType","postId","some","elt","kind","name","key","render","forceIsDirty","hasPublishAction","isBeingScheduled","isOpen","isPostSavingLocked","isPublishable","isPublished","isSaveable","isSaving","isAutoSaving","isToggle","savePostStatus","onSubmit","onToggle","visibility","isSavingNonPostEntityChanges","postStatus","postStatusHasChanged","isButtonDisabled","isToggleDisabled","publishStatus","onClickButton","onClickToggle","buttonProps","className","isBusy","variant","onClick","toggleProps","size","componentProps","children","ref","select","_getCurrentPost$_link","isSavingPost","isAutosavingPost","isEditedPostBeingScheduled","getEditedPostVisibility","isCurrentPostPublished","isEditedPostSaveable","isEditedPostPublishable","getCurrentPost","getCurrentPostType","getCurrentPostId","getEditedPostAttribute","getPostEdits","_links","status","dispatch","editPost","savePost","undoIgnore"],"sources":["@wordpress/editor/src/components/post-publish-button/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { Button } from '@wordpress/components';\r\nimport { Component, createRef } from '@wordpress/element';\r\nimport { withSelect, withDispatch } from '@wordpress/data';\r\nimport { compose } from '@wordpress/compose';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport PublishButtonLabel from './label';\r\nimport { store as editorStore } from '../../store';\r\n\r\nconst noop = () => {};\r\n\r\nexport class PostPublishButton extends Component {\r\n\tconstructor( props ) {\r\n\t\tsuper( props );\r\n\t\tthis.buttonNode = createRef();\r\n\r\n\t\tthis.createOnClick = this.createOnClick.bind( this );\r\n\t\tthis.closeEntitiesSavedStates =\r\n\t\t\tthis.closeEntitiesSavedStates.bind( this );\r\n\r\n\t\tthis.state = {\r\n\t\t\tentitiesSavedStatesCallback: false,\r\n\t\t};\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tif ( this.props.focusOnMount ) {\r\n\t\t\t// This timeout is necessary to make sure the `useEffect` hook of\r\n\t\t\t// `useFocusReturn` gets the correct element (the button that opens the\r\n\t\t\t// PostPublishPanel) otherwise it will get this button.\r\n\t\t\tthis.timeoutID = setTimeout( () => {\r\n\t\t\t\tthis.buttonNode.current.focus();\r\n\t\t\t}, 0 );\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tclearTimeout( this.timeoutID );\r\n\t}\r\n\r\n\tcreateOnClick( callback ) {\r\n\t\treturn ( ...args ) => {\r\n\t\t\tconst { hasNonPostEntityChanges, setEntitiesSavedStatesCallback } =\r\n\t\t\t\tthis.props;\r\n\t\t\t// If a post with non-post entities is published, but the user\r\n\t\t\t// elects to not save changes to the non-post entities, those\r\n\t\t\t// entities will still be dirty when the Publish button is clicked.\r\n\t\t\t// We also need to check that the `setEntitiesSavedStatesCallback`\r\n\t\t\t// prop was passed. See https://github.com/WordPress/gutenberg/pull/37383\r\n\t\t\tif ( hasNonPostEntityChanges && setEntitiesSavedStatesCallback ) {\r\n\t\t\t\t// The modal for multiple entity saving will open,\r\n\t\t\t\t// hold the callback for saving/publishing the post\r\n\t\t\t\t// so that we can call it if the post entity is checked.\r\n\t\t\t\tthis.setState( {\r\n\t\t\t\t\tentitiesSavedStatesCallback: () => callback( ...args ),\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t// Open the save panel by setting its callback.\r\n\t\t\t\t// To set a function on the useState hook, we must set it\r\n\t\t\t\t// with another function (() => myFunction). Passing the\r\n\t\t\t\t// function on its own will cause an error when called.\r\n\t\t\t\tsetEntitiesSavedStatesCallback(\r\n\t\t\t\t\t() => this.closeEntitiesSavedStates\r\n\t\t\t\t);\r\n\t\t\t\treturn noop;\r\n\t\t\t}\r\n\r\n\t\t\treturn callback( ...args );\r\n\t\t};\r\n\t}\r\n\r\n\tcloseEntitiesSavedStates( savedEntities ) {\r\n\t\tconst { postType, postId } = this.props;\r\n\t\tconst { entitiesSavedStatesCallback } = this.state;\r\n\t\tthis.setState( { entitiesSavedStatesCallback: false }, () => {\r\n\t\t\tif (\r\n\t\t\t\tsavedEntities &&\r\n\t\t\t\tsavedEntities.some(\r\n\t\t\t\t\t( elt ) =>\r\n\t\t\t\t\t\telt.kind === 'postType' &&\r\n\t\t\t\t\t\telt.name === postType &&\r\n\t\t\t\t\t\telt.key === postId\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\t// The post entity was checked, call the held callback from `createOnClick`.\r\n\t\t\t\tentitiesSavedStatesCallback();\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tforceIsDirty,\r\n\t\t\thasPublishAction,\r\n\t\t\tisBeingScheduled,\r\n\t\t\tisOpen,\r\n\t\t\tisPostSavingLocked,\r\n\t\t\tisPublishable,\r\n\t\t\tisPublished,\r\n\t\t\tisSaveable,\r\n\t\t\tisSaving,\r\n\t\t\tisAutoSaving,\r\n\t\t\tisToggle,\r\n\t\t\tsavePostStatus,\r\n\t\t\tonSubmit = noop,\r\n\t\t\tonToggle,\r\n\t\t\tvisibility,\r\n\t\t\thasNonPostEntityChanges,\r\n\t\t\tisSavingNonPostEntityChanges,\r\n\t\t\tpostStatus,\r\n\t\t\tpostStatusHasChanged,\r\n\t\t} = this.props;\r\n\r\n\t\tconst isButtonDisabled =\r\n\t\t\t( isSaving ||\r\n\t\t\t\t! isSaveable ||\r\n\t\t\t\tisPostSavingLocked ||\r\n\t\t\t\t( ! isPublishable && ! forceIsDirty ) ) &&\r\n\t\t\t( ! hasNonPostEntityChanges || isSavingNonPostEntityChanges );\r\n\r\n\t\tconst isToggleDisabled =\r\n\t\t\t( isPublished ||\r\n\t\t\t\tisSaving ||\r\n\t\t\t\t! isSaveable ||\r\n\t\t\t\t( ! isPublishable && ! forceIsDirty ) ) &&\r\n\t\t\t( ! hasNonPostEntityChanges || isSavingNonPostEntityChanges );\r\n\r\n\t\t// If the new status has not changed explicitely, we derive it from\r\n\t\t// other factors, like having a publish action, etc.. We need to preserve\r\n\t\t// this because it affects when to show the pre and post publish panels.\r\n\t\t// If it has changed though explicitely, we need to respect that.\r\n\t\tlet publishStatus = 'publish';\r\n\t\tif ( postStatusHasChanged ) {\r\n\t\t\tpublishStatus = postStatus;\r\n\t\t} else if ( ! hasPublishAction ) {\r\n\t\t\tpublishStatus = 'pending';\r\n\t\t} else if ( visibility === 'private' ) {\r\n\t\t\tpublishStatus = 'private';\r\n\t\t} else if ( isBeingScheduled ) {\r\n\t\t\tpublishStatus = 'future';\r\n\t\t}\r\n\r\n\t\tconst onClickButton = () => {\r\n\t\t\tif ( isButtonDisabled ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tonSubmit();\r\n\t\t\tsavePostStatus( publishStatus );\r\n\t\t};\r\n\r\n\t\t// Callback to open the publish panel.\r\n\t\tconst onClickToggle = () => {\r\n\t\t\tif ( isToggleDisabled ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tonToggle();\r\n\t\t};\r\n\r\n\t\tconst buttonProps = {\r\n\t\t\t'aria-disabled': isButtonDisabled,\r\n\t\t\tclassName: 'editor-post-publish-button',\r\n\t\t\tisBusy: ! isAutoSaving && isSaving,\r\n\t\t\tvariant: 'primary',\r\n\t\t\tonClick: this.createOnClick( onClickButton ),\r\n\t\t};\r\n\r\n\t\tconst toggleProps = {\r\n\t\t\t'aria-disabled': isToggleDisabled,\r\n\t\t\t'aria-expanded': isOpen,\r\n\t\t\tclassName: 'editor-post-publish-panel__toggle',\r\n\t\t\tisBusy: isSaving && isPublished,\r\n\t\t\tvariant: 'primary',\r\n\t\t\tsize: 'compact',\r\n\t\t\tonClick: this.createOnClick( onClickToggle ),\r\n\t\t};\r\n\t\tconst componentProps = isToggle ? toggleProps : buttonProps;\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<Button\r\n\t\t\t\t\tref={ this.buttonNode }\r\n\t\t\t\t\t{ ...componentProps }\r\n\t\t\t\t\tclassName={ `${ componentProps.className } editor-post-publish-button__button` }\r\n\t\t\t\t\tsize=\"compact\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<PublishButtonLabel />\r\n\t\t\t\t</Button>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n}\r\n\r\n/**\r\n * Renders the publish button.\r\n */\r\nexport default compose( [\r\n\twithSelect( ( select ) => {\r\n\t\tconst {\r\n\t\t\tisSavingPost,\r\n\t\t\tisAutosavingPost,\r\n\t\t\tisEditedPostBeingScheduled,\r\n\t\t\tgetEditedPostVisibility,\r\n\t\t\tisCurrentPostPublished,\r\n\t\t\tisEditedPostSaveable,\r\n\t\t\tisEditedPostPublishable,\r\n\t\t\tisPostSavingLocked,\r\n\t\t\tgetCurrentPost,\r\n\t\t\tgetCurrentPostType,\r\n\t\t\tgetCurrentPostId,\r\n\t\t\thasNonPostEntityChanges,\r\n\t\t\tisSavingNonPostEntityChanges,\r\n\t\t\tgetEditedPostAttribute,\r\n\t\t\tgetPostEdits,\r\n\t\t} = select( editorStore );\r\n\t\treturn {\r\n\t\t\tisSaving: isSavingPost(),\r\n\t\t\tisAutoSaving: isAutosavingPost(),\r\n\t\t\tisBeingScheduled: isEditedPostBeingScheduled(),\r\n\t\t\tvisibility: getEditedPostVisibility(),\r\n\t\t\tisSaveable: isEditedPostSaveable(),\r\n\t\t\tisPostSavingLocked: isPostSavingLocked(),\r\n\t\t\tisPublishable: isEditedPostPublishable(),\r\n\t\t\tisPublished: isCurrentPostPublished(),\r\n\t\t\thasPublishAction:\r\n\t\t\t\tgetCurrentPost()._links?.[ 'wp:action-publish' ] ?? false,\r\n\t\t\tpostType: getCurrentPostType(),\r\n\t\t\tpostId: getCurrentPostId(),\r\n\t\t\tpostStatus: getEditedPostAttribute( 'status' ),\r\n\t\t\tpostStatusHasChanged: getPostEdits()?.status,\r\n\t\t\thasNonPostEntityChanges: hasNonPostEntityChanges(),\r\n\t\t\tisSavingNonPostEntityChanges: isSavingNonPostEntityChanges(),\r\n\t\t};\r\n\t} ),\r\n\twithDispatch( ( dispatch ) => {\r\n\t\tconst { editPost, savePost } = dispatch( editorStore );\r\n\t\treturn {\r\n\t\t\tsavePostStatus: ( status ) => {\r\n\t\t\t\teditPost( { status }, { undoIgnore: true } );\r\n\t\t\t\tsavePost();\r\n\t\t\t},\r\n\t\t};\r\n\t} ),\r\n] )( PostPublishButton );\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAM,QAAQ,uBAAuB;AAC9C,SAASC,SAAS,EAAEC,SAAS,QAAQ,oBAAoB;AACzD,SAASC,UAAU,EAAEC,YAAY,QAAQ,iBAAiB;AAC1D,SAASC,OAAO,QAAQ,oBAAoB;;AAE5C;AACA;AACA;AACA,OAAOC,kBAAkB,MAAM,SAAS;AACxC,SAASC,KAAK,IAAIC,WAAW,QAAQ,aAAa;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AAEnD,MAAMC,IAAI,GAAGA,CAAA,KAAM,CAAC,CAAC;AAErB,OAAO,MAAMC,iBAAiB,SAASb,SAAS,CAAC;EAChDc,WAAWA,CAAEC,KAAK,EAAG;IACpB,KAAK,CAAEA,KAAM,CAAC;IACd,IAAI,CAACC,UAAU,GAAGf,SAAS,CAAC,CAAC;IAE7B,IAAI,CAACgB,aAAa,GAAG,IAAI,CAACA,aAAa,CAACC,IAAI,CAAE,IAAK,CAAC;IACpD,IAAI,CAACC,wBAAwB,GAC5B,IAAI,CAACA,wBAAwB,CAACD,IAAI,CAAE,IAAK,CAAC;IAE3C,IAAI,CAACE,KAAK,GAAG;MACZC,2BAA2B,EAAE;IAC9B,CAAC;EACF;EAEAC,iBAAiBA,CAAA,EAAG;IACnB,IAAK,IAAI,CAACP,KAAK,CAACQ,YAAY,EAAG;MAC9B;MACA;MACA;MACA,IAAI,CAACC,SAAS,GAAGC,UAAU,CAAE,MAAM;QAClC,IAAI,CAACT,UAAU,CAACU,OAAO,CAACC,KAAK,CAAC,CAAC;MAChC,CAAC,EAAE,CAAE,CAAC;IACP;EACD;EAEAC,oBAAoBA,CAAA,EAAG;IACtBC,YAAY,CAAE,IAAI,CAACL,SAAU,CAAC;EAC/B;EAEAP,aAAaA,CAAEa,QAAQ,EAAG;IACzB,OAAO,CAAE,GAAGC,IAAI,KAAM;MACrB,MAAM;QAAEC,uBAAuB;QAAEC;MAA+B,CAAC,GAChE,IAAI,CAAClB,KAAK;MACX;MACA;MACA;MACA;MACA;MACA,IAAKiB,uBAAuB,IAAIC,8BAA8B,EAAG;QAChE;QACA;QACA;QACA,IAAI,CAACC,QAAQ,CAAE;UACdb,2BAA2B,EAAEA,CAAA,KAAMS,QAAQ,CAAE,GAAGC,IAAK;QACtD,CAAE,CAAC;;QAEH;QACA;QACA;QACA;QACAE,8BAA8B,CAC7B,MAAM,IAAI,CAACd,wBACZ,CAAC;QACD,OAAOP,IAAI;MACZ;MAEA,OAAOkB,QAAQ,CAAE,GAAGC,IAAK,CAAC;IAC3B,CAAC;EACF;EAEAZ,wBAAwBA,CAAEgB,aAAa,EAAG;IACzC,MAAM;MAAEC,QAAQ;MAAEC;IAAO,CAAC,GAAG,IAAI,CAACtB,KAAK;IACvC,MAAM;MAAEM;IAA4B,CAAC,GAAG,IAAI,CAACD,KAAK;IAClD,IAAI,CAACc,QAAQ,CAAE;MAAEb,2BAA2B,EAAE;IAAM,CAAC,EAAE,MAAM;MAC5D,IACCc,aAAa,IACbA,aAAa,CAACG,IAAI,CACfC,GAAG,IACJA,GAAG,CAACC,IAAI,KAAK,UAAU,IACvBD,GAAG,CAACE,IAAI,KAAKL,QAAQ,IACrBG,GAAG,CAACG,GAAG,KAAKL,MACd,CAAC,EACA;QACD;QACAhB,2BAA2B,CAAC,CAAC;MAC9B;IACD,CAAE,CAAC;EACJ;EAEAsB,MAAMA,CAAA,EAAG;IACR,MAAM;MACLC,YAAY;MACZC,gBAAgB;MAChBC,gBAAgB;MAChBC,MAAM;MACNC,kBAAkB;MAClBC,aAAa;MACbC,WAAW;MACXC,UAAU;MACVC,QAAQ;MACRC,YAAY;MACZC,QAAQ;MACRC,cAAc;MACdC,QAAQ,GAAG5C,IAAI;MACf6C,QAAQ;MACRC,UAAU;MACV1B,uBAAuB;MACvB2B,4BAA4B;MAC5BC,UAAU;MACVC;IACD,CAAC,GAAG,IAAI,CAAC9C,KAAK;IAEd,MAAM+C,gBAAgB,GACrB,CAAEV,QAAQ,IACT,CAAED,UAAU,IACZH,kBAAkB,IAChB,CAAEC,aAAa,IAAI,CAAEL,YAAc,MACpC,CAAEZ,uBAAuB,IAAI2B,4BAA4B,CAAE;IAE9D,MAAMI,gBAAgB,GACrB,CAAEb,WAAW,IACZE,QAAQ,IACR,CAAED,UAAU,IACV,CAAEF,aAAa,IAAI,CAAEL,YAAc,MACpC,CAAEZ,uBAAuB,IAAI2B,4BAA4B,CAAE;;IAE9D;IACA;IACA;IACA;IACA,IAAIK,aAAa,GAAG,SAAS;IAC7B,IAAKH,oBAAoB,EAAG;MAC3BG,aAAa,GAAGJ,UAAU;IAC3B,CAAC,MAAM,IAAK,CAAEf,gBAAgB,EAAG;MAChCmB,aAAa,GAAG,SAAS;IAC1B,CAAC,MAAM,IAAKN,UAAU,KAAK,SAAS,EAAG;MACtCM,aAAa,GAAG,SAAS;IAC1B,CAAC,MAAM,IAAKlB,gBAAgB,EAAG;MAC9BkB,aAAa,GAAG,QAAQ;IACzB;IAEA,MAAMC,aAAa,GAAGA,CAAA,KAAM;MAC3B,IAAKH,gBAAgB,EAAG;QACvB;MACD;MACAN,QAAQ,CAAC,CAAC;MACVD,cAAc,CAAES,aAAc,CAAC;IAChC,CAAC;;IAED;IACA,MAAME,aAAa,GAAGA,CAAA,KAAM;MAC3B,IAAKH,gBAAgB,EAAG;QACvB;MACD;MACAN,QAAQ,CAAC,CAAC;IACX,CAAC;IAED,MAAMU,WAAW,GAAG;MACnB,eAAe,EAAEL,gBAAgB;MACjCM,SAAS,EAAE,4BAA4B;MACvCC,MAAM,EAAE,CAAEhB,YAAY,IAAID,QAAQ;MAClCkB,OAAO,EAAE,SAAS;MAClBC,OAAO,EAAE,IAAI,CAACtD,aAAa,CAAEgD,aAAc;IAC5C,CAAC;IAED,MAAMO,WAAW,GAAG;MACnB,eAAe,EAAET,gBAAgB;MACjC,eAAe,EAAEhB,MAAM;MACvBqB,SAAS,EAAE,mCAAmC;MAC9CC,MAAM,EAAEjB,QAAQ,IAAIF,WAAW;MAC/BoB,OAAO,EAAE,SAAS;MAClBG,IAAI,EAAE,SAAS;MACfF,OAAO,EAAE,IAAI,CAACtD,aAAa,CAAEiD,aAAc;IAC5C,CAAC;IACD,MAAMQ,cAAc,GAAGpB,QAAQ,GAAGkB,WAAW,GAAGL,WAAW;IAC3D,oBACC1D,IAAA,CAAAE,SAAA;MAAAgE,QAAA,eACClE,IAAA,CAACV,MAAM;QACN6E,GAAG,EAAG,IAAI,CAAC5D,UAAY;QAAA,GAClB0D,cAAc;QACnBN,SAAS,EAAI,GAAGM,cAAc,CAACN,SAAW,qCAAsC;QAChFK,IAAI,EAAC,SAAS;QAAAE,QAAA,eAEdlE,IAAA,CAACJ,kBAAkB,IAAE;MAAC,CACf;IAAC,CACR,CAAC;EAEL;AACD;;AAEA;AACA;AACA;AACA,eAAeD,OAAO,CAAE,CACvBF,UAAU,CAAI2E,MAAM,IAAM;EAAA,IAAAC,qBAAA;EACzB,MAAM;IACLC,YAAY;IACZC,gBAAgB;IAChBC,0BAA0B;IAC1BC,uBAAuB;IACvBC,sBAAsB;IACtBC,oBAAoB;IACpBC,uBAAuB;IACvBrC,kBAAkB;IAClBsC,cAAc;IACdC,kBAAkB;IAClBC,gBAAgB;IAChBxD,uBAAuB;IACvB2B,4BAA4B;IAC5B8B,sBAAsB;IACtBC;EACD,CAAC,GAAGb,MAAM,CAAEtE,WAAY,CAAC;EACzB,OAAO;IACN6C,QAAQ,EAAE2B,YAAY,CAAC,CAAC;IACxB1B,YAAY,EAAE2B,gBAAgB,CAAC,CAAC;IAChClC,gBAAgB,EAAEmC,0BAA0B,CAAC,CAAC;IAC9CvB,UAAU,EAAEwB,uBAAuB,CAAC,CAAC;IACrC/B,UAAU,EAAEiC,oBAAoB,CAAC,CAAC;IAClCpC,kBAAkB,EAAEA,kBAAkB,CAAC,CAAC;IACxCC,aAAa,EAAEoC,uBAAuB,CAAC,CAAC;IACxCnC,WAAW,EAAEiC,sBAAsB,CAAC,CAAC;IACrCtC,gBAAgB,GAAAiC,qBAAA,GACfQ,cAAc,CAAC,CAAC,CAACK,MAAM,GAAI,mBAAmB,CAAE,cAAAb,qBAAA,cAAAA,qBAAA,GAAI,KAAK;IAC1D1C,QAAQ,EAAEmD,kBAAkB,CAAC,CAAC;IAC9BlD,MAAM,EAAEmD,gBAAgB,CAAC,CAAC;IAC1B5B,UAAU,EAAE6B,sBAAsB,CAAE,QAAS,CAAC;IAC9C5B,oBAAoB,EAAE6B,YAAY,CAAC,CAAC,EAAEE,MAAM;IAC5C5D,uBAAuB,EAAEA,uBAAuB,CAAC,CAAC;IAClD2B,4BAA4B,EAAEA,4BAA4B,CAAC;EAC5D,CAAC;AACF,CAAE,CAAC,EACHxD,YAAY,CAAI0F,QAAQ,IAAM;EAC7B,MAAM;IAAEC,QAAQ;IAAEC;EAAS,CAAC,GAAGF,QAAQ,CAAEtF,WAAY,CAAC;EACtD,OAAO;IACNgD,cAAc,EAAIqC,MAAM,IAAM;MAC7BE,QAAQ,CAAE;QAAEF;MAAO,CAAC,EAAE;QAAEI,UAAU,EAAE;MAAK,CAAE,CAAC;MAC5CD,QAAQ,CAAC,CAAC;IACX;EACD,CAAC;AACF,CAAE,CAAC,CACF,CAAC,CAAElF,iBAAkB,CAAC","ignoreList":[]}