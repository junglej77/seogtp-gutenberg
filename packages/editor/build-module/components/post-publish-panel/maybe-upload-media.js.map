{"version":3,"names":["PanelBody","Button","Spinner","__unstableMotion","motion","__unstableAnimatePresence","AnimatePresence","useSelect","useDispatch","__","store","blockEditorStore","useState","isBlobURL","jsx","_jsx","jsxs","_jsxs","flattenBlocks","blocks","result","forEach","block","push","innerBlocks","Image","selectBlock","img","tabIndex","role","onClick","clientId","onKeyDown","event","key","preventDefault","alt","attributes","src","url","animate","opacity","exit","scale","style","width","height","objectFit","borderRadius","cursor","whileHover","PostFormatPanel","isUploading","setIsUploading","isAnimating","setIsAnimating","hadUploadError","setHadUploadError","editorBlocks","mediaUpload","select","getBlocks","getSettings","externalImages","filter","name","id","updateBlockAttributes","length","panelBodyTitle","className","children","uploadImages","Promise","all","map","image","window","fetch","includes","then","response","blob","resolve","reject","filesList","onFileChange","media","onError","catch","finally","initialOpen","title","display","flexWrap","gap","onExitComplete","__next40pxDefaultSize","variant"],"sources":["@wordpress/editor/src/components/post-publish-panel/maybe-upload-media.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tPanelBody,\r\n\tButton,\r\n\tSpinner,\r\n\t__unstableMotion as motion,\r\n\t__unstableAnimatePresence as AnimatePresence,\r\n} from '@wordpress/components';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { store as blockEditorStore } from '@wordpress/block-editor';\r\nimport { useState } from '@wordpress/element';\r\nimport { isBlobURL } from '@wordpress/blob';\r\n\r\nfunction flattenBlocks( blocks ) {\r\n\tconst result = [];\r\n\r\n\tblocks.forEach( ( block ) => {\r\n\t\tresult.push( block );\r\n\t\tresult.push( ...flattenBlocks( block.innerBlocks ) );\r\n\t} );\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction Image( block ) {\r\n\tconst { selectBlock } = useDispatch( blockEditorStore );\r\n\treturn (\r\n\t\t<motion.img\r\n\t\t\ttabIndex={ 0 }\r\n\t\t\trole=\"button\"\r\n\t\t\taria-label={ __( 'Select image block.' ) }\r\n\t\t\tonClick={ () => {\r\n\t\t\t\tselectBlock( block.clientId );\r\n\t\t\t} }\r\n\t\t\tonKeyDown={ ( event ) => {\r\n\t\t\t\tif ( event.key === 'Enter' || event.key === ' ' ) {\r\n\t\t\t\t\tselectBlock( block.clientId );\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t} }\r\n\t\t\tkey={ block.clientId }\r\n\t\t\talt={ block.attributes.alt }\r\n\t\t\tsrc={ block.attributes.url }\r\n\t\t\tanimate={ { opacity: 1 } }\r\n\t\t\texit={ { opacity: 0, scale: 0 } }\r\n\t\t\tstyle={ {\r\n\t\t\t\twidth: '36px',\r\n\t\t\t\theight: '36px',\r\n\t\t\t\tobjectFit: 'cover',\r\n\t\t\t\tborderRadius: '2px',\r\n\t\t\t\tcursor: 'pointer',\r\n\t\t\t} }\r\n\t\t\twhileHover={ { scale: 1.08 } }\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nexport default function PostFormatPanel() {\r\n\tconst [ isUploading, setIsUploading ] = useState( false );\r\n\tconst [ isAnimating, setIsAnimating ] = useState( false );\r\n\tconst [ hadUploadError, setHadUploadError ] = useState( false );\r\n\tconst { editorBlocks, mediaUpload } = useSelect(\r\n\t\t( select ) => ( {\r\n\t\t\teditorBlocks: select( blockEditorStore ).getBlocks(),\r\n\t\t\tmediaUpload: select( blockEditorStore ).getSettings().mediaUpload,\r\n\t\t} ),\r\n\t\t[]\r\n\t);\r\n\tconst externalImages = flattenBlocks( editorBlocks ).filter(\r\n\t\t( block ) =>\r\n\t\t\tblock.name === 'core/image' &&\r\n\t\t\tblock.attributes.url &&\r\n\t\t\t! block.attributes.id\r\n\t);\r\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\r\n\r\n\tif ( ! mediaUpload || ! externalImages.length ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst panelBodyTitle = [\r\n\t\t__( 'Suggestion:' ),\r\n\t\t<span className=\"editor-post-publish-panel__link\" key=\"label\">\r\n\t\t\t{ __( 'External media' ) }\r\n\t\t</span>,\r\n\t];\r\n\r\n\tfunction uploadImages() {\r\n\t\tsetIsUploading( true );\r\n\t\tsetHadUploadError( false );\r\n\t\tPromise.all(\r\n\t\t\texternalImages.map( ( image ) =>\r\n\t\t\t\twindow\r\n\t\t\t\t\t.fetch(\r\n\t\t\t\t\t\timage.attributes.url.includes( '?' )\r\n\t\t\t\t\t\t\t? image.attributes.url\r\n\t\t\t\t\t\t\t: image.attributes.url + '?'\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.then( ( response ) => response.blob() )\r\n\t\t\t\t\t.then( ( blob ) =>\r\n\t\t\t\t\t\tnew Promise( ( resolve, reject ) => {\r\n\t\t\t\t\t\t\tmediaUpload( {\r\n\t\t\t\t\t\t\t\tfilesList: [ blob ],\r\n\t\t\t\t\t\t\t\tonFileChange: ( [ media ] ) => {\r\n\t\t\t\t\t\t\t\t\tif ( isBlobURL( media.url ) ) {\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tupdateBlockAttributes( image.clientId, {\r\n\t\t\t\t\t\t\t\t\t\tid: media.id,\r\n\t\t\t\t\t\t\t\t\t\turl: media.url,\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tonError() {\r\n\t\t\t\t\t\t\t\t\treject();\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t} ).then( () => setIsAnimating( true ) )\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch( () => {\r\n\t\t\t\t\t\tsetHadUploadError( true );\r\n\t\t\t\t\t} )\r\n\t\t\t)\r\n\t\t).finally( () => {\r\n\t\t\tsetIsUploading( false );\r\n\t\t} );\r\n\t}\r\n\r\n\treturn (\r\n\t\t<PanelBody initialOpen title={ panelBodyTitle }>\r\n\t\t\t<p>\r\n\t\t\t\t{ __(\r\n\t\t\t\t\t'Upload external images to the Media Library. Images from different domains may load slowly, display incorrectly, or be removed unexpectedly.'\r\n\t\t\t\t) }\r\n\t\t\t</p>\r\n\t\t\t<div\r\n\t\t\t\tstyle={ {\r\n\t\t\t\t\tdisplay: 'inline-flex',\r\n\t\t\t\t\tflexWrap: 'wrap',\r\n\t\t\t\t\tgap: '8px',\r\n\t\t\t\t} }\r\n\t\t\t>\r\n\t\t\t\t<AnimatePresence\r\n\t\t\t\t\tonExitComplete={ () => setIsAnimating( false ) }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ externalImages.map( ( image ) => {\r\n\t\t\t\t\t\treturn <Image key={ image.clientId } { ...image } />;\r\n\t\t\t\t\t} ) }\r\n\t\t\t\t</AnimatePresence>\r\n\t\t\t\t{ isUploading || isAnimating ? (\r\n\t\t\t\t\t<Spinner />\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t\tonClick={ uploadImages }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ __( 'Upload' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t) }\r\n\t\t\t</div>\r\n\t\t\t{ hadUploadError && <p>{ __( 'Upload failed, try again.' ) }</p> }\r\n\t\t</PanelBody>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}