{"version":3,"names":["clsx","__unstableGetAnimateClassName","getAnimateClassName","Button","usePrevious","useViewportMatch","useDispatch","useSelect","useEffect","useState","__","Icon","check","cloud","cloudUpload","displayShortcut","store","preferencesStore","STATUS_OPTIONS","editorStore","jsx","_jsx","jsxs","_jsxs","PostSavedState","forceIsDirty","forceSavedMessage","setForceSavedMessage","isLargeViewport","isAutosaving","isDirty","isNew","isPublished","isSaveable","isSaving","isScheduled","hasPublishAction","showIconLabels","postStatus","postStatusHasChanged","select","_getCurrentPost$_link","isEditedPostNew","isCurrentPostPublished","isCurrentPostScheduled","isEditedPostDirty","isSavingPost","isEditedPostSaveable","getCurrentPost","isAutosavingPost","getEditedPostAttribute","getPostEdits","get","_links","status","isPending","savePost","wasSaving","timeoutId","setTimeout","clearTimeout","isIneligibleStatus","includes","map","value","label","shortLabel","isSaved","isSavedState","isDisabled","text","className","type","undefined","onClick","shortcut","primary","variant","size","icon","children"],"sources":["@wordpress/editor/src/components/post-saved-state/index.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\t__unstableGetAnimateClassName as getAnimateClassName,\r\n\tButton,\r\n} from '@wordpress/components';\r\nimport { usePrevious, useViewportMatch } from '@wordpress/compose';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { useEffect, useState } from '@wordpress/element';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { Icon, check, cloud, cloudUpload } from '@wordpress/icons';\r\nimport { displayShortcut } from '@wordpress/keycodes';\r\nimport { store as preferencesStore } from '@wordpress/preferences';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { STATUS_OPTIONS } from '../../components/post-status';\r\nimport { store as editorStore } from '../../store';\r\n\r\n/**\r\n * Component showing whether the post is saved or not and providing save\r\n * buttons.\r\n *\r\n * @param {Object}   props              Component props.\r\n * @param {?boolean} props.forceIsDirty Whether to force the post to be marked\r\n *                                      as dirty.\r\n * @return {import('react').ComponentType} The component.\r\n */\r\nexport default function PostSavedState( { forceIsDirty } ) {\r\n\tconst [ forceSavedMessage, setForceSavedMessage ] = useState( false );\r\n\tconst isLargeViewport = useViewportMatch( 'small' );\r\n\r\n\tconst {\r\n\t\tisAutosaving,\r\n\t\tisDirty,\r\n\t\tisNew,\r\n\t\tisPublished,\r\n\t\tisSaveable,\r\n\t\tisSaving,\r\n\t\tisScheduled,\r\n\t\thasPublishAction,\r\n\t\tshowIconLabels,\r\n\t\tpostStatus,\r\n\t\tpostStatusHasChanged,\r\n\t} = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst {\r\n\t\t\t\tisEditedPostNew,\r\n\t\t\t\tisCurrentPostPublished,\r\n\t\t\t\tisCurrentPostScheduled,\r\n\t\t\t\tisEditedPostDirty,\r\n\t\t\t\tisSavingPost,\r\n\t\t\t\tisEditedPostSaveable,\r\n\t\t\t\tgetCurrentPost,\r\n\t\t\t\tisAutosavingPost,\r\n\t\t\t\tgetEditedPostAttribute,\r\n\t\t\t\tgetPostEdits,\r\n\t\t\t} = select( editorStore );\r\n\t\t\tconst { get } = select( preferencesStore );\r\n\t\t\treturn {\r\n\t\t\t\tisAutosaving: isAutosavingPost(),\r\n\t\t\t\tisDirty: forceIsDirty || isEditedPostDirty(),\r\n\t\t\t\tisNew: isEditedPostNew(),\r\n\t\t\t\tisPublished: isCurrentPostPublished(),\r\n\t\t\t\tisSaving: isSavingPost(),\r\n\t\t\t\tisSaveable: isEditedPostSaveable(),\r\n\t\t\t\tisScheduled: isCurrentPostScheduled(),\r\n\t\t\t\thasPublishAction:\r\n\t\t\t\t\tgetCurrentPost()?._links?.[ 'wp:action-publish' ] ?? false,\r\n\t\t\t\tshowIconLabels: get( 'core', 'showIconLabels' ),\r\n\t\t\t\tpostStatus: getEditedPostAttribute( 'status' ),\r\n\t\t\t\tpostStatusHasChanged: !! getPostEdits()?.status,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ forceIsDirty ]\r\n\t);\r\n\tconst isPending = postStatus === 'pending';\r\n\tconst { savePost } = useDispatch( editorStore );\r\n\r\n\tconst wasSaving = usePrevious( isSaving );\r\n\r\n\tuseEffect( () => {\r\n\t\tlet timeoutId;\r\n\r\n\t\tif ( wasSaving && ! isSaving ) {\r\n\t\t\tsetForceSavedMessage( true );\r\n\t\t\ttimeoutId = setTimeout( () => {\r\n\t\t\t\tsetForceSavedMessage( false );\r\n\t\t\t}, 1000 );\r\n\t\t}\r\n\r\n\t\treturn () => clearTimeout( timeoutId );\r\n\t}, [ isSaving ] );\r\n\r\n\t// Once the post has been submitted for review this button\r\n\t// is not needed for the contributor role.\r\n\tif ( ! hasPublishAction && isPending ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// We shouldn't render the button if the post has not one of the following statuses: pending, draft, auto-draft.\r\n\t// The reason for this is that this button handles the `save as pending` and `save draft` actions.\r\n\t// An exception for this is when the post has a custom status and there should be a way to save changes without\r\n\t// having to publish. This should be handled better in the future when custom statuses have better support.\r\n\t// @see https://github.com/WordPress/gutenberg/issues/3144.\r\n\tconst isIneligibleStatus =\r\n\t\t! [ 'pending', 'draft', 'auto-draft' ].includes( postStatus ) &&\r\n\t\tSTATUS_OPTIONS.map( ( { value } ) => value ).includes( postStatus );\r\n\r\n\tif (\r\n\t\tisPublished ||\r\n\t\tisScheduled ||\r\n\t\tisIneligibleStatus ||\r\n\t\t( postStatusHasChanged &&\r\n\t\t\t[ 'pending', 'draft' ].includes( postStatus ) )\r\n\t) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/* translators: button label text should, if possible, be under 16 characters. */\r\n\tconst label = isPending ? __( 'Save as pending' ) : __( 'Save draft' );\r\n\r\n\t/* translators: button label text should, if possible, be under 16 characters. */\r\n\tconst shortLabel = __( 'Save' );\r\n\r\n\tconst isSaved = forceSavedMessage || ( ! isNew && ! isDirty );\r\n\tconst isSavedState = isSaving || isSaved;\r\n\tconst isDisabled = isSaving || isSaved || ! isSaveable;\r\n\tlet text;\r\n\r\n\tif ( isSaving ) {\r\n\t\ttext = isAutosaving ? __( 'Autosaving' ) : __( 'Saving' );\r\n\t} else if ( isSaved ) {\r\n\t\ttext = __( 'Saved' );\r\n\t} else if ( isLargeViewport ) {\r\n\t\ttext = label;\r\n\t} else if ( showIconLabels ) {\r\n\t\ttext = shortLabel;\r\n\t}\r\n\r\n\t// Use common Button instance for all saved states so that focus is not\r\n\t// lost.\r\n\treturn (\r\n\t\t<Button\r\n\t\t\tclassName={\r\n\t\t\t\tisSaveable || isSaving\r\n\t\t\t\t\t? clsx( {\r\n\t\t\t\t\t\t\t'editor-post-save-draft': ! isSavedState,\r\n\t\t\t\t\t\t\t'editor-post-saved-state': isSavedState,\r\n\t\t\t\t\t\t\t'is-saving': isSaving,\r\n\t\t\t\t\t\t\t'is-autosaving': isAutosaving,\r\n\t\t\t\t\t\t\t'is-saved': isSaved,\r\n\t\t\t\t\t\t\t[ getAnimateClassName( {\r\n\t\t\t\t\t\t\t\ttype: 'loading',\r\n\t\t\t\t\t\t\t} ) ]: isSaving,\r\n\t\t\t\t\t  } )\r\n\t\t\t\t\t: undefined\r\n\t\t\t}\r\n\t\t\tonClick={ isDisabled ? undefined : () => savePost() }\r\n\t\t\t/*\r\n\t\t\t * We want the tooltip to show the keyboard shortcut only when the\r\n\t\t\t * button does something, i.e. when it's not disabled.\r\n\t\t\t */\r\n\t\t\tshortcut={ isDisabled ? undefined : displayShortcut.primary( 's' ) }\r\n\t\t\tvariant=\"tertiary\"\r\n\t\t\tsize=\"compact\"\r\n\t\t\ticon={ isLargeViewport ? undefined : cloudUpload }\r\n\t\t\tlabel={ text || label }\r\n\t\t\taria-disabled={ isDisabled }\r\n\t\t>\r\n\t\t\t{ isSavedState && <Icon icon={ isSaved ? check : cloud } /> }\r\n\t\t\t{ text }\r\n\t\t</Button>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}