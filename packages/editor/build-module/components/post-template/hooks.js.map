{"version":3,"names":["useSelect","useMemo","store","coreStore","editorStore","useEditedPostContext","select","getCurrentPostId","getCurrentPostType","postId","postType","useAllowSwitchingTemplates","canUser","getEntityRecord","getEntityRecords","siteSettings","kind","name","undefined","templates","per_page","isPostsPage","page_for_posts","isFrontPage","page_on_front","some","slug","useTemplates","post_type","useAvailableTemplates","currentTemplateSlug","useCurrentTemplateSlug","allowSwitchingTemplate","filter","template","is_custom","content","raw","entityTemplate","post","getEditedEntityRecord","find"],"sources":["@wordpress/editor/src/components/post-template/hooks.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useMemo } from '@wordpress/element';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editorStore } from '../../store';\r\n\r\nexport function useEditedPostContext() {\r\n\treturn useSelect( ( select ) => {\r\n\t\tconst { getCurrentPostId, getCurrentPostType } = select( editorStore );\r\n\t\treturn {\r\n\t\t\tpostId: getCurrentPostId(),\r\n\t\t\tpostType: getCurrentPostType(),\r\n\t\t};\r\n\t}, [] );\r\n}\r\nexport function useAllowSwitchingTemplates() {\r\n\tconst { postType, postId } = useEditedPostContext();\r\n\treturn useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { canUser, getEntityRecord, getEntityRecords } =\r\n\t\t\t\tselect( coreStore );\r\n\t\t\tconst siteSettings = canUser( 'read', {\r\n\t\t\t\tkind: 'root',\r\n\t\t\t\tname: 'site',\r\n\t\t\t} )\r\n\t\t\t\t? getEntityRecord( 'root', 'site' )\r\n\t\t\t\t: undefined;\r\n\t\t\tconst templates = getEntityRecords( 'postType', 'wp_template', {\r\n\t\t\t\tper_page: -1,\r\n\t\t\t} );\r\n\t\t\tconst isPostsPage = +postId === siteSettings?.page_for_posts;\r\n\t\t\t// If current page is set front page or posts page, we also need\r\n\t\t\t// to check if the current theme has a template for it. If not\r\n\t\t\tconst isFrontPage =\r\n\t\t\t\tpostType === 'page' &&\r\n\t\t\t\t+postId === siteSettings?.page_on_front &&\r\n\t\t\t\ttemplates?.some( ( { slug } ) => slug === 'front-page' );\r\n\t\t\treturn ! isPostsPage && ! isFrontPage;\r\n\t\t},\r\n\t\t[ postId, postType ]\r\n\t);\r\n}\r\n\r\nfunction useTemplates( postType ) {\r\n\treturn useSelect(\r\n\t\t( select ) =>\r\n\t\t\tselect( coreStore ).getEntityRecords( 'postType', 'wp_template', {\r\n\t\t\t\tper_page: -1,\r\n\t\t\t\tpost_type: postType,\r\n\t\t\t} ),\r\n\t\t[ postType ]\r\n\t);\r\n}\r\n\r\nexport function useAvailableTemplates( postType ) {\r\n\tconst currentTemplateSlug = useCurrentTemplateSlug();\r\n\tconst allowSwitchingTemplate = useAllowSwitchingTemplates();\r\n\tconst templates = useTemplates( postType );\r\n\treturn useMemo(\r\n\t\t() =>\r\n\t\t\tallowSwitchingTemplate &&\r\n\t\t\ttemplates?.filter(\r\n\t\t\t\t( template ) =>\r\n\t\t\t\t\ttemplate.is_custom &&\r\n\t\t\t\t\ttemplate.slug !== currentTemplateSlug &&\r\n\t\t\t\t\t!! template.content.raw // Skip empty templates.\r\n\t\t\t),\r\n\t\t[ templates, currentTemplateSlug, allowSwitchingTemplate ]\r\n\t);\r\n}\r\n\r\nexport function useCurrentTemplateSlug() {\r\n\tconst { postType, postId } = useEditedPostContext();\r\n\tconst templates = useTemplates( postType );\r\n\tconst entityTemplate = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst post = select( coreStore ).getEditedEntityRecord(\r\n\t\t\t\t'postType',\r\n\t\t\t\tpostType,\r\n\t\t\t\tpostId\r\n\t\t\t);\r\n\t\t\treturn post?.template;\r\n\t\t},\r\n\t\t[ postType, postId ]\r\n\t);\r\n\r\n\tif ( ! entityTemplate ) {\r\n\t\treturn;\r\n\t}\r\n\t// If a page has a `template` set and is not included in the list\r\n\t// of the theme's templates, do not return it, in order to resolve\r\n\t// to the current theme's default template.\r\n\treturn templates?.find( ( template ) => template.slug === entityTemplate )\r\n\t\t?.slug;\r\n}\r\n"],"mappings":"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","ignoreList":[]}