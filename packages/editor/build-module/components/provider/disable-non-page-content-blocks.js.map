{"version":3,"names":["useSelect","useRegistry","store","blockEditorStore","useEffect","useMemo","applyFilters","editorStore","unlock","POST_CONTENT_BLOCK_TYPES","DisableNonPageContentBlocks","contentOnlyBlockTypes","contentOnlyIds","select","getPostBlocksByName","disabledIds","getBlocksByName","getBlockOrder","flatMap","clientId","registry","setBlockEditingMode","unsetBlockEditingMode","dispatch","batch"],"sources":["@wordpress/editor/src/components/provider/disable-non-page-content-blocks.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect, useRegistry } from '@wordpress/data';\r\nimport { store as blockEditorStore } from '@wordpress/block-editor';\r\nimport { useEffect, useMemo } from '@wordpress/element';\r\nimport { applyFilters } from '@wordpress/hooks';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editorStore } from '../../store';\r\nimport { unlock } from '../../lock-unlock';\r\n\r\nconst POST_CONTENT_BLOCK_TYPES = [\r\n\t'core/post-title',\r\n\t'core/post-featured-image',\r\n\t'core/post-content',\r\n];\r\n\r\n/**\r\n * Component that when rendered, makes it so that the site editor allows only\r\n * page content to be edited.\r\n */\r\nexport default function DisableNonPageContentBlocks() {\r\n\tconst contentOnlyBlockTypes = useMemo(\r\n\t\t() => [\r\n\t\t\t...applyFilters(\r\n\t\t\t\t'editor.postContentBlockTypes',\r\n\t\t\t\tPOST_CONTENT_BLOCK_TYPES\r\n\t\t\t),\r\n\t\t\t'core/template-part',\r\n\t\t],\r\n\t\t[]\r\n\t);\r\n\r\n\t// Note that there are two separate subscriptions because the result for each\r\n\t// returns a new array.\r\n\tconst contentOnlyIds = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getPostBlocksByName } = unlock( select( editorStore ) );\r\n\t\t\treturn getPostBlocksByName( contentOnlyBlockTypes );\r\n\t\t},\r\n\t\t[ contentOnlyBlockTypes ]\r\n\t);\r\n\tconst disabledIds = useSelect( ( select ) => {\r\n\t\tconst { getBlocksByName, getBlockOrder } = select( blockEditorStore );\r\n\t\treturn getBlocksByName( 'core/template-part' ).flatMap( ( clientId ) =>\r\n\t\t\tgetBlockOrder( clientId )\r\n\t\t);\r\n\t}, [] );\r\n\r\n\tconst registry = useRegistry();\r\n\r\n\tuseEffect( () => {\r\n\t\tconst { setBlockEditingMode, unsetBlockEditingMode } =\r\n\t\t\tregistry.dispatch( blockEditorStore );\r\n\r\n\t\tregistry.batch( () => {\r\n\t\t\tsetBlockEditingMode( '', 'disabled' );\r\n\t\t\tfor ( const clientId of contentOnlyIds ) {\r\n\t\t\t\tsetBlockEditingMode( clientId, 'contentOnly' );\r\n\t\t\t}\r\n\t\t\tfor ( const clientId of disabledIds ) {\r\n\t\t\t\tsetBlockEditingMode( clientId, 'disabled' );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn () => {\r\n\t\t\tregistry.batch( () => {\r\n\t\t\t\tunsetBlockEditingMode( '' );\r\n\t\t\t\tfor ( const clientId of contentOnlyIds ) {\r\n\t\t\t\t\tunsetBlockEditingMode( clientId );\r\n\t\t\t\t}\r\n\t\t\t\tfor ( const clientId of disabledIds ) {\r\n\t\t\t\t\tunsetBlockEditingMode( clientId );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t};\r\n\t}, [ contentOnlyIds, disabledIds, registry ] );\r\n\r\n\treturn null;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACxD,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,yBAAyB;AACnE,SAASC,SAAS,EAAEC,OAAO,QAAQ,oBAAoB;AACvD,SAASC,YAAY,QAAQ,kBAAkB;;AAE/C;AACA;AACA;AACA,SAASJ,KAAK,IAAIK,WAAW,QAAQ,aAAa;AAClD,SAASC,MAAM,QAAQ,mBAAmB;AAE1C,MAAMC,wBAAwB,GAAG,CAChC,iBAAiB,EACjB,0BAA0B,EAC1B,mBAAmB,CACnB;;AAED;AACA;AACA;AACA;AACA,eAAe,SAASC,2BAA2BA,CAAA,EAAG;EACrD,MAAMC,qBAAqB,GAAGN,OAAO,CACpC,MAAM,CACL,GAAGC,YAAY,CACd,8BAA8B,EAC9BG,wBACD,CAAC,EACD,oBAAoB,CACpB,EACD,EACD,CAAC;;EAED;EACA;EACA,MAAMG,cAAc,GAAGZ,SAAS,CAC7Ba,MAAM,IAAM;IACb,MAAM;MAAEC;IAAoB,CAAC,GAAGN,MAAM,CAAEK,MAAM,CAAEN,WAAY,CAAE,CAAC;IAC/D,OAAOO,mBAAmB,CAAEH,qBAAsB,CAAC;EACpD,CAAC,EACD,CAAEA,qBAAqB,CACxB,CAAC;EACD,MAAMI,WAAW,GAAGf,SAAS,CAAIa,MAAM,IAAM;IAC5C,MAAM;MAAEG,eAAe;MAAEC;IAAc,CAAC,GAAGJ,MAAM,CAAEV,gBAAiB,CAAC;IACrE,OAAOa,eAAe,CAAE,oBAAqB,CAAC,CAACE,OAAO,CAAIC,QAAQ,IACjEF,aAAa,CAAEE,QAAS,CACzB,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,MAAMC,QAAQ,GAAGnB,WAAW,CAAC,CAAC;EAE9BG,SAAS,CAAE,MAAM;IAChB,MAAM;MAAEiB,mBAAmB;MAAEC;IAAsB,CAAC,GACnDF,QAAQ,CAACG,QAAQ,CAAEpB,gBAAiB,CAAC;IAEtCiB,QAAQ,CAACI,KAAK,CAAE,MAAM;MACrBH,mBAAmB,CAAE,EAAE,EAAE,UAAW,CAAC;MACrC,KAAM,MAAMF,QAAQ,IAAIP,cAAc,EAAG;QACxCS,mBAAmB,CAAEF,QAAQ,EAAE,aAAc,CAAC;MAC/C;MACA,KAAM,MAAMA,QAAQ,IAAIJ,WAAW,EAAG;QACrCM,mBAAmB,CAAEF,QAAQ,EAAE,UAAW,CAAC;MAC5C;IACD,CAAE,CAAC;IAEH,OAAO,MAAM;MACZC,QAAQ,CAACI,KAAK,CAAE,MAAM;QACrBF,qBAAqB,CAAE,EAAG,CAAC;QAC3B,KAAM,MAAMH,QAAQ,IAAIP,cAAc,EAAG;UACxCU,qBAAqB,CAAEH,QAAS,CAAC;QAClC;QACA,KAAM,MAAMA,QAAQ,IAAIJ,WAAW,EAAG;UACrCO,qBAAqB,CAAEH,QAAS,CAAC;QAClC;MACD,CAAE,CAAC;IACJ,CAAC;EACF,CAAC,EAAE,CAAEP,cAAc,EAAEG,WAAW,EAAEK,QAAQ,CAAG,CAAC;EAE9C,OAAO,IAAI;AACZ","ignoreList":[]}