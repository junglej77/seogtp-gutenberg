{"version":3,"names":["__","_x","useSelect","useDispatch","store","coreStore","Button","Dropdown","RadioControl","__experimentalVStack","VStack","__experimentalText","Text","useState","useMemo","__experimentalInspectorPopoverHeader","InspectorPopoverHeader","TEMPLATE_POST_TYPE","PostPanelRow","editorStore","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","COMMENT_OPTIONS","label","value","description","join","SiteDiscussion","editEntityRecord","allowCommentsOnNewPosts","isTemplate","postSlug","select","getEditedPostAttribute","getCurrentPostType","getEditedEntityRecord","canUser","siteSettings","kind","name","undefined","default_comment_status","popoverAnchor","setPopoverAnchor","popoverProps","anchor","placement","offset","shift","includes","setAllowCommentsOnNewPosts","newValue","ref","children","contentClassName","focusOnMount","renderToggle","isOpen","onToggle","size","variant","onClick","renderContent","onClose","title","spacing","className","hideLabelFromVision","options","onChange","selected"],"sources":["@wordpress/editor/src/components/site-discussion/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __, _x } from '@wordpress/i18n';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport {\r\n\tButton,\r\n\tDropdown,\r\n\tRadioControl,\r\n\t__experimentalVStack as VStack,\r\n\t__experimentalText as Text,\r\n} from '@wordpress/components';\r\nimport { useState, useMemo } from '@wordpress/element';\r\nimport { __experimentalInspectorPopoverHeader as InspectorPopoverHeader } from '@wordpress/block-editor';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { TEMPLATE_POST_TYPE } from '../../store/constants';\r\nimport PostPanelRow from '../post-panel-row';\r\nimport { store as editorStore } from '../../store';\r\n\r\nconst COMMENT_OPTIONS = [\r\n\t{\r\n\t\tlabel: _x( 'Open', 'Adjective: e.g. \"Comments are open\"' ),\r\n\t\tvalue: 'open',\r\n\t\tdescription: __( 'Visitors can add new comments and replies.' ),\r\n\t},\r\n\t{\r\n\t\tlabel: __( 'Closed' ),\r\n\t\tvalue: '',\r\n\t\tdescription: [\r\n\t\t\t__( 'Visitors cannot add new comments or replies.' ),\r\n\t\t\t__( 'Existing comments remain visible.' ),\r\n\t\t].join( ' ' ),\r\n\t},\r\n];\r\n\r\nexport default function SiteDiscussion() {\r\n\tconst { editEntityRecord } = useDispatch( coreStore );\r\n\tconst { allowCommentsOnNewPosts, isTemplate, postSlug } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getEditedPostAttribute, getCurrentPostType } =\r\n\t\t\t\tselect( editorStore );\r\n\t\t\tconst { getEditedEntityRecord, canUser } = select( coreStore );\r\n\t\t\tconst siteSettings = canUser( 'read', {\r\n\t\t\t\tkind: 'root',\r\n\t\t\t\tname: 'site',\r\n\t\t\t} )\r\n\t\t\t\t? getEditedEntityRecord( 'root', 'site' )\r\n\t\t\t\t: undefined;\r\n\t\t\treturn {\r\n\t\t\t\tisTemplate: getCurrentPostType() === TEMPLATE_POST_TYPE,\r\n\t\t\t\tpostSlug: getEditedPostAttribute( 'slug' ),\r\n\t\t\t\tallowCommentsOnNewPosts:\r\n\t\t\t\t\tsiteSettings?.default_comment_status || '',\r\n\t\t\t};\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\t// Use internal state instead of a ref to make sure that the component\r\n\t// re-renders when the popover's anchor updates.\r\n\tconst [ popoverAnchor, setPopoverAnchor ] = useState( null );\r\n\t// Memoize popoverProps to avoid returning a new object every time.\r\n\tconst popoverProps = useMemo(\r\n\t\t() => ( {\r\n\t\t\t// Anchor the popover to the middle of the entire row so that it doesn't\r\n\t\t\t// move around when the label changes.\r\n\t\t\tanchor: popoverAnchor,\r\n\t\t\tplacement: 'left-start',\r\n\t\t\toffset: 36,\r\n\t\t\tshift: true,\r\n\t\t} ),\r\n\t\t[ popoverAnchor ]\r\n\t);\r\n\r\n\tif ( ! isTemplate || ! [ 'home', 'index' ].includes( postSlug ) ) {\r\n\t\treturn null;\r\n\t}\r\n\tconst setAllowCommentsOnNewPosts = ( newValue ) => {\r\n\t\teditEntityRecord( 'root', 'site', undefined, {\r\n\t\t\tdefault_comment_status: newValue ? 'open' : null,\r\n\t\t} );\r\n\t};\r\n\treturn (\r\n\t\t<PostPanelRow label={ __( 'Discussion' ) } ref={ setPopoverAnchor }>\r\n\t\t\t<Dropdown\r\n\t\t\t\tpopoverProps={ popoverProps }\r\n\t\t\t\tcontentClassName=\"editor-site-discussion-dropdown__content\"\r\n\t\t\t\tfocusOnMount\r\n\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tsize=\"compact\"\r\n\t\t\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t\t\t\taria-expanded={ isOpen }\r\n\t\t\t\t\t\taria-label={ __( 'Change discussion settings' ) }\r\n\t\t\t\t\t\tonClick={ onToggle }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ allowCommentsOnNewPosts\r\n\t\t\t\t\t\t\t? __( 'Comments open' )\r\n\t\t\t\t\t\t\t: __( 'Comments closed' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t) }\r\n\t\t\t\trenderContent={ ( { onClose } ) => (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<InspectorPopoverHeader\r\n\t\t\t\t\t\t\ttitle={ __( 'Discussion' ) }\r\n\t\t\t\t\t\t\tonClose={ onClose }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<VStack spacing={ 3 }>\r\n\t\t\t\t\t\t\t<Text>\r\n\t\t\t\t\t\t\t\t{ __(\r\n\t\t\t\t\t\t\t\t\t'Changes will apply to new posts only. Individual posts may override these settings.'\r\n\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t</Text>\r\n\t\t\t\t\t\t\t<RadioControl\r\n\t\t\t\t\t\t\t\tclassName=\"editor-site-discussion__options\"\r\n\t\t\t\t\t\t\t\thideLabelFromVision\r\n\t\t\t\t\t\t\t\tlabel={ __( 'Comment status' ) }\r\n\t\t\t\t\t\t\t\toptions={ COMMENT_OPTIONS }\r\n\t\t\t\t\t\t\t\tonChange={ setAllowCommentsOnNewPosts }\r\n\t\t\t\t\t\t\t\tselected={ allowCommentsOnNewPosts }\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</VStack>\r\n\t\t\t\t\t</>\r\n\t\t\t\t) }\r\n\t\t\t/>\r\n\t\t</PostPanelRow>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}