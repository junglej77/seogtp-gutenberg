{"version":3,"names":["Modal","Flex","FlexItem","Button","__","useState","useMemo","useEffect","__experimentalBlockPatternsList","BlockPatternsList","useSelect","useAsyncList","parse","store","coreStore","useEntityBlockEditor","editorStore","TEMPLATE_POST_TYPE","jsx","_jsx","jsxs","_jsxs","useFallbackTemplateContent","slug","isCustom","select","getEntityRecord","getDefaultTemplateId","templateId","is_custom","ignore_empty","content","raw","undefined","useStartPatterns","fallbackContent","patterns","getCurrentPostType","getCurrentPostId","getBlockPatterns","postId","postType","record","currentThemeStylesheet","getCurrentTheme","stylesheet","injectThemeAttributeInBlockTemplateContent","block","innerBlocks","find","innerBlock","name","map","attributes","theme","blocks","title","filter","pattern","Array","isArray","templateTypes","some","templateType","startsWith","PatternSelection","onChoosePattern","onChange","blockPatterns","shownBlockPatterns","shownPatterns","onClickPattern","selection","StartModal","onClose","className","closeLabel","focusOnMount","onRequestClose","isFullScreen","children","justify","expanded","__next40pxDefaultSize","variant","onClick","StartTemplateOptions","isClosed","setIsClosed","shouldOpenModal","_postType","_postId","getEditedEntityRecord","hasEditsForEntityRecord","templateRecord","hasEdits"],"sources":["@wordpress/editor/src/components/start-template-options/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { Modal, Flex, FlexItem, Button } from '@wordpress/components';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useState, useMemo, useEffect } from '@wordpress/element';\r\nimport { __experimentalBlockPatternsList as BlockPatternsList } from '@wordpress/block-editor';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useAsyncList } from '@wordpress/compose';\r\nimport { parse } from '@wordpress/blocks';\r\nimport { store as coreStore, useEntityBlockEditor } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editorStore } from '../../store';\r\nimport { TEMPLATE_POST_TYPE } from '../../store/constants';\r\n\r\nfunction useFallbackTemplateContent( slug, isCustom = false ) {\r\n\treturn useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getEntityRecord, getDefaultTemplateId } =\r\n\t\t\t\tselect( coreStore );\r\n\t\t\tconst templateId = getDefaultTemplateId( {\r\n\t\t\t\tslug,\r\n\t\t\t\tis_custom: isCustom,\r\n\t\t\t\tignore_empty: true,\r\n\t\t\t} );\r\n\t\t\treturn templateId\r\n\t\t\t\t? getEntityRecord( 'postType', TEMPLATE_POST_TYPE, templateId )\r\n\t\t\t\t\t\t?.content?.raw\r\n\t\t\t\t: undefined;\r\n\t\t},\r\n\t\t[ slug, isCustom ]\r\n\t);\r\n}\r\n\r\nfunction useStartPatterns( fallbackContent ) {\r\n\tconst { slug, patterns } = useSelect( ( select ) => {\r\n\t\tconst { getCurrentPostType, getCurrentPostId } = select( editorStore );\r\n\t\tconst { getEntityRecord, getBlockPatterns } = select( coreStore );\r\n\t\tconst postId = getCurrentPostId();\r\n\t\tconst postType = getCurrentPostType();\r\n\t\tconst record = getEntityRecord( 'postType', postType, postId );\r\n\t\treturn {\r\n\t\t\tslug: record.slug,\r\n\t\t\tpatterns: getBlockPatterns(),\r\n\t\t};\r\n\t}, [] );\r\n\r\n\tconst currentThemeStylesheet = useSelect(\r\n\t\t( select ) => select( coreStore ).getCurrentTheme().stylesheet\r\n\t);\r\n\r\n\t// Duplicated from packages/block-library/src/pattern/edit.js.\r\n\tfunction injectThemeAttributeInBlockTemplateContent( block ) {\r\n\t\tif (\r\n\t\t\tblock.innerBlocks.find(\r\n\t\t\t\t( innerBlock ) => innerBlock.name === 'core/template-part'\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\tblock.innerBlocks = block.innerBlocks.map( ( innerBlock ) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tinnerBlock.name === 'core/template-part' &&\r\n\t\t\t\t\tinnerBlock.attributes.theme === undefined\r\n\t\t\t\t) {\r\n\t\t\t\t\tinnerBlock.attributes.theme = currentThemeStylesheet;\r\n\t\t\t\t}\r\n\t\t\t\treturn innerBlock;\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tblock.name === 'core/template-part' &&\r\n\t\t\tblock.attributes.theme === undefined\r\n\t\t) {\r\n\t\t\tblock.attributes.theme = currentThemeStylesheet;\r\n\t\t}\r\n\t\treturn block;\r\n\t}\r\n\r\n\treturn useMemo( () => {\r\n\t\t// filter patterns that are supposed to be used in the current template being edited.\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tname: 'fallback',\r\n\t\t\t\tblocks: parse( fallbackContent ),\r\n\t\t\t\ttitle: __( 'Fallback content' ),\r\n\t\t\t},\r\n\t\t\t...patterns\r\n\t\t\t\t.filter( ( pattern ) => {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\tArray.isArray( pattern.templateTypes ) &&\r\n\t\t\t\t\t\tpattern.templateTypes.some( ( templateType ) =>\r\n\t\t\t\t\t\t\tslug.startsWith( templateType )\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\t\t\t\t} )\r\n\t\t\t\t.map( ( pattern ) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...pattern,\r\n\t\t\t\t\t\tblocks: parse( pattern.content ).map( ( block ) =>\r\n\t\t\t\t\t\t\tinjectThemeAttributeInBlockTemplateContent( block )\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t};\r\n\t\t\t\t} ),\r\n\t\t];\r\n\t}, [ fallbackContent, slug, patterns ] );\r\n}\r\n\r\nfunction PatternSelection( { fallbackContent, onChoosePattern, postType } ) {\r\n\tconst [ , , onChange ] = useEntityBlockEditor( 'postType', postType );\r\n\tconst blockPatterns = useStartPatterns( fallbackContent );\r\n\tconst shownBlockPatterns = useAsyncList( blockPatterns );\r\n\treturn (\r\n\t\t<BlockPatternsList\r\n\t\t\tblockPatterns={ blockPatterns }\r\n\t\t\tshownPatterns={ shownBlockPatterns }\r\n\t\t\tonClickPattern={ ( pattern, blocks ) => {\r\n\t\t\t\tonChange( blocks, { selection: undefined } );\r\n\t\t\t\tonChoosePattern();\r\n\t\t\t} }\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nfunction StartModal( { slug, isCustom, onClose, postType } ) {\r\n\tconst fallbackContent = useFallbackTemplateContent( slug, isCustom );\r\n\tif ( ! fallbackContent ) {\r\n\t\treturn null;\r\n\t}\r\n\treturn (\r\n\t\t<Modal\r\n\t\t\tclassName=\"editor-start-template-options__modal\"\r\n\t\t\ttitle={ __( 'Choose a pattern' ) }\r\n\t\t\tcloseLabel={ __( 'Cancel' ) }\r\n\t\t\tfocusOnMount=\"firstElement\"\r\n\t\t\tonRequestClose={ onClose }\r\n\t\t\tisFullScreen\r\n\t\t>\r\n\t\t\t<div className=\"editor-start-template-options__modal-content\">\r\n\t\t\t\t<PatternSelection\r\n\t\t\t\t\tfallbackContent={ fallbackContent }\r\n\t\t\t\t\tslug={ slug }\r\n\t\t\t\t\tisCustom={ isCustom }\r\n\t\t\t\t\tpostType={ postType }\r\n\t\t\t\t\tonChoosePattern={ () => {\r\n\t\t\t\t\t\tonClose();\r\n\t\t\t\t\t} }\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<Flex\r\n\t\t\t\tclassName=\"editor-start-template-options__modal__actions\"\r\n\t\t\t\tjustify=\"flex-end\"\r\n\t\t\t\texpanded={ false }\r\n\t\t\t>\r\n\t\t\t\t<FlexItem>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t\t\t\tonClick={ onClose }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ __( 'Skip' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</FlexItem>\r\n\t\t\t</Flex>\r\n\t\t</Modal>\r\n\t);\r\n}\r\n\r\nexport default function StartTemplateOptions() {\r\n\tconst [ isClosed, setIsClosed ] = useState( false );\r\n\tconst { shouldOpenModal, slug, isCustom, postType, postId } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getCurrentPostType, getCurrentPostId } =\r\n\t\t\t\tselect( editorStore );\r\n\t\t\tconst _postType = getCurrentPostType();\r\n\t\t\tconst _postId = getCurrentPostId();\r\n\t\t\tconst { getEditedEntityRecord, hasEditsForEntityRecord } =\r\n\t\t\t\tselect( coreStore );\r\n\t\t\tconst templateRecord = getEditedEntityRecord(\r\n\t\t\t\t'postType',\r\n\t\t\t\t_postType,\r\n\t\t\t\t_postId\r\n\t\t\t);\r\n\t\t\tconst hasEdits = hasEditsForEntityRecord(\r\n\t\t\t\t'postType',\r\n\t\t\t\t_postType,\r\n\t\t\t\t_postId\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tshouldOpenModal:\r\n\t\t\t\t\t! hasEdits &&\r\n\t\t\t\t\t'' === templateRecord.content &&\r\n\t\t\t\t\tTEMPLATE_POST_TYPE === _postType,\r\n\t\t\t\tslug: templateRecord.slug,\r\n\t\t\t\tisCustom: templateRecord.is_custom,\r\n\t\t\t\tpostType: _postType,\r\n\t\t\t\tpostId: _postId,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\tuseEffect( () => {\r\n\t\t// Should reset the modal state when navigating to a new page/post.\r\n\t\tsetIsClosed( false );\r\n\t}, [ postType, postId ] );\r\n\r\n\tif ( ! shouldOpenModal || isClosed ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<StartModal\r\n\t\t\tslug={ slug }\r\n\t\t\tisCustom={ isCustom }\r\n\t\t\tpostType={ postType }\r\n\t\t\tonClose={ () => setIsClosed( true ) }\r\n\t\t/>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}