{"version":3,"names":["useDispatch","decodeEntities","store","coreStore","__","sprintf","_x","noticesStore","useState","DataForm","Button","__experimentalHStack","HStack","__experimentalVStack","VStack","getItemTitle","titleField","jsx","_jsx","jsxs","_jsxs","fields","formDuplicateAction","duplicatePost","id","label","isEligible","status","RenderModal","items","closeModal","onActionPerformed","item","setItem","title","isCreatingPage","setIsCreatingPage","saveEntityRecord","createSuccessNotice","createErrorNotice","createPage","event","preventDefault","newItemOject","slug","comment_status","content","raw","excerpt","meta","parent","password","template","format","featured_media","menu_order","ping_status","assignablePropertiesPrefix","assignableProperties","Object","keys","_links","filter","property","startsWith","map","slice","length","forEach","hasOwnProperty","newItem","type","throwOnError","rendered","error","typedError","errorMessage","message","code","onSubmit","children","spacing","data","form","onChange","changes","prev","justify","variant","onClick","__next40pxDefaultSize","isBusy"],"sources":["@wordpress/editor/src/dataviews/actions/duplicate-post.tsx"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { decodeEntities } from '@wordpress/html-entities';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { __, sprintf, _x } from '@wordpress/i18n';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { useState } from '@wordpress/element';\r\nimport { DataForm } from '@wordpress/dataviews';\r\nimport {\r\n\tButton,\r\n\t__experimentalHStack as HStack,\r\n\t__experimentalVStack as VStack,\r\n} from '@wordpress/components';\r\nimport type { Action } from '@wordpress/dataviews';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { getItemTitle } from '../../dataviews/actions/utils';\r\nimport type { CoreDataError, BasePost } from '../types';\r\nimport { titleField } from '../fields';\r\n\r\nconst fields = [ titleField ];\r\nconst formDuplicateAction = {\r\n\tfields: [ 'title' ],\r\n};\r\n\r\nconst duplicatePost: Action< BasePost > = {\r\n\tid: 'duplicate-post',\r\n\tlabel: _x( 'Duplicate', 'action label' ),\r\n\tisEligible( { status } ) {\r\n\t\treturn status !== 'trash';\r\n\t},\r\n\tRenderModal: ( { items, closeModal, onActionPerformed } ) => {\r\n\t\tconst [ item, setItem ] = useState< BasePost >( {\r\n\t\t\t...items[ 0 ],\r\n\t\t\ttitle: sprintf(\r\n\t\t\t\t/* translators: %s: Existing template title */\r\n\t\t\t\t__( '%s (Copy)' ),\r\n\t\t\t\tgetItemTitle( items[ 0 ] )\r\n\t\t\t),\r\n\t\t} );\r\n\r\n\t\tconst [ isCreatingPage, setIsCreatingPage ] = useState( false );\r\n\t\tconst { saveEntityRecord } = useDispatch( coreStore );\r\n\t\tconst { createSuccessNotice, createErrorNotice } =\r\n\t\t\tuseDispatch( noticesStore );\r\n\r\n\t\tasync function createPage( event: React.FormEvent ) {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tif ( isCreatingPage ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst newItemOject = {\r\n\t\t\t\tstatus: 'draft',\r\n\t\t\t\ttitle: item.title,\r\n\t\t\t\tslug: item.title || __( 'No title' ),\r\n\t\t\t\tcomment_status: item.comment_status,\r\n\t\t\t\tcontent:\r\n\t\t\t\t\ttypeof item.content === 'string'\r\n\t\t\t\t\t\t? item.content\r\n\t\t\t\t\t\t: item.content.raw,\r\n\t\t\t\texcerpt:\r\n\t\t\t\t\ttypeof item.excerpt === 'string'\r\n\t\t\t\t\t\t? item.excerpt\r\n\t\t\t\t\t\t: item.excerpt?.raw,\r\n\t\t\t\tmeta: item.meta,\r\n\t\t\t\tparent: item.parent,\r\n\t\t\t\tpassword: item.password,\r\n\t\t\t\ttemplate: item.template,\r\n\t\t\t\tformat: item.format,\r\n\t\t\t\tfeatured_media: item.featured_media,\r\n\t\t\t\tmenu_order: item.menu_order,\r\n\t\t\t\tping_status: item.ping_status,\r\n\t\t\t};\r\n\t\t\tconst assignablePropertiesPrefix = 'wp:action-assign-';\r\n\t\t\t// Get all the properties that the current user is able to assign normally author, categories, tags,\r\n\t\t\t// and custom taxonomies.\r\n\t\t\tconst assignableProperties = Object.keys( item?._links || {} )\r\n\t\t\t\t.filter( ( property ) =>\r\n\t\t\t\t\tproperty.startsWith( assignablePropertiesPrefix )\r\n\t\t\t\t)\r\n\t\t\t\t.map( ( property ) =>\r\n\t\t\t\t\tproperty.slice( assignablePropertiesPrefix.length )\r\n\t\t\t\t);\r\n\t\t\tassignableProperties.forEach( ( property ) => {\r\n\t\t\t\tif ( item.hasOwnProperty( property ) ) {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tnewItemOject[ property ] = item[ property ];\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t\tsetIsCreatingPage( true );\r\n\t\t\ttry {\r\n\t\t\t\tconst newItem = await saveEntityRecord(\r\n\t\t\t\t\t'postType',\r\n\t\t\t\t\titem.type,\r\n\t\t\t\t\tnewItemOject,\r\n\t\t\t\t\t{ throwOnError: true }\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcreateSuccessNotice(\r\n\t\t\t\t\tsprintf(\r\n\t\t\t\t\t\t// translators: %s: Title of the created template e.g: \"Category\".\r\n\t\t\t\t\t\t__( '\"%s\" successfully created.' ),\r\n\t\t\t\t\t\tdecodeEntities( newItem.title?.rendered || item.title )\r\n\t\t\t\t\t),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: 'duplicate-post-action',\r\n\t\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif ( onActionPerformed ) {\r\n\t\t\t\t\tonActionPerformed( [ newItem ] );\r\n\t\t\t\t}\r\n\t\t\t} catch ( error ) {\r\n\t\t\t\tconst typedError = error as CoreDataError;\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\ttypedError.message && typedError.code !== 'unknown_error'\r\n\t\t\t\t\t\t? typedError.message\r\n\t\t\t\t\t\t: __( 'An error occurred while duplicating the page.' );\r\n\r\n\t\t\t\tcreateErrorNotice( errorMessage, {\r\n\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t} );\r\n\t\t\t} finally {\r\n\t\t\t\tsetIsCreatingPage( false );\r\n\t\t\t\tcloseModal?.();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<form onSubmit={ createPage }>\r\n\t\t\t\t<VStack spacing={ 3 }>\r\n\t\t\t\t\t<DataForm\r\n\t\t\t\t\t\tdata={ item }\r\n\t\t\t\t\t\tfields={ fields }\r\n\t\t\t\t\t\tform={ formDuplicateAction }\r\n\t\t\t\t\t\tonChange={ ( changes ) =>\r\n\t\t\t\t\t\t\tsetItem( ( prev ) => ( {\r\n\t\t\t\t\t\t\t\t...prev,\r\n\t\t\t\t\t\t\t\t...changes,\r\n\t\t\t\t\t\t\t} ) )\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<HStack spacing={ 2 } justify=\"end\">\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t\t\t\t\tonClick={ closeModal }\r\n\t\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{ __( 'Cancel' ) }\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t\tisBusy={ isCreatingPage }\r\n\t\t\t\t\t\t\taria-disabled={ isCreatingPage }\r\n\t\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{ _x( 'Duplicate', 'action label' ) }\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</HStack>\r\n\t\t\t\t</VStack>\r\n\t\t\t</form>\r\n\t\t);\r\n\t},\r\n};\r\n\r\nexport default duplicatePost;\r\n"],"mappings":"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","ignoreList":[]}