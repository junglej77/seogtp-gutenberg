{"version":3,"names":["paramCase","kebabCase","downloadZip","downloadBlob","__","download","getItemTitle","getJsonFromItem","item","JSON","stringify","__file","type","title","content","raw","syncStatus","wp_pattern_sync_status","exportPattern","id","label","icon","supportsBulk","isEligible","callback","items","length","slug","nameCount","filesToZip","map","name","lastModified","Date","input","blob"],"sources":["@wordpress/editor/src/dataviews/actions/export-pattern.tsx"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport { paramCase as kebabCase } from 'change-case';\r\nimport { downloadZip } from 'client-zip';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { downloadBlob } from '@wordpress/blob';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { download } from '@wordpress/icons';\r\nimport type { Action } from '@wordpress/dataviews';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport type { Pattern } from '../types';\r\nimport { getItemTitle } from './utils';\r\n\r\nfunction getJsonFromItem( item: Pattern ) {\r\n\treturn JSON.stringify(\r\n\t\t{\r\n\t\t\t__file: item.type,\r\n\t\t\ttitle: getItemTitle( item ),\r\n\t\t\tcontent:\r\n\t\t\t\ttypeof item.content === 'string'\r\n\t\t\t\t\t? item.content\r\n\t\t\t\t\t: item.content?.raw,\r\n\t\t\tsyncStatus: item.wp_pattern_sync_status,\r\n\t\t},\r\n\t\tnull,\r\n\t\t2\r\n\t);\r\n}\r\n\r\nconst exportPattern: Action< Pattern > = {\r\n\tid: 'export-pattern',\r\n\tlabel: __( 'Export as JSON' ),\r\n\ticon: download,\r\n\tsupportsBulk: true,\r\n\tisEligible: ( item ) => item.type === 'wp_block',\r\n\tcallback: async ( items ) => {\r\n\t\tif ( items.length === 1 ) {\r\n\t\t\treturn downloadBlob(\r\n\t\t\t\t`${ kebabCase(\r\n\t\t\t\t\tgetItemTitle( items[ 0 ] ) || items[ 0 ].slug\r\n\t\t\t\t) }.json`,\r\n\t\t\t\tgetJsonFromItem( items[ 0 ] ),\r\n\t\t\t\t'application/json'\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst nameCount: Record< string, number > = {};\r\n\t\tconst filesToZip = items.map( ( item ) => {\r\n\t\t\tconst name = kebabCase( getItemTitle( item ) || item.slug );\r\n\t\t\tnameCount[ name ] = ( nameCount[ name ] || 0 ) + 1;\r\n\t\t\treturn {\r\n\t\t\t\tname: `${\r\n\t\t\t\t\tname +\r\n\t\t\t\t\t( nameCount[ name ] > 1\r\n\t\t\t\t\t\t? '-' + ( nameCount[ name ] - 1 )\r\n\t\t\t\t\t\t: '' )\r\n\t\t\t\t}.json`,\r\n\t\t\t\tlastModified: new Date(),\r\n\t\t\t\tinput: getJsonFromItem( item ),\r\n\t\t\t};\r\n\t\t} );\r\n\t\treturn downloadBlob(\r\n\t\t\t__( 'patterns-export' ) + '.zip',\r\n\t\t\tawait downloadZip( filesToZip ).blob(),\r\n\t\t\t'application/zip'\r\n\t\t);\r\n\t},\r\n};\r\n\r\nexport default exportPattern;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,IAAIC,SAAS,QAAQ,aAAa;AACpD,SAASC,WAAW,QAAQ,YAAY;;AAExC;AACA;AACA;AACA,SAASC,YAAY,QAAQ,iBAAiB;AAC9C,SAASC,EAAE,QAAQ,iBAAiB;AACpC,SAASC,QAAQ,QAAQ,kBAAkB;;AAG3C;AACA;AACA;;AAEA,SAASC,YAAY,QAAQ,SAAS;AAEtC,SAASC,eAAeA,CAAEC,IAAa,EAAG;EACzC,OAAOC,IAAI,CAACC,SAAS,CACpB;IACCC,MAAM,EAAEH,IAAI,CAACI,IAAI;IACjBC,KAAK,EAAEP,YAAY,CAAEE,IAAK,CAAC;IAC3BM,OAAO,EACN,OAAON,IAAI,CAACM,OAAO,KAAK,QAAQ,GAC7BN,IAAI,CAACM,OAAO,GACZN,IAAI,CAACM,OAAO,EAAEC,GAAG;IACrBC,UAAU,EAAER,IAAI,CAACS;EAClB,CAAC,EACD,IAAI,EACJ,CACD,CAAC;AACF;AAEA,MAAMC,aAAgC,GAAG;EACxCC,EAAE,EAAE,gBAAgB;EACpBC,KAAK,EAAEhB,EAAE,CAAE,gBAAiB,CAAC;EAC7BiB,IAAI,EAAEhB,QAAQ;EACdiB,YAAY,EAAE,IAAI;EAClBC,UAAU,EAAIf,IAAI,IAAMA,IAAI,CAACI,IAAI,KAAK,UAAU;EAChDY,QAAQ,EAAE,MAAQC,KAAK,IAAM;IAC5B,IAAKA,KAAK,CAACC,MAAM,KAAK,CAAC,EAAG;MACzB,OAAOvB,YAAY,CACjB,GAAGF,SAAS,CACZK,YAAY,CAAEmB,KAAK,CAAE,CAAC,CAAG,CAAC,IAAIA,KAAK,CAAE,CAAC,CAAE,CAACE,IAC1C,CAAG,OAAM,EACTpB,eAAe,CAAEkB,KAAK,CAAE,CAAC,CAAG,CAAC,EAC7B,kBACD,CAAC;IACF;IACA,MAAMG,SAAmC,GAAG,CAAC,CAAC;IAC9C,MAAMC,UAAU,GAAGJ,KAAK,CAACK,GAAG,CAAItB,IAAI,IAAM;MACzC,MAAMuB,IAAI,GAAG9B,SAAS,CAAEK,YAAY,CAAEE,IAAK,CAAC,IAAIA,IAAI,CAACmB,IAAK,CAAC;MAC3DC,SAAS,CAAEG,IAAI,CAAE,GAAG,CAAEH,SAAS,CAAEG,IAAI,CAAE,IAAI,CAAC,IAAK,CAAC;MAClD,OAAO;QACNA,IAAI,EAAG,GACNA,IAAI,IACFH,SAAS,CAAEG,IAAI,CAAE,GAAG,CAAC,GACpB,GAAG,IAAKH,SAAS,CAAEG,IAAI,CAAE,GAAG,CAAC,CAAE,GAC/B,EAAE,CACL,OAAM;QACPC,YAAY,EAAE,IAAIC,IAAI,CAAC,CAAC;QACxBC,KAAK,EAAE3B,eAAe,CAAEC,IAAK;MAC9B,CAAC;IACF,CAAE,CAAC;IACH,OAAOL,YAAY,CAClBC,EAAE,CAAE,iBAAkB,CAAC,GAAG,MAAM,EAChC,MAAMF,WAAW,CAAE2B,UAAW,CAAC,CAACM,IAAI,CAAC,CAAC,EACtC,iBACD,CAAC;EACF;AACD,CAAC;AAED,eAAejB,aAAa","ignoreList":[]}