{"version":3,"names":["useDispatch","store","coreStore","__","useState","privateApis","patternsPrivateApis","Button","TextControl","__experimentalHStack","HStack","__experimentalVStack","VStack","noticesStore","TEMPLATE_ORIGINS","TEMPLATE_PART_POST_TYPE","TEMPLATE_POST_TYPE","unlock","getItemTitle","isTemplateRemovable","isTemplate","isTemplatePart","jsx","_jsx","jsxs","_jsxs","PATTERN_TYPES","renamePost","id","label","isEligible","post","status","Object","values","includes","type","permissions","update","is_custom","source","custom","has_theme_file","user","RenderModal","items","closeModal","onActionPerformed","item","title","setTitle","editEntityRecord","saveEditedEntityRecord","createSuccessNotice","createErrorNotice","onRename","event","preventDefault","throwOnError","error","typedError","errorMessage","message","code","onSubmit","children","spacing","__nextHasNoMarginBottom","__next40pxDefaultSize","value","onChange","required","justify","variant","onClick"],"sources":["@wordpress/editor/src/dataviews/actions/rename-post.tsx"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useState } from '@wordpress/element';\r\n// @ts-ignore\r\nimport { privateApis as patternsPrivateApis } from '@wordpress/patterns';\r\nimport {\r\n\tButton,\r\n\tTextControl,\r\n\t__experimentalHStack as HStack,\r\n\t__experimentalVStack as VStack,\r\n} from '@wordpress/components';\r\nimport type { Action } from '@wordpress/dataviews';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport {\r\n\tTEMPLATE_ORIGINS,\r\n\tTEMPLATE_PART_POST_TYPE,\r\n\tTEMPLATE_POST_TYPE,\r\n} from '../../store/constants';\r\nimport { unlock } from '../../lock-unlock';\r\nimport {\r\n\tgetItemTitle,\r\n\tisTemplateRemovable,\r\n\tisTemplate,\r\n\tisTemplatePart,\r\n} from './utils';\r\nimport type { CoreDataError, PostWithPermissions } from '../types';\r\n\r\n// Patterns.\r\nconst { PATTERN_TYPES } = unlock( patternsPrivateApis );\r\n\r\nconst renamePost: Action< PostWithPermissions > = {\r\n\tid: 'rename-post',\r\n\tlabel: __( 'Rename' ),\r\n\tisEligible( post ) {\r\n\t\tif ( post.status === 'trash' ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// Templates, template parts and patterns have special checks for renaming.\r\n\t\tif (\r\n\t\t\t! [\r\n\t\t\t\tTEMPLATE_POST_TYPE,\r\n\t\t\t\tTEMPLATE_PART_POST_TYPE,\r\n\t\t\t\t...Object.values( PATTERN_TYPES ),\r\n\t\t\t].includes( post.type )\r\n\t\t) {\r\n\t\t\treturn post.permissions?.update;\r\n\t\t}\r\n\r\n\t\t// In the case of templates, we can only rename custom templates.\r\n\t\tif ( isTemplate( post ) ) {\r\n\t\t\treturn (\r\n\t\t\t\tisTemplateRemovable( post ) &&\r\n\t\t\t\tpost.is_custom &&\r\n\t\t\t\tpost.permissions?.update\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ( isTemplatePart( post ) ) {\r\n\t\t\treturn (\r\n\t\t\t\tpost.source === TEMPLATE_ORIGINS.custom &&\r\n\t\t\t\t! post?.has_theme_file &&\r\n\t\t\t\tpost.permissions?.update\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn post.type === PATTERN_TYPES.user && post.permissions?.update;\r\n\t},\r\n\tRenderModal: ( { items, closeModal, onActionPerformed } ) => {\r\n\t\tconst [ item ] = items;\r\n\t\tconst [ title, setTitle ] = useState( () => getItemTitle( item ) );\r\n\t\tconst { editEntityRecord, saveEditedEntityRecord } =\r\n\t\t\tuseDispatch( coreStore );\r\n\t\tconst { createSuccessNotice, createErrorNotice } =\r\n\t\t\tuseDispatch( noticesStore );\r\n\r\n\t\tasync function onRename( event: React.FormEvent ) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\ttry {\r\n\t\t\t\tawait editEntityRecord( 'postType', item.type, item.id, {\r\n\t\t\t\t\ttitle,\r\n\t\t\t\t} );\r\n\t\t\t\t// Update state before saving rerenders the list.\r\n\t\t\t\tsetTitle( '' );\r\n\t\t\t\tcloseModal?.();\r\n\t\t\t\t// Persist edited entity.\r\n\t\t\t\tawait saveEditedEntityRecord( 'postType', item.type, item.id, {\r\n\t\t\t\t\tthrowOnError: true,\r\n\t\t\t\t} );\r\n\t\t\t\tcreateSuccessNotice( __( 'Name updated' ), {\r\n\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t} );\r\n\t\t\t\tonActionPerformed?.( items );\r\n\t\t\t} catch ( error ) {\r\n\t\t\t\tconst typedError = error as CoreDataError;\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\ttypedError.message && typedError.code !== 'unknown_error'\r\n\t\t\t\t\t\t? typedError.message\r\n\t\t\t\t\t\t: __( 'An error occurred while updating the name' );\r\n\t\t\t\tcreateErrorNotice( errorMessage, { type: 'snackbar' } );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<form onSubmit={ onRename }>\r\n\t\t\t\t<VStack spacing=\"5\">\r\n\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\tlabel={ __( 'Name' ) }\r\n\t\t\t\t\t\tvalue={ title }\r\n\t\t\t\t\t\tonChange={ setTitle }\r\n\t\t\t\t\t\trequired\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<HStack justify=\"right\">\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t\t\t\t\tonClick={ () => {\r\n\t\t\t\t\t\t\t\tcloseModal?.();\r\n\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{ __( 'Cancel' ) }\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{ __( 'Save' ) }\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</HStack>\r\n\t\t\t\t</VStack>\r\n\t\t\t</form>\r\n\t\t);\r\n\t},\r\n};\r\n\r\nexport default renamePost;\r\n"],"mappings":"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","ignoreList":[]}