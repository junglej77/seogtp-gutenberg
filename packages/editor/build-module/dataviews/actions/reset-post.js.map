{"version":3,"names":["backup","useDispatch","store","coreStore","__","sprintf","noticesStore","useState","Button","__experimentalText","Text","__experimentalHStack","HStack","__experimentalVStack","VStack","TEMPLATE_POST_TYPE","TEMPLATE_ORIGINS","editorStore","unlock","isTemplateOrTemplatePart","getItemTitle","jsx","_jsx","jsxs","_jsxs","resetPost","id","label","isEligible","item","source","custom","Boolean","type","plugin","has_theme_file","icon","supportsBulk","hideModalHeader","RenderModal","items","closeModal","onActionPerformed","isBusy","setIsBusy","revertTemplate","saveEditedEntityRecord","createSuccessNotice","createErrorNotice","onConfirm","template","allowUndo","length","error","fallbackErrorMessage","typedError","errorMessage","message","code","spacing","children","justify","__next40pxDefaultSize","variant","onClick","disabled","accessibleWhenDisabled"],"sources":["@wordpress/editor/src/dataviews/actions/reset-post.tsx"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { backup } from '@wordpress/icons';\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { useState } from '@wordpress/element';\r\nimport {\r\n\tButton,\r\n\t__experimentalText as Text,\r\n\t__experimentalHStack as HStack,\r\n\t__experimentalVStack as VStack,\r\n} from '@wordpress/components';\r\nimport type { Action } from '@wordpress/dataviews';\r\nimport type { StoreDescriptor } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { TEMPLATE_POST_TYPE, TEMPLATE_ORIGINS } from '../../store/constants';\r\nimport { store as editorStore } from '../../store';\r\nimport { unlock } from '../../lock-unlock';\r\nimport type { Post, CoreDataError } from '../types';\r\nimport { isTemplateOrTemplatePart, getItemTitle } from './utils';\r\n\r\nconst resetPost: Action< Post > = {\r\n\tid: 'reset-post',\r\n\tlabel: __( 'Reset' ),\r\n\tisEligible: ( item ) => {\r\n\t\treturn (\r\n\t\t\tisTemplateOrTemplatePart( item ) &&\r\n\t\t\titem?.source === TEMPLATE_ORIGINS.custom &&\r\n\t\t\t( Boolean( item.type === 'wp_template' && item?.plugin ) ||\r\n\t\t\t\titem?.has_theme_file )\r\n\t\t);\r\n\t},\r\n\ticon: backup,\r\n\tsupportsBulk: true,\r\n\thideModalHeader: true,\r\n\tRenderModal: ( { items, closeModal, onActionPerformed } ) => {\r\n\t\tconst [ isBusy, setIsBusy ] = useState( false );\r\n\t\tconst { revertTemplate } = unlock(\r\n\t\t\tuseDispatch( editorStore as StoreDescriptor )\r\n\t\t);\r\n\t\tconst { saveEditedEntityRecord } = useDispatch( coreStore );\r\n\t\tconst { createSuccessNotice, createErrorNotice } =\r\n\t\t\tuseDispatch( noticesStore );\r\n\t\tconst onConfirm = async () => {\r\n\t\t\ttry {\r\n\t\t\t\tfor ( const template of items ) {\r\n\t\t\t\t\tawait revertTemplate( template, {\r\n\t\t\t\t\t\tallowUndo: false,\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tawait saveEditedEntityRecord(\r\n\t\t\t\t\t\t'postType',\r\n\t\t\t\t\t\ttemplate.type,\r\n\t\t\t\t\t\ttemplate.id\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tcreateSuccessNotice(\r\n\t\t\t\t\titems.length > 1\r\n\t\t\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t\t\t/* translators: The number of items. */\r\n\t\t\t\t\t\t\t\t__( '%s items reset.' ),\r\n\t\t\t\t\t\t\t\titems.length\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: sprintf(\r\n\t\t\t\t\t\t\t\t/* translators: The template/part's name. */\r\n\t\t\t\t\t\t\t\t__( '\"%s\" reset.' ),\r\n\t\t\t\t\t\t\t\tgetItemTitle( items[ 0 ] )\r\n\t\t\t\t\t\t  ),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\t\tid: 'revert-template-action',\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} catch ( error ) {\r\n\t\t\t\tlet fallbackErrorMessage;\r\n\t\t\t\tif ( items[ 0 ].type === TEMPLATE_POST_TYPE ) {\r\n\t\t\t\t\tfallbackErrorMessage =\r\n\t\t\t\t\t\titems.length === 1\r\n\t\t\t\t\t\t\t? __(\r\n\t\t\t\t\t\t\t\t\t'An error occurred while reverting the template.'\r\n\t\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t\t: __(\r\n\t\t\t\t\t\t\t\t\t'An error occurred while reverting the templates.'\r\n\t\t\t\t\t\t\t  );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfallbackErrorMessage =\r\n\t\t\t\t\t\titems.length === 1\r\n\t\t\t\t\t\t\t? __(\r\n\t\t\t\t\t\t\t\t\t'An error occurred while reverting the template part.'\r\n\t\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t\t: __(\r\n\t\t\t\t\t\t\t\t\t'An error occurred while reverting the template parts.'\r\n\t\t\t\t\t\t\t  );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst typedError = error as CoreDataError;\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\ttypedError.message && typedError.code !== 'unknown_error'\r\n\t\t\t\t\t\t? typedError.message\r\n\t\t\t\t\t\t: fallbackErrorMessage;\r\n\r\n\t\t\t\tcreateErrorNotice( errorMessage, { type: 'snackbar' } );\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn (\r\n\t\t\t<VStack spacing=\"5\">\r\n\t\t\t\t<Text>\r\n\t\t\t\t\t{ __( 'Reset to default and clear all customizations?' ) }\r\n\t\t\t\t</Text>\r\n\t\t\t\t<HStack justify=\"right\">\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t\t\t\tonClick={ closeModal }\r\n\t\t\t\t\t\tdisabled={ isBusy }\r\n\t\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ __( 'Cancel' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t\tonClick={ async () => {\r\n\t\t\t\t\t\t\tsetIsBusy( true );\r\n\t\t\t\t\t\t\tawait onConfirm();\r\n\t\t\t\t\t\t\tonActionPerformed?.( items );\r\n\t\t\t\t\t\t\tsetIsBusy( false );\r\n\t\t\t\t\t\t\tcloseModal?.();\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tisBusy={ isBusy }\r\n\t\t\t\t\t\tdisabled={ isBusy }\r\n\t\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ __( 'Reset' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</HStack>\r\n\t\t\t</VStack>\r\n\t\t);\r\n\t},\r\n};\r\n\r\nexport default resetPost;\r\n"],"mappings":"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","ignoreList":[]}