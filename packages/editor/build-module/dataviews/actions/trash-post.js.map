{"version":3,"names":["trash","useDispatch","store","coreStore","__","_n","sprintf","_x","noticesStore","useState","Button","__experimentalText","Text","__experimentalHStack","HStack","__experimentalVStack","VStack","getItemTitle","isTemplateOrTemplatePart","jsx","_jsx","jsxs","_jsxs","trashPost","id","label","isPrimary","icon","isEligible","item","type","status","includes","permissions","delete","supportsBulk","hideModalHeader","RenderModal","items","closeModal","onActionPerformed","isBusy","setIsBusy","createSuccessNotice","createErrorNotice","deleteEntityRecord","spacing","children","length","justify","__next40pxDefaultSize","variant","onClick","disabled","accessibleWhenDisabled","promiseResult","Promise","allSettled","map","toString","throwOnError","every","successMessage","errorMessage","typedError","reason","message","errorMessages","Set","failedPromises","filter","failedPromise","add","size","join"],"sources":["@wordpress/editor/src/dataviews/actions/trash-post.tsx"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { trash } from '@wordpress/icons';\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { __, _n, sprintf, _x } from '@wordpress/i18n';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { useState } from '@wordpress/element';\r\nimport {\r\n\tButton,\r\n\t__experimentalText as Text,\r\n\t__experimentalHStack as HStack,\r\n\t__experimentalVStack as VStack,\r\n} from '@wordpress/components';\r\nimport type { Action } from '@wordpress/dataviews';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { getItemTitle, isTemplateOrTemplatePart } from './utils';\r\nimport type { CoreDataError, PostWithPermissions } from '../types';\r\n\r\nconst trashPost: Action< PostWithPermissions > = {\r\n\tid: 'move-to-trash',\r\n\tlabel: __( 'Move to trash' ),\r\n\tisPrimary: true,\r\n\ticon: trash,\r\n\tisEligible( item ) {\r\n\t\tif ( isTemplateOrTemplatePart( item ) || item.type === 'wp_block' ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t!! item.status &&\r\n\t\t\t! [ 'auto-draft', 'trash' ].includes( item.status ) &&\r\n\t\t\titem.permissions?.delete\r\n\t\t);\r\n\t},\r\n\tsupportsBulk: true,\r\n\thideModalHeader: true,\r\n\tRenderModal: ( { items, closeModal, onActionPerformed } ) => {\r\n\t\tconst [ isBusy, setIsBusy ] = useState( false );\r\n\t\tconst { createSuccessNotice, createErrorNotice } =\r\n\t\t\tuseDispatch( noticesStore );\r\n\t\tconst { deleteEntityRecord } = useDispatch( coreStore );\r\n\t\treturn (\r\n\t\t\t<VStack spacing=\"5\">\r\n\t\t\t\t<Text>\r\n\t\t\t\t\t{ items.length === 1\r\n\t\t\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t\t\t// translators: %s: The item's title.\r\n\t\t\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t\t\t'Are you sure you want to move \"%s\" to the trash?'\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\tgetItemTitle( items[ 0 ] )\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: sprintf(\r\n\t\t\t\t\t\t\t\t// translators: %d: The number of items (2 or more).\r\n\t\t\t\t\t\t\t\t_n(\r\n\t\t\t\t\t\t\t\t\t'Are you sure you want to move %d item to the trash ?',\r\n\t\t\t\t\t\t\t\t\t'Are you sure you want to move %d items to the trash ?',\r\n\t\t\t\t\t\t\t\t\titems.length\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\titems.length\r\n\t\t\t\t\t\t  ) }\r\n\t\t\t\t</Text>\r\n\t\t\t\t<HStack justify=\"right\">\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t\t\t\tonClick={ closeModal }\r\n\t\t\t\t\t\tdisabled={ isBusy }\r\n\t\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ __( 'Cancel' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t\tonClick={ async () => {\r\n\t\t\t\t\t\t\tsetIsBusy( true );\r\n\t\t\t\t\t\t\tconst promiseResult = await Promise.allSettled(\r\n\t\t\t\t\t\t\t\titems.map( ( item ) =>\r\n\t\t\t\t\t\t\t\t\tdeleteEntityRecord(\r\n\t\t\t\t\t\t\t\t\t\t'postType',\r\n\t\t\t\t\t\t\t\t\t\titem.type,\r\n\t\t\t\t\t\t\t\t\t\titem.id.toString(),\r\n\t\t\t\t\t\t\t\t\t\t{},\r\n\t\t\t\t\t\t\t\t\t\t{ throwOnError: true }\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t// If all the promises were fulfilled with success.\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tpromiseResult.every(\r\n\t\t\t\t\t\t\t\t\t( { status } ) => status === 'fulfilled'\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tlet successMessage;\r\n\t\t\t\t\t\t\t\tif ( promiseResult.length === 1 ) {\r\n\t\t\t\t\t\t\t\t\tsuccessMessage = sprintf(\r\n\t\t\t\t\t\t\t\t\t\t/* translators: The item's title. */\r\n\t\t\t\t\t\t\t\t\t\t__( '\"%s\" moved to the trash.' ),\r\n\t\t\t\t\t\t\t\t\t\tgetItemTitle( items[ 0 ] )\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tsuccessMessage = sprintf(\r\n\t\t\t\t\t\t\t\t\t\t/* translators: The number of items. */\r\n\t\t\t\t\t\t\t\t\t\t_n(\r\n\t\t\t\t\t\t\t\t\t\t\t'%s item moved to the trash.',\r\n\t\t\t\t\t\t\t\t\t\t\t'%s items moved to the trash.',\r\n\t\t\t\t\t\t\t\t\t\t\titems.length\r\n\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t\titems.length\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcreateSuccessNotice( successMessage, {\r\n\t\t\t\t\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\t\t\t\t\tid: 'move-to-trash-action',\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// If there was at least one failure.\r\n\t\t\t\t\t\t\t\tlet errorMessage;\r\n\t\t\t\t\t\t\t\t// If we were trying to delete a single item.\r\n\t\t\t\t\t\t\t\tif ( promiseResult.length === 1 ) {\r\n\t\t\t\t\t\t\t\t\tconst typedError = promiseResult[ 0 ] as {\r\n\t\t\t\t\t\t\t\t\t\treason?: CoreDataError;\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\tif ( typedError.reason?.message ) {\r\n\t\t\t\t\t\t\t\t\t\terrorMessage =\r\n\t\t\t\t\t\t\t\t\t\t\ttypedError.reason.message;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\terrorMessage = __(\r\n\t\t\t\t\t\t\t\t\t\t\t'An error occurred while moving the item to the trash.'\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// If we were trying to delete multiple items.\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconst errorMessages = new Set();\r\n\t\t\t\t\t\t\t\t\tconst failedPromises = promiseResult.filter(\r\n\t\t\t\t\t\t\t\t\t\t( { status } ) => status === 'rejected'\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\tfor ( const failedPromise of failedPromises ) {\r\n\t\t\t\t\t\t\t\t\t\tconst typedError = failedPromise as {\r\n\t\t\t\t\t\t\t\t\t\t\treason?: CoreDataError;\r\n\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\tif ( typedError.reason?.message ) {\r\n\t\t\t\t\t\t\t\t\t\t\terrorMessages.add(\r\n\t\t\t\t\t\t\t\t\t\t\t\ttypedError.reason.message\r\n\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif ( errorMessages.size === 0 ) {\r\n\t\t\t\t\t\t\t\t\t\terrorMessage = __(\r\n\t\t\t\t\t\t\t\t\t\t\t'An error occurred while moving the items to the trash.'\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t} else if ( errorMessages.size === 1 ) {\r\n\t\t\t\t\t\t\t\t\t\terrorMessage = sprintf(\r\n\t\t\t\t\t\t\t\t\t\t\t/* translators: %s: an error message */\r\n\t\t\t\t\t\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t\t\t\t\t\t'An error occurred while moving the item to the trash: %s'\r\n\t\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t\t\t[ ...errorMessages ][ 0 ]\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\terrorMessage = sprintf(\r\n\t\t\t\t\t\t\t\t\t\t\t/* translators: %s: a list of comma separated error messages */\r\n\t\t\t\t\t\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Some errors occurred while moving the items to the trash: %s'\r\n\t\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t\t\t[ ...errorMessages ].join( ',' )\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcreateErrorNotice( errorMessage, {\r\n\t\t\t\t\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif ( onActionPerformed ) {\r\n\t\t\t\t\t\t\t\tonActionPerformed( items );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsetIsBusy( false );\r\n\t\t\t\t\t\t\tcloseModal?.();\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tisBusy={ isBusy }\r\n\t\t\t\t\t\tdisabled={ isBusy }\r\n\t\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ _x( 'Trash', 'verb' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</HStack>\r\n\t\t\t</VStack>\r\n\t\t);\r\n\t},\r\n};\r\n\r\nexport default trashPost;\r\n"],"mappings":"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","ignoreList":[]}