{"version":3,"names":["useSelect","useEntityProp","useMemo","createHigherOrderComponent","addFilter","store","editorStore","jsx","_jsx","createWithMetaAttributeSource","metaAttributes","BlockEdit","attributes","setAttributes","props","postType","select","getCurrentPostType","meta","setMeta","mergedAttributes","Object","fromEntries","entries","map","attributeKey","metaKey","nextAttributes","nextMeta","filter","key","value","length","shimAttributeSource","settings","_settings$attributes","source","edit"],"sources":["@wordpress/editor/src/hooks/custom-sources-backwards-compatibility.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useEntityProp } from '@wordpress/core-data';\r\nimport { useMemo } from '@wordpress/element';\r\nimport { createHigherOrderComponent } from '@wordpress/compose';\r\nimport { addFilter } from '@wordpress/hooks';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as editorStore } from '../store';\r\n\r\n/** @typedef {import('@wordpress/compose').WPHigherOrderComponent} WPHigherOrderComponent */\r\n/** @typedef {import('@wordpress/blocks').WPBlockSettings} WPBlockSettings */\r\n\r\n/**\r\n * Object whose keys are the names of block attributes, where each value\r\n * represents the meta key to which the block attribute is intended to save.\r\n *\r\n * @see https://developer.wordpress.org/reference/functions/register_meta/\r\n *\r\n * @typedef {Object<string,string>} WPMetaAttributeMapping\r\n */\r\n\r\n/**\r\n * Given a mapping of attribute names (meta source attributes) to their\r\n * associated meta key, returns a higher order component that overrides its\r\n * `attributes` and `setAttributes` props to sync any changes with the edited\r\n * post's meta keys.\r\n *\r\n * @param {WPMetaAttributeMapping} metaAttributes Meta attribute mapping.\r\n *\r\n * @return {WPHigherOrderComponent} Higher-order component.\r\n */\r\nconst createWithMetaAttributeSource = ( metaAttributes ) =>\r\n\tcreateHigherOrderComponent(\r\n\t\t( BlockEdit ) =>\r\n\t\t\t( { attributes, setAttributes, ...props } ) => {\r\n\t\t\t\tconst postType = useSelect(\r\n\t\t\t\t\t( select ) => select( editorStore ).getCurrentPostType(),\r\n\t\t\t\t\t[]\r\n\t\t\t\t);\r\n\t\t\t\tconst [ meta, setMeta ] = useEntityProp(\r\n\t\t\t\t\t'postType',\r\n\t\t\t\t\tpostType,\r\n\t\t\t\t\t'meta'\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst mergedAttributes = useMemo(\r\n\t\t\t\t\t() => ( {\r\n\t\t\t\t\t\t...attributes,\r\n\t\t\t\t\t\t...Object.fromEntries(\r\n\t\t\t\t\t\t\tObject.entries( metaAttributes ).map(\r\n\t\t\t\t\t\t\t\t( [ attributeKey, metaKey ] ) => [\r\n\t\t\t\t\t\t\t\t\tattributeKey,\r\n\t\t\t\t\t\t\t\t\tmeta[ metaKey ],\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t} ),\r\n\t\t\t\t\t[ attributes, meta ]\r\n\t\t\t\t);\r\n\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<BlockEdit\r\n\t\t\t\t\t\tattributes={ mergedAttributes }\r\n\t\t\t\t\t\tsetAttributes={ ( nextAttributes ) => {\r\n\t\t\t\t\t\t\tconst nextMeta = Object.fromEntries(\r\n\t\t\t\t\t\t\t\tObject.entries( nextAttributes ?? {} )\r\n\t\t\t\t\t\t\t\t\t.filter(\r\n\t\t\t\t\t\t\t\t\t\t// Filter to intersection of keys between the updated\r\n\t\t\t\t\t\t\t\t\t\t// attributes and those with an associated meta key.\r\n\t\t\t\t\t\t\t\t\t\t( [ key ] ) => key in metaAttributes\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t.map( ( [ attributeKey, value ] ) => [\r\n\t\t\t\t\t\t\t\t\t\t// Rename the keys to the expected meta key name.\r\n\t\t\t\t\t\t\t\t\t\tmetaAttributes[ attributeKey ],\r\n\t\t\t\t\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\t\t\t\t] )\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif ( Object.entries( nextMeta ).length ) {\r\n\t\t\t\t\t\t\t\tsetMeta( nextMeta );\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsetAttributes( nextAttributes );\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t{ ...props }\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t'withMetaAttributeSource'\r\n\t);\r\n\r\n/**\r\n * Filters a registered block's settings to enhance a block's `edit` component\r\n * to upgrade meta-sourced attributes to use the post's meta entity property.\r\n *\r\n * @param {WPBlockSettings} settings Registered block settings.\r\n *\r\n * @return {WPBlockSettings} Filtered block settings.\r\n */\r\nfunction shimAttributeSource( settings ) {\r\n\t/** @type {WPMetaAttributeMapping} */\r\n\tconst metaAttributes = Object.fromEntries(\r\n\t\tObject.entries( settings.attributes ?? {} )\r\n\t\t\t.filter( ( [ , { source } ] ) => source === 'meta' )\r\n\t\t\t.map( ( [ attributeKey, { meta } ] ) => [ attributeKey, meta ] )\r\n\t);\r\n\tif ( Object.entries( metaAttributes ).length ) {\r\n\t\tsettings.edit = createWithMetaAttributeSource( metaAttributes )(\r\n\t\t\tsettings.edit\r\n\t\t);\r\n\t}\r\n\r\n\treturn settings;\r\n}\r\n\r\naddFilter(\r\n\t'blocks.registerBlockType',\r\n\t'core/editor/custom-sources-backwards-compatibility/shim-attribute-source',\r\n\tshimAttributeSource\r\n);\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,aAAa,QAAQ,sBAAsB;AACpD,SAASC,OAAO,QAAQ,oBAAoB;AAC5C,SAASC,0BAA0B,QAAQ,oBAAoB;AAC/D,SAASC,SAAS,QAAQ,kBAAkB;;AAE5C;AACA;AACA;AACA,SAASC,KAAK,IAAIC,WAAW,QAAQ,UAAU;;AAE/C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA,SAAAC,GAAA,IAAAC,IAAA;AAUA,MAAMC,6BAA6B,GAAKC,cAAc,IACrDP,0BAA0B,CACvBQ,SAAS,IACV,CAAE;EAAEC,UAAU;EAAEC,aAAa;EAAE,GAAGC;AAAM,CAAC,KAAM;EAC9C,MAAMC,QAAQ,GAAGf,SAAS,CACvBgB,MAAM,IAAMA,MAAM,CAAEV,WAAY,CAAC,CAACW,kBAAkB,CAAC,CAAC,EACxD,EACD,CAAC;EACD,MAAM,CAAEC,IAAI,EAAEC,OAAO,CAAE,GAAGlB,aAAa,CACtC,UAAU,EACVc,QAAQ,EACR,MACD,CAAC;EAED,MAAMK,gBAAgB,GAAGlB,OAAO,CAC/B,OAAQ;IACP,GAAGU,UAAU;IACb,GAAGS,MAAM,CAACC,WAAW,CACpBD,MAAM,CAACE,OAAO,CAAEb,cAAe,CAAC,CAACc,GAAG,CACnC,CAAE,CAAEC,YAAY,EAAEC,OAAO,CAAE,KAAM,CAChCD,YAAY,EACZP,IAAI,CAAEQ,OAAO,CAAE,CAEjB,CACD;EACD,CAAC,CAAE,EACH,CAAEd,UAAU,EAAEM,IAAI,CACnB,CAAC;EAED,oBACCV,IAAA,CAACG,SAAS;IACTC,UAAU,EAAGQ,gBAAkB;IAC/BP,aAAa,EAAKc,cAAc,IAAM;MACrC,MAAMC,QAAQ,GAAGP,MAAM,CAACC,WAAW,CAClCD,MAAM,CAACE,OAAO,CAAEI,cAAc,aAAdA,cAAc,cAAdA,cAAc,GAAI,CAAC,CAAE,CAAC,CACpCE,MAAM;MACN;MACA;MACA,CAAE,CAAEC,GAAG,CAAE,KAAMA,GAAG,IAAIpB,cACvB,CAAC,CACAc,GAAG,CAAE,CAAE,CAAEC,YAAY,EAAEM,KAAK,CAAE,KAAM;MACpC;MACArB,cAAc,CAAEe,YAAY,CAAE,EAC9BM,KAAK,CACJ,CACJ,CAAC;MAED,IAAKV,MAAM,CAACE,OAAO,CAAEK,QAAS,CAAC,CAACI,MAAM,EAAG;QACxCb,OAAO,CAAES,QAAS,CAAC;MACpB;MAEAf,aAAa,CAAEc,cAAe,CAAC;IAChC,CAAG;IAAA,GACEb;EAAK,CACV,CAAC;AAEJ,CAAC,EACF,yBACD,CAAC;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASmB,mBAAmBA,CAAEC,QAAQ,EAAG;EAAA,IAAAC,oBAAA;EACxC;EACA,MAAMzB,cAAc,GAAGW,MAAM,CAACC,WAAW,CACxCD,MAAM,CAACE,OAAO,EAAAY,oBAAA,GAAED,QAAQ,CAACtB,UAAU,cAAAuB,oBAAA,cAAAA,oBAAA,GAAI,CAAC,CAAE,CAAC,CACzCN,MAAM,CAAE,CAAE,GAAI;IAAEO;EAAO,CAAC,CAAE,KAAMA,MAAM,KAAK,MAAO,CAAC,CACnDZ,GAAG,CAAE,CAAE,CAAEC,YAAY,EAAE;IAAEP;EAAK,CAAC,CAAE,KAAM,CAAEO,YAAY,EAAEP,IAAI,CAAG,CACjE,CAAC;EACD,IAAKG,MAAM,CAACE,OAAO,CAAEb,cAAe,CAAC,CAACsB,MAAM,EAAG;IAC9CE,QAAQ,CAACG,IAAI,GAAG5B,6BAA6B,CAAEC,cAAe,CAAC,CAC9DwB,QAAQ,CAACG,IACV,CAAC;EACF;EAEA,OAAOH,QAAQ;AAChB;AAEA9B,SAAS,CACR,0BAA0B,EAC1B,0EAA0E,EAC1E6B,mBACD,CAAC","ignoreList":[]}