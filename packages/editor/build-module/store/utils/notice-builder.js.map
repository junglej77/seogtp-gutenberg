{"version":3,"names":["__","SAVE_POST_NOTICE_ID","TRASH_POST_NOTICE_ID","getNotificationArgumentsForSaveSuccess","data","_postType$viewable","previousPost","post","postType","options","isAutosave","publishStatus","isPublished","includes","status","willPublish","willTrash","noticeMessage","shouldShowLink","viewable","isDraft","labels","item_trashed","item_reverted_to_draft","publish","item_published","private","item_published_privately","future","item_scheduled","item_updated","actions","push","label","view_item","url","link","id","type","getNotificationArgumentsForSaveFail","edits","error","code","indexOf","messages","message","test","join","getNotificationArgumentsForTrashFail"],"sources":["@wordpress/editor/src/store/utils/notice-builder.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { SAVE_POST_NOTICE_ID, TRASH_POST_NOTICE_ID } from '../constants';\r\n\r\n/**\r\n * Builds the arguments for a success notification dispatch.\r\n *\r\n * @param {Object} data Incoming data to build the arguments from.\r\n *\r\n * @return {Array} Arguments for dispatch. An empty array signals no\r\n *                 notification should be sent.\r\n */\r\nexport function getNotificationArgumentsForSaveSuccess( data ) {\r\n\tconst { previousPost, post, postType } = data;\r\n\t// Autosaves are neither shown a notice nor redirected.\r\n\tif ( data.options?.isAutosave ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst publishStatus = [ 'publish', 'private', 'future' ];\r\n\tconst isPublished = publishStatus.includes( previousPost.status );\r\n\tconst willPublish = publishStatus.includes( post.status );\r\n\tconst willTrash =\r\n\t\tpost.status === 'trash' && previousPost.status !== 'trash';\r\n\r\n\tlet noticeMessage;\r\n\tlet shouldShowLink = postType?.viewable ?? false;\r\n\tlet isDraft;\r\n\r\n\t// Always should a notice, which will be spoken for accessibility.\r\n\tif ( willTrash ) {\r\n\t\tnoticeMessage = postType.labels.item_trashed;\r\n\t\tshouldShowLink = false;\r\n\t} else if ( ! isPublished && ! willPublish ) {\r\n\t\t// If saving a non-published post, don't show notice.\r\n\t\tnoticeMessage = __( 'Draft saved.' );\r\n\t\tisDraft = true;\r\n\t} else if ( isPublished && ! willPublish ) {\r\n\t\t// If undoing publish status, show specific notice.\r\n\t\tnoticeMessage = postType.labels.item_reverted_to_draft;\r\n\t\tshouldShowLink = false;\r\n\t} else if ( ! isPublished && willPublish ) {\r\n\t\t// If publishing or scheduling a post, show the corresponding\r\n\t\t// publish message.\r\n\t\tnoticeMessage = {\r\n\t\t\tpublish: postType.labels.item_published,\r\n\t\t\tprivate: postType.labels.item_published_privately,\r\n\t\t\tfuture: postType.labels.item_scheduled,\r\n\t\t}[ post.status ];\r\n\t} else {\r\n\t\t// Generic fallback notice.\r\n\t\tnoticeMessage = postType.labels.item_updated;\r\n\t}\r\n\r\n\tconst actions = [];\r\n\tif ( shouldShowLink ) {\r\n\t\tactions.push( {\r\n\t\t\tlabel: isDraft ? __( 'View Preview' ) : postType.labels.view_item,\r\n\t\t\turl: post.link,\r\n\t\t} );\r\n\t}\r\n\treturn [\r\n\t\tnoticeMessage,\r\n\t\t{\r\n\t\t\tid: SAVE_POST_NOTICE_ID,\r\n\t\t\ttype: 'snackbar',\r\n\t\t\tactions,\r\n\t\t},\r\n\t];\r\n}\r\n\r\n/**\r\n * Builds the fail notification arguments for dispatch.\r\n *\r\n * @param {Object} data Incoming data to build the arguments with.\r\n *\r\n * @return {Array} Arguments for dispatch. An empty array signals no\r\n *                 notification should be sent.\r\n */\r\nexport function getNotificationArgumentsForSaveFail( data ) {\r\n\tconst { post, edits, error } = data;\r\n\tif ( error && 'rest_autosave_no_changes' === error.code ) {\r\n\t\t// Autosave requested a new autosave, but there were no changes. This shouldn't\r\n\t\t// result in an error notice for the user.\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst publishStatus = [ 'publish', 'private', 'future' ];\r\n\tconst isPublished = publishStatus.indexOf( post.status ) !== -1;\r\n\t// If the post was being published, we show the corresponding publish error message\r\n\t// Unless we publish an \"updating failed\" message.\r\n\tconst messages = {\r\n\t\tpublish: __( 'Publishing failed.' ),\r\n\t\tprivate: __( 'Publishing failed.' ),\r\n\t\tfuture: __( 'Scheduling failed.' ),\r\n\t};\r\n\tlet noticeMessage =\r\n\t\t! isPublished && publishStatus.indexOf( edits.status ) !== -1\r\n\t\t\t? messages[ edits.status ]\r\n\t\t\t: __( 'Updating failed.' );\r\n\r\n\t// Check if message string contains HTML. Notice text is currently only\r\n\t// supported as plaintext, and stripping the tags may muddle the meaning.\r\n\tif ( error.message && ! /<\\/?[^>]*>/.test( error.message ) ) {\r\n\t\tnoticeMessage = [ noticeMessage, error.message ].join( ' ' );\r\n\t}\r\n\treturn [\r\n\t\tnoticeMessage,\r\n\t\t{\r\n\t\t\tid: SAVE_POST_NOTICE_ID,\r\n\t\t},\r\n\t];\r\n}\r\n\r\n/**\r\n * Builds the trash fail notification arguments for dispatch.\r\n *\r\n * @param {Object} data\r\n *\r\n * @return {Array} Arguments for dispatch.\r\n */\r\nexport function getNotificationArgumentsForTrashFail( data ) {\r\n\treturn [\r\n\t\tdata.error.message && data.error.code !== 'unknown_error'\r\n\t\t\t? data.error.message\r\n\t\t\t: __( 'Trashing failed' ),\r\n\t\t{\r\n\t\t\tid: TRASH_POST_NOTICE_ID,\r\n\t\t},\r\n\t];\r\n}\r\n"],"mappings":"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","ignoreList":[]}