{"version":3,"names":["Clipboard","__","Component","withSpokenMessages","RichTextToolbarButton","applyFormat","getActiveFormat","getTextContent","isCollapsed","removeFormat","slice","isURL","link","linkIcon","ModalLinkUI","isValidHref","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","name","title","tagName","className","attributes","url","target","rel","edit","LinkEdit","constructor","arguments","addLink","bind","stopAddingLink","onRemoveFormat","getURLFromClipboard","state","addingLink","value","onChange","props","text","newValue","type","start","end","activeFormats","needsSelectionUpdate","setState","clipboardURL","undefined","getLinkSelection","isActive","startFormat","startIndex","endIndex","formats","find","format","speak","linkSelection","clipboardText","getString","render","activeAttributes","children","isVisible","onClose","onRemove","icon","onClick","shortcutType","shortcutCharacter"],"sources":["@wordpress/format-library/src/link/index.native.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport Clipboard from '@react-native-clipboard/clipboard';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { __ } from '@wordpress/i18n';\r\nimport { Component } from '@wordpress/element';\r\nimport { withSpokenMessages } from '@wordpress/components';\r\nimport { RichTextToolbarButton } from '@wordpress/block-editor';\r\nimport {\r\n\tapplyFormat,\r\n\tgetActiveFormat,\r\n\tgetTextContent,\r\n\tisCollapsed,\r\n\tremoveFormat,\r\n\tslice,\r\n} from '@wordpress/rich-text';\r\nimport { isURL } from '@wordpress/url';\r\nimport { link as linkIcon } from '@wordpress/icons';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport ModalLinkUI from './modal';\r\nimport { isValidHref } from './utils';\r\n\r\nconst name = 'core/link';\r\n\r\nexport const link = {\r\n\tname,\r\n\ttitle: __( 'Link' ),\r\n\ttagName: 'a',\r\n\tclassName: null,\r\n\tattributes: {\r\n\t\turl: 'href',\r\n\t\ttarget: 'target',\r\n\t\trel: 'rel',\r\n\t},\r\n\tedit: withSpokenMessages(\r\n\t\tclass LinkEdit extends Component {\r\n\t\t\tconstructor() {\r\n\t\t\t\tsuper( ...arguments );\r\n\r\n\t\t\t\tthis.addLink = this.addLink.bind( this );\r\n\t\t\t\tthis.stopAddingLink = this.stopAddingLink.bind( this );\r\n\t\t\t\tthis.onRemoveFormat = this.onRemoveFormat.bind( this );\r\n\t\t\t\tthis.getURLFromClipboard =\r\n\t\t\t\t\tthis.getURLFromClipboard.bind( this );\r\n\t\t\t\tthis.state = {\r\n\t\t\t\t\taddingLink: false,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\taddLink() {\r\n\t\t\t\tconst { value, onChange } = this.props;\r\n\t\t\t\tconst text = getTextContent( slice( value ) );\r\n\r\n\t\t\t\tif ( text && isURL( text ) && isValidHref( text ) ) {\r\n\t\t\t\t\tconst newValue = applyFormat( value, {\r\n\t\t\t\t\t\ttype: name,\r\n\t\t\t\t\t\tattributes: { url: text },\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tnewValue.start = newValue.end;\r\n\t\t\t\t\tnewValue.activeFormats = [];\r\n\t\t\t\t\tonChange( { ...newValue, needsSelectionUpdate: true } );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setState( { addingLink: true } );\r\n\t\t\t\t\tthis.getURLFromClipboard();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstopAddingLink() {\r\n\t\t\t\tthis.setState( { addingLink: false, clipboardURL: undefined } );\r\n\t\t\t}\r\n\r\n\t\t\tgetLinkSelection() {\r\n\t\t\t\tconst { value, isActive } = this.props;\r\n\t\t\t\tconst startFormat = getActiveFormat( value, 'core/link' );\r\n\r\n\t\t\t\t// If the link isn't selected, get the link manually by looking around the cursor\r\n\t\t\t\t// TODO: handle partly selected links.\r\n\t\t\t\tif ( startFormat && isCollapsed( value ) && isActive ) {\r\n\t\t\t\t\tlet startIndex = value.start;\r\n\t\t\t\t\tlet endIndex = value.end;\r\n\r\n\t\t\t\t\twhile (\r\n\t\t\t\t\t\tvalue.formats[ startIndex ]?.find(\r\n\t\t\t\t\t\t\t( format ) => format?.type === startFormat.type\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tstartIndex--;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tendIndex++;\r\n\r\n\t\t\t\t\twhile (\r\n\t\t\t\t\t\tvalue.formats[ endIndex ]?.find(\r\n\t\t\t\t\t\t\t( format ) => format?.type === startFormat.type\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tendIndex++;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...value,\r\n\t\t\t\t\t\tstart: startIndex + 1,\r\n\t\t\t\t\t\tend: endIndex,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tonRemoveFormat() {\r\n\t\t\t\tconst { onChange, speak, value } = this.props;\r\n\t\t\t\tconst startFormat = getActiveFormat( value, 'core/link' );\r\n\r\n\t\t\t\t// Before we try to remove anything we check if there is something at the caret position to remove.\r\n\t\t\t\tif ( isCollapsed( value ) && startFormat === undefined ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst linkSelection = this.getLinkSelection();\r\n\r\n\t\t\t\tonChange( removeFormat( linkSelection, name ) );\r\n\t\t\t\tspeak( __( 'Link removed.' ), 'assertive' );\r\n\t\t\t}\r\n\r\n\t\t\tasync getURLFromClipboard() {\r\n\t\t\t\tconst clipboardText = await Clipboard.getString();\r\n\t\t\t\tif ( ! clipboardText ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// Check if pasted text is URL.\r\n\t\t\t\tif ( ! isURL( clipboardText ) ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState( { clipboardURL: clipboardText } );\r\n\t\t\t}\r\n\r\n\t\t\trender() {\r\n\t\t\t\tconst { isActive, activeAttributes, onChange } = this.props;\r\n\t\t\t\tconst linkSelection = this.getLinkSelection();\r\n\t\t\t\t// If no URL is set and we have a clipboard URL let's use it.\r\n\t\t\t\tif ( ! activeAttributes.url && this.state.clipboardURL ) {\r\n\t\t\t\t\tactiveAttributes.url = this.state.clipboardURL;\r\n\t\t\t\t}\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<ModalLinkUI\r\n\t\t\t\t\t\t\tisVisible={ this.state.addingLink }\r\n\t\t\t\t\t\t\tisActive={ isActive }\r\n\t\t\t\t\t\t\tactiveAttributes={ activeAttributes }\r\n\t\t\t\t\t\t\tonClose={ this.stopAddingLink }\r\n\t\t\t\t\t\t\tonChange={ onChange }\r\n\t\t\t\t\t\t\tonRemove={ this.onRemoveFormat }\r\n\t\t\t\t\t\t\tvalue={ linkSelection }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<RichTextToolbarButton\r\n\t\t\t\t\t\t\tname=\"link\"\r\n\t\t\t\t\t\t\ticon={ linkIcon }\r\n\t\t\t\t\t\t\ttitle={ __( 'Link' ) }\r\n\t\t\t\t\t\t\tonClick={ this.addLink }\r\n\t\t\t\t\t\t\tisActive={ isActive }\r\n\t\t\t\t\t\t\tshortcutType=\"primary\"\r\n\t\t\t\t\t\t\tshortcutCharacter=\"k\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t),\r\n};\r\n"],"mappings":"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","ignoreList":[]}