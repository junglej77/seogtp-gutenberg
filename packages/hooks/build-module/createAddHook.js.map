{"version":3,"names":["validateNamespace","validateHookName","createAddHook","hooks","storeKey","addHook","hookName","namespace","callback","priority","hooksStore","console","error","handler","handlers","i","length","splice","__current","forEach","hookInfo","name","currentIndex","runs","doAction"],"sources":["@wordpress/hooks/src/createAddHook.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport validateNamespace from './validateNamespace.js';\r\nimport validateHookName from './validateHookName.js';\r\n\r\n/**\r\n * @callback AddHook\r\n *\r\n * Adds the hook to the appropriate hooks container.\r\n *\r\n * @param {string}               hookName      Name of hook to add\r\n * @param {string}               namespace     The unique namespace identifying the callback in the form `vendor/plugin/function`.\r\n * @param {import('.').Callback} callback      Function to call when the hook is run\r\n * @param {number}               [priority=10] Priority of this hook\r\n */\r\n\r\n/**\r\n * Returns a function which, when invoked, will add a hook.\r\n *\r\n * @param {import('.').Hooks}    hooks    Hooks instance.\r\n * @param {import('.').StoreKey} storeKey\r\n *\r\n * @return {AddHook} Function that adds a new hook.\r\n */\r\nfunction createAddHook( hooks, storeKey ) {\r\n\treturn function addHook( hookName, namespace, callback, priority = 10 ) {\r\n\t\tconst hooksStore = hooks[ storeKey ];\r\n\r\n\t\tif ( ! validateHookName( hookName ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( ! validateNamespace( namespace ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( 'function' !== typeof callback ) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.error( 'The hook callback must be a function.' );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Validate numeric priority\r\n\t\tif ( 'number' !== typeof priority ) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.error(\r\n\t\t\t\t'If specified, the hook priority must be a number.'\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst handler = { callback, priority, namespace };\r\n\r\n\t\tif ( hooksStore[ hookName ] ) {\r\n\t\t\t// Find the correct insert index of the new hook.\r\n\t\t\tconst handlers = hooksStore[ hookName ].handlers;\r\n\r\n\t\t\t/** @type {number} */\r\n\t\t\tlet i;\r\n\t\t\tfor ( i = handlers.length; i > 0; i-- ) {\r\n\t\t\t\tif ( priority >= handlers[ i - 1 ].priority ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( i === handlers.length ) {\r\n\t\t\t\t// If append, operate via direct assignment.\r\n\t\t\t\thandlers[ i ] = handler;\r\n\t\t\t} else {\r\n\t\t\t\t// Otherwise, insert before index via splice.\r\n\t\t\t\thandlers.splice( i, 0, handler );\r\n\t\t\t}\r\n\r\n\t\t\t// We may also be currently executing this hook.  If the callback\r\n\t\t\t// we're adding would come after the current callback, there's no\r\n\t\t\t// problem; otherwise we need to increase the execution index of\r\n\t\t\t// any other runs by 1 to account for the added element.\r\n\t\t\thooksStore.__current.forEach( ( hookInfo ) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\thookInfo.name === hookName &&\r\n\t\t\t\t\thookInfo.currentIndex >= i\r\n\t\t\t\t) {\r\n\t\t\t\t\thookInfo.currentIndex++;\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\t// This is the first hook of its type.\r\n\t\t\thooksStore[ hookName ] = {\r\n\t\t\t\thandlers: [ handler ],\r\n\t\t\t\truns: 0,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif ( hookName !== 'hookAdded' ) {\r\n\t\t\thooks.doAction(\r\n\t\t\t\t'hookAdded',\r\n\t\t\t\thookName,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tcallback,\r\n\t\t\t\tpriority\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createAddHook;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,iBAAiB,MAAM,wBAAwB;AACtD,OAAOC,gBAAgB,MAAM,uBAAuB;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,aAAaA,CAAEC,KAAK,EAAEC,QAAQ,EAAG;EACzC,OAAO,SAASC,OAAOA,CAAEC,QAAQ,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,QAAQ,GAAG,EAAE,EAAG;IACvE,MAAMC,UAAU,GAAGP,KAAK,CAAEC,QAAQ,CAAE;IAEpC,IAAK,CAAEH,gBAAgB,CAAEK,QAAS,CAAC,EAAG;MACrC;IACD;IAEA,IAAK,CAAEN,iBAAiB,CAAEO,SAAU,CAAC,EAAG;MACvC;IACD;IAEA,IAAK,UAAU,KAAK,OAAOC,QAAQ,EAAG;MACrC;MACAG,OAAO,CAACC,KAAK,CAAE,uCAAwC,CAAC;MACxD;IACD;;IAEA;IACA,IAAK,QAAQ,KAAK,OAAOH,QAAQ,EAAG;MACnC;MACAE,OAAO,CAACC,KAAK,CACZ,mDACD,CAAC;MACD;IACD;IAEA,MAAMC,OAAO,GAAG;MAAEL,QAAQ;MAAEC,QAAQ;MAAEF;IAAU,CAAC;IAEjD,IAAKG,UAAU,CAAEJ,QAAQ,CAAE,EAAG;MAC7B;MACA,MAAMQ,QAAQ,GAAGJ,UAAU,CAAEJ,QAAQ,CAAE,CAACQ,QAAQ;;MAEhD;MACA,IAAIC,CAAC;MACL,KAAMA,CAAC,GAAGD,QAAQ,CAACE,MAAM,EAAED,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAG;QACvC,IAAKN,QAAQ,IAAIK,QAAQ,CAAEC,CAAC,GAAG,CAAC,CAAE,CAACN,QAAQ,EAAG;UAC7C;QACD;MACD;MAEA,IAAKM,CAAC,KAAKD,QAAQ,CAACE,MAAM,EAAG;QAC5B;QACAF,QAAQ,CAAEC,CAAC,CAAE,GAAGF,OAAO;MACxB,CAAC,MAAM;QACN;QACAC,QAAQ,CAACG,MAAM,CAAEF,CAAC,EAAE,CAAC,EAAEF,OAAQ,CAAC;MACjC;;MAEA;MACA;MACA;MACA;MACAH,UAAU,CAACQ,SAAS,CAACC,OAAO,CAAIC,QAAQ,IAAM;QAC7C,IACCA,QAAQ,CAACC,IAAI,KAAKf,QAAQ,IAC1Bc,QAAQ,CAACE,YAAY,IAAIP,CAAC,EACzB;UACDK,QAAQ,CAACE,YAAY,EAAE;QACxB;MACD,CAAE,CAAC;IACJ,CAAC,MAAM;MACN;MACAZ,UAAU,CAAEJ,QAAQ,CAAE,GAAG;QACxBQ,QAAQ,EAAE,CAAED,OAAO,CAAE;QACrBU,IAAI,EAAE;MACP,CAAC;IACF;IAEA,IAAKjB,QAAQ,KAAK,WAAW,EAAG;MAC/BH,KAAK,CAACqB,QAAQ,CACb,WAAW,EACXlB,QAAQ,EACRC,SAAS,EACTC,QAAQ,EACRC,QACD,CAAC;IACF;EACD,CAAC;AACF;AAEA,eAAeP,aAAa","ignoreList":[]}