{"version":3,"names":["store","privateApis","getConfig","fetchHeadAssets","updateHead","directivePrefix","getRegionRootFragment","initialVdom","toVdom","render","parseServerData","populateServerData","batch","navigationMode","_getConfig$navigation","pages","Map","headElements","getPagePath","url","u","URL","window","location","href","pathname","search","fetchPage","html","res","fetch","status","text","dom","DOMParser","parseFromString","regionsToVdom","e","vdom","regions","body","undefined","head","globalThis","IS_GUTENBERG_PLUGIN","get","document","attrName","querySelectorAll","forEach","region","id","getAttribute","has","title","querySelector","innerText","initialData","renderRegions","page","fragment","forcePageReload","assign","Promise","addEventListener","pagePath","state","reload","map","call","script","set","tag","textContent","resolve","isValidLink","ref","HTMLAnchorElement","target","origin","startsWith","searchParams","isValidEvent","event","button","metaKey","ctrlKey","altKey","shiftKey","defaultPrevented","navigatingTo","actions","navigation","hasStarted","hasFinished","texts","loading","loaded","message","navigate","options","clientNavigationDisabled","loadingAnimation","screenReaderAnnouncement","timeout","prefetch","timeoutPromise","setTimeout","loadingTimeout","race","clearTimeout","config","history","replace","hash","scrollIntoView","force","closest","preventDefault","nodeName"],"sources":["@wordpress/interactivity-router/src/index.ts"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { store, privateApis, getConfig } from '@wordpress/interactivity';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { fetchHeadAssets, updateHead } from './head';\r\n\r\nconst {\r\n\tdirectivePrefix,\r\n\tgetRegionRootFragment,\r\n\tinitialVdom,\r\n\ttoVdom,\r\n\trender,\r\n\tparseServerData,\r\n\tpopulateServerData,\r\n\tbatch,\r\n} = privateApis(\r\n\t'I acknowledge that using private APIs means my theme or plugin will inevitably break in the next version of WordPress.'\r\n);\r\n\r\ninterface NavigateOptions {\r\n\tforce?: boolean;\r\n\thtml?: string;\r\n\treplace?: boolean;\r\n\ttimeout?: number;\r\n\tloadingAnimation?: boolean;\r\n\tscreenReaderAnnouncement?: boolean;\r\n}\r\n\r\ninterface PrefetchOptions {\r\n\tforce?: boolean;\r\n\thtml?: string;\r\n}\r\n\r\ninterface VdomParams {\r\n\tvdom?: typeof initialVdom;\r\n}\r\n\r\ninterface Page {\r\n\tregions: Record< string, any >;\r\n\thead: HTMLHeadElement[];\r\n\ttitle: string;\r\n\tinitialData: any;\r\n}\r\n\r\ntype RegionsToVdom = ( dom: Document, params?: VdomParams ) => Promise< Page >;\r\n\r\n// Check if the navigation mode is full page or region based.\r\nconst navigationMode: 'regionBased' | 'fullPage' =\r\n\tgetConfig( 'core/router' ).navigationMode ?? 'regionBased';\r\n\r\n// The cache of visited and prefetched pages, stylesheets and scripts.\r\nconst pages = new Map< string, Promise< Page | false > >();\r\nconst headElements = new Map< string, { tag: HTMLElement; text: string } >();\r\n\r\n// Helper to remove domain and hash from the URL. We are only interesting in\r\n// caching the path and the query.\r\nconst getPagePath = ( url: string ) => {\r\n\tconst u = new URL( url, window.location.href );\r\n\treturn u.pathname + u.search;\r\n};\r\n\r\n// Fetch a new page and convert it to a static virtual DOM.\r\nconst fetchPage = async ( url: string, { html }: { html: string } ) => {\r\n\ttry {\r\n\t\tif ( ! html ) {\r\n\t\t\tconst res = await window.fetch( url );\r\n\t\t\tif ( res.status !== 200 ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\thtml = await res.text();\r\n\t\t}\r\n\t\tconst dom = new window.DOMParser().parseFromString( html, 'text/html' );\r\n\t\treturn regionsToVdom( dom );\r\n\t} catch ( e ) {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\n// Return an object with VDOM trees of those HTML regions marked with a\r\n// `router-region` directive.\r\nconst regionsToVdom: RegionsToVdom = async ( dom, { vdom } = {} ) => {\r\n\tconst regions = { body: undefined };\r\n\tlet head: HTMLElement[];\r\n\tif ( globalThis.IS_GUTENBERG_PLUGIN ) {\r\n\t\tif ( navigationMode === 'fullPage' ) {\r\n\t\t\thead = await fetchHeadAssets( dom, headElements );\r\n\t\t\tregions.body = vdom\r\n\t\t\t\t? vdom.get( document.body )\r\n\t\t\t\t: toVdom( dom.body );\r\n\t\t}\r\n\t}\r\n\tif ( navigationMode === 'regionBased' ) {\r\n\t\tconst attrName = `data-${ directivePrefix }-router-region`;\r\n\t\tdom.querySelectorAll( `[${ attrName }]` ).forEach( ( region ) => {\r\n\t\t\tconst id = region.getAttribute( attrName );\r\n\t\t\tregions[ id ] = vdom?.has( region )\r\n\t\t\t\t? vdom.get( region )\r\n\t\t\t\t: toVdom( region );\r\n\t\t} );\r\n\t}\r\n\tconst title = dom.querySelector( 'title' )?.innerText;\r\n\tconst initialData = parseServerData( dom );\r\n\treturn { regions, head, title, initialData };\r\n};\r\n\r\n// Render all interactive regions contained in the given page.\r\nconst renderRegions = ( page: Page ) => {\r\n\tbatch( () => {\r\n\t\tif ( globalThis.IS_GUTENBERG_PLUGIN ) {\r\n\t\t\tif ( navigationMode === 'fullPage' ) {\r\n\t\t\t\t// Once this code is tested and more mature, the head should be updated for region based navigation as well.\r\n\t\t\t\tupdateHead( page.head );\r\n\t\t\t\tconst fragment = getRegionRootFragment( document.body );\r\n\t\t\t\trender( page.regions.body, fragment );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ( navigationMode === 'regionBased' ) {\r\n\t\t\tpopulateServerData( page.initialData );\r\n\t\t\tconst attrName = `data-${ directivePrefix }-router-region`;\r\n\t\t\tdocument\r\n\t\t\t\t.querySelectorAll( `[${ attrName }]` )\r\n\t\t\t\t.forEach( ( region ) => {\r\n\t\t\t\t\tconst id = region.getAttribute( attrName );\r\n\t\t\t\t\tconst fragment = getRegionRootFragment( region );\r\n\t\t\t\t\trender( page.regions[ id ], fragment );\r\n\t\t\t\t} );\r\n\t\t}\r\n\t\tif ( page.title ) {\r\n\t\t\tdocument.title = page.title;\r\n\t\t}\r\n\t} );\r\n};\r\n\r\n/**\r\n * Load the given page forcing a full page reload.\r\n *\r\n * The function returns a promise that won't resolve, useful to prevent any\r\n * potential feedback indicating that the navigation has finished while the new\r\n * page is being loaded.\r\n *\r\n * @param href The page href.\r\n * @return Promise that never resolves.\r\n */\r\nconst forcePageReload = ( href: string ) => {\r\n\twindow.location.assign( href );\r\n\treturn new Promise( () => {} );\r\n};\r\n\r\n// Listen to the back and forward buttons and restore the page if it's in the\r\n// cache.\r\nwindow.addEventListener( 'popstate', async () => {\r\n\tconst pagePath = getPagePath( window.location.href ); // Remove hash.\r\n\tconst page = pages.has( pagePath ) && ( await pages.get( pagePath ) );\r\n\tif ( page ) {\r\n\t\trenderRegions( page );\r\n\t\t// Update the URL in the state.\r\n\t\tstate.url = window.location.href;\r\n\t} else {\r\n\t\twindow.location.reload();\r\n\t}\r\n} );\r\n\r\n// Initialize the router and cache the initial page using the initial vDOM.\r\n// Once this code is tested and more mature, the head should be updated for\r\n// region based navigation as well.\r\nif ( globalThis.IS_GUTENBERG_PLUGIN ) {\r\n\tif ( navigationMode === 'fullPage' ) {\r\n\t\t// Cache the scripts. Has to be called before fetching the assets.\r\n\t\t[].map.call( document.querySelectorAll( 'script[src]' ), ( script ) => {\r\n\t\t\theadElements.set( script.getAttribute( 'src' ), {\r\n\t\t\t\ttag: script,\r\n\t\t\t\ttext: script.textContent,\r\n\t\t\t} );\r\n\t\t} );\r\n\t\tawait fetchHeadAssets( document, headElements );\r\n\t}\r\n}\r\npages.set(\r\n\tgetPagePath( window.location.href ),\r\n\tPromise.resolve( regionsToVdom( document, { vdom: initialVdom } ) )\r\n);\r\n\r\n// Check if the link is valid for client-side navigation.\r\nconst isValidLink = ( ref: HTMLAnchorElement ) =>\r\n\tref &&\r\n\tref instanceof window.HTMLAnchorElement &&\r\n\tref.href &&\r\n\t( ! ref.target || ref.target === '_self' ) &&\r\n\tref.origin === window.location.origin &&\r\n\t! ref.pathname.startsWith( '/wp-admin' ) &&\r\n\t! ref.pathname.startsWith( '/wp-login.php' ) &&\r\n\t! ref.getAttribute( 'href' ).startsWith( '#' ) &&\r\n\t! new URL( ref.href ).searchParams.has( '_wpnonce' );\r\n\r\n// Check if the event is valid for client-side navigation.\r\nconst isValidEvent = ( event: MouseEvent ) =>\r\n\tevent &&\r\n\tevent.button === 0 && // Left clicks only.\r\n\t! event.metaKey && // Open in new tab (Mac).\r\n\t! event.ctrlKey && // Open in new tab (Windows).\r\n\t! event.altKey && // Download.\r\n\t! event.shiftKey &&\r\n\t! event.defaultPrevented;\r\n\r\n// Variable to store the current navigation.\r\nlet navigatingTo = '';\r\n\r\nexport const { state, actions } = store( 'core/router', {\r\n\tstate: {\r\n\t\turl: window.location.href,\r\n\t\tnavigation: {\r\n\t\t\thasStarted: false,\r\n\t\t\thasFinished: false,\r\n\t\t\ttexts: {\r\n\t\t\t\tloading: '',\r\n\t\t\t\tloaded: '',\r\n\t\t\t},\r\n\t\t\tmessage: '',\r\n\t\t},\r\n\t},\r\n\tactions: {\r\n\t\t/**\r\n\t\t * Navigates to the specified page.\r\n\t\t *\r\n\t\t * This function normalizes the passed href, fetchs the page HTML if\r\n\t\t * needed, and updates any interactive regions whose contents have\r\n\t\t * changed. It also creates a new entry in the browser session history.\r\n\t\t *\r\n\t\t * @param href                               The page href.\r\n\t\t * @param [options]                          Options object.\r\n\t\t * @param [options.force]                    If true, it forces re-fetching the URL.\r\n\t\t * @param [options.html]                     HTML string to be used instead of fetching the requested URL.\r\n\t\t * @param [options.replace]                  If true, it replaces the current entry in the browser session history.\r\n\t\t * @param [options.timeout]                  Time until the navigation is aborted, in milliseconds. Default is 10000.\r\n\t\t * @param [options.loadingAnimation]         Whether an animation should be shown while navigating. Default to `true`.\r\n\t\t * @param [options.screenReaderAnnouncement] Whether a message for screen readers should be announced while navigating. Default to `true`.\r\n\t\t *\r\n\t\t * @return  Promise that resolves once the navigation is completed or aborted.\r\n\t\t */\r\n\t\t*navigate( href: string, options: NavigateOptions = {} ) {\r\n\t\t\tconst { clientNavigationDisabled } = getConfig();\r\n\t\t\tif ( clientNavigationDisabled ) {\r\n\t\t\t\tyield forcePageReload( href );\r\n\t\t\t}\r\n\r\n\t\t\tconst pagePath = getPagePath( href );\r\n\t\t\tconst { navigation } = state;\r\n\t\t\tconst {\r\n\t\t\t\tloadingAnimation = true,\r\n\t\t\t\tscreenReaderAnnouncement = true,\r\n\t\t\t\ttimeout = 10000,\r\n\t\t\t} = options;\r\n\r\n\t\t\tnavigatingTo = href;\r\n\t\t\tactions.prefetch( pagePath, options );\r\n\r\n\t\t\t// Create a promise that resolves when the specified timeout ends.\r\n\t\t\t// The timeout value is 10 seconds by default.\r\n\t\t\tconst timeoutPromise = new Promise< void >( ( resolve ) =>\r\n\t\t\t\tsetTimeout( resolve, timeout )\r\n\t\t\t);\r\n\r\n\t\t\t// Don't update the navigation status immediately, wait 400 ms.\r\n\t\t\tconst loadingTimeout = setTimeout( () => {\r\n\t\t\t\tif ( navigatingTo !== href ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( loadingAnimation ) {\r\n\t\t\t\t\tnavigation.hasStarted = true;\r\n\t\t\t\t\tnavigation.hasFinished = false;\r\n\t\t\t\t}\r\n\t\t\t\tif ( screenReaderAnnouncement ) {\r\n\t\t\t\t\tnavigation.message = navigation.texts.loading;\r\n\t\t\t\t}\r\n\t\t\t}, 400 );\r\n\r\n\t\t\tconst page = yield Promise.race( [\r\n\t\t\t\tpages.get( pagePath ),\r\n\t\t\t\ttimeoutPromise,\r\n\t\t\t] );\r\n\r\n\t\t\t// Dismiss loading message if it hasn't been added yet.\r\n\t\t\tclearTimeout( loadingTimeout );\r\n\r\n\t\t\t// Once the page is fetched, the destination URL could have changed\r\n\t\t\t// (e.g., by clicking another link in the meantime). If so, bail\r\n\t\t\t// out, and let the newer execution to update the HTML.\r\n\t\t\tif ( navigatingTo !== href ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tpage &&\r\n\t\t\t\t! page.initialData?.config?.[ 'core/router' ]\r\n\t\t\t\t\t?.clientNavigationDisabled\r\n\t\t\t) {\r\n\t\t\t\tyield renderRegions( page );\r\n\t\t\t\twindow.history[\r\n\t\t\t\t\toptions.replace ? 'replaceState' : 'pushState'\r\n\t\t\t\t]( {}, '', href );\r\n\r\n\t\t\t\t// Update the URL in the state.\r\n\t\t\t\tstate.url = href;\r\n\r\n\t\t\t\t// Update the navigation status once the the new page rendering\r\n\t\t\t\t// has been completed.\r\n\t\t\t\tif ( loadingAnimation ) {\r\n\t\t\t\t\tnavigation.hasStarted = false;\r\n\t\t\t\t\tnavigation.hasFinished = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( screenReaderAnnouncement ) {\r\n\t\t\t\t\t// Announce that the page has been loaded. If the message is the\r\n\t\t\t\t\t// same, we use a no-break space similar to the @wordpress/a11y\r\n\t\t\t\t\t// package: https://github.com/WordPress/gutenberg/blob/c395242b8e6ee20f8b06c199e4fc2920d7018af1/packages/a11y/src/filter-message.js#L20-L26\r\n\t\t\t\t\tnavigation.message =\r\n\t\t\t\t\t\tnavigation.texts.loaded +\r\n\t\t\t\t\t\t( navigation.message === navigation.texts.loaded\r\n\t\t\t\t\t\t\t? '\\u00A0'\r\n\t\t\t\t\t\t\t: '' );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Scroll to the anchor if exits in the link.\r\n\t\t\t\tconst { hash } = new URL( href, window.location.href );\r\n\t\t\t\tif ( hash ) {\r\n\t\t\t\t\tdocument.querySelector( hash )?.scrollIntoView();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tyield forcePageReload( href );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Prefetchs the page with the passed URL.\r\n\t\t *\r\n\t\t * The function normalizes the URL and stores internally the fetch\r\n\t\t * promise, to avoid triggering a second fetch for an ongoing request.\r\n\t\t *\r\n\t\t * @param url             The page URL.\r\n\t\t * @param [options]       Options object.\r\n\t\t * @param [options.force] Force fetching the URL again.\r\n\t\t * @param [options.html]  HTML string to be used instead of fetching the requested URL.\r\n\t\t */\r\n\t\tprefetch( url: string, options: PrefetchOptions = {} ) {\r\n\t\t\tconst { clientNavigationDisabled } = getConfig();\r\n\t\t\tif ( clientNavigationDisabled ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst pagePath = getPagePath( url );\r\n\t\t\tif ( options.force || ! pages.has( pagePath ) ) {\r\n\t\t\t\tpages.set(\r\n\t\t\t\t\tpagePath,\r\n\t\t\t\t\tfetchPage( pagePath, { html: options.html } )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n} );\r\n\r\n// Add click and prefetch to all links.\r\nif ( globalThis.IS_GUTENBERG_PLUGIN ) {\r\n\tif ( navigationMode === 'fullPage' ) {\r\n\t\t// Navigate on click.\r\n\t\tdocument.addEventListener(\r\n\t\t\t'click',\r\n\t\t\tfunction ( event ) {\r\n\t\t\t\tconst ref = ( event.target as Element ).closest( 'a' );\r\n\t\t\t\tif ( isValidLink( ref ) && isValidEvent( event ) ) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tactions.navigate( ref.href );\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttrue\r\n\t\t);\r\n\t\t// Prefetch on hover.\r\n\t\tdocument.addEventListener(\r\n\t\t\t'mouseenter',\r\n\t\t\tfunction ( event ) {\r\n\t\t\t\tif ( ( event.target as Element )?.nodeName === 'A' ) {\r\n\t\t\t\t\tconst ref = ( event.target as Element ).closest( 'a' );\r\n\t\t\t\t\tif ( isValidLink( ref ) && isValidEvent( event ) ) {\r\n\t\t\t\t\t\tactions.prefetch( ref.href );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttrue\r\n\t\t);\r\n\t}\r\n}\r\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,KAAK,EAAEC,WAAW,EAAEC,SAAS,QAAQ,0BAA0B;;AAExE;AACA;AACA;AACA,SAASC,eAAe,EAAEC,UAAU,QAAQ,QAAQ;AAEpD,MAAM;EACLC,eAAe;EACfC,qBAAqB;EACrBC,WAAW;EACXC,MAAM;EACNC,MAAM;EACNC,eAAe;EACfC,kBAAkB;EAClBC;AACD,CAAC,GAAGX,WAAW,CACd,wHACD,CAAC;AA6BD;AACA,MAAMY,cAA0C,IAAAC,qBAAA,GAC/CZ,SAAS,CAAE,aAAc,CAAC,CAACW,cAAc,cAAAC,qBAAA,cAAAA,qBAAA,GAAI,aAAa;;AAE3D;AACA,MAAMC,KAAK,GAAG,IAAIC,GAAG,CAAoC,CAAC;AAC1D,MAAMC,YAAY,GAAG,IAAID,GAAG,CAA+C,CAAC;;AAE5E;AACA;AACA,MAAME,WAAW,GAAKC,GAAW,IAAM;EACtC,MAAMC,CAAC,GAAG,IAAIC,GAAG,CAAEF,GAAG,EAAEG,MAAM,CAACC,QAAQ,CAACC,IAAK,CAAC;EAC9C,OAAOJ,CAAC,CAACK,QAAQ,GAAGL,CAAC,CAACM,MAAM;AAC7B,CAAC;;AAED;AACA,MAAMC,SAAS,GAAG,MAAAA,CAAQR,GAAW,EAAE;EAAES;AAAuB,CAAC,KAAM;EACtE,IAAI;IACH,IAAK,CAAEA,IAAI,EAAG;MACb,MAAMC,GAAG,GAAG,MAAMP,MAAM,CAACQ,KAAK,CAAEX,GAAI,CAAC;MACrC,IAAKU,GAAG,CAACE,MAAM,KAAK,GAAG,EAAG;QACzB,OAAO,KAAK;MACb;MACAH,IAAI,GAAG,MAAMC,GAAG,CAACG,IAAI,CAAC,CAAC;IACxB;IACA,MAAMC,GAAG,GAAG,IAAIX,MAAM,CAACY,SAAS,CAAC,CAAC,CAACC,eAAe,CAAEP,IAAI,EAAE,WAAY,CAAC;IACvE,OAAOQ,aAAa,CAAEH,GAAI,CAAC;EAC5B,CAAC,CAAC,OAAQI,CAAC,EAAG;IACb,OAAO,KAAK;EACb;AACD,CAAC;;AAED;AACA;AACA,MAAMD,aAA4B,GAAG,MAAAA,CAAQH,GAAG,EAAE;EAAEK;AAAK,CAAC,GAAG,CAAC,CAAC,KAAM;EACpE,MAAMC,OAAO,GAAG;IAAEC,IAAI,EAAEC;EAAU,CAAC;EACnC,IAAIC,IAAmB;EACvB,IAAKC,UAAU,CAACC,mBAAmB,EAAG;IACrC,IAAK/B,cAAc,KAAK,UAAU,EAAG;MACpC6B,IAAI,GAAG,MAAMvC,eAAe,CAAE8B,GAAG,EAAEhB,YAAa,CAAC;MACjDsB,OAAO,CAACC,IAAI,GAAGF,IAAI,GAChBA,IAAI,CAACO,GAAG,CAAEC,QAAQ,CAACN,IAAK,CAAC,GACzBhC,MAAM,CAAEyB,GAAG,CAACO,IAAK,CAAC;IACtB;EACD;EACA,IAAK3B,cAAc,KAAK,aAAa,EAAG;IACvC,MAAMkC,QAAQ,GAAI,QAAQ1C,eAAiB,gBAAe;IAC1D4B,GAAG,CAACe,gBAAgB,CAAG,IAAID,QAAU,GAAG,CAAC,CAACE,OAAO,CAAIC,MAAM,IAAM;MAChE,MAAMC,EAAE,GAAGD,MAAM,CAACE,YAAY,CAAEL,QAAS,CAAC;MAC1CR,OAAO,CAAEY,EAAE,CAAE,GAAGb,IAAI,EAAEe,GAAG,CAAEH,MAAO,CAAC,GAChCZ,IAAI,CAACO,GAAG,CAAEK,MAAO,CAAC,GAClB1C,MAAM,CAAE0C,MAAO,CAAC;IACpB,CAAE,CAAC;EACJ;EACA,MAAMI,KAAK,GAAGrB,GAAG,CAACsB,aAAa,CAAE,OAAQ,CAAC,EAAEC,SAAS;EACrD,MAAMC,WAAW,GAAG/C,eAAe,CAAEuB,GAAI,CAAC;EAC1C,OAAO;IAAEM,OAAO;IAAEG,IAAI;IAAEY,KAAK;IAAEG;EAAY,CAAC;AAC7C,CAAC;;AAED;AACA,MAAMC,aAAa,GAAKC,IAAU,IAAM;EACvC/C,KAAK,CAAE,MAAM;IACZ,IAAK+B,UAAU,CAACC,mBAAmB,EAAG;MACrC,IAAK/B,cAAc,KAAK,UAAU,EAAG;QACpC;QACAT,UAAU,CAAEuD,IAAI,CAACjB,IAAK,CAAC;QACvB,MAAMkB,QAAQ,GAAGtD,qBAAqB,CAAEwC,QAAQ,CAACN,IAAK,CAAC;QACvD/B,MAAM,CAAEkD,IAAI,CAACpB,OAAO,CAACC,IAAI,EAAEoB,QAAS,CAAC;MACtC;IACD;IACA,IAAK/C,cAAc,KAAK,aAAa,EAAG;MACvCF,kBAAkB,CAAEgD,IAAI,CAACF,WAAY,CAAC;MACtC,MAAMV,QAAQ,GAAI,QAAQ1C,eAAiB,gBAAe;MAC1DyC,QAAQ,CACNE,gBAAgB,CAAG,IAAID,QAAU,GAAG,CAAC,CACrCE,OAAO,CAAIC,MAAM,IAAM;QACvB,MAAMC,EAAE,GAAGD,MAAM,CAACE,YAAY,CAAEL,QAAS,CAAC;QAC1C,MAAMa,QAAQ,GAAGtD,qBAAqB,CAAE4C,MAAO,CAAC;QAChDzC,MAAM,CAAEkD,IAAI,CAACpB,OAAO,CAAEY,EAAE,CAAE,EAAES,QAAS,CAAC;MACvC,CAAE,CAAC;IACL;IACA,IAAKD,IAAI,CAACL,KAAK,EAAG;MACjBR,QAAQ,CAACQ,KAAK,GAAGK,IAAI,CAACL,KAAK;IAC5B;EACD,CAAE,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMO,eAAe,GAAKrC,IAAY,IAAM;EAC3CF,MAAM,CAACC,QAAQ,CAACuC,MAAM,CAAEtC,IAAK,CAAC;EAC9B,OAAO,IAAIuC,OAAO,CAAE,MAAM,CAAC,CAAE,CAAC;AAC/B,CAAC;;AAED;AACA;AACAzC,MAAM,CAAC0C,gBAAgB,CAAE,UAAU,EAAE,YAAY;EAChD,MAAMC,QAAQ,GAAG/C,WAAW,CAAEI,MAAM,CAACC,QAAQ,CAACC,IAAK,CAAC,CAAC,CAAC;EACtD,MAAMmC,IAAI,GAAG5C,KAAK,CAACsC,GAAG,CAAEY,QAAS,CAAC,KAAM,MAAMlD,KAAK,CAAC8B,GAAG,CAAEoB,QAAS,CAAC,CAAE;EACrE,IAAKN,IAAI,EAAG;IACXD,aAAa,CAAEC,IAAK,CAAC;IACrB;IACAO,KAAK,CAAC/C,GAAG,GAAGG,MAAM,CAACC,QAAQ,CAACC,IAAI;EACjC,CAAC,MAAM;IACNF,MAAM,CAACC,QAAQ,CAAC4C,MAAM,CAAC,CAAC;EACzB;AACD,CAAE,CAAC;;AAEH;AACA;AACA;AACA,IAAKxB,UAAU,CAACC,mBAAmB,EAAG;EACrC,IAAK/B,cAAc,KAAK,UAAU,EAAG;IACpC;IACA,EAAE,CAACuD,GAAG,CAACC,IAAI,CAAEvB,QAAQ,CAACE,gBAAgB,CAAE,aAAc,CAAC,EAAIsB,MAAM,IAAM;MACtErD,YAAY,CAACsD,GAAG,CAAED,MAAM,CAAClB,YAAY,CAAE,KAAM,CAAC,EAAE;QAC/CoB,GAAG,EAAEF,MAAM;QACXtC,IAAI,EAAEsC,MAAM,CAACG;MACd,CAAE,CAAC;IACJ,CAAE,CAAC;IACH,MAAMtE,eAAe,CAAE2C,QAAQ,EAAE7B,YAAa,CAAC;EAChD;AACD;AACAF,KAAK,CAACwD,GAAG,CACRrD,WAAW,CAAEI,MAAM,CAACC,QAAQ,CAACC,IAAK,CAAC,EACnCuC,OAAO,CAACW,OAAO,CAAEtC,aAAa,CAAEU,QAAQ,EAAE;EAAER,IAAI,EAAE/B;AAAY,CAAE,CAAE,CACnE,CAAC;;AAED;AACA,MAAMoE,WAAW,GAAKC,GAAsB,IAC3CA,GAAG,IACHA,GAAG,YAAYtD,MAAM,CAACuD,iBAAiB,IACvCD,GAAG,CAACpD,IAAI,KACN,CAAEoD,GAAG,CAACE,MAAM,IAAIF,GAAG,CAACE,MAAM,KAAK,OAAO,CAAE,IAC1CF,GAAG,CAACG,MAAM,KAAKzD,MAAM,CAACC,QAAQ,CAACwD,MAAM,IACrC,CAAEH,GAAG,CAACnD,QAAQ,CAACuD,UAAU,CAAE,WAAY,CAAC,IACxC,CAAEJ,GAAG,CAACnD,QAAQ,CAACuD,UAAU,CAAE,eAAgB,CAAC,IAC5C,CAAEJ,GAAG,CAACxB,YAAY,CAAE,MAAO,CAAC,CAAC4B,UAAU,CAAE,GAAI,CAAC,IAC9C,CAAE,IAAI3D,GAAG,CAAEuD,GAAG,CAACpD,IAAK,CAAC,CAACyD,YAAY,CAAC5B,GAAG,CAAE,UAAW,CAAC;;AAErD;AACA,MAAM6B,YAAY,GAAKC,KAAiB,IACvCA,KAAK,IACLA,KAAK,CAACC,MAAM,KAAK,CAAC;AAAI;AACtB,CAAED,KAAK,CAACE,OAAO;AAAI;AACnB,CAAEF,KAAK,CAACG,OAAO;AAAI;AACnB,CAAEH,KAAK,CAACI,MAAM;AAAI;AAClB,CAAEJ,KAAK,CAACK,QAAQ,IAChB,CAAEL,KAAK,CAACM,gBAAgB;;AAEzB;AACA,IAAIC,YAAY,GAAG,EAAE;AAErB,OAAO,MAAM;EAAExB,KAAK;EAAEyB;AAAQ,CAAC,GAAG3F,KAAK,CAAE,aAAa,EAAE;EACvDkE,KAAK,EAAE;IACN/C,GAAG,EAAEG,MAAM,CAACC,QAAQ,CAACC,IAAI;IACzBoE,UAAU,EAAE;MACXC,UAAU,EAAE,KAAK;MACjBC,WAAW,EAAE,KAAK;MAClBC,KAAK,EAAE;QACNC,OAAO,EAAE,EAAE;QACXC,MAAM,EAAE;MACT,CAAC;MACDC,OAAO,EAAE;IACV;EACD,CAAC;EACDP,OAAO,EAAE;IACR;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACE,CAACQ,QAAQA,CAAE3E,IAAY,EAAE4E,OAAwB,GAAG,CAAC,CAAC,EAAG;MACxD,MAAM;QAAEC;MAAyB,CAAC,GAAGnG,SAAS,CAAC,CAAC;MAChD,IAAKmG,wBAAwB,EAAG;QAC/B,MAAMxC,eAAe,CAAErC,IAAK,CAAC;MAC9B;MAEA,MAAMyC,QAAQ,GAAG/C,WAAW,CAAEM,IAAK,CAAC;MACpC,MAAM;QAAEoE;MAAW,CAAC,GAAG1B,KAAK;MAC5B,MAAM;QACLoC,gBAAgB,GAAG,IAAI;QACvBC,wBAAwB,GAAG,IAAI;QAC/BC,OAAO,GAAG;MACX,CAAC,GAAGJ,OAAO;MAEXV,YAAY,GAAGlE,IAAI;MACnBmE,OAAO,CAACc,QAAQ,CAAExC,QAAQ,EAAEmC,OAAQ,CAAC;;MAErC;MACA;MACA,MAAMM,cAAc,GAAG,IAAI3C,OAAO,CAAYW,OAAO,IACpDiC,UAAU,CAAEjC,OAAO,EAAE8B,OAAQ,CAC9B,CAAC;;MAED;MACA,MAAMI,cAAc,GAAGD,UAAU,CAAE,MAAM;QACxC,IAAKjB,YAAY,KAAKlE,IAAI,EAAG;UAC5B;QACD;QAEA,IAAK8E,gBAAgB,EAAG;UACvBV,UAAU,CAACC,UAAU,GAAG,IAAI;UAC5BD,UAAU,CAACE,WAAW,GAAG,KAAK;QAC/B;QACA,IAAKS,wBAAwB,EAAG;UAC/BX,UAAU,CAACM,OAAO,GAAGN,UAAU,CAACG,KAAK,CAACC,OAAO;QAC9C;MACD,CAAC,EAAE,GAAI,CAAC;MAER,MAAMrC,IAAI,GAAG,MAAMI,OAAO,CAAC8C,IAAI,CAAE,CAChC9F,KAAK,CAAC8B,GAAG,CAAEoB,QAAS,CAAC,EACrByC,cAAc,CACb,CAAC;;MAEH;MACAI,YAAY,CAAEF,cAAe,CAAC;;MAE9B;MACA;MACA;MACA,IAAKlB,YAAY,KAAKlE,IAAI,EAAG;QAC5B;MACD;MAEA,IACCmC,IAAI,IACJ,CAAEA,IAAI,CAACF,WAAW,EAAEsD,MAAM,GAAI,aAAa,CAAE,EAC1CV,wBAAwB,EAC1B;QACD,MAAM3C,aAAa,CAAEC,IAAK,CAAC;QAC3BrC,MAAM,CAAC0F,OAAO,CACbZ,OAAO,CAACa,OAAO,GAAG,cAAc,GAAG,WAAW,CAC9C,CAAE,CAAC,CAAC,EAAE,EAAE,EAAEzF,IAAK,CAAC;;QAEjB;QACA0C,KAAK,CAAC/C,GAAG,GAAGK,IAAI;;QAEhB;QACA;QACA,IAAK8E,gBAAgB,EAAG;UACvBV,UAAU,CAACC,UAAU,GAAG,KAAK;UAC7BD,UAAU,CAACE,WAAW,GAAG,IAAI;QAC9B;QAEA,IAAKS,wBAAwB,EAAG;UAC/B;UACA;UACA;UACAX,UAAU,CAACM,OAAO,GACjBN,UAAU,CAACG,KAAK,CAACE,MAAM,IACrBL,UAAU,CAACM,OAAO,KAAKN,UAAU,CAACG,KAAK,CAACE,MAAM,GAC7C,QAAQ,GACR,EAAE,CAAE;QACT;;QAEA;QACA,MAAM;UAAEiB;QAAK,CAAC,GAAG,IAAI7F,GAAG,CAAEG,IAAI,EAAEF,MAAM,CAACC,QAAQ,CAACC,IAAK,CAAC;QACtD,IAAK0F,IAAI,EAAG;UACXpE,QAAQ,CAACS,aAAa,CAAE2D,IAAK,CAAC,EAAEC,cAAc,CAAC,CAAC;QACjD;MACD,CAAC,MAAM;QACN,MAAMtD,eAAe,CAAErC,IAAK,CAAC;MAC9B;IACD,CAAC;IAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACEiF,QAAQA,CAAEtF,GAAW,EAAEiF,OAAwB,GAAG,CAAC,CAAC,EAAG;MACtD,MAAM;QAAEC;MAAyB,CAAC,GAAGnG,SAAS,CAAC,CAAC;MAChD,IAAKmG,wBAAwB,EAAG;QAC/B;MACD;MAEA,MAAMpC,QAAQ,GAAG/C,WAAW,CAAEC,GAAI,CAAC;MACnC,IAAKiF,OAAO,CAACgB,KAAK,IAAI,CAAErG,KAAK,CAACsC,GAAG,CAAEY,QAAS,CAAC,EAAG;QAC/ClD,KAAK,CAACwD,GAAG,CACRN,QAAQ,EACRtC,SAAS,CAAEsC,QAAQ,EAAE;UAAErC,IAAI,EAAEwE,OAAO,CAACxE;QAAK,CAAE,CAC7C,CAAC;MACF;IACD;EACD;AACD,CAAE,CAAC;;AAEH;AACA,IAAKe,UAAU,CAACC,mBAAmB,EAAG;EACrC,IAAK/B,cAAc,KAAK,UAAU,EAAG;IACpC;IACAiC,QAAQ,CAACkB,gBAAgB,CACxB,OAAO,EACP,UAAWmB,KAAK,EAAG;MAClB,MAAMP,GAAG,GAAKO,KAAK,CAACL,MAAM,CAAcuC,OAAO,CAAE,GAAI,CAAC;MACtD,IAAK1C,WAAW,CAAEC,GAAI,CAAC,IAAIM,YAAY,CAAEC,KAAM,CAAC,EAAG;QAClDA,KAAK,CAACmC,cAAc,CAAC,CAAC;QACtB3B,OAAO,CAACQ,QAAQ,CAAEvB,GAAG,CAACpD,IAAK,CAAC;MAC7B;IACD,CAAC,EACD,IACD,CAAC;IACD;IACAsB,QAAQ,CAACkB,gBAAgB,CACxB,YAAY,EACZ,UAAWmB,KAAK,EAAG;MAClB,IAAOA,KAAK,CAACL,MAAM,EAAeyC,QAAQ,KAAK,GAAG,EAAG;QACpD,MAAM3C,GAAG,GAAKO,KAAK,CAACL,MAAM,CAAcuC,OAAO,CAAE,GAAI,CAAC;QACtD,IAAK1C,WAAW,CAAEC,GAAI,CAAC,IAAIM,YAAY,CAAEC,KAAM,CAAC,EAAG;UAClDQ,OAAO,CAACc,QAAQ,CAAE7B,GAAG,CAACpD,IAAK,CAAC;QAC7B;MACD;IACD,CAAC,EACD,IACD,CAAC;EACF;AACD","ignoreList":[]}