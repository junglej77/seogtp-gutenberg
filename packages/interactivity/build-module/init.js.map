{"version":3,"names":["hydrate","toVdom","hydratedIslands","createRootFragment","splitTask","directivePrefix","regionRootFragments","WeakMap","getRegionRootFragment","region","parentElement","Error","has","set","get","initialVdom","init","nodes","document","querySelectorAll","node","fragment","vdom"],"sources":["@wordpress/interactivity/src/init.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport { hydrate, type ContainerNode, type ComponentChild } from 'preact';\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { toVdom, hydratedIslands } from './vdom';\r\nimport { createRootFragment, splitTask } from './utils';\r\nimport { directivePrefix } from './constants';\r\n\r\n// Keep the same root fragment for each interactive region node.\r\nconst regionRootFragments = new WeakMap();\r\nexport const getRegionRootFragment = ( region: Element ): ContainerNode => {\r\n\tif ( ! region.parentElement ) {\r\n\t\tthrow Error( 'The passed region should be an element with a parent.' );\r\n\t}\r\n\tif ( ! regionRootFragments.has( region ) ) {\r\n\t\tregionRootFragments.set(\r\n\t\t\tregion,\r\n\t\t\tcreateRootFragment( region.parentElement, region )\r\n\t\t);\r\n\t}\r\n\treturn regionRootFragments.get( region );\r\n};\r\n\r\n// Initial vDOM regions associated with its DOM element.\r\nexport const initialVdom = new WeakMap< Element, ComponentChild[] >();\r\n\r\n// Initialize the router with the initial DOM.\r\nexport const init = async () => {\r\n\tconst nodes = document.querySelectorAll(\r\n\t\t`[data-${ directivePrefix }-interactive]`\r\n\t);\r\n\r\n\tfor ( const node of nodes ) {\r\n\t\tif ( ! hydratedIslands.has( node ) ) {\r\n\t\t\tawait splitTask();\r\n\t\t\tconst fragment = getRegionRootFragment( node );\r\n\t\t\tconst vdom = toVdom( node );\r\n\t\t\tinitialVdom.set( node, vdom );\r\n\t\t\tawait splitTask();\r\n\t\t\thydrate( vdom, fragment );\r\n\t\t}\r\n\t}\r\n};\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,OAAO,QAAiD,QAAQ;AACzE;AACA;AACA;AACA,SAASC,MAAM,EAAEC,eAAe,QAAQ,QAAQ;AAChD,SAASC,kBAAkB,EAAEC,SAAS,QAAQ,SAAS;AACvD,SAASC,eAAe,QAAQ,aAAa;;AAE7C;AACA,MAAMC,mBAAmB,GAAG,IAAIC,OAAO,CAAC,CAAC;AACzC,OAAO,MAAMC,qBAAqB,GAAKC,MAAe,IAAqB;EAC1E,IAAK,CAAEA,MAAM,CAACC,aAAa,EAAG;IAC7B,MAAMC,KAAK,CAAE,uDAAwD,CAAC;EACvE;EACA,IAAK,CAAEL,mBAAmB,CAACM,GAAG,CAAEH,MAAO,CAAC,EAAG;IAC1CH,mBAAmB,CAACO,GAAG,CACtBJ,MAAM,EACNN,kBAAkB,CAAEM,MAAM,CAACC,aAAa,EAAED,MAAO,CAClD,CAAC;EACF;EACA,OAAOH,mBAAmB,CAACQ,GAAG,CAAEL,MAAO,CAAC;AACzC,CAAC;;AAED;AACA,OAAO,MAAMM,WAAW,GAAG,IAAIR,OAAO,CAA8B,CAAC;;AAErE;AACA,OAAO,MAAMS,IAAI,GAAG,MAAAA,CAAA,KAAY;EAC/B,MAAMC,KAAK,GAAGC,QAAQ,CAACC,gBAAgB,CACrC,SAASd,eAAiB,eAC5B,CAAC;EAED,KAAM,MAAMe,IAAI,IAAIH,KAAK,EAAG;IAC3B,IAAK,CAAEf,eAAe,CAACU,GAAG,CAAEQ,IAAK,CAAC,EAAG;MACpC,MAAMhB,SAAS,CAAC,CAAC;MACjB,MAAMiB,QAAQ,GAAGb,qBAAqB,CAAEY,IAAK,CAAC;MAC9C,MAAME,IAAI,GAAGrB,MAAM,CAAEmB,IAAK,CAAC;MAC3BL,WAAW,CAACF,GAAG,CAAEO,IAAI,EAAEE,IAAK,CAAC;MAC7B,MAAMlB,SAAS,CAAC,CAAC;MACjBJ,OAAO,CAAEsB,IAAI,EAAED,QAAS,CAAC;IAC1B;EACD;AACD,CAAC","ignoreList":[]}