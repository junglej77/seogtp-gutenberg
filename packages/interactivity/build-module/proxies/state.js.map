{"version":3,"names":["batch","signal","createProxy","getProxyFromObject","getNamespaceFromProxy","shouldProxy","getObjectFromProxy","PropSignal","setNamespace","resetNamespace","isPlainObject","wellKnownSymbols","Set","Object","getOwnPropertyNames","Symbol","map","key","filter","value","proxyToProps","WeakMap","hasPropSignal","proxy","has","get","getPropSignal","initial","set","Map","props","ns","prop","setGetter","setValue","proxifyState","objToIterable","peeking","stateHandlers","target","receiver","hasOwnProperty","Reflect","desc","getOwnPropertyDescriptor","result","getComputed","args","call","defineProperty","isNew","Array","isArray","length","deleteProperty","undefined","ownKeys","_","namespace","obj","peek","deepMergeRecursive","source","override","hasNewKeys","configurable","enumerable","propSignal","deepMerge"],"sources":["@wordpress/interactivity/src/proxies/state.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport { batch, signal, type Signal } from '@preact/signals';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport {\r\n\tcreateProxy,\r\n\tgetProxyFromObject,\r\n\tgetNamespaceFromProxy,\r\n\tshouldProxy,\r\n\tgetObjectFromProxy,\r\n} from './registry';\r\nimport { PropSignal } from './signals';\r\nimport { setNamespace, resetNamespace } from '../namespaces';\r\nimport { isPlainObject } from '../utils';\r\n\r\n/**\r\n * Set of built-in symbols.\r\n */\r\nconst wellKnownSymbols = new Set(\r\n\tObject.getOwnPropertyNames( Symbol )\r\n\t\t.map( ( key ) => Symbol[ key ] )\r\n\t\t.filter( ( value ) => typeof value === 'symbol' )\r\n);\r\n\r\n/**\r\n * Relates each proxy with a map of {@link PropSignal} instances, representing\r\n * the proxy's accessed properties.\r\n */\r\nconst proxyToProps: WeakMap<\r\n\tobject,\r\n\tMap< string | symbol, PropSignal >\r\n> = new WeakMap();\r\n\r\n/**\r\n *  Checks wether a {@link PropSignal | `PropSignal`} instance exists for the\r\n *  given property in the passed proxy.\r\n *\r\n * @param proxy Proxy of a state object or array.\r\n * @param key   The property key.\r\n * @return `true` when it exists; false otherwise.\r\n */\r\nexport const hasPropSignal = ( proxy: object, key: string ) =>\r\n\tproxyToProps.has( proxy ) && proxyToProps.get( proxy )!.has( key );\r\n\r\n/**\r\n * Returns the {@link PropSignal | `PropSignal`} instance associated with the\r\n * specified prop in the passed proxy.\r\n *\r\n * The `PropSignal` instance is generated if it doesn't exist yet, using the\r\n * `initial` parameter to initialize the internal signals.\r\n *\r\n * @param proxy   Proxy of a state object or array.\r\n * @param key     The property key.\r\n * @param initial Initial data for the `PropSignal` instance.\r\n * @return The `PropSignal` instance.\r\n */\r\nconst getPropSignal = (\r\n\tproxy: object,\r\n\tkey: string | number | symbol,\r\n\tinitial?: PropertyDescriptor\r\n) => {\r\n\tif ( ! proxyToProps.has( proxy ) ) {\r\n\t\tproxyToProps.set( proxy, new Map() );\r\n\t}\r\n\tkey = typeof key === 'number' ? `${ key }` : key;\r\n\tconst props = proxyToProps.get( proxy )!;\r\n\tif ( ! props.has( key ) ) {\r\n\t\tconst ns = getNamespaceFromProxy( proxy );\r\n\t\tconst prop = new PropSignal( proxy );\r\n\t\tprops.set( key, prop );\r\n\t\tif ( initial ) {\r\n\t\t\tconst { get, value } = initial;\r\n\t\t\tif ( get ) {\r\n\t\t\t\tprop.setGetter( get );\r\n\t\t\t} else {\r\n\t\t\t\tprop.setValue(\r\n\t\t\t\t\tshouldProxy( value ) ? proxifyState( ns, value ) : value\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn props.get( key )!;\r\n};\r\n\r\n/**\r\n * Relates each proxied object (i.e., the original object) with a signal that\r\n * tracks changes in the number of properties.\r\n */\r\nconst objToIterable = new WeakMap< object, Signal< number > >();\r\n\r\n/**\r\n * When this flag is `true`, it avoids any signal subscription, overriding state\r\n * props' \"reactive\" behavior.\r\n */\r\nlet peeking = false;\r\n\r\n/**\r\n * Handlers for reactive objects and arrays in the state.\r\n */\r\nconst stateHandlers: ProxyHandler< object > = {\r\n\tget( target: object, key: string | symbol, receiver: object ): any {\r\n\t\t/*\r\n\t\t * The property should not be reactive for the following cases:\r\n\t\t * 1. While using the `peek` function to read the property.\r\n\t\t * 2. The property exists but comes from the Object or Array prototypes.\r\n\t\t * 3. The property key is a known symbol.\r\n\t\t */\r\n\t\tif (\r\n\t\t\tpeeking ||\r\n\t\t\t( ! target.hasOwnProperty( key ) && key in target ) ||\r\n\t\t\t( typeof key === 'symbol' && wellKnownSymbols.has( key ) )\r\n\t\t) {\r\n\t\t\treturn Reflect.get( target, key, receiver );\r\n\t\t}\r\n\r\n\t\t// At this point, the property should be reactive.\r\n\t\tconst desc = Object.getOwnPropertyDescriptor( target, key );\r\n\t\tconst prop = getPropSignal( receiver, key, desc );\r\n\t\tconst result = prop.getComputed().value;\r\n\r\n\t\t/*\r\n\t\t * Check if the property is a synchronous function. If it is, set the\r\n\t\t * default namespace. Synchronous functions always run in the proper scope,\r\n\t\t * which is set by the Directives component.\r\n\t\t */\r\n\t\tif ( typeof result === 'function' ) {\r\n\t\t\tconst ns = getNamespaceFromProxy( receiver );\r\n\t\t\treturn ( ...args: unknown[] ) => {\r\n\t\t\t\tsetNamespace( ns );\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn result.call( receiver, ...args );\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tresetNamespace();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t},\r\n\r\n\tset(\r\n\t\ttarget: object,\r\n\t\tkey: string,\r\n\t\tvalue: unknown,\r\n\t\treceiver: object\r\n\t): boolean {\r\n\t\tsetNamespace( getNamespaceFromProxy( receiver ) );\r\n\t\ttry {\r\n\t\t\treturn Reflect.set( target, key, value, receiver );\r\n\t\t} finally {\r\n\t\t\tresetNamespace();\r\n\t\t}\r\n\t},\r\n\r\n\tdefineProperty(\r\n\t\ttarget: object,\r\n\t\tkey: string,\r\n\t\tdesc: PropertyDescriptor\r\n\t): boolean {\r\n\t\tconst isNew = ! ( key in target );\r\n\t\tconst result = Reflect.defineProperty( target, key, desc );\r\n\r\n\t\tif ( result ) {\r\n\t\t\tconst receiver = getProxyFromObject( target )!;\r\n\t\t\tconst prop = getPropSignal( receiver, key );\r\n\t\t\tconst { get, value } = desc;\r\n\t\t\tif ( get ) {\r\n\t\t\t\tprop.setGetter( get );\r\n\t\t\t} else {\r\n\t\t\t\tconst ns = getNamespaceFromProxy( receiver );\r\n\t\t\t\tprop.setValue(\r\n\t\t\t\t\tshouldProxy( value ) ? proxifyState( ns, value ) : value\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif ( isNew && objToIterable.has( target ) ) {\r\n\t\t\t\tobjToIterable.get( target )!.value++;\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\t * Modify the `length` property value only if the related\r\n\t\t\t * `PropSignal` exists, which means that there are subscriptions to\r\n\t\t\t * this property.\r\n\t\t\t */\r\n\t\t\tif (\r\n\t\t\t\tArray.isArray( target ) &&\r\n\t\t\t\tproxyToProps.get( receiver )?.has( 'length' )\r\n\t\t\t) {\r\n\t\t\t\tconst length = getPropSignal( receiver, 'length' );\r\n\t\t\t\tlength.setValue( target.length );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t},\r\n\r\n\tdeleteProperty( target: object, key: string ): boolean {\r\n\t\tconst result = Reflect.deleteProperty( target, key );\r\n\r\n\t\tif ( result ) {\r\n\t\t\tconst prop = getPropSignal( getProxyFromObject( target )!, key );\r\n\t\t\tprop.setValue( undefined );\r\n\r\n\t\t\tif ( objToIterable.has( target ) ) {\r\n\t\t\t\tobjToIterable.get( target )!.value++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t},\r\n\r\n\townKeys( target: object ): ( string | symbol )[] {\r\n\t\tif ( ! objToIterable.has( target ) ) {\r\n\t\t\tobjToIterable.set( target, signal( 0 ) );\r\n\t\t}\r\n\t\t/*\r\n\t\t *This subscribes to the signal while preventing the minifier from\r\n\t\t * deleting this line in production.\r\n\t\t */\r\n\t\t( objToIterable as any )._ = objToIterable.get( target )!.value;\r\n\t\treturn Reflect.ownKeys( target );\r\n\t},\r\n};\r\n\r\n/**\r\n * Returns the proxy associated with the given state object, creating it if it\r\n * does not exist.\r\n *\r\n * @param namespace The namespace that will be associated to this proxy.\r\n * @param obj       The object to proxify.\r\n *\r\n * @throws Error if the object cannot be proxified. Use {@link shouldProxy} to\r\n *         check if a proxy can be created for a specific object.\r\n *\r\n * @return The associated proxy.\r\n */\r\nexport const proxifyState = < T extends object >(\r\n\tnamespace: string,\r\n\tobj: T\r\n): T => createProxy( namespace, obj, stateHandlers ) as T;\r\n\r\n/**\r\n * Reads the value of the specified property without subscribing to it.\r\n *\r\n * @param obj The object to read the property from.\r\n * @param key The property key.\r\n * @return The property value.\r\n */\r\nexport const peek = < T extends object, K extends keyof T >(\r\n\tobj: T,\r\n\tkey: K\r\n): T[ K ] => {\r\n\tpeeking = true;\r\n\ttry {\r\n\t\treturn obj[ key ];\r\n\t} finally {\r\n\t\tpeeking = false;\r\n\t}\r\n};\r\n\r\n/**\r\n * Internal recursive implementation for {@link deepMerge | `deepMerge`}.\r\n *\r\n * @param target   The target object.\r\n * @param source   The source object containing new values and props.\r\n * @param override Whether existing props should be overwritten or not (`true`\r\n *                 by default).\r\n */\r\nconst deepMergeRecursive = (\r\n\ttarget: any,\r\n\tsource: any,\r\n\toverride: boolean = true\r\n) => {\r\n\tif ( isPlainObject( target ) && isPlainObject( source ) ) {\r\n\t\tlet hasNewKeys = false;\r\n\t\tfor ( const key in source ) {\r\n\t\t\tconst isNew = ! ( key in target );\r\n\t\t\thasNewKeys = hasNewKeys || isNew;\r\n\r\n\t\t\tconst desc = Object.getOwnPropertyDescriptor( source, key );\r\n\t\t\tif (\r\n\t\t\t\ttypeof desc?.get === 'function' ||\r\n\t\t\t\ttypeof desc?.set === 'function'\r\n\t\t\t) {\r\n\t\t\t\tif ( override || isNew ) {\r\n\t\t\t\t\tObject.defineProperty( target, key, {\r\n\t\t\t\t\t\t...desc,\r\n\t\t\t\t\t\tconfigurable: true,\r\n\t\t\t\t\t\tenumerable: true,\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tconst proxy = getProxyFromObject( target );\r\n\t\t\t\t\tif ( desc?.get && proxy && hasPropSignal( proxy, key ) ) {\r\n\t\t\t\t\t\tconst propSignal = getPropSignal( proxy, key );\r\n\t\t\t\t\t\tpropSignal.setGetter( desc.get );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if ( isPlainObject( source[ key ] ) ) {\r\n\t\t\t\tif ( isNew ) {\r\n\t\t\t\t\ttarget[ key ] = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdeepMergeRecursive( target[ key ], source[ key ], override );\r\n\t\t\t} else if ( override || isNew ) {\r\n\t\t\t\tObject.defineProperty( target, key, desc! );\r\n\r\n\t\t\t\tconst proxy = getProxyFromObject( target );\r\n\t\t\t\tif ( desc?.value && proxy && hasPropSignal( proxy, key ) ) {\r\n\t\t\t\t\tconst propSignal = getPropSignal( proxy, key );\r\n\t\t\t\t\tpropSignal.setValue( desc.value );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( hasNewKeys && objToIterable.has( target ) ) {\r\n\t\t\tobjToIterable.get( target )!.value++;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Recursively update prop values inside the passed `target` and nested plain\r\n * objects, using the values present in `source`. References to plain objects\r\n * are kept, only updating props containing primitives or arrays. Arrays are\r\n * replaced instead of merged or concatenated.\r\n *\r\n * If the `override` parameter is set to `false`, then all values in `target`\r\n * are preserved, and only new properties from `source` are added.\r\n *\r\n * @param target   The target object.\r\n * @param source   The source object containing new values and props.\r\n * @param override Whether existing props should be overwritten or not (`true`\r\n *                 by default).\r\n */\r\nexport const deepMerge = (\r\n\ttarget: any,\r\n\tsource: any,\r\n\toverride: boolean = true\r\n) =>\r\n\tbatch( () =>\r\n\t\tdeepMergeRecursive(\r\n\t\t\tgetObjectFromProxy( target ) || target,\r\n\t\t\tsource,\r\n\t\t\toverride\r\n\t\t)\r\n\t);\r\n"],"mappings":"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","ignoreList":[]}