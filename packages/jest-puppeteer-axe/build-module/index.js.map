{"version":3,"names":["AxePuppeteer","formatViolations","violations","map","help","helpUrl","id","nodes","output","forEach","node","any","length","target","item","message","all","none","join","toPassAxeTests","page","include","exclude","disabledRules","options","config","axe","disableRules","configure","analyze","pass","utils","matcherHint","RECEIVED_COLOR","expect","extend"],"sources":["@wordpress/jest-puppeteer-axe/src/index.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport AxePuppeteer from '@axe-core/puppeteer';\r\n\r\n/** @typedef {import('puppeteer-core').Page} Page */\r\n\r\n/** @typedef {import('axe-core').RunOptions} RunOptions */\r\n\r\n/** @typedef {import('axe-core').Spec} Spec */\r\n\r\n/**\r\n * Formats the list of violations object returned by Axe analysis.\r\n *\r\n * @param {Object} violations The object with the errors found by Axe.\r\n *\r\n * @return {string} The user friendly message to display when the matcher fails.\r\n */\r\nfunction formatViolations( violations ) {\r\n\treturn violations\r\n\t\t.map( ( { help, helpUrl, id, nodes } ) => {\r\n\t\t\tlet output =\r\n\t\t\t\t`Rule: \"${ id }\" (${ help })\\n` +\r\n\t\t\t\t`Help: ${ helpUrl }\\n` +\r\n\t\t\t\t'Affected Nodes:\\n';\r\n\r\n\t\t\tnodes.forEach( ( node ) => {\r\n\t\t\t\tif ( node.any.length ) {\r\n\t\t\t\t\toutput += `  ${ node.target }\\n`;\r\n\t\t\t\t\toutput += '    Fix ANY of the following:\\n';\r\n\t\t\t\t\tnode.any.forEach( ( item ) => {\r\n\t\t\t\t\t\toutput += `    - ${ item.message }\\n`;\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( node.all.length ) {\r\n\t\t\t\t\toutput += `  ${ node.target }\\n`;\r\n\t\t\t\t\toutput += '    Fix ALL of the following:\\n';\r\n\t\t\t\t\tnode.all.forEach( ( item ) => {\r\n\t\t\t\t\t\toutput += `      - ${ item.message }.\\n`;\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( node.none.length ) {\r\n\t\t\t\t\toutput += `  ${ node.target }\\n`;\r\n\t\t\t\t\toutput += '    Fix ALL of the following:\\n';\r\n\t\t\t\t\tnode.none.forEach( ( item ) => {\r\n\t\t\t\t\t\toutput += `      - ${ item.message }.\\n`;\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t\treturn output;\r\n\t\t} )\r\n\t\t.join( '\\n' );\r\n}\r\n\r\n/**\r\n * Defines async matcher to check whether a given Puppeteer's page instance passes Axe accessibility tests.\r\n *\r\n * @see https://www.deque.com/axe/\r\n * It is possible to pass optional Axe API options to perform customized check.\r\n *\r\n * @see https://github.com/dequelabs/axe-core-npm/tree/develop/packages/puppeteer\r\n *\r\n * @param {Page}          page                 Puppeteer's page instance.\r\n * @param {?Object}       params               Optional params that allow better control over Axe API.\r\n * @param {?string|Array} params.include       CSS selector(s) to add to the list of elements\r\n *                                             to include in analysis.\r\n * @param {?string|Array} params.exclude       CSS selector(s) to add to the list of elements\r\n *                                             to exclude from analysis.\r\n * @param {?Array}        params.disabledRules The list of Axe rules to skip from verification.\r\n * @param {?RunOptions}   params.options       A flexible way to configure how Axe run operates,\r\n *                                             see https://github.com/dequelabs/axe-core/blob/HEAD/doc/API.md#options-parameter.\r\n * @param {?Spec}         params.config        Axe configuration object,\r\n *                                             see https://github.com/dequelabs/axe-core/blob/HEAD/doc/API.md#api-name-axeconfigure.\r\n *\r\n * @return {Object} A matcher object with two keys `pass` and `message`.\r\n */\r\nasync function toPassAxeTests(\r\n\tpage,\r\n\t{ include, exclude, disabledRules, options, config } = {}\r\n) {\r\n\tconst axe = new AxePuppeteer( page );\r\n\r\n\tif ( include ) {\r\n\t\taxe.include( include );\r\n\t}\r\n\r\n\tif ( exclude ) {\r\n\t\taxe.exclude( exclude );\r\n\t}\r\n\r\n\tif ( options ) {\r\n\t\taxe.options( options );\r\n\t}\r\n\r\n\tif ( disabledRules ) {\r\n\t\taxe.disableRules( disabledRules );\r\n\t}\r\n\r\n\tif ( config ) {\r\n\t\taxe.configure( config );\r\n\t}\r\n\r\n\tconst { violations } = await axe.analyze();\r\n\r\n\tconst pass = violations.length === 0;\r\n\tconst message = pass\r\n\t\t? () => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\tthis.utils.matcherHint( '.not.toPassAxeTests' ) +\r\n\t\t\t\t\t'\\n\\n' +\r\n\t\t\t\t\t'Expected page to contain accessibility check violations.\\n' +\r\n\t\t\t\t\t'No violations found.'\r\n\t\t\t\t);\r\n\t\t  }\r\n\t\t: () => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\tthis.utils.matcherHint( '.toPassAxeTests' ) +\r\n\t\t\t\t\t'\\n\\n' +\r\n\t\t\t\t\t'Expected page to pass Axe accessibility tests.\\n' +\r\n\t\t\t\t\t'Violations found:\\n' +\r\n\t\t\t\t\tthis.utils.RECEIVED_COLOR( formatViolations( violations ) )\r\n\t\t\t\t);\r\n\t\t  };\r\n\r\n\treturn {\r\n\t\tmessage,\r\n\t\tpass,\r\n\t};\r\n}\r\n\r\nexpect.extend( {\r\n\ttoPassAxeTests,\r\n} );\r\n"],"mappings":"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","ignoreList":[]}