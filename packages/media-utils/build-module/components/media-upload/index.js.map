{"version":3,"names":["Component","__","DEFAULT_EMPTY_GALLERY","getFeaturedImageMediaFrame","wp","window","media","view","MediaFrame","Select","extend","featuredImageToolbar","toolbar","createSelectToolbar","text","l10n","setFeaturedImage","state","options","editState","selection","get","EditImage","model","single","controller","render","content","set","loadEditor","createStates","on","states","add","FeaturedImage","editImage","getGalleryDetailsMediaFrame","Post","galleryToolbar","editing","Toolbar","items","insert","style","updateGallery","insertGallery","priority","requires","library","click","close","trigger","setState","reset","Library","id","title","createGalleryTitle","filterable","multiple","editable","query","type","GalleryEdit","menu","displaySettings","GalleryAdd","slimImageObject","img","attrSet","reduce","result","key","hasOwnProperty","getAttachmentsCollection","ids","order","orderby","post__in","posts_per_page","MediaUpload","constructor","arguments","openModal","bind","onOpen","onSelect","onUpdate","onClose","initializeListeners","frame","buildAndSetGalleryFrame","addToGallery","allowedTypes","value","props","lastGalleryValue","remove","currentState","length","GalleryDetailsMediaFrame","attachments","Selection","models","toJSON","mimeType","buildAndSetFeatureImageFrame","featuredImageId","featuredImageFrame","settings","post","componentWillUnmount","selections","selectedImages","map","attachment","updateCollection","mode","hasMedia","Array","isArray","isGallery","gallery","valueArray","forEach","more","done","detach","frameContent","collection","toArray","mirroring","_hasMore","unstableFeaturedImageFlow","modalClass","frameConfig","$el","addClass","open"],"sources":["@wordpress/media-utils/src/components/media-upload/index.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { Component } from '@wordpress/element';\r\nimport { __ } from '@wordpress/i18n';\r\n\r\nconst DEFAULT_EMPTY_GALLERY = [];\r\n\r\n/**\r\n * Prepares the Featured Image toolbars and frames.\r\n *\r\n * @return {window.wp.media.view.MediaFrame.Select} The default media workflow.\r\n */\r\nconst getFeaturedImageMediaFrame = () => {\r\n\tconst { wp } = window;\r\n\r\n\treturn wp.media.view.MediaFrame.Select.extend( {\r\n\t\t/**\r\n\t\t * Enables the Set Featured Image Button.\r\n\t\t *\r\n\t\t * @param {Object} toolbar toolbar for featured image state\r\n\t\t * @return {void}\r\n\t\t */\r\n\t\tfeaturedImageToolbar( toolbar ) {\r\n\t\t\tthis.createSelectToolbar( toolbar, {\r\n\t\t\t\ttext: wp.media.view.l10n.setFeaturedImage,\r\n\t\t\t\tstate: this.options.state,\r\n\t\t\t} );\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle the edit state requirements of selected media item.\r\n\t\t *\r\n\t\t * @return {void}\r\n\t\t */\r\n\t\teditState() {\r\n\t\t\tconst selection = this.state( 'featured-image' ).get( 'selection' );\r\n\t\t\tconst view = new wp.media.view.EditImage( {\r\n\t\t\t\tmodel: selection.single(),\r\n\t\t\t\tcontroller: this,\r\n\t\t\t} ).render();\r\n\r\n\t\t\t// Set the view to the EditImage frame using the selected image.\r\n\t\t\tthis.content.set( view );\r\n\r\n\t\t\t// After bringing in the frame, load the actual editor via an ajax call.\r\n\t\t\tview.loadEditor();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Create the default states.\r\n\t\t *\r\n\t\t * @return {void}\r\n\t\t */\r\n\t\tcreateStates: function createStates() {\r\n\t\t\tthis.on(\r\n\t\t\t\t'toolbar:create:featured-image',\r\n\t\t\t\tthis.featuredImageToolbar,\r\n\t\t\t\tthis\r\n\t\t\t);\r\n\t\t\tthis.on( 'content:render:edit-image', this.editState, this );\r\n\r\n\t\t\tthis.states.add( [\r\n\t\t\t\tnew wp.media.controller.FeaturedImage(),\r\n\t\t\t\tnew wp.media.controller.EditImage( {\r\n\t\t\t\t\tmodel: this.options.editImage,\r\n\t\t\t\t} ),\r\n\t\t\t] );\r\n\t\t},\r\n\t} );\r\n};\r\n\r\n/**\r\n * Prepares the Gallery toolbars and frames.\r\n *\r\n * @return {window.wp.media.view.MediaFrame.Post} The default media workflow.\r\n */\r\nconst getGalleryDetailsMediaFrame = () => {\r\n\tconst { wp } = window;\r\n\t/**\r\n\t * Custom gallery details frame.\r\n\t *\r\n\t * @see https://github.com/xwp/wp-core-media-widgets/blob/905edbccfc2a623b73a93dac803c5335519d7837/wp-admin/js/widgets/media-gallery-widget.js\r\n\t * @class GalleryDetailsMediaFrame\r\n\t * @class\r\n\t */\r\n\treturn wp.media.view.MediaFrame.Post.extend( {\r\n\t\t/**\r\n\t\t * Set up gallery toolbar.\r\n\t\t *\r\n\t\t * @return {void}\r\n\t\t */\r\n\t\tgalleryToolbar() {\r\n\t\t\tconst editing = this.state().get( 'editing' );\r\n\t\t\tthis.toolbar.set(\r\n\t\t\t\tnew wp.media.view.Toolbar( {\r\n\t\t\t\t\tcontroller: this,\r\n\t\t\t\t\titems: {\r\n\t\t\t\t\t\tinsert: {\r\n\t\t\t\t\t\t\tstyle: 'primary',\r\n\t\t\t\t\t\t\ttext: editing\r\n\t\t\t\t\t\t\t\t? wp.media.view.l10n.updateGallery\r\n\t\t\t\t\t\t\t\t: wp.media.view.l10n.insertGallery,\r\n\t\t\t\t\t\t\tpriority: 80,\r\n\t\t\t\t\t\t\trequires: { library: true },\r\n\r\n\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t * @fires wp.media.controller.State#update\r\n\t\t\t\t\t\t\t */\r\n\t\t\t\t\t\t\tclick() {\r\n\t\t\t\t\t\t\t\tconst controller = this.controller,\r\n\t\t\t\t\t\t\t\t\tstate = controller.state();\r\n\r\n\t\t\t\t\t\t\t\tcontroller.close();\r\n\t\t\t\t\t\t\t\tstate.trigger(\r\n\t\t\t\t\t\t\t\t\t'update',\r\n\t\t\t\t\t\t\t\t\tstate.get( 'library' )\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\t// Restore and reset the default state.\r\n\t\t\t\t\t\t\t\tcontroller.setState( controller.options.state );\r\n\t\t\t\t\t\t\t\tcontroller.reset();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t} )\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle the edit state requirements of selected media item.\r\n\t\t *\r\n\t\t * @return {void}\r\n\t\t */\r\n\t\teditState() {\r\n\t\t\tconst selection = this.state( 'gallery' ).get( 'selection' );\r\n\t\t\tconst view = new wp.media.view.EditImage( {\r\n\t\t\t\tmodel: selection.single(),\r\n\t\t\t\tcontroller: this,\r\n\t\t\t} ).render();\r\n\r\n\t\t\t// Set the view to the EditImage frame using the selected image.\r\n\t\t\tthis.content.set( view );\r\n\r\n\t\t\t// After bringing in the frame, load the actual editor via an ajax call.\r\n\t\t\tview.loadEditor();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Create the default states.\r\n\t\t *\r\n\t\t * @return {void}\r\n\t\t */\r\n\t\tcreateStates: function createStates() {\r\n\t\t\tthis.on( 'toolbar:create:main-gallery', this.galleryToolbar, this );\r\n\t\t\tthis.on( 'content:render:edit-image', this.editState, this );\r\n\r\n\t\t\tthis.states.add( [\r\n\t\t\t\tnew wp.media.controller.Library( {\r\n\t\t\t\t\tid: 'gallery',\r\n\t\t\t\t\ttitle: wp.media.view.l10n.createGalleryTitle,\r\n\t\t\t\t\tpriority: 40,\r\n\t\t\t\t\ttoolbar: 'main-gallery',\r\n\t\t\t\t\tfilterable: 'uploaded',\r\n\t\t\t\t\tmultiple: 'add',\r\n\t\t\t\t\teditable: false,\r\n\r\n\t\t\t\t\tlibrary: wp.media.query( {\r\n\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t...this.options.library,\r\n\t\t\t\t\t} ),\r\n\t\t\t\t} ),\r\n\t\t\t\tnew wp.media.controller.EditImage( {\r\n\t\t\t\t\tmodel: this.options.editImage,\r\n\t\t\t\t} ),\r\n\r\n\t\t\t\tnew wp.media.controller.GalleryEdit( {\r\n\t\t\t\t\tlibrary: this.options.selection,\r\n\t\t\t\t\tediting: this.options.editing,\r\n\t\t\t\t\tmenu: 'gallery',\r\n\t\t\t\t\tdisplaySettings: false,\r\n\t\t\t\t\tmultiple: true,\r\n\t\t\t\t} ),\r\n\r\n\t\t\t\tnew wp.media.controller.GalleryAdd(),\r\n\t\t\t] );\r\n\t\t},\r\n\t} );\r\n};\r\n\r\n// The media library image object contains numerous attributes\r\n// we only need this set to display the image in the library.\r\nconst slimImageObject = ( img ) => {\r\n\tconst attrSet = [\r\n\t\t'sizes',\r\n\t\t'mime',\r\n\t\t'type',\r\n\t\t'subtype',\r\n\t\t'id',\r\n\t\t'url',\r\n\t\t'alt',\r\n\t\t'link',\r\n\t\t'caption',\r\n\t];\r\n\treturn attrSet.reduce( ( result, key ) => {\r\n\t\tif ( img?.hasOwnProperty( key ) ) {\r\n\t\t\tresult[ key ] = img[ key ];\r\n\t\t}\r\n\t\treturn result;\r\n\t}, {} );\r\n};\r\n\r\nconst getAttachmentsCollection = ( ids ) => {\r\n\tconst { wp } = window;\r\n\r\n\treturn wp.media.query( {\r\n\t\torder: 'ASC',\r\n\t\torderby: 'post__in',\r\n\t\tpost__in: ids,\r\n\t\tposts_per_page: -1,\r\n\t\tquery: true,\r\n\t\ttype: 'image',\r\n\t} );\r\n};\r\n\r\nclass MediaUpload extends Component {\r\n\tconstructor() {\r\n\t\tsuper( ...arguments );\r\n\t\tthis.openModal = this.openModal.bind( this );\r\n\t\tthis.onOpen = this.onOpen.bind( this );\r\n\t\tthis.onSelect = this.onSelect.bind( this );\r\n\t\tthis.onUpdate = this.onUpdate.bind( this );\r\n\t\tthis.onClose = this.onClose.bind( this );\r\n\t}\r\n\r\n\tinitializeListeners() {\r\n\t\t// When an image is selected in the media frame...\r\n\t\tthis.frame.on( 'select', this.onSelect );\r\n\t\tthis.frame.on( 'update', this.onUpdate );\r\n\t\tthis.frame.on( 'open', this.onOpen );\r\n\t\tthis.frame.on( 'close', this.onClose );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the Gallery frame and initializes listeners.\r\n\t *\r\n\t * @return {void}\r\n\t */\r\n\tbuildAndSetGalleryFrame() {\r\n\t\tconst {\r\n\t\t\taddToGallery = false,\r\n\t\t\tallowedTypes,\r\n\t\t\tmultiple = false,\r\n\t\t\tvalue = DEFAULT_EMPTY_GALLERY,\r\n\t\t} = this.props;\r\n\r\n\t\t// If the value did not changed there is no need to rebuild the frame,\r\n\t\t// we can continue to use the existing one.\r\n\t\tif ( value === this.lastGalleryValue ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { wp } = window;\r\n\r\n\t\tthis.lastGalleryValue = value;\r\n\r\n\t\t// If a frame already existed remove it.\r\n\t\tif ( this.frame ) {\r\n\t\t\tthis.frame.remove();\r\n\t\t}\r\n\t\tlet currentState;\r\n\t\tif ( addToGallery ) {\r\n\t\t\tcurrentState = 'gallery-library';\r\n\t\t} else {\r\n\t\t\tcurrentState = value && value.length ? 'gallery-edit' : 'gallery';\r\n\t\t}\r\n\t\tif ( ! this.GalleryDetailsMediaFrame ) {\r\n\t\t\tthis.GalleryDetailsMediaFrame = getGalleryDetailsMediaFrame();\r\n\t\t}\r\n\t\tconst attachments = getAttachmentsCollection( value );\r\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\r\n\t\t\tprops: attachments.props.toJSON(),\r\n\t\t\tmultiple,\r\n\t\t} );\r\n\t\tthis.frame = new this.GalleryDetailsMediaFrame( {\r\n\t\t\tmimeType: allowedTypes,\r\n\t\t\tstate: currentState,\r\n\t\t\tmultiple,\r\n\t\t\tselection,\r\n\t\t\tediting: value && value.length ? true : false,\r\n\t\t} );\r\n\t\twp.media.frame = this.frame;\r\n\t\tthis.initializeListeners();\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the Media Library requirements for the featured image flow.\r\n\t *\r\n\t * @return {void}\r\n\t */\r\n\tbuildAndSetFeatureImageFrame() {\r\n\t\tconst { wp } = window;\r\n\t\tconst { value: featuredImageId, multiple, allowedTypes } = this.props;\r\n\t\tconst featuredImageFrame = getFeaturedImageMediaFrame();\r\n\t\tconst attachments = getAttachmentsCollection( featuredImageId );\r\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\r\n\t\t\tprops: attachments.props.toJSON(),\r\n\t\t} );\r\n\t\tthis.frame = new featuredImageFrame( {\r\n\t\t\tmimeType: allowedTypes,\r\n\t\t\tstate: 'featured-image',\r\n\t\t\tmultiple,\r\n\t\t\tselection,\r\n\t\t\tediting: featuredImageId,\r\n\t\t} );\r\n\t\twp.media.frame = this.frame;\r\n\t\t// In order to select the current featured image when opening\r\n\t\t// the media library we have to set the appropriate settings.\r\n\t\t// Currently they are set in php for the post editor, but\r\n\t\t// not for site editor.\r\n\t\twp.media.view.settings.post = {\r\n\t\t\t...wp.media.view.settings.post,\r\n\t\t\tfeaturedImageId: featuredImageId || -1,\r\n\t\t};\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.frame?.remove();\r\n\t}\r\n\r\n\tonUpdate( selections ) {\r\n\t\tconst { onSelect, multiple = false } = this.props;\r\n\t\tconst state = this.frame.state();\r\n\t\tconst selectedImages = selections || state.get( 'selection' );\r\n\r\n\t\tif ( ! selectedImages || ! selectedImages.models.length ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( multiple ) {\r\n\t\t\tonSelect(\r\n\t\t\t\tselectedImages.models.map( ( model ) =>\r\n\t\t\t\t\tslimImageObject( model.toJSON() )\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tonSelect( slimImageObject( selectedImages.models[ 0 ].toJSON() ) );\r\n\t\t}\r\n\t}\r\n\r\n\tonSelect() {\r\n\t\tconst { onSelect, multiple = false } = this.props;\r\n\t\t// Get media attachment details from the frame state.\r\n\t\tconst attachment = this.frame.state().get( 'selection' ).toJSON();\r\n\t\tonSelect( multiple ? attachment : attachment[ 0 ] );\r\n\t}\r\n\r\n\tonOpen() {\r\n\t\tconst { wp } = window;\r\n\t\tconst { value } = this.props;\r\n\t\tthis.updateCollection();\r\n\r\n\t\t//Handle active tab in media model on model open.\r\n\t\tif ( this.props.mode ) {\r\n\t\t\tthis.frame.content.mode( this.props.mode );\r\n\t\t}\r\n\r\n\t\t// Handle both this.props.value being either (number[]) multiple ids\r\n\t\t// (for galleries) or a (number) singular id (e.g. image block).\r\n\t\tconst hasMedia = Array.isArray( value ) ? !! value?.length : !! value;\r\n\r\n\t\tif ( ! hasMedia ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst isGallery = this.props.gallery;\r\n\t\tconst selection = this.frame.state().get( 'selection' );\r\n\t\tconst valueArray = Array.isArray( value ) ? value : [ value ];\r\n\r\n\t\tif ( ! isGallery ) {\r\n\t\t\tvalueArray.forEach( ( id ) => {\r\n\t\t\t\tselection.add( wp.media.attachment( id ) );\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\t// Load the images so they are available in the media modal.\r\n\t\tconst attachments = getAttachmentsCollection( valueArray );\r\n\r\n\t\t// Once attachments are loaded, set the current selection.\r\n\t\tattachments.more().done( function () {\r\n\t\t\tif ( isGallery && attachments?.models?.length ) {\r\n\t\t\t\tselection.add( attachments.models );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\tonClose() {\r\n\t\tconst { onClose } = this.props;\r\n\r\n\t\tif ( onClose ) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\r\n\t\tthis.frame.detach();\r\n\t}\r\n\r\n\tupdateCollection() {\r\n\t\tconst frameContent = this.frame.content.get();\r\n\t\tif ( frameContent && frameContent.collection ) {\r\n\t\t\tconst collection = frameContent.collection;\r\n\r\n\t\t\t// Clean all attachments we have in memory.\r\n\t\t\tcollection\r\n\t\t\t\t.toArray()\r\n\t\t\t\t.forEach( ( model ) => model.trigger( 'destroy', model ) );\r\n\r\n\t\t\t// Reset has more flag, if library had small amount of items all items may have been loaded before.\r\n\t\t\tcollection.mirroring._hasMore = true;\r\n\r\n\t\t\t// Request items.\r\n\t\t\tcollection.more();\r\n\t\t}\r\n\t}\r\n\r\n\topenModal() {\r\n\t\tconst {\r\n\t\t\tallowedTypes,\r\n\t\t\tgallery = false,\r\n\t\t\tunstableFeaturedImageFlow = false,\r\n\t\t\tmodalClass,\r\n\t\t\tmultiple = false,\r\n\t\t\ttitle = __( 'Select or Upload Media' ),\r\n\t\t} = this.props;\r\n\t\tconst { wp } = window;\r\n\r\n\t\tif ( gallery ) {\r\n\t\t\tthis.buildAndSetGalleryFrame();\r\n\t\t} else {\r\n\t\t\tconst frameConfig = {\r\n\t\t\t\ttitle,\r\n\t\t\t\tmultiple,\r\n\t\t\t};\r\n\t\t\tif ( !! allowedTypes ) {\r\n\t\t\t\tframeConfig.library = { type: allowedTypes };\r\n\t\t\t}\r\n\r\n\t\t\tthis.frame = wp.media( frameConfig );\r\n\t\t}\r\n\r\n\t\tif ( modalClass ) {\r\n\t\t\tthis.frame.$el.addClass( modalClass );\r\n\t\t}\r\n\r\n\t\tif ( unstableFeaturedImageFlow ) {\r\n\t\t\tthis.buildAndSetFeatureImageFrame();\r\n\t\t}\r\n\t\tthis.initializeListeners();\r\n\t\tthis.frame.open();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.props.render( { open: this.openModal } );\r\n\t}\r\n}\r\n\r\nexport default MediaUpload;\r\n"],"mappings":"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","ignoreList":[]}