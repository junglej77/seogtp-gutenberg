{"version":3,"names":["apiFetch","flattenFormData","transformAttachment","uploadToServer","file","additionalData","signal","data","FormData","append","name","type","replace","key","value","Object","entries","path","body","method"],"sources":["@wordpress/media-utils/src/utils/upload-to-server.ts"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport apiFetch from '@wordpress/api-fetch';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { flattenFormData } from './flatten-form-data';\r\nimport { transformAttachment } from './transform-attachment';\r\nimport type { CreateRestAttachment, RestAttachment } from './types';\r\n\r\nexport async function uploadToServer(\r\n\tfile: File,\r\n\tadditionalData: CreateRestAttachment = {},\r\n\tsignal?: AbortSignal\r\n) {\r\n\t// Create upload payload.\r\n\tconst data = new FormData();\r\n\tdata.append( 'file', file, file.name || file.type.replace( '/', '.' ) );\r\n\tfor ( const [ key, value ] of Object.entries( additionalData ) ) {\r\n\t\tflattenFormData(\r\n\t\t\tdata,\r\n\t\t\tkey,\r\n\t\t\tvalue as string | Record< string, string > | undefined\r\n\t\t);\r\n\t}\r\n\r\n\treturn transformAttachment(\r\n\t\tawait apiFetch< RestAttachment >( {\r\n\t\t\t// This allows the video block to directly get a video's poster image.\r\n\t\t\tpath: '/wp/v2/media?_embed=wp:featuredmedia',\r\n\t\t\tbody: data,\r\n\t\t\tmethod: 'POST',\r\n\t\t\tsignal,\r\n\t\t} )\r\n\t);\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,QAAQ,MAAM,sBAAsB;;AAE3C;AACA;AACA;AACA,SAASC,eAAe,QAAQ,qBAAqB;AACrD,SAASC,mBAAmB,QAAQ,wBAAwB;AAG5D,OAAO,eAAeC,cAAcA,CACnCC,IAAU,EACVC,cAAoC,GAAG,CAAC,CAAC,EACzCC,MAAoB,EACnB;EACD;EACA,MAAMC,IAAI,GAAG,IAAIC,QAAQ,CAAC,CAAC;EAC3BD,IAAI,CAACE,MAAM,CAAE,MAAM,EAAEL,IAAI,EAAEA,IAAI,CAACM,IAAI,IAAIN,IAAI,CAACO,IAAI,CAACC,OAAO,CAAE,GAAG,EAAE,GAAI,CAAE,CAAC;EACvE,KAAM,MAAM,CAAEC,GAAG,EAAEC,KAAK,CAAE,IAAIC,MAAM,CAACC,OAAO,CAAEX,cAAe,CAAC,EAAG;IAChEJ,eAAe,CACdM,IAAI,EACJM,GAAG,EACHC,KACD,CAAC;EACF;EAEA,OAAOZ,mBAAmB,CACzB,MAAMF,QAAQ,CAAoB;IACjC;IACAiB,IAAI,EAAE,sCAAsC;IAC5CC,IAAI,EAAEX,IAAI;IACVY,MAAM,EAAE,MAAM;IACdb;EACD,CAAE,CACH,CAAC;AACF","ignoreList":[]}