{"version":3,"names":["useId","__","sprintf","DropdownMenu","ToolbarItem","__experimentalText","Text","store","blocksStore","useSelect","copy","blockEditorStore","BlockIcon","privateApis","blockEditorPrivateApis","BlockControls","unlock","PATTERN_OVERRIDES_BINDING_SOURCE","jsx","_jsx","Fragment","_Fragment","useBlockDisplayTitle","PatternOverridesToolbarIndicator","clientIds","isSingleBlockSelected","length","icon","firstBlockName","select","getBlockAttributes","getBlockNamesByClientId","getBlockType","getActiveBlockVariation","blockTypeNames","_firstBlockTypeName","firstBlockType","_icon","match","isSelectionOfSameType","Set","size","metadata","name","firstBlockTitle","clientId","maximumLength","blockDescription","toLowerCase","descriptionId","children","toggleProps","className","label","popoverProps","placement","showColors","description","menuProps","orientation","id","PatternOverridesBlockControls","hasPatternOverrides","hasParentPattern","getSelectedBlockClientIds","getBlockParentsByBlockName","selectedClientIds","_hasPatternOverrides","every","_getBlockAttributes$m","Object","values","bindings","some","binding","source","_hasParentPattern","group"],"sources":["@wordpress/patterns/src/components/pattern-overrides-block-controls.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useId } from '@wordpress/element';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport {\r\n\tDropdownMenu,\r\n\tToolbarItem,\r\n\t__experimentalText as Text,\r\n} from '@wordpress/components';\r\nimport { store as blocksStore } from '@wordpress/blocks';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { copy } from '@wordpress/icons';\r\nimport {\r\n\tstore as blockEditorStore,\r\n\tBlockIcon,\r\n\tprivateApis as blockEditorPrivateApis,\r\n\tBlockControls,\r\n} from '@wordpress/block-editor';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { unlock } from '../lock-unlock';\r\nimport { PATTERN_OVERRIDES_BINDING_SOURCE } from '../constants';\r\n\r\nconst { useBlockDisplayTitle } = unlock( blockEditorPrivateApis );\r\n\r\nfunction PatternOverridesToolbarIndicator( { clientIds } ) {\r\n\tconst isSingleBlockSelected = clientIds.length === 1;\r\n\tconst { icon, firstBlockName } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { getBlockAttributes, getBlockNamesByClientId } =\r\n\t\t\t\tselect( blockEditorStore );\r\n\t\t\tconst { getBlockType, getActiveBlockVariation } =\r\n\t\t\t\tselect( blocksStore );\r\n\t\t\tconst blockTypeNames = getBlockNamesByClientId( clientIds );\r\n\t\t\tconst _firstBlockTypeName = blockTypeNames[ 0 ];\r\n\t\t\tconst firstBlockType = getBlockType( _firstBlockTypeName );\r\n\t\t\tlet _icon;\r\n\t\t\tif ( isSingleBlockSelected ) {\r\n\t\t\t\tconst match = getActiveBlockVariation(\r\n\t\t\t\t\t_firstBlockTypeName,\r\n\t\t\t\t\tgetBlockAttributes( clientIds[ 0 ] )\r\n\t\t\t\t);\r\n\t\t\t\t// Take into account active block variations.\r\n\t\t\t\t_icon = match?.icon || firstBlockType.icon;\r\n\t\t\t} else {\r\n\t\t\t\tconst isSelectionOfSameType =\r\n\t\t\t\t\tnew Set( blockTypeNames ).size === 1;\r\n\t\t\t\t// When selection consists of blocks of multiple types, display an\r\n\t\t\t\t// appropriate icon to communicate the non-uniformity.\r\n\t\t\t\t_icon = isSelectionOfSameType ? firstBlockType.icon : copy;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ticon: _icon,\r\n\t\t\t\tfirstBlockName: getBlockAttributes( clientIds[ 0 ] ).metadata\r\n\t\t\t\t\t.name,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[ clientIds, isSingleBlockSelected ]\r\n\t);\r\n\tconst firstBlockTitle = useBlockDisplayTitle( {\r\n\t\tclientId: clientIds[ 0 ],\r\n\t\tmaximumLength: 35,\r\n\t} );\r\n\r\n\tconst blockDescription = isSingleBlockSelected\r\n\t\t? sprintf(\r\n\t\t\t\t/* translators: %1s: The block type's name; %2s: The block's user-provided name (the same as the override name). */\r\n\t\t\t\t__( 'This %1$s is editable using the \"%2$s\" override.' ),\r\n\t\t\t\tfirstBlockTitle.toLowerCase(),\r\n\t\t\t\tfirstBlockName\r\n\t\t  )\r\n\t\t: __( 'These blocks are editable using overrides.' );\r\n\r\n\tconst descriptionId = useId();\r\n\r\n\treturn (\r\n\t\t<ToolbarItem>\r\n\t\t\t{ ( toggleProps ) => (\r\n\t\t\t\t<DropdownMenu\r\n\t\t\t\t\tclassName=\"patterns-pattern-overrides-toolbar-indicator\"\r\n\t\t\t\t\tlabel={ firstBlockTitle }\r\n\t\t\t\t\tpopoverProps={ {\r\n\t\t\t\t\t\tplacement: 'bottom-start',\r\n\t\t\t\t\t\tclassName:\r\n\t\t\t\t\t\t\t'patterns-pattern-overrides-toolbar-indicator__popover',\r\n\t\t\t\t\t} }\r\n\t\t\t\t\ticon={\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<BlockIcon\r\n\t\t\t\t\t\t\t\ticon={ icon }\r\n\t\t\t\t\t\t\t\tclassName=\"patterns-pattern-overrides-toolbar-indicator-icon\"\r\n\t\t\t\t\t\t\t\tshowColors\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoggleProps={ {\r\n\t\t\t\t\t\tdescription: blockDescription,\r\n\t\t\t\t\t\t...toggleProps,\r\n\t\t\t\t\t} }\r\n\t\t\t\t\tmenuProps={ {\r\n\t\t\t\t\t\torientation: 'both',\r\n\t\t\t\t\t\t'aria-describedby': descriptionId,\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t{ () => (\r\n\t\t\t\t\t\t<Text id={ descriptionId }>{ blockDescription }</Text>\r\n\t\t\t\t\t) }\r\n\t\t\t\t</DropdownMenu>\r\n\t\t\t) }\r\n\t\t</ToolbarItem>\r\n\t);\r\n}\r\n\r\nexport default function PatternOverridesBlockControls() {\r\n\tconst { clientIds, hasPatternOverrides, hasParentPattern } = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst {\r\n\t\t\t\tgetBlockAttributes,\r\n\t\t\t\tgetSelectedBlockClientIds,\r\n\t\t\t\tgetBlockParentsByBlockName,\r\n\t\t\t} = select( blockEditorStore );\r\n\t\t\tconst selectedClientIds = getSelectedBlockClientIds();\r\n\t\t\tconst _hasPatternOverrides = selectedClientIds.every(\r\n\t\t\t\t( clientId ) =>\r\n\t\t\t\t\tObject.values(\r\n\t\t\t\t\t\tgetBlockAttributes( clientId )?.metadata?.bindings ?? {}\r\n\t\t\t\t\t).some(\r\n\t\t\t\t\t\t( binding ) =>\r\n\t\t\t\t\t\t\tbinding?.source === PATTERN_OVERRIDES_BINDING_SOURCE\r\n\t\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tconst _hasParentPattern = selectedClientIds.every(\r\n\t\t\t\t( clientId ) =>\r\n\t\t\t\t\tgetBlockParentsByBlockName( clientId, 'core/block', true )\r\n\t\t\t\t\t\t.length > 0\r\n\t\t\t);\r\n\t\t\treturn {\r\n\t\t\t\tclientIds: selectedClientIds,\r\n\t\t\t\thasPatternOverrides: _hasPatternOverrides,\r\n\t\t\t\thasParentPattern: _hasParentPattern,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\treturn hasPatternOverrides && hasParentPattern ? (\r\n\t\t<BlockControls group=\"parent\">\r\n\t\t\t<PatternOverridesToolbarIndicator clientIds={ clientIds } />\r\n\t\t</BlockControls>\r\n\t) : null;\r\n}\r\n"],"mappings":"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","ignoreList":[]}