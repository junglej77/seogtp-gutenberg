{"version":3,"names":["useState","useId","InspectorControls","privateApis","blockEditorPrivateApis","BaseControl","Button","__","PATTERN_OVERRIDES_BINDING_SOURCE","AllowOverridesModal","DisallowOverridesModal","unlock","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","useBlockBindingsUtils","PatternOverridesControls","attributes","setAttributes","name","blockName","controlId","showAllowOverridesModal","setShowAllowOverridesModal","showDisallowOverridesModal","setShowDisallowOverridesModal","hasName","metadata","defaultBindings","bindings","__default","hasOverrides","source","isConnectedToOtherSources","updateBlockBindings","updateBindings","isChecked","customName","undefined","hasUnsupportedImageAttributes","caption","length","href","helpText","children","group","__nextHasNoMarginBottom","id","label","help","__next40pxDefaultSize","className","variant","onClick","disabled","accessibleWhenDisabled","initialName","onClose","onSave","newName"],"sources":["@wordpress/patterns/src/components/pattern-overrides-controls.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { useState, useId } from '@wordpress/element';\r\nimport {\r\n\tInspectorControls,\r\n\tprivateApis as blockEditorPrivateApis,\r\n} from '@wordpress/block-editor';\r\nimport { BaseControl, Button } from '@wordpress/components';\r\nimport { __ } from '@wordpress/i18n';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { PATTERN_OVERRIDES_BINDING_SOURCE } from '../constants';\r\nimport {\r\n\tAllowOverridesModal,\r\n\tDisallowOverridesModal,\r\n} from './allow-overrides-modal';\r\nimport { unlock } from '../lock-unlock';\r\n\r\nconst { useBlockBindingsUtils } = unlock( blockEditorPrivateApis );\r\n\r\nfunction PatternOverridesControls( {\r\n\tattributes,\r\n\tsetAttributes,\r\n\tname: blockName,\r\n} ) {\r\n\tconst controlId = useId();\r\n\tconst [ showAllowOverridesModal, setShowAllowOverridesModal ] =\r\n\t\tuseState( false );\r\n\tconst [ showDisallowOverridesModal, setShowDisallowOverridesModal ] =\r\n\t\tuseState( false );\r\n\r\n\tconst hasName = !! attributes.metadata?.name;\r\n\tconst defaultBindings = attributes.metadata?.bindings?.__default;\r\n\tconst hasOverrides =\r\n\t\thasName && defaultBindings?.source === PATTERN_OVERRIDES_BINDING_SOURCE;\r\n\tconst isConnectedToOtherSources =\r\n\t\tdefaultBindings?.source &&\r\n\t\tdefaultBindings.source !== PATTERN_OVERRIDES_BINDING_SOURCE;\r\n\tconst { updateBlockBindings } = useBlockBindingsUtils();\r\n\r\n\tfunction updateBindings( isChecked, customName ) {\r\n\t\tif ( customName ) {\r\n\t\t\tsetAttributes( {\r\n\t\t\t\tmetadata: {\r\n\t\t\t\t\t...attributes.metadata,\r\n\t\t\t\t\tname: customName,\r\n\t\t\t\t},\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tupdateBlockBindings( {\r\n\t\t\t__default: isChecked\r\n\t\t\t\t? { source: PATTERN_OVERRIDES_BINDING_SOURCE }\r\n\t\t\t\t: undefined,\r\n\t\t} );\r\n\t}\r\n\r\n\t// Avoid overwriting other (e.g. meta) bindings.\r\n\tif ( isConnectedToOtherSources ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst hasUnsupportedImageAttributes =\r\n\t\tblockName === 'core/image' &&\r\n\t\t( !! attributes.caption?.length || !! attributes.href?.length );\r\n\r\n\tconst helpText =\r\n\t\t! hasOverrides && hasUnsupportedImageAttributes\r\n\t\t\t? __(\r\n\t\t\t\t\t`Overrides currently don't support image captions or links. Remove the caption or link first before enabling overrides.`\r\n\t\t\t  )\r\n\t\t\t: __(\r\n\t\t\t\t\t'Allow changes to this block throughout instances of this pattern.'\r\n\t\t\t  );\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<InspectorControls group=\"advanced\">\r\n\t\t\t\t<BaseControl\r\n\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\tid={ controlId }\r\n\t\t\t\t\tlabel={ __( 'Overrides' ) }\r\n\t\t\t\t\thelp={ helpText }\r\n\t\t\t\t>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\tclassName=\"pattern-overrides-control__allow-overrides-button\"\r\n\t\t\t\t\t\tvariant=\"secondary\"\r\n\t\t\t\t\t\taria-haspopup=\"dialog\"\r\n\t\t\t\t\t\tonClick={ () => {\r\n\t\t\t\t\t\t\tif ( hasOverrides ) {\r\n\t\t\t\t\t\t\t\tsetShowDisallowOverridesModal( true );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsetShowAllowOverridesModal( true );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t\tdisabled={\r\n\t\t\t\t\t\t\t! hasOverrides && hasUnsupportedImageAttributes\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\taccessibleWhenDisabled\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{ hasOverrides\r\n\t\t\t\t\t\t\t? __( 'Disable overrides' )\r\n\t\t\t\t\t\t\t: __( 'Enable overrides' ) }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</BaseControl>\r\n\t\t\t</InspectorControls>\r\n\r\n\t\t\t{ showAllowOverridesModal && (\r\n\t\t\t\t<AllowOverridesModal\r\n\t\t\t\t\tinitialName={ attributes.metadata?.name }\r\n\t\t\t\t\tonClose={ () => setShowAllowOverridesModal( false ) }\r\n\t\t\t\t\tonSave={ ( newName ) => {\r\n\t\t\t\t\t\tupdateBindings( true, newName );\r\n\t\t\t\t\t} }\r\n\t\t\t\t/>\r\n\t\t\t) }\r\n\t\t\t{ showDisallowOverridesModal && (\r\n\t\t\t\t<DisallowOverridesModal\r\n\t\t\t\t\tonClose={ () => setShowDisallowOverridesModal( false ) }\r\n\t\t\t\t\tonSave={ () => updateBindings( false ) }\r\n\t\t\t\t/>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nexport default PatternOverridesControls;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,QAAQ,EAAEC,KAAK,QAAQ,oBAAoB;AACpD,SACCC,iBAAiB,EACjBC,WAAW,IAAIC,sBAAsB,QAC/B,yBAAyB;AAChC,SAASC,WAAW,EAAEC,MAAM,QAAQ,uBAAuB;AAC3D,SAASC,EAAE,QAAQ,iBAAiB;;AAEpC;AACA;AACA;AACA,SAASC,gCAAgC,QAAQ,cAAc;AAC/D,SACCC,mBAAmB,EACnBC,sBAAsB,QAChB,yBAAyB;AAChC,SAASC,MAAM,QAAQ,gBAAgB;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAExC,MAAM;EAAEC;AAAsB,CAAC,GAAGP,MAAM,CAAEP,sBAAuB,CAAC;AAElE,SAASe,wBAAwBA,CAAE;EAClCC,UAAU;EACVC,aAAa;EACbC,IAAI,EAAEC;AACP,CAAC,EAAG;EACH,MAAMC,SAAS,GAAGvB,KAAK,CAAC,CAAC;EACzB,MAAM,CAAEwB,uBAAuB,EAAEC,0BAA0B,CAAE,GAC5D1B,QAAQ,CAAE,KAAM,CAAC;EAClB,MAAM,CAAE2B,0BAA0B,EAAEC,6BAA6B,CAAE,GAClE5B,QAAQ,CAAE,KAAM,CAAC;EAElB,MAAM6B,OAAO,GAAG,CAAC,CAAET,UAAU,CAACU,QAAQ,EAAER,IAAI;EAC5C,MAAMS,eAAe,GAAGX,UAAU,CAACU,QAAQ,EAAEE,QAAQ,EAAEC,SAAS;EAChE,MAAMC,YAAY,GACjBL,OAAO,IAAIE,eAAe,EAAEI,MAAM,KAAK3B,gCAAgC;EACxE,MAAM4B,yBAAyB,GAC9BL,eAAe,EAAEI,MAAM,IACvBJ,eAAe,CAACI,MAAM,KAAK3B,gCAAgC;EAC5D,MAAM;IAAE6B;EAAoB,CAAC,GAAGnB,qBAAqB,CAAC,CAAC;EAEvD,SAASoB,cAAcA,CAAEC,SAAS,EAAEC,UAAU,EAAG;IAChD,IAAKA,UAAU,EAAG;MACjBnB,aAAa,CAAE;QACdS,QAAQ,EAAE;UACT,GAAGV,UAAU,CAACU,QAAQ;UACtBR,IAAI,EAAEkB;QACP;MACD,CAAE,CAAC;IACJ;IAEAH,mBAAmB,CAAE;MACpBJ,SAAS,EAAEM,SAAS,GACjB;QAAEJ,MAAM,EAAE3B;MAAiC,CAAC,GAC5CiC;IACJ,CAAE,CAAC;EACJ;;EAEA;EACA,IAAKL,yBAAyB,EAAG;IAChC,OAAO,IAAI;EACZ;EAEA,MAAMM,6BAA6B,GAClCnB,SAAS,KAAK,YAAY,KACxB,CAAC,CAAEH,UAAU,CAACuB,OAAO,EAAEC,MAAM,IAAI,CAAC,CAAExB,UAAU,CAACyB,IAAI,EAAED,MAAM,CAAE;EAEhE,MAAME,QAAQ,GACb,CAAEZ,YAAY,IAAIQ,6BAA6B,GAC5CnC,EAAE,CACD,wHACD,CAAC,GACDA,EAAE,CACF,mEACA,CAAC;EAEL,oBACCU,KAAA,CAAAF,SAAA;IAAAgC,QAAA,gBACClC,IAAA,CAACX,iBAAiB;MAAC8C,KAAK,EAAC,UAAU;MAAAD,QAAA,eAClClC,IAAA,CAACR,WAAW;QACX4C,uBAAuB;QACvBC,EAAE,EAAG1B,SAAW;QAChB2B,KAAK,EAAG5C,EAAE,CAAE,WAAY,CAAG;QAC3B6C,IAAI,EAAGN,QAAU;QAAAC,QAAA,eAEjBlC,IAAA,CAACP,MAAM;UACN+C,qBAAqB;UACrBC,SAAS,EAAC,mDAAmD;UAC7DC,OAAO,EAAC,WAAW;UACnB,iBAAc,QAAQ;UACtBC,OAAO,EAAGA,CAAA,KAAM;YACf,IAAKtB,YAAY,EAAG;cACnBN,6BAA6B,CAAE,IAAK,CAAC;YACtC,CAAC,MAAM;cACNF,0BAA0B,CAAE,IAAK,CAAC;YACnC;UACD,CAAG;UACH+B,QAAQ,EACP,CAAEvB,YAAY,IAAIQ,6BAClB;UACDgB,sBAAsB;UAAAX,QAAA,EAEpBb,YAAY,GACX3B,EAAE,CAAE,mBAAoB,CAAC,GACzBA,EAAE,CAAE,kBAAmB;QAAC,CACpB;MAAC,CACG;IAAC,CACI,CAAC,EAElBkB,uBAAuB,iBACxBZ,IAAA,CAACJ,mBAAmB;MACnBkD,WAAW,EAAGvC,UAAU,CAACU,QAAQ,EAAER,IAAM;MACzCsC,OAAO,EAAGA,CAAA,KAAMlC,0BAA0B,CAAE,KAAM,CAAG;MACrDmC,MAAM,EAAKC,OAAO,IAAM;QACvBxB,cAAc,CAAE,IAAI,EAAEwB,OAAQ,CAAC;MAChC;IAAG,CACH,CACD,EACCnC,0BAA0B,iBAC3Bd,IAAA,CAACH,sBAAsB;MACtBkD,OAAO,EAAGA,CAAA,KAAMhC,6BAA6B,CAAE,KAAM,CAAG;MACxDiC,MAAM,EAAGA,CAAA,KAAMvB,cAAc,CAAE,KAAM;IAAG,CACxC,CACD;EAAA,CACA,CAAC;AAEL;AAEA,eAAenB,wBAAwB","ignoreList":[]}