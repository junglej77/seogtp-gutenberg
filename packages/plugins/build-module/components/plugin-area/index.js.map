{"version":3,"names":["memoize","useMemo","useSyncExternalStore","addAction","removeAction","isShallowEqual","PluginContextProvider","PluginErrorBoundary","getPlugins","jsx","_jsx","getPluginContext","icon","name","PluginArea","scope","onError","store","lastValue","subscribe","listener","getValue","nextValue","plugins","style","display","children","map","render","Plugin","value"],"sources":["@wordpress/plugins/src/components/plugin-area/index.tsx"],"sourcesContent":["// 外部依赖\r\nimport memoize from 'memize';\r\n\r\n// WordPress 依赖\r\nimport { useMemo, useSyncExternalStore } from '@wordpress/element';\r\nimport { addAction, removeAction } from '@wordpress/hooks';\r\nimport isShallowEqual from '@wordpress/is-shallow-equal';\r\n\r\n// 内部依赖\r\nimport { PluginContextProvider } from '../plugin-context';\r\nimport { PluginErrorBoundary } from '../plugin-error-boundary';\r\nimport { getPlugins } from '../../api';\r\nimport type { PluginContext } from '../plugin-context';\r\nimport type { WPPlugin } from '../../api';\r\n\r\n// 缓存插件上下文\r\nconst getPluginContext = memoize(\r\n\t( icon: PluginContext[ 'icon' ], name: PluginContext[ 'name' ] ) => ( {\r\n\t\ticon,\r\n\t\tname,\r\n\t} )\r\n);\r\n\r\n/**\r\n * 渲染所有插件填充的组件，并将其放置在一个隐藏的 div 中。\r\n *\r\n * @param props\r\n * @param props.scope 插件的作用域\r\n * @param props.onError 插件出错时的回调函数\r\n * @return 返回要渲染的组件\r\n */\r\nfunction PluginArea( {\r\n\tscope,\r\n\tonError,\r\n}: {\r\n\tscope?: string;\r\n\tonError?: ( name: WPPlugin[ 'name' ], error: Error ) => void;\r\n} ) {\r\n\t// 使用 useMemo 创建一个插件存储对象\r\n\tconst store = useMemo( () => {\r\n\t\tlet lastValue: WPPlugin[] = [];\r\n\r\n\t\treturn {\r\n\t\t\t// 订阅插件注册和注销事件\r\n\t\t\tsubscribe(\r\n\t\t\t\tlistener: (\r\n\t\t\t\t\tplugin: Omit< WPPlugin, 'name' >,\r\n\t\t\t\t\tname: WPPlugin[ 'name' ]\r\n\t\t\t\t) => void\r\n\t\t\t) {\r\n\t\t\t\taddAction(\r\n\t\t\t\t\t'plugins.pluginRegistered',\r\n\t\t\t\t\t'core/plugins/plugin-area/plugins-registered',\r\n\t\t\t\t\tlistener\r\n\t\t\t\t);\r\n\t\t\t\taddAction(\r\n\t\t\t\t\t'plugins.pluginUnregistered',\r\n\t\t\t\t\t'core/plugins/plugin-area/plugins-unregistered',\r\n\t\t\t\t\tlistener\r\n\t\t\t\t);\r\n\t\t\t\treturn () => {\r\n\t\t\t\t\tremoveAction(\r\n\t\t\t\t\t\t'plugins.pluginRegistered',\r\n\t\t\t\t\t\t'core/plugins/plugin-area/plugins-registered'\r\n\t\t\t\t\t);\r\n\t\t\t\t\tremoveAction(\r\n\t\t\t\t\t\t'plugins.pluginUnregistered',\r\n\t\t\t\t\t\t'core/plugins/plugin-area/plugins-unregistered'\r\n\t\t\t\t\t);\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\t// 获取当前插件列表\r\n\t\t\tgetValue() {\r\n\t\t\t\tconst nextValue = getPlugins( scope );\r\n\r\n\t\t\t\tif ( ! isShallowEqual( lastValue, nextValue ) ) {\r\n\t\t\t\t\tlastValue = nextValue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn lastValue;\r\n\t\t\t},\r\n\t\t};\r\n\t}, [ scope ] );\r\n\r\n\t// 同步外部存储的插件列表\r\n\tconst plugins = useSyncExternalStore(\r\n\t\tstore.subscribe,\r\n\t\tstore.getValue,\r\n\t\tstore.getValue\r\n\t);\r\n\r\n\t// 渲染插件填充\r\n\treturn (\r\n\t\t<div style={ { display: 'none' } }>\r\n\t\t\t{ plugins.map( ( { icon, name, render: Plugin } ) => (\r\n\t\t\t\t<PluginContextProvider\r\n\t\t\t\t\tkey={ name }\r\n\t\t\t\t\tvalue={ getPluginContext( icon, name ) }\r\n\t\t\t\t>\r\n\t\t\t\t\t<PluginErrorBoundary name={ name } onError={ onError }>\r\n\t\t\t\t\t\t<Plugin />\r\n\t\t\t\t\t</PluginErrorBoundary>\r\n\t\t\t\t</PluginContextProvider>\r\n\t\t\t) ) }\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default PluginArea;\r\n"],"mappings":"AAAA;AACA,OAAOA,OAAO,MAAM,QAAQ;;AAE5B;AACA,SAASC,OAAO,EAAEC,oBAAoB,QAAQ,oBAAoB;AAClE,SAASC,SAAS,EAAEC,YAAY,QAAQ,kBAAkB;AAC1D,OAAOC,cAAc,MAAM,6BAA6B;;AAExD;AACA,SAASC,qBAAqB,QAAQ,mBAAmB;AACzD,SAASC,mBAAmB,QAAQ,0BAA0B;AAC9D,SAASC,UAAU,QAAQ,WAAW;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAIvC;AACA,MAAMC,gBAAgB,GAAGX,OAAO,CAC/B,CAAEY,IAA6B,EAAEC,IAA6B,MAAQ;EACrED,IAAI;EACJC;AACD,CAAC,CACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,UAAUA,CAAE;EACpBC,KAAK;EACLC;AAID,CAAC,EAAG;EACH;EACA,MAAMC,KAAK,GAAGhB,OAAO,CAAE,MAAM;IAC5B,IAAIiB,SAAqB,GAAG,EAAE;IAE9B,OAAO;MACN;MACAC,SAASA,CACRC,QAGS,EACR;QACDjB,SAAS,CACR,0BAA0B,EAC1B,6CAA6C,EAC7CiB,QACD,CAAC;QACDjB,SAAS,CACR,4BAA4B,EAC5B,+CAA+C,EAC/CiB,QACD,CAAC;QACD,OAAO,MAAM;UACZhB,YAAY,CACX,0BAA0B,EAC1B,6CACD,CAAC;UACDA,YAAY,CACX,4BAA4B,EAC5B,+CACD,CAAC;QACF,CAAC;MACF,CAAC;MACD;MACAiB,QAAQA,CAAA,EAAG;QACV,MAAMC,SAAS,GAAGd,UAAU,CAAEO,KAAM,CAAC;QAErC,IAAK,CAAEV,cAAc,CAAEa,SAAS,EAAEI,SAAU,CAAC,EAAG;UAC/CJ,SAAS,GAAGI,SAAS;QACtB;QAEA,OAAOJ,SAAS;MACjB;IACD,CAAC;EACF,CAAC,EAAE,CAAEH,KAAK,CAAG,CAAC;;EAEd;EACA,MAAMQ,OAAO,GAAGrB,oBAAoB,CACnCe,KAAK,CAACE,SAAS,EACfF,KAAK,CAACI,QAAQ,EACdJ,KAAK,CAACI,QACP,CAAC;;EAED;EACA,oBACCX,IAAA;IAAKc,KAAK,EAAG;MAAEC,OAAO,EAAE;IAAO,CAAG;IAAAC,QAAA,EAC/BH,OAAO,CAACI,GAAG,CAAE,CAAE;MAAEf,IAAI;MAAEC,IAAI;MAAEe,MAAM,EAAEC;IAAO,CAAC,kBAC9CnB,IAAA,CAACJ,qBAAqB;MAErBwB,KAAK,EAAGnB,gBAAgB,CAAEC,IAAI,EAAEC,IAAK,CAAG;MAAAa,QAAA,eAExChB,IAAA,CAACH,mBAAmB;QAACM,IAAI,EAAGA,IAAM;QAACG,OAAO,EAAGA,OAAS;QAAAU,QAAA,eACrDhB,IAAA,CAACmB,MAAM,IAAE;MAAC,CACU;IAAC,GALhBhB,IAMgB,CACtB;EAAC,CACC,CAAC;AAER;AAEA,eAAeC,UAAU","ignoreList":[]}