{"version":3,"names":["create","convertLegacyLocalStorageData","convertPreferencesPackageData","__unstableCreatePersistenceLayer","serverData","userId","localStorageRestoreKey","localData","JSON","parse","window","localStorage","getItem","serverModified","Date","_modified","localModified","preloadedData"],"sources":["@wordpress/preferences-persistence/src/index.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\nimport create from './create';\r\nimport convertLegacyLocalStorageData from './migrations/legacy-local-storage-data';\r\nimport convertPreferencesPackageData from './migrations/preferences-package-data';\r\n\r\nexport { create };\r\n\r\n/**\r\n * Creates the persistence layer with preloaded data.\r\n *\r\n * It prioritizes any data from the server, but falls back first to localStorage\r\n * restore data, and then to any legacy data.\r\n *\r\n * This function is used internally by WordPress in an inline script, so\r\n * prefixed with `__unstable`.\r\n *\r\n * @param {Object} serverData Preferences data preloaded from the server.\r\n * @param {string} userId     The user id.\r\n *\r\n * @return {Object} The persistence layer initialized with the preloaded data.\r\n */\r\nexport function __unstableCreatePersistenceLayer( serverData, userId ) {\r\n\tconst localStorageRestoreKey = `WP_PREFERENCES_USER_${ userId }`;\r\n\tconst localData = JSON.parse(\r\n\t\twindow.localStorage.getItem( localStorageRestoreKey )\r\n\t);\r\n\r\n\t// Date parse returns NaN for invalid input. Coerce anything invalid\r\n\t// into a conveniently comparable zero.\r\n\tconst serverModified =\r\n\t\tDate.parse( serverData && serverData._modified ) || 0;\r\n\tconst localModified = Date.parse( localData && localData._modified ) || 0;\r\n\r\n\tlet preloadedData;\r\n\tif ( serverData && serverModified >= localModified ) {\r\n\t\tpreloadedData = convertPreferencesPackageData( serverData );\r\n\t} else if ( localData ) {\r\n\t\tpreloadedData = convertPreferencesPackageData( localData );\r\n\t} else {\r\n\t\t// Check if there is data in the legacy format from the old persistence system.\r\n\t\tpreloadedData = convertLegacyLocalStorageData( userId );\r\n\t}\r\n\r\n\treturn create( {\r\n\t\tpreloadedData,\r\n\t\tlocalStorageRestoreKey,\r\n\t} );\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,MAAM,MAAM,UAAU;AAC7B,OAAOC,6BAA6B,MAAM,wCAAwC;AAClF,OAAOC,6BAA6B,MAAM,uCAAuC;AAEjF,SAASF,MAAM;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASG,gCAAgCA,CAAEC,UAAU,EAAEC,MAAM,EAAG;EACtE,MAAMC,sBAAsB,GAAI,uBAAuBD,MAAQ,EAAC;EAChE,MAAME,SAAS,GAAGC,IAAI,CAACC,KAAK,CAC3BC,MAAM,CAACC,YAAY,CAACC,OAAO,CAAEN,sBAAuB,CACrD,CAAC;;EAED;EACA;EACA,MAAMO,cAAc,GACnBC,IAAI,CAACL,KAAK,CAAEL,UAAU,IAAIA,UAAU,CAACW,SAAU,CAAC,IAAI,CAAC;EACtD,MAAMC,aAAa,GAAGF,IAAI,CAACL,KAAK,CAAEF,SAAS,IAAIA,SAAS,CAACQ,SAAU,CAAC,IAAI,CAAC;EAEzE,IAAIE,aAAa;EACjB,IAAKb,UAAU,IAAIS,cAAc,IAAIG,aAAa,EAAG;IACpDC,aAAa,GAAGf,6BAA6B,CAAEE,UAAW,CAAC;EAC5D,CAAC,MAAM,IAAKG,SAAS,EAAG;IACvBU,aAAa,GAAGf,6BAA6B,CAAEK,SAAU,CAAC;EAC3D,CAAC,MAAM;IACN;IACAU,aAAa,GAAGhB,6BAA6B,CAAEI,MAAO,CAAC;EACxD;EAEA,OAAOL,MAAM,CAAE;IACdiB,aAAa;IACbX;EACD,CAAE,CAAC;AACJ","ignoreList":[]}