{"version":3,"names":["moveInterfaceEnableItems","state","_state$preferencesSto","_sourceEnableItems$si","_sourceEnableItems$mu","interfaceStoreName","preferencesStoreName","sourceEnableItems","enableItems","allPreferences","preferences","sourceComplementaryAreas","singleEnableItems","complementaryArea","preferencesWithConvertedComplementaryAreas","Object","keys","reduce","accumulator","scope","data","sourcePinnedItems","multipleEnableItems","pinnedItems","allConvertedData","otherInterfaceItems","undefined"],"sources":["@wordpress/preferences-persistence/src/migrations/legacy-local-storage-data/move-interface-enable-items.js"],"sourcesContent":["/**\r\n * Migrates interface 'enableItems' data to the preferences store.\r\n *\r\n * The interface package stores this data in this format:\r\n * ```js\r\n * {\r\n *     enableItems: {\r\n *         singleEnableItems: {\r\n * \t           complementaryArea: {\r\n *                 'core/edit-post': 'edit-post/document',\r\n *                 'core/edit-site': 'edit-site/global-styles',\r\n *             }\r\n *         },\r\n *         multipleEnableItems: {\r\n *             pinnedItems: {\r\n *                 'core/edit-post': {\r\n *                     'plugin-1': true,\r\n *                 },\r\n *                 'core/edit-site': {\r\n *                     'plugin-2': true,\r\n *                 },\r\n *             },\r\n *         }\r\n *     }\r\n * }\r\n * ```\r\n *\r\n * and it should be converted it to:\r\n * ```js\r\n * {\r\n *     'core/edit-post': {\r\n *         complementaryArea: 'edit-post/document',\r\n *         pinnedItems: {\r\n *             'plugin-1': true,\r\n *         },\r\n *     },\r\n *     'core/edit-site': {\r\n *         complementaryArea: 'edit-site/global-styles',\r\n *         pinnedItems: {\r\n *             'plugin-2': true,\r\n *         },\r\n *     },\r\n * }\r\n * ```\r\n *\r\n * @param {Object} state The local storage state.\r\n */\r\nexport default function moveInterfaceEnableItems( state ) {\r\n\tconst interfaceStoreName = 'core/interface';\r\n\tconst preferencesStoreName = 'core/preferences';\r\n\tconst sourceEnableItems = state?.[ interfaceStoreName ]?.enableItems;\r\n\r\n\t// There's nothing to migrate, exit early.\r\n\tif ( ! sourceEnableItems ) {\r\n\t\treturn state;\r\n\t}\r\n\r\n\tconst allPreferences = state?.[ preferencesStoreName ]?.preferences ?? {};\r\n\r\n\t// First convert complementaryAreas into the right format.\r\n\t// Use the existing preferences as the accumulator so that the data is\r\n\t// merged.\r\n\tconst sourceComplementaryAreas =\r\n\t\tsourceEnableItems?.singleEnableItems?.complementaryArea ?? {};\r\n\r\n\tconst preferencesWithConvertedComplementaryAreas = Object.keys(\r\n\t\tsourceComplementaryAreas\r\n\t).reduce( ( accumulator, scope ) => {\r\n\t\tconst data = sourceComplementaryAreas[ scope ];\r\n\r\n\t\t// Don't overwrite any existing data in the preferences store.\r\n\t\tif ( accumulator?.[ scope ]?.complementaryArea ) {\r\n\t\t\treturn accumulator;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t...accumulator,\r\n\t\t\t[ scope ]: {\r\n\t\t\t\t...accumulator[ scope ],\r\n\t\t\t\tcomplementaryArea: data,\r\n\t\t\t},\r\n\t\t};\r\n\t}, allPreferences );\r\n\r\n\t// Next feed the converted complementary areas back into a reducer that\r\n\t// converts the pinned items, resulting in the fully migrated data.\r\n\tconst sourcePinnedItems =\r\n\t\tsourceEnableItems?.multipleEnableItems?.pinnedItems ?? {};\r\n\tconst allConvertedData = Object.keys( sourcePinnedItems ).reduce(\r\n\t\t( accumulator, scope ) => {\r\n\t\t\tconst data = sourcePinnedItems[ scope ];\r\n\t\t\t// Don't overwrite any existing data in the preferences store.\r\n\t\t\tif ( accumulator?.[ scope ]?.pinnedItems ) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...accumulator,\r\n\t\t\t\t[ scope ]: {\r\n\t\t\t\t\t...accumulator[ scope ],\r\n\t\t\t\t\tpinnedItems: data,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t},\r\n\t\tpreferencesWithConvertedComplementaryAreas\r\n\t);\r\n\r\n\tconst otherInterfaceItems = state[ interfaceStoreName ];\r\n\r\n\treturn {\r\n\t\t...state,\r\n\t\t[ preferencesStoreName ]: {\r\n\t\t\tpreferences: allConvertedData,\r\n\t\t},\r\n\t\t[ interfaceStoreName ]: {\r\n\t\t\t...otherInterfaceItems,\r\n\t\t\tenableItems: undefined,\r\n\t\t},\r\n\t};\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASA,wBAAwBA,CAAEC,KAAK,EAAG;EAAA,IAAAC,qBAAA,EAAAC,qBAAA,EAAAC,qBAAA;EACzD,MAAMC,kBAAkB,GAAG,gBAAgB;EAC3C,MAAMC,oBAAoB,GAAG,kBAAkB;EAC/C,MAAMC,iBAAiB,GAAGN,KAAK,GAAII,kBAAkB,CAAE,EAAEG,WAAW;;EAEpE;EACA,IAAK,CAAED,iBAAiB,EAAG;IAC1B,OAAON,KAAK;EACb;EAEA,MAAMQ,cAAc,IAAAP,qBAAA,GAAGD,KAAK,GAAIK,oBAAoB,CAAE,EAAEI,WAAW,cAAAR,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;;EAEzE;EACA;EACA;EACA,MAAMS,wBAAwB,IAAAR,qBAAA,GAC7BI,iBAAiB,EAAEK,iBAAiB,EAAEC,iBAAiB,cAAAV,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;EAE9D,MAAMW,0CAA0C,GAAGC,MAAM,CAACC,IAAI,CAC7DL,wBACD,CAAC,CAACM,MAAM,CAAE,CAAEC,WAAW,EAAEC,KAAK,KAAM;IACnC,MAAMC,IAAI,GAAGT,wBAAwB,CAAEQ,KAAK,CAAE;;IAE9C;IACA,IAAKD,WAAW,GAAIC,KAAK,CAAE,EAAEN,iBAAiB,EAAG;MAChD,OAAOK,WAAW;IACnB;IAEA,OAAO;MACN,GAAGA,WAAW;MACd,CAAEC,KAAK,GAAI;QACV,GAAGD,WAAW,CAAEC,KAAK,CAAE;QACvBN,iBAAiB,EAAEO;MACpB;IACD,CAAC;EACF,CAAC,EAAEX,cAAe,CAAC;;EAEnB;EACA;EACA,MAAMY,iBAAiB,IAAAjB,qBAAA,GACtBG,iBAAiB,EAAEe,mBAAmB,EAAEC,WAAW,cAAAnB,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;EAC1D,MAAMoB,gBAAgB,GAAGT,MAAM,CAACC,IAAI,CAAEK,iBAAkB,CAAC,CAACJ,MAAM,CAC/D,CAAEC,WAAW,EAAEC,KAAK,KAAM;IACzB,MAAMC,IAAI,GAAGC,iBAAiB,CAAEF,KAAK,CAAE;IACvC;IACA,IAAKD,WAAW,GAAIC,KAAK,CAAE,EAAEI,WAAW,EAAG;MAC1C,OAAOL,WAAW;IACnB;IAEA,OAAO;MACN,GAAGA,WAAW;MACd,CAAEC,KAAK,GAAI;QACV,GAAGD,WAAW,CAAEC,KAAK,CAAE;QACvBI,WAAW,EAAEH;MACd;IACD,CAAC;EACF,CAAC,EACDN,0CACD,CAAC;EAED,MAAMW,mBAAmB,GAAGxB,KAAK,CAAEI,kBAAkB,CAAE;EAEvD,OAAO;IACN,GAAGJ,KAAK;IACR,CAAEK,oBAAoB,GAAI;MACzBI,WAAW,EAAEc;IACd,CAAC;IACD,CAAEnB,kBAAkB,GAAI;MACvB,GAAGoB,mBAAmB;MACtBjB,WAAW,EAAEkB;IACd;EACD,CAAC;AACF","ignoreList":[]}