{"version":3,"names":["moveThirdPartyFeaturePreferencesToPreferences","state","interfaceStoreName","preferencesStoreName","interfaceScopes","preferences","features","interfaceScopeKeys","Object","keys","length","reduce","convertedState","scope","startsWith","featuresToMigrate","existingMigratedData","otherPreferencesScopes","otherInterfaceState","otherInterfaceScopes","undefined"],"sources":["@wordpress/preferences-persistence/src/migrations/legacy-local-storage-data/move-third-party-feature-preferences.js"],"sourcesContent":["/**\r\n * The interface package previously had a public API that could be used by\r\n * plugins to set persisted boolean 'feature' preferences.\r\n *\r\n * While usage was likely non-existent or very small, this function ensures\r\n * those are migrated to the preferences data structure. The interface\r\n * package's APIs have now been deprecated and use the preferences store.\r\n *\r\n * This will convert data that looks like this:\r\n * ```js\r\n * {\r\n *     'core/interface': {\r\n *         preferences: {\r\n *             features: {\r\n *                 'my-plugin': {\r\n *                     myPluginFeature: true\r\n *                 }\r\n *             }\r\n *         }\r\n *     }\r\n * }\r\n * ```\r\n *\r\n * To this:\r\n * ```js\r\n *  * {\r\n *     'core/preferences': {\r\n *         preferences: {\r\n *             'my-plugin': {\r\n *                 myPluginFeature: true\r\n *             }\r\n *         }\r\n *     }\r\n * }\r\n * ```\r\n *\r\n * @param {Object} state The local storage state\r\n *\r\n * @return {Object} The state with third party preferences moved to the\r\n *                  preferences data structure.\r\n */\r\nexport default function moveThirdPartyFeaturePreferencesToPreferences( state ) {\r\n\tconst interfaceStoreName = 'core/interface';\r\n\tconst preferencesStoreName = 'core/preferences';\r\n\r\n\tconst interfaceScopes =\r\n\t\tstate?.[ interfaceStoreName ]?.preferences?.features;\r\n\tconst interfaceScopeKeys = interfaceScopes\r\n\t\t? Object.keys( interfaceScopes )\r\n\t\t: [];\r\n\r\n\tif ( ! interfaceScopeKeys?.length ) {\r\n\t\treturn state;\r\n\t}\r\n\r\n\treturn interfaceScopeKeys.reduce( function ( convertedState, scope ) {\r\n\t\tif ( scope.startsWith( 'core' ) ) {\r\n\t\t\treturn convertedState;\r\n\t\t}\r\n\r\n\t\tconst featuresToMigrate = interfaceScopes?.[ scope ];\r\n\t\tif ( ! featuresToMigrate ) {\r\n\t\t\treturn convertedState;\r\n\t\t}\r\n\r\n\t\tconst existingMigratedData =\r\n\t\t\tconvertedState?.[ preferencesStoreName ]?.preferences?.[ scope ];\r\n\r\n\t\tif ( existingMigratedData ) {\r\n\t\t\treturn convertedState;\r\n\t\t}\r\n\r\n\t\tconst otherPreferencesScopes =\r\n\t\t\tconvertedState?.[ preferencesStoreName ]?.preferences;\r\n\t\tconst otherInterfaceState = convertedState?.[ interfaceStoreName ];\r\n\t\tconst otherInterfaceScopes =\r\n\t\t\tconvertedState?.[ interfaceStoreName ]?.preferences?.features;\r\n\r\n\t\treturn {\r\n\t\t\t...convertedState,\r\n\t\t\t[ preferencesStoreName ]: {\r\n\t\t\t\tpreferences: {\r\n\t\t\t\t\t...otherPreferencesScopes,\r\n\t\t\t\t\t[ scope ]: featuresToMigrate,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t[ interfaceStoreName ]: {\r\n\t\t\t\t...otherInterfaceState,\r\n\t\t\t\tpreferences: {\r\n\t\t\t\t\tfeatures: {\r\n\t\t\t\t\t\t...otherInterfaceScopes,\r\n\t\t\t\t\t\t[ scope ]: undefined,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t};\r\n\t}, state );\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASA,6CAA6CA,CAAEC,KAAK,EAAG;EAC9E,MAAMC,kBAAkB,GAAG,gBAAgB;EAC3C,MAAMC,oBAAoB,GAAG,kBAAkB;EAE/C,MAAMC,eAAe,GACpBH,KAAK,GAAIC,kBAAkB,CAAE,EAAEG,WAAW,EAAEC,QAAQ;EACrD,MAAMC,kBAAkB,GAAGH,eAAe,GACvCI,MAAM,CAACC,IAAI,CAAEL,eAAgB,CAAC,GAC9B,EAAE;EAEL,IAAK,CAAEG,kBAAkB,EAAEG,MAAM,EAAG;IACnC,OAAOT,KAAK;EACb;EAEA,OAAOM,kBAAkB,CAACI,MAAM,CAAE,UAAWC,cAAc,EAAEC,KAAK,EAAG;IACpE,IAAKA,KAAK,CAACC,UAAU,CAAE,MAAO,CAAC,EAAG;MACjC,OAAOF,cAAc;IACtB;IAEA,MAAMG,iBAAiB,GAAGX,eAAe,GAAIS,KAAK,CAAE;IACpD,IAAK,CAAEE,iBAAiB,EAAG;MAC1B,OAAOH,cAAc;IACtB;IAEA,MAAMI,oBAAoB,GACzBJ,cAAc,GAAIT,oBAAoB,CAAE,EAAEE,WAAW,GAAIQ,KAAK,CAAE;IAEjE,IAAKG,oBAAoB,EAAG;MAC3B,OAAOJ,cAAc;IACtB;IAEA,MAAMK,sBAAsB,GAC3BL,cAAc,GAAIT,oBAAoB,CAAE,EAAEE,WAAW;IACtD,MAAMa,mBAAmB,GAAGN,cAAc,GAAIV,kBAAkB,CAAE;IAClE,MAAMiB,oBAAoB,GACzBP,cAAc,GAAIV,kBAAkB,CAAE,EAAEG,WAAW,EAAEC,QAAQ;IAE9D,OAAO;MACN,GAAGM,cAAc;MACjB,CAAET,oBAAoB,GAAI;QACzBE,WAAW,EAAE;UACZ,GAAGY,sBAAsB;UACzB,CAAEJ,KAAK,GAAIE;QACZ;MACD,CAAC;MACD,CAAEb,kBAAkB,GAAI;QACvB,GAAGgB,mBAAmB;QACtBb,WAAW,EAAE;UACZC,QAAQ,EAAE;YACT,GAAGa,oBAAoB;YACvB,CAAEN,KAAK,GAAIO;UACZ;QACD;MACD;IACD,CAAC;EACF,CAAC,EAAEnB,KAAM,CAAC;AACX","ignoreList":[]}