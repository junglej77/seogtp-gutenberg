{"version":3,"names":["CORE_MODULES_USING_PRIVATE_APIS","registeredPrivateApis","requiredConsent","allowReRegistration","globalThis","IS_WORDPRESS_CORE","error","__dangerousOptInToUnstableAPIsOnlyForCoreModules","consent","moduleName","includes","Error","push","lock","unlock","object","privateData","__private","lockedData","set","get","WeakMap","Symbol","allowCoreModule","name","resetAllowedCoreModules","length","pop","resetRegisteredPrivateApis"],"sources":["@wordpress/private-apis/src/implementation.js"],"sourcesContent":["/**\r\n * wordpress/private-apis â€“ the utilities to enable private cross-package\r\n * exports of private APIs.\r\n *\r\n * This \"implementation.js\" file is needed for the sake of the unit tests. It\r\n * exports more than the public API of the package to aid in testing.\r\n */\r\n\r\n/**\r\n * The list of core modules allowed to opt-in to the private APIs.\r\n */\r\nconst CORE_MODULES_USING_PRIVATE_APIS = [\r\n\t'@wordpress/block-directory',\r\n\t'@wordpress/block-editor',\r\n\t'@wordpress/block-library',\r\n\t'@wordpress/blocks',\r\n\t'@wordpress/commands',\r\n\t'@wordpress/components',\r\n\t'@wordpress/core-commands',\r\n\t'@wordpress/core-data',\r\n\t'@wordpress/customize-widgets',\r\n\t'@wordpress/data',\r\n\t'@wordpress/edit-post',\r\n\t'@wordpress/edit-site',\r\n\t'@wordpress/edit-widgets',\r\n\t'@wordpress/editor',\r\n\t'@wordpress/format-library',\r\n\t'@wordpress/interface',\r\n\t'@wordpress/patterns',\r\n\t'@wordpress/preferences',\r\n\t'@wordpress/reusable-blocks',\r\n\t'@wordpress/router',\r\n\t'@wordpress/dataviews',\r\n];\r\n\r\n/**\r\n * A list of core modules that already opted-in to\r\n * the privateApis package.\r\n *\r\n * @type {string[]}\r\n */\r\nconst registeredPrivateApis = [];\r\n\r\n/*\r\n * Warning for theme and plugin developers.\r\n *\r\n * The use of private developer APIs is intended for use by WordPress Core\r\n * and the Gutenberg plugin exclusively.\r\n *\r\n * Dangerously opting in to using these APIs is NOT RECOMMENDED. Furthermore,\r\n * the WordPress Core philosophy to strive to maintain backward compatibility\r\n * for third-party developers DOES NOT APPLY to private APIs.\r\n *\r\n * THE CONSENT STRING FOR OPTING IN TO THESE APIS MAY CHANGE AT ANY TIME AND\r\n * WITHOUT NOTICE. THIS CHANGE WILL BREAK EXISTING THIRD-PARTY CODE. SUCH A\r\n * CHANGE MAY OCCUR IN EITHER A MAJOR OR MINOR RELEASE.\r\n */\r\nconst requiredConsent =\r\n\t'I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.';\r\n\r\n/** @type {boolean} */\r\nlet allowReRegistration;\r\n// The safety measure is meant for WordPress core where IS_WORDPRESS_CORE\r\n// is set to true.\r\n// For the general use-case, the re-registration should be allowed by default\r\n// Let's default to true, then. Try/catch will fall back to \"true\" even if the\r\n// environment variable is not explicitly defined.\r\ntry {\r\n\tallowReRegistration = globalThis.IS_WORDPRESS_CORE ? false : true;\r\n} catch ( error ) {\r\n\tallowReRegistration = true;\r\n}\r\n\r\n/**\r\n * Called by a @wordpress package wishing to opt-in to accessing or exposing\r\n * private private APIs.\r\n *\r\n * @param {string} consent    The consent string.\r\n * @param {string} moduleName The name of the module that is opting in.\r\n * @return {{lock: typeof lock, unlock: typeof unlock}} An object containing the lock and unlock functions.\r\n */\r\nexport const __dangerousOptInToUnstableAPIsOnlyForCoreModules = (\r\n\tconsent,\r\n\tmoduleName\r\n) => {\r\n\tif ( ! CORE_MODULES_USING_PRIVATE_APIS.includes( moduleName ) ) {\r\n\t\tthrow new Error(\r\n\t\t\t`You tried to opt-in to unstable APIs as module \"${ moduleName }\". ` +\r\n\t\t\t\t'This feature is only for JavaScript modules shipped with WordPress core. ' +\r\n\t\t\t\t'Please do not use it in plugins and themes as the unstable APIs will be removed ' +\r\n\t\t\t\t'without a warning. If you ignore this error and depend on unstable features, ' +\r\n\t\t\t\t'your product will inevitably break on one of the next WordPress releases.'\r\n\t\t);\r\n\t}\r\n\tif (\r\n\t\t! allowReRegistration &&\r\n\t\tregisteredPrivateApis.includes( moduleName )\r\n\t) {\r\n\t\t// This check doesn't play well with Story Books / Hot Module Reloading\r\n\t\t// and isn't included in the Gutenberg plugin. It only matters in the\r\n\t\t// WordPress core release.\r\n\t\tthrow new Error(\r\n\t\t\t`You tried to opt-in to unstable APIs as module \"${ moduleName }\" which is already registered. ` +\r\n\t\t\t\t'This feature is only for JavaScript modules shipped with WordPress core. ' +\r\n\t\t\t\t'Please do not use it in plugins and themes as the unstable APIs will be removed ' +\r\n\t\t\t\t'without a warning. If you ignore this error and depend on unstable features, ' +\r\n\t\t\t\t'your product will inevitably break on one of the next WordPress releases.'\r\n\t\t);\r\n\t}\r\n\tif ( consent !== requiredConsent ) {\r\n\t\tthrow new Error(\r\n\t\t\t`You tried to opt-in to unstable APIs without confirming you know the consequences. ` +\r\n\t\t\t\t'This feature is only for JavaScript modules shipped with WordPress core. ' +\r\n\t\t\t\t'Please do not use it in plugins and themes as the unstable APIs will removed ' +\r\n\t\t\t\t'without a warning. If you ignore this error and depend on unstable features, ' +\r\n\t\t\t\t'your product will inevitably break on the next WordPress release.'\r\n\t\t);\r\n\t}\r\n\tregisteredPrivateApis.push( moduleName );\r\n\r\n\treturn {\r\n\t\tlock,\r\n\t\tunlock,\r\n\t};\r\n};\r\n\r\n/**\r\n * Binds private data to an object.\r\n * It does not alter the passed object in any way, only\r\n * registers it in an internal map of private data.\r\n *\r\n * The private data can't be accessed by any other means\r\n * than the `unlock` function.\r\n *\r\n * @example\r\n * ```js\r\n * const object = {};\r\n * const privateData = { a: 1 };\r\n * lock( object, privateData );\r\n *\r\n * object\r\n * // {}\r\n *\r\n * unlock( object );\r\n * // { a: 1 }\r\n * ```\r\n *\r\n * @param {any} object      The object to bind the private data to.\r\n * @param {any} privateData The private data to bind to the object.\r\n */\r\nfunction lock( object, privateData ) {\r\n\tif ( ! object ) {\r\n\t\tthrow new Error( 'Cannot lock an undefined object.' );\r\n\t}\r\n\tif ( ! ( __private in object ) ) {\r\n\t\tobject[ __private ] = {};\r\n\t}\r\n\tlockedData.set( object[ __private ], privateData );\r\n}\r\n\r\n/**\r\n * Unlocks the private data bound to an object.\r\n *\r\n * It does not alter the passed object in any way, only\r\n * returns the private data paired with it using the `lock()`\r\n * function.\r\n *\r\n * @example\r\n * ```js\r\n * const object = {};\r\n * const privateData = { a: 1 };\r\n * lock( object, privateData );\r\n *\r\n * object\r\n * // {}\r\n *\r\n * unlock( object );\r\n * // { a: 1 }\r\n * ```\r\n *\r\n * @param {any} object The object to unlock the private data from.\r\n * @return {any} The private data bound to the object.\r\n */\r\nfunction unlock( object ) {\r\n\tif ( ! object ) {\r\n\t\tthrow new Error( 'Cannot unlock an undefined object.' );\r\n\t}\r\n\tif ( ! ( __private in object ) ) {\r\n\t\tthrow new Error(\r\n\t\t\t'Cannot unlock an object that was not locked before. '\r\n\t\t);\r\n\t}\r\n\r\n\treturn lockedData.get( object[ __private ] );\r\n}\r\n\r\nconst lockedData = new WeakMap();\r\n\r\n/**\r\n * Used by lock() and unlock() to uniquely identify the private data\r\n * related to a containing object.\r\n */\r\nconst __private = Symbol( 'Private API ID' );\r\n\r\n// Unit tests utilities:\r\n\r\n/**\r\n * Private function to allow the unit tests to allow\r\n * a mock module to access the private APIs.\r\n *\r\n * @param {string} name The name of the module.\r\n */\r\nexport function allowCoreModule( name ) {\r\n\tCORE_MODULES_USING_PRIVATE_APIS.push( name );\r\n}\r\n\r\n/**\r\n * Private function to allow the unit tests to set\r\n * a custom list of allowed modules.\r\n */\r\nexport function resetAllowedCoreModules() {\r\n\twhile ( CORE_MODULES_USING_PRIVATE_APIS.length ) {\r\n\t\tCORE_MODULES_USING_PRIVATE_APIS.pop();\r\n\t}\r\n}\r\n/**\r\n * Private function to allow the unit tests to reset\r\n * the list of registered private apis.\r\n */\r\nexport function resetRegisteredPrivateApis() {\r\n\twhile ( registeredPrivateApis.length ) {\r\n\t\tregisteredPrivateApis.pop();\r\n\t}\r\n}\r\n"],"mappings":"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","ignoreList":[]}