{"version":3,"names":["jsdom","jsdomLevel1Core","html","core","dom","level1","Node","Element","CharacterData","NO_MODIFICATION_ALLOWED_ERR","HIERARCHY_REQUEST_ERR","NOT_FOUND_ERR","prototype","contains","node","parentNode","insertBefore","newChild","refChild","_readonly","DOMException","_ownerDocument","nodeType","ATTRIBUTE_NODE","current","_parentNode","DOCUMENT_FRAGMENT_NODE","tmpNode","i","_childNodes","length","removeChild","firstChild","refChildIndex","_indexOf","Array","splice","call","_attached","_attach","_modified","matches","matchesSelector","closest","selector","el","parentElement","remove","isNonDocumentTypeChildNode","Object","defineProperties","get","parent","ELEMENT_NODE","previousElementSibling","sibling","previousSibling","nextElementSibling","nextSibling","dataset","toDataAttributeName","property","replace","match","toLowerCase","Proxy","set","_target","value","attributeName","setAttribute","getAttribute","DOMParser","parseFromString","string","global"],"sources":["@wordpress/react-native-editor/src/jsdom-patches.js"],"sourcesContent":["/**\r\n * This file is used in src/globals.js to patch jsdom-jscore.\r\n *\r\n * Node.prototype.contains is implemented as a simple recursive function.\r\n *\r\n * Node.prototype.insertBefore is re-implemented (code copied) with the\r\n * WrongDocumentError exception disabled.\r\n *\r\n * Element.prototype.matches is aliased to Element.prototype.matchesSelector.\r\n *\r\n * Getters are defined on the Node.prototype for the following properties:\r\n * parentElement, previousElementSibling, nextElementSibling.\r\n */\r\n\r\n/**\r\n * External dependencies\r\n */\r\nimport jsdom from 'jsdom-jscore-rn';\r\nimport jsdomLevel1Core from 'jsdom-jscore-rn/lib/jsdom/level1/core';\r\n\r\n// Must be called to initialize jsdom before patching prototypes.\r\njsdom.html( '', null, null );\r\n\r\nconst { core } = jsdomLevel1Core.dom.level1;\r\nconst { Node, Element, CharacterData } = core;\r\n\r\n// Exception codes.\r\nconst { NO_MODIFICATION_ALLOWED_ERR, HIERARCHY_REQUEST_ERR, NOT_FOUND_ERR } =\r\n\tcore;\r\n\r\n/**\r\n * Copy of Node.contains polyfill from polyfill-library package (https://t.ly/mehjW).\r\n * This polyfill was originally used in WordPress Core (https://t.ly/4o7wQ).\r\n *\r\n * @param {number} node Node to check.\r\n * @return {boolean} true if passed node is a descendant of this node, or the\r\n * same node, false otherwise.\r\n *\r\n * This function is necessary in the mobile environment, because there are code\r\n * paths that make use of functions in the Gutenberg (web) project, which has\r\n * expectation that this is implemented (as it is in the browser environment).\r\n */\r\nNode.prototype.contains = function ( node ) {\r\n\tdo {\r\n\t\tif ( this === node ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} while ( ( node = node && node.parentNode ) );\r\n\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * Copy of insertBefore function from jsdom-jscore, WRONG_DOCUMENT_ERR exception\r\n * disabled.\r\n *\r\n * @param {Object} newChild The node to be insterted.\r\n * @param {Object} refChild The node before which newChild is inserted.\r\n * @return {Object} the newly inserted child node\r\n *\r\n * This function is modified here to remove the WRONG_DOCUMENT_ERR exception\r\n * that is no longer part of the DOM spec for this function.\r\n * see: https://github.com/jsdom/jsdom/issues/717 for more information, * and:\r\n * https://dom.spec.whatwg.org/#dom-node-insertbefore for the latest spec.\r\n */\r\nNode.prototype.insertBefore = function (\r\n\t/* Node */ newChild,\r\n\t/* Node */ refChild\r\n) {\r\n\tif ( this._readonly === true ) {\r\n\t\tthrow new core.DOMException(\r\n\t\t\tNO_MODIFICATION_ALLOWED_ERR,\r\n\t\t\t'Attempting to modify a read-only node'\r\n\t\t);\r\n\t}\r\n\r\n\t// Adopt unowned children, for weird nodes like DocumentType.\r\n\tif ( ! newChild._ownerDocument ) {\r\n\t\tnewChild._ownerDocument = this._ownerDocument;\r\n\t}\r\n\r\n\t/*\r\n\t * This is commented out to prevent WrongDocumentError\r\n\t * see: https://github.com/jsdom/jsdom/issues/717\r\n\t *\r\n\t// TODO - if (!newChild) then?\r\n\tif (newChild._ownerDocument !== this._ownerDocument) {\r\n\t\tthrow new core.DOMException(WRONG_DOCUMENT_ERR);\r\n\t}\r\n\t*/\r\n\r\n\tif ( newChild.nodeType && newChild.nodeType === newChild.ATTRIBUTE_NODE ) {\r\n\t\tthrow new core.DOMException( HIERARCHY_REQUEST_ERR );\r\n\t}\r\n\r\n\t// Search for parents matching the newChild.\r\n\tlet current = this;\r\n\tdo {\r\n\t\tif ( current === newChild ) {\r\n\t\t\tthrow new core.DOMException( HIERARCHY_REQUEST_ERR );\r\n\t\t}\r\n\t} while ( ( current = current._parentNode ) );\r\n\r\n\t// Fragments are merged into the element.\r\n\tif ( newChild.nodeType === newChild.DOCUMENT_FRAGMENT_NODE ) {\r\n\t\tlet tmpNode,\r\n\t\t\ti = newChild._childNodes.length;\r\n\t\twhile ( i-- > 0 ) {\r\n\t\t\ttmpNode = newChild.removeChild( newChild.firstChild );\r\n\t\t\tthis.insertBefore( tmpNode, refChild );\r\n\t\t}\r\n\t} else if ( newChild === refChild ) {\r\n\t\treturn newChild;\r\n\t} else {\r\n\t\t// If the newChild is already in the tree elsewhere, remove it first.\r\n\t\tif ( newChild._parentNode ) {\r\n\t\t\tnewChild._parentNode.removeChild( newChild );\r\n\t\t}\r\n\r\n\t\tif ( refChild === null ) {\r\n\t\t\t// eslint-disable-next-line no-var\r\n\t\t\tvar refChildIndex = this._childNodes.length;\r\n\t\t} else {\r\n\t\t\t// eslint-disable-next-line no-redeclare, no-var\r\n\t\t\tvar refChildIndex = this._indexOf( refChild );\r\n\t\t\tif ( refChildIndex === -1 ) {\r\n\t\t\t\tthrow new core.DOMException( NOT_FOUND_ERR );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tArray.prototype.splice.call(\r\n\t\t\tthis._childNodes,\r\n\t\t\trefChildIndex,\r\n\t\t\t0,\r\n\t\t\tnewChild\r\n\t\t);\r\n\r\n\t\tnewChild._parentNode = this;\r\n\t\tif ( this._attached && newChild._attach ) {\r\n\t\t\tnewChild._attach();\r\n\t\t}\r\n\r\n\t\tthis._modified();\r\n\t}\r\n\r\n\treturn newChild;\r\n}; // Raises(DOMException);\r\n\r\n/*\r\n * This is merely an alias (polyfill not needed).\r\n * see: https://developer.mozilla.org/en-US/docs/Web/API/Element/matches#Polyfill\r\n *\r\n * This function is necessary in the mobile environment, because there are code\r\n * paths that make use of functions in the Gutenberg (web) project, which has\r\n * expectation that this is implemented (as it is in the browser environment).\r\n */\r\nElement.prototype.matches = Element.prototype.matchesSelector;\r\n\r\n/*\r\n * Implementation of Element.prototype.closest that it's missing from the jsdom-jscore fork we're using.\r\n * See https://github.com/wordpress-mobile/gutenberg-mobile/issues/1625\r\n */\r\nElement.prototype.closest = function ( selector ) {\r\n\tlet el = this;\r\n\twhile ( el ) {\r\n\t\tif ( el.matches( selector ) ) {\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\tel = el.parentElement;\r\n\t}\r\n\treturn null;\r\n};\r\n\r\n/**\r\n * Implementation of Element.prototype.remove based on polyfills:\r\n * - https://github.com/chenzhenxi/element-remove/blob/master/index.js\r\n * (referenced in https://developer.mozilla.org/en-US/docs/Web/API/Element/remove#see_also)\r\n * - https://github.com/JakeChampion/polyfill-library/blob/master/polyfills/Element/prototype/remove/polyfill.js\r\n */\r\nElement.prototype.remove = function () {\r\n\tif ( this.parentNode ) {\r\n\t\tthis.parentNode.removeChild( this );\r\n\t}\r\n};\r\n\r\n/**\r\n * Helper function to check if a node implements the NonDocumentTypeChildNode\r\n * interface\r\n *\r\n * @param {Object} node Node to check\r\n * @return {boolean} true if node is a NonDocumentTypeChildNode, false otherwise\r\n *\r\n * This function is needed to implement the previousElementSibling and\r\n * nextElementSibling properties.\r\n * See: https://dom.spec.whatwg.org/#interface-nondocumenttypechildnode\r\n */\r\nfunction isNonDocumentTypeChildNode( node ) {\r\n\treturn node instanceof Element || node instanceof CharacterData;\r\n}\r\n\r\n// $FlowFixMe\r\nObject.defineProperties( Node.prototype, {\r\n\t/*\r\n\t * This defines parentElement property on the Node prototype using a getter.\r\n\t * See: https://dom.spec.whatwg.org/#parent-element\r\n\t */\r\n\tparentElement: {\r\n\t\tget() {\r\n\t\t\tconst parent = this.parentNode;\r\n\r\n\t\t\tif ( parent && parent.nodeType === parent.ELEMENT_NODE ) {\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\t},\r\n\t/*\r\n\t * This defines previousElementSibling property on the Node prototype using a\r\n\t * getter.\r\n\t * See: https://dom.spec.whatwg.org/#dom-nondocumenttypechildnode-previouselementsibling\r\n\t */\r\n\tpreviousElementSibling: {\r\n\t\tget() {\r\n\t\t\t// Property is undefined if node is not a NonDocumentTypeChildNode.\r\n\t\t\tif ( ! isNonDocumentTypeChildNode( this ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet sibling = this.previousSibling;\r\n\r\n\t\t\twhile ( sibling && sibling.nodeType !== sibling.ELEMENT_NODE ) {\r\n\t\t\t\tsibling = sibling.previousSibling;\r\n\t\t\t}\r\n\r\n\t\t\treturn sibling;\r\n\t\t},\r\n\t},\r\n\t/*\r\n\t * This defines nextElementSibling property on the Node prototype using a\r\n\t * getter.\r\n\t * See: https://dom.spec.whatwg.org/#dom-nondocumenttypechildnode-nextelementsibling\r\n\t */\r\n\tnextElementSibling: {\r\n\t\tget() {\r\n\t\t\t// Property is undefined if node is not a NonDocumentTypeChildNode.\r\n\t\t\tif ( ! isNonDocumentTypeChildNode( this ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet sibling = this.nextSibling;\r\n\r\n\t\t\twhile ( sibling && sibling.nodeType !== sibling.ELEMENT_NODE ) {\r\n\t\t\t\tsibling = sibling.nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\treturn sibling;\r\n\t\t},\r\n\t},\r\n\tdataset: {\r\n\t\tget() {\r\n\t\t\tconst node = this;\r\n\r\n\t\t\t// Helper function to convert property name to data-* attribute name\r\n\t\t\tfunction toDataAttributeName( property ) {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t'data-' +\r\n\t\t\t\t\tproperty.replace(\r\n\t\t\t\t\t\t/[A-Z]/g,\r\n\t\t\t\t\t\t( match ) => '-' + match.toLowerCase()\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn new Proxy(\r\n\t\t\t\t{},\r\n\t\t\t\t{\r\n\t\t\t\t\tset( _target, property, value ) {\r\n\t\t\t\t\t\tconst attributeName = toDataAttributeName( property );\r\n\t\t\t\t\t\tnode.setAttribute( attributeName, value );\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tget( _target, property ) {\r\n\t\t\t\t\t\tconst attributeName = toDataAttributeName( property );\r\n\t\t\t\t\t\treturn node.getAttribute( attributeName );\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\t\tset() {},\r\n\t},\r\n} );\r\n\r\nclass DOMParser {\r\n\t// This is required for the stripHTML function, but it doesn't necessarily\r\n\t// conform to the DOM standard.\r\n\t// See https://github.com/wordpress-mobile/gutenberg-mobile/pull/1771\r\n\tparseFromString( string ) {\r\n\t\treturn jsdom.html( string );\r\n\t}\r\n}\r\n\r\nglobal.DOMParser = DOMParser;\r\n"],"mappings":"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","ignoreList":[]}