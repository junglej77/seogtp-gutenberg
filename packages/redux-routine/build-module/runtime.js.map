{"version":3,"names":["create","isPromise","isActionOfType","isAction","createRuntime","controls","dispatch","rungenControls","Object","entries","map","actionType","control","value","next","iterate","yieldNext","yieldError","routine","then","unhandledActionControl","push","rungenRuntime","action","Promise","resolve","reject","result"],"sources":["@wordpress/redux-routine/src/runtime.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport type { Control } from 'rungen';\r\nimport { create } from 'rungen';\r\nimport isPromise from 'is-promise';\r\nimport type { Dispatch, AnyAction } from 'redux';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { isActionOfType, isAction } from './is-action';\r\n\r\n/**\r\n * Create a co-routine runtime.\r\n *\r\n * @param controls Object of control handlers.\r\n * @param dispatch Unhandled action dispatch.\r\n */\r\nexport default function createRuntime(\r\n\tcontrols: Record<\r\n\t\tstring,\r\n\t\t( value: any ) => Promise< boolean > | boolean\r\n\t> = {},\r\n\tdispatch: Dispatch\r\n) {\r\n\tconst rungenControls = Object.entries( controls ).map(\r\n\t\t( [ actionType, control ] ): Control =>\r\n\t\t\t( value, next, iterate, yieldNext, yieldError ) => {\r\n\t\t\t\tif ( ! isActionOfType( value, actionType ) ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tconst routine = control( value );\r\n\t\t\t\tif ( isPromise( routine ) ) {\r\n\t\t\t\t\t// Async control routine awaits resolution.\r\n\t\t\t\t\troutine.then( yieldNext, yieldError );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tyieldNext( routine );\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t);\r\n\r\n\tconst unhandledActionControl = (\r\n\t\tvalue: AnyAction | unknown,\r\n\t\tnext: () => void\r\n\t) => {\r\n\t\tif ( ! isAction( value ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tdispatch( value );\r\n\t\tnext();\r\n\t\treturn true;\r\n\t};\r\n\trungenControls.push( unhandledActionControl );\r\n\r\n\tconst rungenRuntime = create( rungenControls );\r\n\r\n\treturn ( action: AnyAction | Generator ) =>\r\n\t\tnew Promise( ( resolve, reject ) =>\r\n\t\t\trungenRuntime(\r\n\t\t\t\taction,\r\n\t\t\t\t( result ) => {\r\n\t\t\t\t\tif ( isAction( result ) ) {\r\n\t\t\t\t\t\tdispatch( result );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve( result );\r\n\t\t\t\t},\r\n\t\t\t\treject\r\n\t\t\t)\r\n\t\t);\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;;AAEA,SAASA,MAAM,QAAQ,QAAQ;AAC/B,OAAOC,SAAS,MAAM,YAAY;AAGlC;AACA;AACA;AACA,SAASC,cAAc,EAAEC,QAAQ,QAAQ,aAAa;;AAEtD;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,aAAaA,CACpCC,QAGC,GAAG,CAAC,CAAC,EACNC,QAAkB,EACjB;EACD,MAAMC,cAAc,GAAGC,MAAM,CAACC,OAAO,CAAEJ,QAAS,CAAC,CAACK,GAAG,CACpD,CAAE,CAAEC,UAAU,EAAEC,OAAO,CAAE,KACxB,CAAEC,KAAK,EAAEC,IAAI,EAAEC,OAAO,EAAEC,SAAS,EAAEC,UAAU,KAAM;IAClD,IAAK,CAAEf,cAAc,CAAEW,KAAK,EAAEF,UAAW,CAAC,EAAG;MAC5C,OAAO,KAAK;IACb;IACA,MAAMO,OAAO,GAAGN,OAAO,CAAEC,KAAM,CAAC;IAChC,IAAKZ,SAAS,CAAEiB,OAAQ,CAAC,EAAG;MAC3B;MACAA,OAAO,CAACC,IAAI,CAAEH,SAAS,EAAEC,UAAW,CAAC;IACtC,CAAC,MAAM;MACND,SAAS,CAAEE,OAAQ,CAAC;IACrB;IACA,OAAO,IAAI;EACZ,CACF,CAAC;EAED,MAAME,sBAAsB,GAAGA,CAC9BP,KAA0B,EAC1BC,IAAgB,KACZ;IACJ,IAAK,CAAEX,QAAQ,CAAEU,KAAM,CAAC,EAAG;MAC1B,OAAO,KAAK;IACb;IACAP,QAAQ,CAAEO,KAAM,CAAC;IACjBC,IAAI,CAAC,CAAC;IACN,OAAO,IAAI;EACZ,CAAC;EACDP,cAAc,CAACc,IAAI,CAAED,sBAAuB,CAAC;EAE7C,MAAME,aAAa,GAAGtB,MAAM,CAAEO,cAAe,CAAC;EAE9C,OAASgB,MAA6B,IACrC,IAAIC,OAAO,CAAE,CAAEC,OAAO,EAAEC,MAAM,KAC7BJ,aAAa,CACZC,MAAM,EACJI,MAAM,IAAM;IACb,IAAKxB,QAAQ,CAAEwB,MAAO,CAAC,EAAG;MACzBrB,QAAQ,CAAEqB,MAAO,CAAC;IACnB;IACAF,OAAO,CAAEE,MAAO,CAAC;EAClB,CAAC,EACDD,MACD,CACD,CAAC;AACH","ignoreList":[]}