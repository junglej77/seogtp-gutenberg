{"version":3,"names":["hasBlockSupport","isReusableBlock","store","blockEditorStore","useCallback","useState","MenuItem","Modal","Button","TextControl","__experimentalHStack","HStack","__experimentalVStack","VStack","ToggleControl","symbol","useDispatch","useSelect","__","_x","sprintf","noticesStore","coreStore","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ReusableBlockConvertButton","clientIds","rootClientId","onClose","syncType","setSyncType","undefined","isModalOpen","setIsModalOpen","title","setTitle","canConvert","select","_getBlocksByClientId","canUser","getBlocksByClientId","canInsertBlockType","getBlockRootClientId","rootId","length","blocks","isReusable","getEntityRecord","attributes","ref","_canConvert","every","block","isValid","name","kind","__experimentalConvertBlocksToReusable","convertBlocksToReusable","createSuccessNotice","createErrorNotice","onConvert","reusableBlockTitle","type","id","error","message","children","icon","onClick","onRequestClose","overlayClassName","onSubmit","event","preventDefault","spacing","__next40pxDefaultSize","__nextHasNoMarginBottom","label","value","onChange","placeholder","help","checked","justify","variant"],"sources":["@wordpress/reusable-blocks/src/components/reusable-blocks-menu-items/reusable-block-convert-button.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { hasBlockSupport, isReusableBlock } from '@wordpress/blocks';\r\nimport { store as blockEditorStore } from '@wordpress/block-editor';\r\nimport { useCallback, useState } from '@wordpress/element';\r\nimport {\r\n\tMenuItem,\r\n\tModal,\r\n\tButton,\r\n\tTextControl,\r\n\t__experimentalHStack as HStack,\r\n\t__experimentalVStack as VStack,\r\n\tToggleControl,\r\n} from '@wordpress/components';\r\nimport { symbol } from '@wordpress/icons';\r\nimport { useDispatch, useSelect } from '@wordpress/data';\r\nimport { __, _x, sprintf } from '@wordpress/i18n';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store } from '../../store';\r\n\r\n/**\r\n * Menu control to convert block(s) to reusable block.\r\n *\r\n * @param {Object}   props              Component props.\r\n * @param {string[]} props.clientIds    Client ids of selected blocks.\r\n * @param {string}   props.rootClientId ID of the currently selected top-level block.\r\n * @param {()=>void} props.onClose      Callback to close the menu.\r\n * @return {import('react').ComponentType} The menu control or null.\r\n */\r\nexport default function ReusableBlockConvertButton( {\r\n\tclientIds,\r\n\trootClientId,\r\n\tonClose,\r\n} ) {\r\n\tconst [ syncType, setSyncType ] = useState( undefined );\r\n\tconst [ isModalOpen, setIsModalOpen ] = useState( false );\r\n\tconst [ title, setTitle ] = useState( '' );\r\n\tconst canConvert = useSelect(\r\n\t\t( select ) => {\r\n\t\t\tconst { canUser } = select( coreStore );\r\n\t\t\tconst {\r\n\t\t\t\tgetBlocksByClientId,\r\n\t\t\t\tcanInsertBlockType,\r\n\t\t\t\tgetBlockRootClientId,\r\n\t\t\t} = select( blockEditorStore );\r\n\r\n\t\t\tconst rootId =\r\n\t\t\t\trootClientId ||\r\n\t\t\t\t( clientIds.length > 0\r\n\t\t\t\t\t? getBlockRootClientId( clientIds[ 0 ] )\r\n\t\t\t\t\t: undefined );\r\n\r\n\t\t\tconst blocks = getBlocksByClientId( clientIds ) ?? [];\r\n\r\n\t\t\tconst isReusable =\r\n\t\t\t\tblocks.length === 1 &&\r\n\t\t\t\tblocks[ 0 ] &&\r\n\t\t\t\tisReusableBlock( blocks[ 0 ] ) &&\r\n\t\t\t\t!! select( coreStore ).getEntityRecord(\r\n\t\t\t\t\t'postType',\r\n\t\t\t\t\t'wp_block',\r\n\t\t\t\t\tblocks[ 0 ].attributes.ref\r\n\t\t\t\t);\r\n\r\n\t\t\tconst _canConvert =\r\n\t\t\t\t// Hide when this is already a reusable block.\r\n\t\t\t\t! isReusable &&\r\n\t\t\t\t// Hide when reusable blocks are disabled.\r\n\t\t\t\tcanInsertBlockType( 'core/block', rootId ) &&\r\n\t\t\t\tblocks.every(\r\n\t\t\t\t\t( block ) =>\r\n\t\t\t\t\t\t// Guard against the case where a regular block has *just* been converted.\r\n\t\t\t\t\t\t!! block &&\r\n\t\t\t\t\t\t// Hide on invalid blocks.\r\n\t\t\t\t\t\tblock.isValid &&\r\n\t\t\t\t\t\t// Hide when block doesn't support being made reusable.\r\n\t\t\t\t\t\thasBlockSupport( block.name, 'reusable', true )\r\n\t\t\t\t) &&\r\n\t\t\t\t// Hide when current doesn't have permission to do that.\r\n\t\t\t\t// Blocks refers to the wp_block post type, this checks the ability to create a post of that type.\r\n\t\t\t\t!! canUser( 'create', {\r\n\t\t\t\t\tkind: 'postType',\r\n\t\t\t\t\tname: 'wp_block',\r\n\t\t\t\t} );\r\n\r\n\t\t\treturn _canConvert;\r\n\t\t},\r\n\t\t[ clientIds, rootClientId ]\r\n\t);\r\n\r\n\tconst { __experimentalConvertBlocksToReusable: convertBlocksToReusable } =\r\n\t\tuseDispatch( store );\r\n\r\n\tconst { createSuccessNotice, createErrorNotice } =\r\n\t\tuseDispatch( noticesStore );\r\n\tconst onConvert = useCallback(\r\n\t\tasync function ( reusableBlockTitle ) {\r\n\t\t\ttry {\r\n\t\t\t\tawait convertBlocksToReusable(\r\n\t\t\t\t\tclientIds,\r\n\t\t\t\t\treusableBlockTitle,\r\n\t\t\t\t\tsyncType\r\n\t\t\t\t);\r\n\t\t\t\tcreateSuccessNotice(\r\n\t\t\t\t\t! syncType\r\n\t\t\t\t\t\t? sprintf(\r\n\t\t\t\t\t\t\t\t// translators: %s: the name the user has given to the pattern.\r\n\t\t\t\t\t\t\t\t__( 'Synced pattern created: %s' ),\r\n\t\t\t\t\t\t\t\treusableBlockTitle\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: sprintf(\r\n\t\t\t\t\t\t\t\t// translators: %s: the name the user has given to the pattern.\r\n\t\t\t\t\t\t\t\t__( 'Unsynced pattern created: %s' ),\r\n\t\t\t\t\t\t\t\treusableBlockTitle\r\n\t\t\t\t\t\t  ),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\t\tid: 'convert-to-reusable-block-success',\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} catch ( error ) {\r\n\t\t\t\tcreateErrorNotice( error.message, {\r\n\t\t\t\t\ttype: 'snackbar',\r\n\t\t\t\t\tid: 'convert-to-reusable-block-error',\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t},\r\n\t\t[\r\n\t\t\tconvertBlocksToReusable,\r\n\t\t\tclientIds,\r\n\t\t\tsyncType,\r\n\t\t\tcreateSuccessNotice,\r\n\t\t\tcreateErrorNotice,\r\n\t\t]\r\n\t);\r\n\r\n\tif ( ! canConvert ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<MenuItem icon={ symbol } onClick={ () => setIsModalOpen( true ) }>\r\n\t\t\t\t{ __( 'Create pattern' ) }\r\n\t\t\t</MenuItem>\r\n\t\t\t{ isModalOpen && (\r\n\t\t\t\t<Modal\r\n\t\t\t\t\ttitle={ __( 'Create pattern' ) }\r\n\t\t\t\t\tonRequestClose={ () => {\r\n\t\t\t\t\t\tsetIsModalOpen( false );\r\n\t\t\t\t\t\tsetTitle( '' );\r\n\t\t\t\t\t} }\r\n\t\t\t\t\toverlayClassName=\"reusable-blocks-menu-items__convert-modal\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<form\r\n\t\t\t\t\t\tonSubmit={ ( event ) => {\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\tonConvert( title );\r\n\t\t\t\t\t\t\tsetIsModalOpen( false );\r\n\t\t\t\t\t\t\tsetTitle( '' );\r\n\t\t\t\t\t\t\tonClose();\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<VStack spacing=\"5\">\r\n\t\t\t\t\t\t\t<TextControl\r\n\t\t\t\t\t\t\t\t__next40pxDefaultSize\r\n\t\t\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\t\t\tlabel={ __( 'Name' ) }\r\n\t\t\t\t\t\t\t\tvalue={ title }\r\n\t\t\t\t\t\t\t\tonChange={ setTitle }\r\n\t\t\t\t\t\t\t\tplaceholder={ __( 'My pattern' ) }\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<ToggleControl\r\n\t\t\t\t\t\t\t\t__nextHasNoMarginBottom\r\n\t\t\t\t\t\t\t\tlabel={ _x( 'Synced', 'pattern (singular)' ) }\r\n\t\t\t\t\t\t\t\thelp={ __(\r\n\t\t\t\t\t\t\t\t\t'Sync this pattern across multiple locations.'\r\n\t\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t\t\tchecked={ ! syncType }\r\n\t\t\t\t\t\t\t\tonChange={ () => {\r\n\t\t\t\t\t\t\t\t\tsetSyncType(\r\n\t\t\t\t\t\t\t\t\t\t! syncType ? 'unsynced' : undefined\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<HStack justify=\"right\">\r\n\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\t\t\t\tvariant=\"tertiary\"\r\n\t\t\t\t\t\t\t\t\tonClick={ () => {\r\n\t\t\t\t\t\t\t\t\t\tsetIsModalOpen( false );\r\n\t\t\t\t\t\t\t\t\t\tsetTitle( '' );\r\n\t\t\t\t\t\t\t\t\t} }\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{ __( 'Cancel' ) }\r\n\t\t\t\t\t\t\t\t</Button>\r\n\r\n\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t// TODO: Switch to `true` (40px size) if possible\r\n\t\t\t\t\t\t\t\t\t__next40pxDefaultSize={ false }\r\n\t\t\t\t\t\t\t\t\tvariant=\"primary\"\r\n\t\t\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{ __( 'Create' ) }\r\n\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t</HStack>\r\n\t\t\t\t\t\t</VStack>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</Modal>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}