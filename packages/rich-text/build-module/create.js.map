{"version":3,"names":["select","store","richTextStore","createElement","mergePair","OBJECT_REPLACEMENT_CHARACTER","ZWNBSP","toHTMLString","getTextContent","createEmptyValue","formats","replacements","text","toFormat","tagName","attributes","formatType","class","getFormatTypeForClassName","replace","className","trim","getFormatTypeForBareElement","type","__experimentalCreatePrepareEditableTree","__experimentalCreateOnChangeEditableValue","name","registeredAttributes","unregisteredAttributes","_attributes","key","contentEditable","contenteditable","RichTextData","value","empty","fromPlainText","create","fromHTMLString","html","fromHTMLElement","htmlElement","options","preserveWhiteSpace","element","collapseWhiteSpace","richTextData","Object","defineProperty","innerHTML","constructor","init","toPlainText","originalHTML","valueOf","toString","toJSON","length","getOwnPropertyNames","String","prototype","hasOwnProperty","args","range","__unstableIsEditableTree","isEditableTree","Array","document","createFromElement","accumulateSelection","accumulator","node","parentNode","startContainer","startOffset","endContainer","endOffset","currentLength","start","undefined","nodeType","TEXT_NODE","childNodes","end","filterRange","filter","nodeValue","slice","isRoot","clone","cloneNode","normalize","from","forEach","i","nodes","newNodeValue","test","indexOf","startsWith","endsWith","ELEMENT_NODE","CARRIAGE_RETURN","removeReservedCharacters","string","RegExp","hasChildNodes","index","nodeName","toLowerCase","getAttribute","encodeURIComponent","format","getAttributes","mergeFormats","newFormats","hasAttributes","safeName"],"sources":["@wordpress/rich-text/src/create.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport { select } from '@wordpress/data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { store as richTextStore } from './store';\r\nimport { createElement } from './create-element';\r\nimport { mergePair } from './concat';\r\nimport { OBJECT_REPLACEMENT_CHARACTER, ZWNBSP } from './special-characters';\r\nimport { toHTMLString } from './to-html-string';\r\nimport { getTextContent } from './get-text-content';\r\n\r\n/** @typedef {import('./types').RichTextValue} RichTextValue */\r\n\r\nfunction createEmptyValue() {\r\n\treturn {\r\n\t\tformats: [],\r\n\t\treplacements: [],\r\n\t\ttext: '',\r\n\t};\r\n}\r\n\r\nfunction toFormat( { tagName, attributes } ) {\r\n\tlet formatType;\r\n\r\n\tif ( attributes && attributes.class ) {\r\n\t\tformatType = select( richTextStore ).getFormatTypeForClassName(\r\n\t\t\tattributes.class\r\n\t\t);\r\n\r\n\t\tif ( formatType ) {\r\n\t\t\t// Preserve any additional classes.\r\n\t\t\tattributes.class = ` ${ attributes.class } `\r\n\t\t\t\t.replace( ` ${ formatType.className } `, ' ' )\r\n\t\t\t\t.trim();\r\n\r\n\t\t\tif ( ! attributes.class ) {\r\n\t\t\t\tdelete attributes.class;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif ( ! formatType ) {\r\n\t\tformatType =\r\n\t\t\tselect( richTextStore ).getFormatTypeForBareElement( tagName );\r\n\t}\r\n\r\n\tif ( ! formatType ) {\r\n\t\treturn attributes ? { type: tagName, attributes } : { type: tagName };\r\n\t}\r\n\r\n\tif (\r\n\t\tformatType.__experimentalCreatePrepareEditableTree &&\r\n\t\t! formatType.__experimentalCreateOnChangeEditableValue\r\n\t) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif ( ! attributes ) {\r\n\t\treturn { formatType, type: formatType.name, tagName };\r\n\t}\r\n\r\n\tconst registeredAttributes = {};\r\n\tconst unregisteredAttributes = {};\r\n\tconst _attributes = { ...attributes };\r\n\r\n\tfor ( const key in formatType.attributes ) {\r\n\t\tconst name = formatType.attributes[ key ];\r\n\r\n\t\tregisteredAttributes[ key ] = _attributes[ name ];\r\n\r\n\t\t// delete the attribute and what's left is considered\r\n\t\t// to be unregistered.\r\n\t\tdelete _attributes[ name ];\r\n\r\n\t\tif ( typeof registeredAttributes[ key ] === 'undefined' ) {\r\n\t\t\tdelete registeredAttributes[ key ];\r\n\t\t}\r\n\t}\r\n\r\n\tfor ( const name in _attributes ) {\r\n\t\tunregisteredAttributes[ name ] = attributes[ name ];\r\n\t}\r\n\r\n\tif ( formatType.contentEditable === false ) {\r\n\t\tdelete unregisteredAttributes.contenteditable;\r\n\t}\r\n\r\n\treturn {\r\n\t\tformatType,\r\n\t\ttype: formatType.name,\r\n\t\ttagName,\r\n\t\tattributes: registeredAttributes,\r\n\t\tunregisteredAttributes,\r\n\t};\r\n}\r\n\r\n/**\r\n * The RichTextData class is used to instantiate a wrapper around rich text\r\n * values, with methods that can be used to transform or manipulate the data.\r\n *\r\n * - Create an empty instance: `new RichTextData()`.\r\n * - Create one from an HTML string: `RichTextData.fromHTMLString(\r\n *   '<em>hello</em>' )`.\r\n * - Create one from a wrapper HTMLElement: `RichTextData.fromHTMLElement(\r\n *   document.querySelector( 'p' ) )`.\r\n * - Create one from plain text: `RichTextData.fromPlainText( '1\\n2' )`.\r\n * - Create one from a rich text value: `new RichTextData( { text: '...',\r\n *   formats: [ ... ] } )`.\r\n *\r\n * @todo Add methods to manipulate the data, such as applyFormat, slice etc.\r\n */\r\nexport class RichTextData {\r\n\t#value;\r\n\r\n\tstatic empty() {\r\n\t\treturn new RichTextData();\r\n\t}\r\n\tstatic fromPlainText( text ) {\r\n\t\treturn new RichTextData( create( { text } ) );\r\n\t}\r\n\tstatic fromHTMLString( html ) {\r\n\t\treturn new RichTextData( create( { html } ) );\r\n\t}\r\n\tstatic fromHTMLElement( htmlElement, options = {} ) {\r\n\t\tconst { preserveWhiteSpace = false } = options;\r\n\t\tconst element = preserveWhiteSpace\r\n\t\t\t? htmlElement\r\n\t\t\t: collapseWhiteSpace( htmlElement );\r\n\t\tconst richTextData = new RichTextData( create( { element } ) );\r\n\t\tObject.defineProperty( richTextData, 'originalHTML', {\r\n\t\t\tvalue: htmlElement.innerHTML,\r\n\t\t} );\r\n\t\treturn richTextData;\r\n\t}\r\n\tconstructor( init = createEmptyValue() ) {\r\n\t\tthis.#value = init;\r\n\t}\r\n\ttoPlainText() {\r\n\t\treturn getTextContent( this.#value );\r\n\t}\r\n\t// We could expose `toHTMLElement` at some point as well, but we'd only use\r\n\t// it internally.\r\n\ttoHTMLString( { preserveWhiteSpace } = {} ) {\r\n\t\treturn (\r\n\t\t\tthis.originalHTML ||\r\n\t\t\ttoHTMLString( { value: this.#value, preserveWhiteSpace } )\r\n\t\t);\r\n\t}\r\n\tvalueOf() {\r\n\t\treturn this.toHTMLString();\r\n\t}\r\n\ttoString() {\r\n\t\treturn this.toHTMLString();\r\n\t}\r\n\ttoJSON() {\r\n\t\treturn this.toHTMLString();\r\n\t}\r\n\tget length() {\r\n\t\treturn this.text.length;\r\n\t}\r\n\tget formats() {\r\n\t\treturn this.#value.formats;\r\n\t}\r\n\tget replacements() {\r\n\t\treturn this.#value.replacements;\r\n\t}\r\n\tget text() {\r\n\t\treturn this.#value.text;\r\n\t}\r\n}\r\n\r\nfor ( const name of Object.getOwnPropertyNames( String.prototype ) ) {\r\n\tif ( RichTextData.prototype.hasOwnProperty( name ) ) {\r\n\t\tcontinue;\r\n\t}\r\n\r\n\tObject.defineProperty( RichTextData.prototype, name, {\r\n\t\tvalue( ...args ) {\r\n\t\t\t// Should we convert back to RichTextData?\r\n\t\t\treturn this.toHTMLString()[ name ]( ...args );\r\n\t\t},\r\n\t} );\r\n}\r\n\r\n/**\r\n * Create a RichText value from an `Element` tree (DOM), an HTML string or a\r\n * plain text string, with optionally a `Range` object to set the selection. If\r\n * called without any input, an empty value will be created. The optional\r\n * functions can be used to filter out content.\r\n *\r\n * A value will have the following shape, which you are strongly encouraged not\r\n * to modify without the use of helper functions:\r\n *\r\n * ```js\r\n * {\r\n *   text: string,\r\n *   formats: Array,\r\n *   replacements: Array,\r\n *   ?start: number,\r\n *   ?end: number,\r\n * }\r\n * ```\r\n *\r\n * As you can see, text and formatting are separated. `text` holds the text,\r\n * including any replacement characters for objects and lines. `formats`,\r\n * `objects` and `lines` are all sparse arrays of the same length as `text`. It\r\n * holds information about the formatting at the relevant text indices. Finally\r\n * `start` and `end` state which text indices are selected. They are only\r\n * provided if a `Range` was given.\r\n *\r\n * @param {Object}  [$1]                          Optional named arguments.\r\n * @param {Element} [$1.element]                  Element to create value from.\r\n * @param {string}  [$1.text]                     Text to create value from.\r\n * @param {string}  [$1.html]                     HTML to create value from.\r\n * @param {Range}   [$1.range]                    Range to create value from.\r\n * @param {boolean} [$1.__unstableIsEditableTree]\r\n * @return {RichTextValue} A rich text value.\r\n */\r\nexport function create( {\r\n\telement,\r\n\ttext,\r\n\thtml,\r\n\trange,\r\n\t__unstableIsEditableTree: isEditableTree,\r\n} = {} ) {\r\n\tif ( html instanceof RichTextData ) {\r\n\t\treturn {\r\n\t\t\ttext: html.text,\r\n\t\t\tformats: html.formats,\r\n\t\t\treplacements: html.replacements,\r\n\t\t};\r\n\t}\r\n\r\n\tif ( typeof text === 'string' && text.length > 0 ) {\r\n\t\treturn {\r\n\t\t\tformats: Array( text.length ),\r\n\t\t\treplacements: Array( text.length ),\r\n\t\t\ttext,\r\n\t\t};\r\n\t}\r\n\r\n\tif ( typeof html === 'string' && html.length > 0 ) {\r\n\t\t// It does not matter which document this is, we're just using it to\r\n\t\t// parse.\r\n\t\telement = createElement( document, html );\r\n\t}\r\n\r\n\tif ( typeof element !== 'object' ) {\r\n\t\treturn createEmptyValue();\r\n\t}\r\n\r\n\treturn createFromElement( {\r\n\t\telement,\r\n\t\trange,\r\n\t\tisEditableTree,\r\n\t} );\r\n}\r\n\r\n/**\r\n * Helper to accumulate the value's selection start and end from the current\r\n * node and range.\r\n *\r\n * @param {Object} accumulator Object to accumulate into.\r\n * @param {Node}   node        Node to create value with.\r\n * @param {Range}  range       Range to create value with.\r\n * @param {Object} value       Value that is being accumulated.\r\n */\r\nfunction accumulateSelection( accumulator, node, range, value ) {\r\n\tif ( ! range ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst { parentNode } = node;\r\n\tconst { startContainer, startOffset, endContainer, endOffset } = range;\r\n\tconst currentLength = accumulator.text.length;\r\n\r\n\t// Selection can be extracted from value.\r\n\tif ( value.start !== undefined ) {\r\n\t\taccumulator.start = currentLength + value.start;\r\n\t\t// Range indicates that the current node has selection.\r\n\t} else if ( node === startContainer && node.nodeType === node.TEXT_NODE ) {\r\n\t\taccumulator.start = currentLength + startOffset;\r\n\t\t// Range indicates that the current node is selected.\r\n\t} else if (\r\n\t\tparentNode === startContainer &&\r\n\t\tnode === startContainer.childNodes[ startOffset ]\r\n\t) {\r\n\t\taccumulator.start = currentLength;\r\n\t\t// Range indicates that the selection is after the current node.\r\n\t} else if (\r\n\t\tparentNode === startContainer &&\r\n\t\tnode === startContainer.childNodes[ startOffset - 1 ]\r\n\t) {\r\n\t\taccumulator.start = currentLength + value.text.length;\r\n\t\t// Fallback if no child inside handled the selection.\r\n\t} else if ( node === startContainer ) {\r\n\t\taccumulator.start = currentLength;\r\n\t}\r\n\r\n\t// Selection can be extracted from value.\r\n\tif ( value.end !== undefined ) {\r\n\t\taccumulator.end = currentLength + value.end;\r\n\t\t// Range indicates that the current node has selection.\r\n\t} else if ( node === endContainer && node.nodeType === node.TEXT_NODE ) {\r\n\t\taccumulator.end = currentLength + endOffset;\r\n\t\t// Range indicates that the current node is selected.\r\n\t} else if (\r\n\t\tparentNode === endContainer &&\r\n\t\tnode === endContainer.childNodes[ endOffset - 1 ]\r\n\t) {\r\n\t\taccumulator.end = currentLength + value.text.length;\r\n\t\t// Range indicates that the selection is before the current node.\r\n\t} else if (\r\n\t\tparentNode === endContainer &&\r\n\t\tnode === endContainer.childNodes[ endOffset ]\r\n\t) {\r\n\t\taccumulator.end = currentLength;\r\n\t\t// Fallback if no child inside handled the selection.\r\n\t} else if ( node === endContainer ) {\r\n\t\taccumulator.end = currentLength + endOffset;\r\n\t}\r\n}\r\n\r\n/**\r\n * Adjusts the start and end offsets from a range based on a text filter.\r\n *\r\n * @param {Node}     node   Node of which the text should be filtered.\r\n * @param {Range}    range  The range to filter.\r\n * @param {Function} filter Function to use to filter the text.\r\n *\r\n * @return {Object|void} Object containing range properties.\r\n */\r\nfunction filterRange( node, range, filter ) {\r\n\tif ( ! range ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst { startContainer, endContainer } = range;\r\n\tlet { startOffset, endOffset } = range;\r\n\r\n\tif ( node === startContainer ) {\r\n\t\tstartOffset = filter( node.nodeValue.slice( 0, startOffset ) ).length;\r\n\t}\r\n\r\n\tif ( node === endContainer ) {\r\n\t\tendOffset = filter( node.nodeValue.slice( 0, endOffset ) ).length;\r\n\t}\r\n\r\n\treturn { startContainer, startOffset, endContainer, endOffset };\r\n}\r\n\r\n/**\r\n * Collapse any whitespace used for HTML formatting to one space character,\r\n * because it will also be displayed as such by the browser.\r\n *\r\n * We need to strip it from the content because we use white-space: pre-wrap for\r\n * displaying editable rich text. Without using white-space: pre-wrap, the\r\n * browser will litter the content with non breaking spaces, among other issues.\r\n * See packages/rich-text/src/component/use-default-style.js.\r\n *\r\n * @see\r\n * https://developer.mozilla.org/en-US/docs/Web/CSS/white-space-collapse#collapsing_of_white_space\r\n *\r\n * @param {HTMLElement} element\r\n * @param {boolean}     isRoot\r\n *\r\n * @return {HTMLElement} New element with collapsed whitespace.\r\n */\r\nfunction collapseWhiteSpace( element, isRoot = true ) {\r\n\tconst clone = element.cloneNode( true );\r\n\tclone.normalize();\r\n\tArray.from( clone.childNodes ).forEach( ( node, i, nodes ) => {\r\n\t\tif ( node.nodeType === node.TEXT_NODE ) {\r\n\t\t\tlet newNodeValue = node.nodeValue;\r\n\r\n\t\t\tif ( /[\\n\\t\\r\\f]/.test( newNodeValue ) ) {\r\n\t\t\t\tnewNodeValue = newNodeValue.replace( /[\\n\\t\\r\\f]+/g, ' ' );\r\n\t\t\t}\r\n\r\n\t\t\tif ( newNodeValue.indexOf( '  ' ) !== -1 ) {\r\n\t\t\t\tnewNodeValue = newNodeValue.replace( / {2,}/g, ' ' );\r\n\t\t\t}\r\n\r\n\t\t\tif ( i === 0 && newNodeValue.startsWith( ' ' ) ) {\r\n\t\t\t\tnewNodeValue = newNodeValue.slice( 1 );\r\n\t\t\t} else if (\r\n\t\t\t\tisRoot &&\r\n\t\t\t\ti === nodes.length - 1 &&\r\n\t\t\t\tnewNodeValue.endsWith( ' ' )\r\n\t\t\t) {\r\n\t\t\t\tnewNodeValue = newNodeValue.slice( 0, -1 );\r\n\t\t\t}\r\n\r\n\t\t\tnode.nodeValue = newNodeValue;\r\n\t\t} else if ( node.nodeType === node.ELEMENT_NODE ) {\r\n\t\t\tcollapseWhiteSpace( node, false );\r\n\t\t}\r\n\t} );\r\n\treturn clone;\r\n}\r\n\r\n/**\r\n * We need to normalise line breaks to `\\n` so they are consistent across\r\n * platforms and serialised properly. Not removing \\r would cause it to\r\n * linger and result in double line breaks when whitespace is preserved.\r\n */\r\nconst CARRIAGE_RETURN = '\\r';\r\n\r\n/**\r\n * Removes reserved characters used by rich-text (zero width non breaking spaces\r\n * added by `toTree` and object replacement characters).\r\n *\r\n * @param {string} string\r\n */\r\nexport function removeReservedCharacters( string ) {\r\n\t// with the global flag, note that we should create a new regex each time OR\r\n\t// reset lastIndex state.\r\n\treturn string.replace(\r\n\t\tnew RegExp(\r\n\t\t\t`[${ ZWNBSP }${ OBJECT_REPLACEMENT_CHARACTER }${ CARRIAGE_RETURN }]`,\r\n\t\t\t'gu'\r\n\t\t),\r\n\t\t''\r\n\t);\r\n}\r\n\r\n/**\r\n * Creates a Rich Text value from a DOM element and range.\r\n *\r\n * @param {Object}  $1                  Named argements.\r\n * @param {Element} [$1.element]        Element to create value from.\r\n * @param {Range}   [$1.range]          Range to create value from.\r\n * @param {boolean} [$1.isEditableTree]\r\n *\r\n * @return {RichTextValue} A rich text value.\r\n */\r\nfunction createFromElement( { element, range, isEditableTree } ) {\r\n\tconst accumulator = createEmptyValue();\r\n\r\n\tif ( ! element ) {\r\n\t\treturn accumulator;\r\n\t}\r\n\r\n\tif ( ! element.hasChildNodes() ) {\r\n\t\taccumulateSelection( accumulator, element, range, createEmptyValue() );\r\n\t\treturn accumulator;\r\n\t}\r\n\r\n\tconst length = element.childNodes.length;\r\n\r\n\t// Optimise for speed.\r\n\tfor ( let index = 0; index < length; index++ ) {\r\n\t\tconst node = element.childNodes[ index ];\r\n\t\tconst tagName = node.nodeName.toLowerCase();\r\n\r\n\t\tif ( node.nodeType === node.TEXT_NODE ) {\r\n\t\t\tconst text = removeReservedCharacters( node.nodeValue );\r\n\t\t\trange = filterRange( node, range, removeReservedCharacters );\r\n\t\t\taccumulateSelection( accumulator, node, range, { text } );\r\n\t\t\t// Create a sparse array of the same length as `text`, in which\r\n\t\t\t// formats can be added.\r\n\t\t\taccumulator.formats.length += text.length;\r\n\t\t\taccumulator.replacements.length += text.length;\r\n\t\t\taccumulator.text += text;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif ( node.nodeType !== node.ELEMENT_NODE ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tisEditableTree &&\r\n\t\t\t// Ignore any line breaks that are not inserted by us.\r\n\t\t\ttagName === 'br' &&\r\n\t\t\t! node.getAttribute( 'data-rich-text-line-break' )\r\n\t\t) {\r\n\t\t\taccumulateSelection( accumulator, node, range, createEmptyValue() );\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif ( tagName === 'script' ) {\r\n\t\t\tconst value = {\r\n\t\t\t\tformats: [ , ],\r\n\t\t\t\treplacements: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: tagName,\r\n\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t'data-rich-text-script':\r\n\t\t\t\t\t\t\t\tnode.getAttribute( 'data-rich-text-script' ) ||\r\n\t\t\t\t\t\t\t\tencodeURIComponent( node.innerHTML ),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\ttext: OBJECT_REPLACEMENT_CHARACTER,\r\n\t\t\t};\r\n\t\t\taccumulateSelection( accumulator, node, range, value );\r\n\t\t\tmergePair( accumulator, value );\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif ( tagName === 'br' ) {\r\n\t\t\taccumulateSelection( accumulator, node, range, createEmptyValue() );\r\n\t\t\tmergePair( accumulator, create( { text: '\\n' } ) );\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst format = toFormat( {\r\n\t\t\ttagName,\r\n\t\t\tattributes: getAttributes( { element: node } ),\r\n\t\t} );\r\n\r\n\t\t// When a format type is declared as not editable, replace it with an\r\n\t\t// object replacement character and preserve the inner HTML.\r\n\t\tif ( format?.formatType?.contentEditable === false ) {\r\n\t\t\tdelete format.formatType;\r\n\t\t\taccumulateSelection( accumulator, node, range, createEmptyValue() );\r\n\t\t\tmergePair( accumulator, {\r\n\t\t\t\tformats: [ , ],\r\n\t\t\t\treplacements: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t...format,\r\n\t\t\t\t\t\tinnerHTML: node.innerHTML,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\ttext: OBJECT_REPLACEMENT_CHARACTER,\r\n\t\t\t} );\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif ( format ) {\r\n\t\t\tdelete format.formatType;\r\n\t\t}\r\n\r\n\t\tconst value = createFromElement( {\r\n\t\t\telement: node,\r\n\t\t\trange,\r\n\t\t\tisEditableTree,\r\n\t\t} );\r\n\r\n\t\taccumulateSelection( accumulator, node, range, value );\r\n\r\n\t\t// Ignore any placeholders, but keep their content since the browser\r\n\t\t// might insert text inside them when the editable element is flex.\r\n\t\tif ( ! format || node.getAttribute( 'data-rich-text-placeholder' ) ) {\r\n\t\t\tmergePair( accumulator, value );\r\n\t\t} else if ( value.text.length === 0 ) {\r\n\t\t\tif ( format.attributes ) {\r\n\t\t\t\tmergePair( accumulator, {\r\n\t\t\t\t\tformats: [ , ],\r\n\t\t\t\t\treplacements: [ format ],\r\n\t\t\t\t\ttext: OBJECT_REPLACEMENT_CHARACTER,\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Indices should share a reference to the same formats array.\r\n\t\t\t// Only create a new reference if `formats` changes.\r\n\t\t\tfunction mergeFormats( formats ) {\r\n\t\t\t\tif ( mergeFormats.formats === formats ) {\r\n\t\t\t\t\treturn mergeFormats.newFormats;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst newFormats = formats\r\n\t\t\t\t\t? [ format, ...formats ]\r\n\t\t\t\t\t: [ format ];\r\n\r\n\t\t\t\tmergeFormats.formats = formats;\r\n\t\t\t\tmergeFormats.newFormats = newFormats;\r\n\r\n\t\t\t\treturn newFormats;\r\n\t\t\t}\r\n\r\n\t\t\t// Since the formats parameter can be `undefined`, preset\r\n\t\t\t// `mergeFormats` with a new reference.\r\n\t\t\tmergeFormats.newFormats = [ format ];\r\n\r\n\t\t\tmergePair( accumulator, {\r\n\t\t\t\t...value,\r\n\t\t\t\tformats: Array.from( value.formats, mergeFormats ),\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\treturn accumulator;\r\n}\r\n\r\n/**\r\n * Gets the attributes of an element in object shape.\r\n *\r\n * @param {Object}  $1         Named argements.\r\n * @param {Element} $1.element Element to get attributes from.\r\n *\r\n * @return {Object|void} Attribute object or `undefined` if the element has no\r\n *                       attributes.\r\n */\r\nfunction getAttributes( { element } ) {\r\n\tif ( ! element.hasAttributes() ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst length = element.attributes.length;\r\n\tlet accumulator;\r\n\r\n\t// Optimise for speed.\r\n\tfor ( let i = 0; i < length; i++ ) {\r\n\t\tconst { name, value } = element.attributes[ i ];\r\n\r\n\t\tif ( name.indexOf( 'data-rich-text-' ) === 0 ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst safeName = /^on/i.test( name )\r\n\t\t\t? 'data-disable-rich-text-' + name\r\n\t\t\t: name;\r\n\r\n\t\taccumulator = accumulator || {};\r\n\t\taccumulator[ safeName ] = value;\r\n\t}\r\n\r\n\treturn accumulator;\r\n}\r\n"],"mappings":"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","ignoreList":[]}