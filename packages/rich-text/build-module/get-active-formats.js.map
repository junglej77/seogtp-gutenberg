{"version":3,"names":["isFormatEqual","getActiveFormats","value","EMPTY_ACTIVE_FORMATS","formats","start","end","activeFormats","undefined","formatsBefore","formatsAfter","length","selectedFormats","slice","_activeFormats","i","formatsAtIndex","ii","format","find","_format","splice"],"sources":["@wordpress/rich-text/src/get-active-formats.js"],"sourcesContent":["/** @typedef {import('./types').RichTextValue} RichTextValue */\r\n/** @typedef {import('./types').RichTextFormatList} RichTextFormatList */\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport { isFormatEqual } from './is-format-equal';\r\n\r\n/**\r\n * Gets the all format objects at the start of the selection.\r\n *\r\n * @param {RichTextValue} value                Value to inspect.\r\n * @param {Array}         EMPTY_ACTIVE_FORMATS Array to return if there are no\r\n *                                             active formats.\r\n *\r\n * @return {RichTextFormatList} Active format objects.\r\n */\r\nexport function getActiveFormats( value, EMPTY_ACTIVE_FORMATS = [] ) {\r\n\tconst { formats, start, end, activeFormats } = value;\r\n\tif ( start === undefined ) {\r\n\t\treturn EMPTY_ACTIVE_FORMATS;\r\n\t}\r\n\r\n\tif ( start === end ) {\r\n\t\t// For a collapsed caret, it is possible to override the active formats.\r\n\t\tif ( activeFormats ) {\r\n\t\t\treturn activeFormats;\r\n\t\t}\r\n\r\n\t\tconst formatsBefore = formats[ start - 1 ] || EMPTY_ACTIVE_FORMATS;\r\n\t\tconst formatsAfter = formats[ start ] || EMPTY_ACTIVE_FORMATS;\r\n\r\n\t\t// By default, select the lowest amount of formats possible (which means\r\n\t\t// the caret is positioned outside the format boundary). The user can\r\n\t\t// then use arrow keys to define `activeFormats`.\r\n\t\tif ( formatsBefore.length < formatsAfter.length ) {\r\n\t\t\treturn formatsBefore;\r\n\t\t}\r\n\r\n\t\treturn formatsAfter;\r\n\t}\r\n\r\n\t// If there's no formats at the start index, there are not active formats.\r\n\tif ( ! formats[ start ] ) {\r\n\t\treturn EMPTY_ACTIVE_FORMATS;\r\n\t}\r\n\r\n\tconst selectedFormats = formats.slice( start, end );\r\n\r\n\t// Clone the formats so we're not mutating the live value.\r\n\tconst _activeFormats = [ ...selectedFormats[ 0 ] ];\r\n\tlet i = selectedFormats.length;\r\n\r\n\t// For performance reasons, start from the end where it's much quicker to\r\n\t// realise that there are no active formats.\r\n\twhile ( i-- ) {\r\n\t\tconst formatsAtIndex = selectedFormats[ i ];\r\n\r\n\t\t// If we run into any index without formats, we're sure that there's no\r\n\t\t// active formats.\r\n\t\tif ( ! formatsAtIndex ) {\r\n\t\t\treturn EMPTY_ACTIVE_FORMATS;\r\n\t\t}\r\n\r\n\t\tlet ii = _activeFormats.length;\r\n\r\n\t\t// Loop over the active formats and remove any that are not present at\r\n\t\t// the current index.\r\n\t\twhile ( ii-- ) {\r\n\t\t\tconst format = _activeFormats[ ii ];\r\n\r\n\t\t\tif (\r\n\t\t\t\t! formatsAtIndex.find( ( _format ) =>\r\n\t\t\t\t\tisFormatEqual( format, _format )\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\t_activeFormats.splice( ii, 1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If there are no active formats, we can stop.\r\n\t\tif ( _activeFormats.length === 0 ) {\r\n\t\t\treturn EMPTY_ACTIVE_FORMATS;\r\n\t\t}\r\n\t}\r\n\r\n\treturn _activeFormats || EMPTY_ACTIVE_FORMATS;\r\n}\r\n"],"mappings":"AAAA;AACA;;AAEA;AACA;AACA;AACA,SAASA,aAAa,QAAQ,mBAAmB;;AAEjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,gBAAgBA,CAAEC,KAAK,EAAEC,oBAAoB,GAAG,EAAE,EAAG;EACpE,MAAM;IAAEC,OAAO;IAAEC,KAAK;IAAEC,GAAG;IAAEC;EAAc,CAAC,GAAGL,KAAK;EACpD,IAAKG,KAAK,KAAKG,SAAS,EAAG;IAC1B,OAAOL,oBAAoB;EAC5B;EAEA,IAAKE,KAAK,KAAKC,GAAG,EAAG;IACpB;IACA,IAAKC,aAAa,EAAG;MACpB,OAAOA,aAAa;IACrB;IAEA,MAAME,aAAa,GAAGL,OAAO,CAAEC,KAAK,GAAG,CAAC,CAAE,IAAIF,oBAAoB;IAClE,MAAMO,YAAY,GAAGN,OAAO,CAAEC,KAAK,CAAE,IAAIF,oBAAoB;;IAE7D;IACA;IACA;IACA,IAAKM,aAAa,CAACE,MAAM,GAAGD,YAAY,CAACC,MAAM,EAAG;MACjD,OAAOF,aAAa;IACrB;IAEA,OAAOC,YAAY;EACpB;;EAEA;EACA,IAAK,CAAEN,OAAO,CAAEC,KAAK,CAAE,EAAG;IACzB,OAAOF,oBAAoB;EAC5B;EAEA,MAAMS,eAAe,GAAGR,OAAO,CAACS,KAAK,CAAER,KAAK,EAAEC,GAAI,CAAC;;EAEnD;EACA,MAAMQ,cAAc,GAAG,CAAE,GAAGF,eAAe,CAAE,CAAC,CAAE,CAAE;EAClD,IAAIG,CAAC,GAAGH,eAAe,CAACD,MAAM;;EAE9B;EACA;EACA,OAAQI,CAAC,EAAE,EAAG;IACb,MAAMC,cAAc,GAAGJ,eAAe,CAAEG,CAAC,CAAE;;IAE3C;IACA;IACA,IAAK,CAAEC,cAAc,EAAG;MACvB,OAAOb,oBAAoB;IAC5B;IAEA,IAAIc,EAAE,GAAGH,cAAc,CAACH,MAAM;;IAE9B;IACA;IACA,OAAQM,EAAE,EAAE,EAAG;MACd,MAAMC,MAAM,GAAGJ,cAAc,CAAEG,EAAE,CAAE;MAEnC,IACC,CAAED,cAAc,CAACG,IAAI,CAAIC,OAAO,IAC/BpB,aAAa,CAAEkB,MAAM,EAAEE,OAAQ,CAChC,CAAC,EACA;QACDN,cAAc,CAACO,MAAM,CAAEJ,EAAE,EAAE,CAAE,CAAC;MAC/B;IACD;;IAEA;IACA,IAAKH,cAAc,CAACH,MAAM,KAAK,CAAC,EAAG;MAClC,OAAOR,oBAAoB;IAC5B;EACD;EAEA,OAAOW,cAAc,IAAIX,oBAAoB;AAC9C","ignoreList":[]}