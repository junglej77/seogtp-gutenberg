{"version":3,"names":["normaliseFormats","removeFormat","value","formatType","startIndex","start","endIndex","end","formats","activeFormats","newFormats","slice","format","find","type","newFormat","filterFormats","i","filter","index","length"],"sources":["@wordpress/rich-text/src/remove-format.js"],"sourcesContent":["/**\r\n * Internal dependencies\r\n */\r\n\r\nimport { normaliseFormats } from './normalise-formats';\r\n\r\n/** @typedef {import('./types').RichTextValue} RichTextValue */\r\n\r\n/**\r\n * Remove any format object from a Rich Text value by type from the given\r\n * `startIndex` to the given `endIndex`. Indices are retrieved from the\r\n * selection if none are provided.\r\n *\r\n * @param {RichTextValue} value        Value to modify.\r\n * @param {string}        formatType   Format type to remove.\r\n * @param {number}        [startIndex] Start index.\r\n * @param {number}        [endIndex]   End index.\r\n *\r\n * @return {RichTextValue} A new value with the format applied.\r\n */\r\nexport function removeFormat(\r\n\tvalue,\r\n\tformatType,\r\n\tstartIndex = value.start,\r\n\tendIndex = value.end\r\n) {\r\n\tconst { formats, activeFormats } = value;\r\n\tconst newFormats = formats.slice();\r\n\r\n\t// If the selection is collapsed, expand start and end to the edges of the\r\n\t// format.\r\n\tif ( startIndex === endIndex ) {\r\n\t\tconst format = newFormats[ startIndex ]?.find(\r\n\t\t\t( { type } ) => type === formatType\r\n\t\t);\r\n\r\n\t\tif ( format ) {\r\n\t\t\twhile (\r\n\t\t\t\tnewFormats[ startIndex ]?.find(\r\n\t\t\t\t\t( newFormat ) => newFormat === format\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\tfilterFormats( newFormats, startIndex, formatType );\r\n\t\t\t\tstartIndex--;\r\n\t\t\t}\r\n\r\n\t\t\tendIndex++;\r\n\r\n\t\t\twhile (\r\n\t\t\t\tnewFormats[ endIndex ]?.find(\r\n\t\t\t\t\t( newFormat ) => newFormat === format\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\tfilterFormats( newFormats, endIndex, formatType );\r\n\t\t\t\tendIndex++;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor ( let i = startIndex; i < endIndex; i++ ) {\r\n\t\t\tif ( newFormats[ i ] ) {\r\n\t\t\t\tfilterFormats( newFormats, i, formatType );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn normaliseFormats( {\r\n\t\t...value,\r\n\t\tformats: newFormats,\r\n\t\tactiveFormats:\r\n\t\t\tactiveFormats?.filter( ( { type } ) => type !== formatType ) || [],\r\n\t} );\r\n}\r\n\r\nfunction filterFormats( formats, index, formatType ) {\r\n\tconst newFormats = formats[ index ].filter(\r\n\t\t( { type } ) => type !== formatType\r\n\t);\r\n\r\n\tif ( newFormats.length ) {\r\n\t\tformats[ index ] = newFormats;\r\n\t} else {\r\n\t\tdelete formats[ index ];\r\n\t}\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;;AAEA,SAASA,gBAAgB,QAAQ,qBAAqB;;AAEtD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,YAAYA,CAC3BC,KAAK,EACLC,UAAU,EACVC,UAAU,GAAGF,KAAK,CAACG,KAAK,EACxBC,QAAQ,GAAGJ,KAAK,CAACK,GAAG,EACnB;EACD,MAAM;IAAEC,OAAO;IAAEC;EAAc,CAAC,GAAGP,KAAK;EACxC,MAAMQ,UAAU,GAAGF,OAAO,CAACG,KAAK,CAAC,CAAC;;EAElC;EACA;EACA,IAAKP,UAAU,KAAKE,QAAQ,EAAG;IAC9B,MAAMM,MAAM,GAAGF,UAAU,CAAEN,UAAU,CAAE,EAAES,IAAI,CAC5C,CAAE;MAAEC;IAAK,CAAC,KAAMA,IAAI,KAAKX,UAC1B,CAAC;IAED,IAAKS,MAAM,EAAG;MACb,OACCF,UAAU,CAAEN,UAAU,CAAE,EAAES,IAAI,CAC3BE,SAAS,IAAMA,SAAS,KAAKH,MAChC,CAAC,EACA;QACDI,aAAa,CAAEN,UAAU,EAAEN,UAAU,EAAED,UAAW,CAAC;QACnDC,UAAU,EAAE;MACb;MAEAE,QAAQ,EAAE;MAEV,OACCI,UAAU,CAAEJ,QAAQ,CAAE,EAAEO,IAAI,CACzBE,SAAS,IAAMA,SAAS,KAAKH,MAChC,CAAC,EACA;QACDI,aAAa,CAAEN,UAAU,EAAEJ,QAAQ,EAAEH,UAAW,CAAC;QACjDG,QAAQ,EAAE;MACX;IACD;EACD,CAAC,MAAM;IACN,KAAM,IAAIW,CAAC,GAAGb,UAAU,EAAEa,CAAC,GAAGX,QAAQ,EAAEW,CAAC,EAAE,EAAG;MAC7C,IAAKP,UAAU,CAAEO,CAAC,CAAE,EAAG;QACtBD,aAAa,CAAEN,UAAU,EAAEO,CAAC,EAAEd,UAAW,CAAC;MAC3C;IACD;EACD;EAEA,OAAOH,gBAAgB,CAAE;IACxB,GAAGE,KAAK;IACRM,OAAO,EAAEE,UAAU;IACnBD,aAAa,EACZA,aAAa,EAAES,MAAM,CAAE,CAAE;MAAEJ;IAAK,CAAC,KAAMA,IAAI,KAAKX,UAAW,CAAC,IAAI;EAClE,CAAE,CAAC;AACJ;AAEA,SAASa,aAAaA,CAAER,OAAO,EAAEW,KAAK,EAAEhB,UAAU,EAAG;EACpD,MAAMO,UAAU,GAAGF,OAAO,CAAEW,KAAK,CAAE,CAACD,MAAM,CACzC,CAAE;IAAEJ;EAAK,CAAC,KAAMA,IAAI,KAAKX,UAC1B,CAAC;EAED,IAAKO,UAAU,CAACU,MAAM,EAAG;IACxBZ,OAAO,CAAEW,KAAK,CAAE,GAAGT,UAAU;EAC9B,CAAC,MAAM;IACN,OAAOF,OAAO,CAAEW,KAAK,CAAE;EACxB;AACD","ignoreList":[]}