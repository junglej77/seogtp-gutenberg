{"version":3,"names":["createBrowserHistory","buildQueryString","history","originalHistoryPush","push","originalHistoryReplace","replace","preserveThemePreview","params","hasOwnProperty","currentSearch","URLSearchParams","location","search","currentThemePreview","get","wp_theme_preview","state","call","locationMemo","WeakMap","getLocationWithParams","locationWithParams","Object","fromEntries","set"],"sources":["@wordpress/router/src/history.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport { createBrowserHistory } from 'history';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { buildQueryString } from '@wordpress/url';\r\n\r\nconst history = createBrowserHistory();\r\n\r\nconst originalHistoryPush = history.push;\r\nconst originalHistoryReplace = history.replace;\r\n\r\n// Preserve the `wp_theme_preview` query parameter when navigating\r\n// around the Site Editor.\r\n// TODO: move this hack out of the router into Site Editor code.\r\nfunction preserveThemePreview( params ) {\r\n\tif ( params.hasOwnProperty( 'wp_theme_preview' ) ) {\r\n\t\treturn params;\r\n\t}\r\n\tconst currentSearch = new URLSearchParams( history.location.search );\r\n\tconst currentThemePreview = currentSearch.get( 'wp_theme_preview' );\r\n\tif ( currentThemePreview === null ) {\r\n\t\treturn params;\r\n\t}\r\n\treturn { ...params, wp_theme_preview: currentThemePreview };\r\n}\r\n\r\nfunction push( params, state ) {\r\n\tconst search = buildQueryString( preserveThemePreview( params ) );\r\n\treturn originalHistoryPush.call( history, { search }, state );\r\n}\r\n\r\nfunction replace( params, state ) {\r\n\tconst search = buildQueryString( preserveThemePreview( params ) );\r\n\treturn originalHistoryReplace.call( history, { search }, state );\r\n}\r\n\r\nconst locationMemo = new WeakMap();\r\nfunction getLocationWithParams() {\r\n\tconst location = history.location;\r\n\tlet locationWithParams = locationMemo.get( location );\r\n\tif ( ! locationWithParams ) {\r\n\t\tlocationWithParams = {\r\n\t\t\t...location,\r\n\t\t\tparams: Object.fromEntries(\r\n\t\t\t\tnew URLSearchParams( location.search )\r\n\t\t\t),\r\n\t\t};\r\n\t\tlocationMemo.set( location, locationWithParams );\r\n\t}\r\n\treturn locationWithParams;\r\n}\r\n\r\nhistory.push = push;\r\nhistory.replace = replace;\r\nhistory.getLocationWithParams = getLocationWithParams;\r\n\r\nexport default history;\r\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,oBAAoB,QAAQ,SAAS;;AAE9C;AACA;AACA;AACA,SAASC,gBAAgB,QAAQ,gBAAgB;AAEjD,MAAMC,OAAO,GAAGF,oBAAoB,CAAC,CAAC;AAEtC,MAAMG,mBAAmB,GAAGD,OAAO,CAACE,IAAI;AACxC,MAAMC,sBAAsB,GAAGH,OAAO,CAACI,OAAO;;AAE9C;AACA;AACA;AACA,SAASC,oBAAoBA,CAAEC,MAAM,EAAG;EACvC,IAAKA,MAAM,CAACC,cAAc,CAAE,kBAAmB,CAAC,EAAG;IAClD,OAAOD,MAAM;EACd;EACA,MAAME,aAAa,GAAG,IAAIC,eAAe,CAAET,OAAO,CAACU,QAAQ,CAACC,MAAO,CAAC;EACpE,MAAMC,mBAAmB,GAAGJ,aAAa,CAACK,GAAG,CAAE,kBAAmB,CAAC;EACnE,IAAKD,mBAAmB,KAAK,IAAI,EAAG;IACnC,OAAON,MAAM;EACd;EACA,OAAO;IAAE,GAAGA,MAAM;IAAEQ,gBAAgB,EAAEF;EAAoB,CAAC;AAC5D;AAEA,SAASV,IAAIA,CAAEI,MAAM,EAAES,KAAK,EAAG;EAC9B,MAAMJ,MAAM,GAAGZ,gBAAgB,CAAEM,oBAAoB,CAAEC,MAAO,CAAE,CAAC;EACjE,OAAOL,mBAAmB,CAACe,IAAI,CAAEhB,OAAO,EAAE;IAAEW;EAAO,CAAC,EAAEI,KAAM,CAAC;AAC9D;AAEA,SAASX,OAAOA,CAAEE,MAAM,EAAES,KAAK,EAAG;EACjC,MAAMJ,MAAM,GAAGZ,gBAAgB,CAAEM,oBAAoB,CAAEC,MAAO,CAAE,CAAC;EACjE,OAAOH,sBAAsB,CAACa,IAAI,CAAEhB,OAAO,EAAE;IAAEW;EAAO,CAAC,EAAEI,KAAM,CAAC;AACjE;AAEA,MAAME,YAAY,GAAG,IAAIC,OAAO,CAAC,CAAC;AAClC,SAASC,qBAAqBA,CAAA,EAAG;EAChC,MAAMT,QAAQ,GAAGV,OAAO,CAACU,QAAQ;EACjC,IAAIU,kBAAkB,GAAGH,YAAY,CAACJ,GAAG,CAAEH,QAAS,CAAC;EACrD,IAAK,CAAEU,kBAAkB,EAAG;IAC3BA,kBAAkB,GAAG;MACpB,GAAGV,QAAQ;MACXJ,MAAM,EAAEe,MAAM,CAACC,WAAW,CACzB,IAAIb,eAAe,CAAEC,QAAQ,CAACC,MAAO,CACtC;IACD,CAAC;IACDM,YAAY,CAACM,GAAG,CAAEb,QAAQ,EAAEU,kBAAmB,CAAC;EACjD;EACA,OAAOA,kBAAkB;AAC1B;AAEApB,OAAO,CAACE,IAAI,GAAGA,IAAI;AACnBF,OAAO,CAACI,OAAO,GAAGA,OAAO;AACzBJ,OAAO,CAACmB,qBAAqB,GAAGA,qBAAqB;AAErD,eAAenB,OAAO","ignoreList":[]}