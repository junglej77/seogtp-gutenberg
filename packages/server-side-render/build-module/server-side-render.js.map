{"version":3,"names":["fastDeepEqual","useDebounce","usePrevious","RawHTML","useEffect","useRef","useState","__","sprintf","apiFetch","addQueryArgs","Placeholder","Spinner","__experimentalSanitizeBlockAttributes","jsx","_jsx","jsxs","_jsxs","EMPTY_OBJECT","rendererPath","block","attributes","urlQueryArgs","context","removeBlockSupportAttributes","backgroundColor","borderColor","fontFamily","fontSize","gradient","textColor","className","restAttributes","border","color","elements","spacing","typography","restStyles","style","DefaultEmptyResponsePlaceholder","children","DefaultErrorResponsePlaceholder","response","errorMessage","errorMsg","DefaultLoadingResponsePlaceholder","showLoader","position","top","left","marginTop","marginLeft","opacity","ServerSideRender","props","httpMethod","skipBlockSupportAttributes","EmptyResponsePlaceholder","ErrorResponsePlaceholder","LoadingResponsePlaceholder","isMountedRef","setShowLoader","fetchRequestRef","setResponse","prevProps","isLoading","setIsLoading","fetchData","_sanitizedAttributes","_sanitizedAttributes2","current","timeout","setTimeout","sanitizedAttributes","isPostRequest","urlAttributes","path","data","fetchRequest","method","then","fetchResponse","rendered","catch","error","message","finally","clearTimeout","debouncedFetchData","undefined","hasResponse","hasEmptyResponse","hasError"],"sources":["@wordpress/server-side-render/src/server-side-render.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport fastDeepEqual from 'fast-deep-equal/es6';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useDebounce, usePrevious } from '@wordpress/compose';\r\nimport { RawHTML, useEffect, useRef, useState } from '@wordpress/element';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport apiFetch from '@wordpress/api-fetch';\r\nimport { addQueryArgs } from '@wordpress/url';\r\nimport { Placeholder, Spinner } from '@wordpress/components';\r\nimport { __experimentalSanitizeBlockAttributes } from '@wordpress/blocks';\r\n\r\nconst EMPTY_OBJECT = {};\r\n\r\nexport function rendererPath( block, attributes = null, urlQueryArgs = {} ) {\r\n\treturn addQueryArgs( `/wp/v2/block-renderer/${ block }`, {\r\n\t\tcontext: 'edit',\r\n\t\t...( null !== attributes ? { attributes } : {} ),\r\n\t\t...urlQueryArgs,\r\n\t} );\r\n}\r\n\r\nexport function removeBlockSupportAttributes( attributes ) {\r\n\tconst {\r\n\t\tbackgroundColor,\r\n\t\tborderColor,\r\n\t\tfontFamily,\r\n\t\tfontSize,\r\n\t\tgradient,\r\n\t\ttextColor,\r\n\t\tclassName,\r\n\t\t...restAttributes\r\n\t} = attributes;\r\n\r\n\tconst { border, color, elements, spacing, typography, ...restStyles } =\r\n\t\tattributes?.style || EMPTY_OBJECT;\r\n\r\n\treturn {\r\n\t\t...restAttributes,\r\n\t\tstyle: restStyles,\r\n\t};\r\n}\r\n\r\nfunction DefaultEmptyResponsePlaceholder( { className } ) {\r\n\treturn (\r\n\t\t<Placeholder className={ className }>\r\n\t\t\t{ __( 'Block rendered as empty.' ) }\r\n\t\t</Placeholder>\r\n\t);\r\n}\r\n\r\nfunction DefaultErrorResponsePlaceholder( { response, className } ) {\r\n\tconst errorMessage = sprintf(\r\n\t\t// translators: %s: error message describing the problem\r\n\t\t__( 'Error loading block: %s' ),\r\n\t\tresponse.errorMsg\r\n\t);\r\n\treturn <Placeholder className={ className }>{ errorMessage }</Placeholder>;\r\n}\r\n\r\nfunction DefaultLoadingResponsePlaceholder( { children, showLoader } ) {\r\n\treturn (\r\n\t\t<div style={ { position: 'relative' } }>\r\n\t\t\t{ showLoader && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tstyle={ {\r\n\t\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\t\ttop: '50%',\r\n\t\t\t\t\t\tleft: '50%',\r\n\t\t\t\t\t\tmarginTop: '-9px',\r\n\t\t\t\t\t\tmarginLeft: '-9px',\r\n\t\t\t\t\t} }\r\n\t\t\t\t>\r\n\t\t\t\t\t<Spinner />\r\n\t\t\t\t</div>\r\n\t\t\t) }\r\n\t\t\t<div style={ { opacity: showLoader ? '0.3' : 1 } }>\r\n\t\t\t\t{ children }\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default function ServerSideRender( props ) {\r\n\tconst {\r\n\t\tattributes,\r\n\t\tblock,\r\n\t\tclassName,\r\n\t\thttpMethod = 'GET',\r\n\t\turlQueryArgs,\r\n\t\tskipBlockSupportAttributes = false,\r\n\t\tEmptyResponsePlaceholder = DefaultEmptyResponsePlaceholder,\r\n\t\tErrorResponsePlaceholder = DefaultErrorResponsePlaceholder,\r\n\t\tLoadingResponsePlaceholder = DefaultLoadingResponsePlaceholder,\r\n\t} = props;\r\n\r\n\tconst isMountedRef = useRef( false );\r\n\tconst [ showLoader, setShowLoader ] = useState( false );\r\n\tconst fetchRequestRef = useRef();\r\n\tconst [ response, setResponse ] = useState( null );\r\n\tconst prevProps = usePrevious( props );\r\n\tconst [ isLoading, setIsLoading ] = useState( false );\r\n\r\n\tfunction fetchData() {\r\n\t\tif ( ! isMountedRef.current ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsLoading( true );\r\n\r\n\t\t// Schedule showing the Spinner after 1 second.\r\n\t\tconst timeout = setTimeout( () => {\r\n\t\t\tsetShowLoader( true );\r\n\t\t}, 1000 );\r\n\r\n\t\tlet sanitizedAttributes =\r\n\t\t\tattributes &&\r\n\t\t\t__experimentalSanitizeBlockAttributes( block, attributes );\r\n\r\n\t\tif ( skipBlockSupportAttributes ) {\r\n\t\t\tsanitizedAttributes =\r\n\t\t\t\tremoveBlockSupportAttributes( sanitizedAttributes );\r\n\t\t}\r\n\r\n\t\t// If httpMethod is 'POST', send the attributes in the request body instead of the URL.\r\n\t\t// This allows sending a larger attributes object than in a GET request, where the attributes are in the URL.\r\n\t\tconst isPostRequest = 'POST' === httpMethod;\r\n\t\tconst urlAttributes = isPostRequest\r\n\t\t\t? null\r\n\t\t\t: sanitizedAttributes ?? null;\r\n\t\tconst path = rendererPath( block, urlAttributes, urlQueryArgs );\r\n\t\tconst data = isPostRequest\r\n\t\t\t? { attributes: sanitizedAttributes ?? null }\r\n\t\t\t: null;\r\n\r\n\t\t// Store the latest fetch request so that when we process it, we can\r\n\t\t// check if it is the current request, to avoid race conditions on slow networks.\r\n\t\tconst fetchRequest = ( fetchRequestRef.current = apiFetch( {\r\n\t\t\tpath,\r\n\t\t\tdata,\r\n\t\t\tmethod: isPostRequest ? 'POST' : 'GET',\r\n\t\t} )\r\n\t\t\t.then( ( fetchResponse ) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tisMountedRef.current &&\r\n\t\t\t\t\tfetchRequest === fetchRequestRef.current &&\r\n\t\t\t\t\tfetchResponse\r\n\t\t\t\t) {\r\n\t\t\t\t\tsetResponse( fetchResponse.rendered );\r\n\t\t\t\t}\r\n\t\t\t} )\r\n\t\t\t.catch( ( error ) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tisMountedRef.current &&\r\n\t\t\t\t\tfetchRequest === fetchRequestRef.current\r\n\t\t\t\t) {\r\n\t\t\t\t\tsetResponse( {\r\n\t\t\t\t\t\terror: true,\r\n\t\t\t\t\t\terrorMsg: error.message,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} )\r\n\t\t\t.finally( () => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tisMountedRef.current &&\r\n\t\t\t\t\tfetchRequest === fetchRequestRef.current\r\n\t\t\t\t) {\r\n\t\t\t\t\tsetIsLoading( false );\r\n\t\t\t\t\t// Cancel the timeout to show the Spinner.\r\n\t\t\t\t\tsetShowLoader( false );\r\n\t\t\t\t\tclearTimeout( timeout );\r\n\t\t\t\t}\r\n\t\t\t} ) );\r\n\r\n\t\treturn fetchRequest;\r\n\t}\r\n\r\n\tconst debouncedFetchData = useDebounce( fetchData, 500 );\r\n\r\n\t// When the component unmounts, set isMountedRef to false. This will\r\n\t// let the async fetch callbacks know when to stop.\r\n\tuseEffect( () => {\r\n\t\tisMountedRef.current = true;\r\n\t\treturn () => {\r\n\t\t\tisMountedRef.current = false;\r\n\t\t};\r\n\t}, [] );\r\n\r\n\tuseEffect( () => {\r\n\t\t// Don't debounce the first fetch. This ensures that the first render\r\n\t\t// shows data as soon as possible.\r\n\t\tif ( prevProps === undefined ) {\r\n\t\t\tfetchData();\r\n\t\t} else if ( ! fastDeepEqual( prevProps, props ) ) {\r\n\t\t\tdebouncedFetchData();\r\n\t\t}\r\n\t} );\r\n\r\n\tconst hasResponse = !! response;\r\n\tconst hasEmptyResponse = response === '';\r\n\tconst hasError = response?.error;\r\n\r\n\tif ( isLoading ) {\r\n\t\treturn (\r\n\t\t\t<LoadingResponsePlaceholder { ...props } showLoader={ showLoader }>\r\n\t\t\t\t{ hasResponse && (\r\n\t\t\t\t\t<RawHTML className={ className }>{ response }</RawHTML>\r\n\t\t\t\t) }\r\n\t\t\t</LoadingResponsePlaceholder>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( hasEmptyResponse || ! hasResponse ) {\r\n\t\treturn <EmptyResponsePlaceholder { ...props } />;\r\n\t}\r\n\r\n\tif ( hasError ) {\r\n\t\treturn <ErrorResponsePlaceholder response={ response } { ...props } />;\r\n\t}\r\n\r\n\treturn <RawHTML className={ className }>{ response }</RawHTML>;\r\n}\r\n"],"mappings":"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","ignoreList":[]}