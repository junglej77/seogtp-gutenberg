{"version":3,"names":["paramCase","kebabCase","VARIABLE_REFERENCE_PREFIX","VARIABLE_PATH_SEPARATOR_TOKEN_ATTRIBUTE","VARIABLE_PATH_SEPARATOR_TOKEN_STYLE","getStyleValueByPath","object","path","value","forEach","fieldName","generateRule","style","options","ruleKey","styleValue","selector","key","getCSSValueFromRawStyle","generateBoxRules","ruleKeys","individualProperties","boxStyle","rules","push","default","sideRules","reduce","acc","side","individual","replace","upperFirst","startsWith","variable","slice","length","split","map","presetVariable","splitRegexp","join","string","firstLetter","rest","toUpperCase","camelCaseJoin","strings","firstItem","toLowerCase","safeDecodeURI","uri","decodeURI","uriError"],"sources":["@wordpress/style-engine/src/styles/utils.ts"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport { paramCase as kebabCase } from 'change-case';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport type {\r\n\tCssRulesKeys,\r\n\tGeneratedCSSRule,\r\n\tStyle,\r\n\tBox,\r\n\tStyleOptions,\r\n} from '../types';\r\nimport {\r\n\tVARIABLE_REFERENCE_PREFIX,\r\n\tVARIABLE_PATH_SEPARATOR_TOKEN_ATTRIBUTE,\r\n\tVARIABLE_PATH_SEPARATOR_TOKEN_STYLE,\r\n} from './constants';\r\n\r\n/**\r\n * Helper util to return a value from a certain path of the object.\r\n * Path is specified as an array of properties, like `[ 'x', 'y' ]`.\r\n *\r\n * @param object Input object.\r\n * @param path   Path to the object property.\r\n * @return Value of the object property at the specified path.\r\n */\r\nexport const getStyleValueByPath = (\r\n\tobject: Record< any, any >,\r\n\tpath: string[]\r\n) => {\r\n\tlet value: any = object;\r\n\tpath.forEach( ( fieldName: string ) => {\r\n\t\tvalue = value?.[ fieldName ];\r\n\t} );\r\n\treturn value;\r\n};\r\n\r\n/**\r\n * Returns a JSON representation of the generated CSS rules.\r\n *\r\n * @param style   Style object.\r\n * @param options Options object with settings to adjust how the styles are generated.\r\n * @param path    An array of strings representing the path to the style value in the style object.\r\n * @param ruleKey A CSS property key.\r\n *\r\n * @return GeneratedCSSRule[] CSS rules.\r\n */\r\nexport function generateRule(\r\n\tstyle: Style,\r\n\toptions: StyleOptions,\r\n\tpath: string[],\r\n\truleKey: string\r\n): GeneratedCSSRule[] {\r\n\tconst styleValue: string | undefined = getStyleValueByPath( style, path );\r\n\r\n\treturn styleValue\r\n\t\t? [\r\n\t\t\t\t{\r\n\t\t\t\t\tselector: options?.selector,\r\n\t\t\t\t\tkey: ruleKey,\r\n\t\t\t\t\tvalue: getCSSValueFromRawStyle( styleValue ),\r\n\t\t\t\t},\r\n\t\t  ]\r\n\t\t: [];\r\n}\r\n\r\n/**\r\n * Returns a JSON representation of the generated CSS rules taking into account box model properties, top, right, bottom, left.\r\n *\r\n * @param style                Style object.\r\n * @param options              Options object with settings to adjust how the styles are generated.\r\n * @param path                 An array of strings representing the path to the style value in the style object.\r\n * @param ruleKeys             An array of CSS property keys and patterns.\r\n * @param individualProperties The \"sides\" or individual properties for which to generate rules.\r\n *\r\n * @return GeneratedCSSRule[]  CSS rules.\r\n */\r\nexport function generateBoxRules(\r\n\tstyle: Style,\r\n\toptions: StyleOptions,\r\n\tpath: string[],\r\n\truleKeys: CssRulesKeys,\r\n\tindividualProperties: string[] = [ 'top', 'right', 'bottom', 'left' ]\r\n): GeneratedCSSRule[] {\r\n\tconst boxStyle: Box | string | undefined = getStyleValueByPath(\r\n\t\tstyle,\r\n\t\tpath\r\n\t);\r\n\tif ( ! boxStyle ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst rules: GeneratedCSSRule[] = [];\r\n\tif ( typeof boxStyle === 'string' ) {\r\n\t\trules.push( {\r\n\t\t\tselector: options?.selector,\r\n\t\t\tkey: ruleKeys.default,\r\n\t\t\tvalue: boxStyle,\r\n\t\t} );\r\n\t} else {\r\n\t\tconst sideRules = individualProperties.reduce(\r\n\t\t\t( acc: GeneratedCSSRule[], side: string ) => {\r\n\t\t\t\tconst value = getCSSValueFromRawStyle(\r\n\t\t\t\t\tgetStyleValueByPath( boxStyle, [ side ] )\r\n\t\t\t\t);\r\n\t\t\t\tif ( value ) {\r\n\t\t\t\t\tacc.push( {\r\n\t\t\t\t\t\tselector: options?.selector,\r\n\t\t\t\t\t\tkey: ruleKeys?.individual.replace(\r\n\t\t\t\t\t\t\t'%s',\r\n\t\t\t\t\t\t\tupperFirst( side )\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t},\r\n\t\t\t[]\r\n\t\t);\r\n\t\trules.push( ...sideRules );\r\n\t}\r\n\r\n\treturn rules;\r\n}\r\n\r\n/**\r\n * Returns a WordPress CSS custom var value from incoming style preset value,\r\n * if one is detected.\r\n *\r\n * The preset value is a string and follows the pattern `var:description|context|slug`.\r\n *\r\n * Example:\r\n *\r\n * `getCSSValueFromRawStyle( 'var:preset|color|heavenlyBlue' )` // returns 'var(--wp--preset--color--heavenly-blue)'\r\n *\r\n * @param styleValue A string representing a raw CSS value. Non-strings won't be processed.\r\n *\r\n * @return A CSS custom var value if the incoming style value is a preset value.\r\n */\r\n\r\nexport function getCSSValueFromRawStyle< StyleValue = string >(\r\n\tstyleValue: StyleValue\r\n): StyleValue {\r\n\tif (\r\n\t\ttypeof styleValue === 'string' &&\r\n\t\tstyleValue.startsWith( VARIABLE_REFERENCE_PREFIX )\r\n\t) {\r\n\t\tconst variable = styleValue\r\n\t\t\t.slice( VARIABLE_REFERENCE_PREFIX.length )\r\n\t\t\t.split( VARIABLE_PATH_SEPARATOR_TOKEN_ATTRIBUTE )\r\n\t\t\t.map( ( presetVariable ) =>\r\n\t\t\t\tkebabCase( presetVariable, {\r\n\t\t\t\t\tsplitRegexp: [\r\n\t\t\t\t\t\t/([a-z0-9])([A-Z])/g, // fooBar => foo-bar, 3Bar => 3-bar\r\n\t\t\t\t\t\t/([0-9])([a-z])/g, // 3bar => 3-bar\r\n\t\t\t\t\t\t/([A-Za-z])([0-9])/g, // Foo3 => foo-3, foo3 => foo-3\r\n\t\t\t\t\t\t/([A-Z])([A-Z][a-z])/g, // FOOBar => foo-bar\r\n\t\t\t\t\t],\r\n\t\t\t\t} )\r\n\t\t\t)\r\n\t\t\t.join( VARIABLE_PATH_SEPARATOR_TOKEN_STYLE );\r\n\t\treturn `var(--wp--${ variable })` as StyleValue;\r\n\t}\r\n\treturn styleValue;\r\n}\r\n\r\n/**\r\n * Capitalizes the first letter in a string.\r\n *\r\n * @param string The string whose first letter the function will capitalize.\r\n *\r\n * @return String with the first letter capitalized.\r\n */\r\nexport function upperFirst( string: string ): string {\r\n\tconst [ firstLetter, ...rest ] = string;\r\n\treturn firstLetter.toUpperCase() + rest.join( '' );\r\n}\r\n\r\n/**\r\n * Converts an array of strings into a camelCase string.\r\n *\r\n * @param strings The strings to join into a camelCase string.\r\n *\r\n * @return camelCase string.\r\n */\r\nexport function camelCaseJoin( strings: string[] ): string {\r\n\tconst [ firstItem, ...rest ] = strings;\r\n\treturn firstItem.toLowerCase() + rest.map( upperFirst ).join( '' );\r\n}\r\n\r\n/**\r\n * Safely decodes a URI with `decodeURI`. Returns the URI unmodified if\r\n * `decodeURI` throws an error.\r\n *\r\n * @param {string} uri URI to decode.\r\n *\r\n * @example\r\n * ```js\r\n * const badUri = safeDecodeURI( '%z' ); // does not throw an Error, simply returns '%z'\r\n * ```\r\n *\r\n * @return {string} Decoded URI if possible.\r\n */\r\nexport function safeDecodeURI( uri: string ): string {\r\n\ttry {\r\n\t\treturn decodeURI( uri );\r\n\t} catch ( uriError ) {\r\n\t\treturn uri;\r\n\t}\r\n}\r\n"],"mappings":"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","ignoreList":[]}