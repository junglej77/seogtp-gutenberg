{"version":3,"names":["apiFetch","debounce","__","Control","constructor","id","idBase","instance","onChangeInstance","onChangeHasPreview","onError","_instance","_hasPreview","number","lastNumber","handleFormChange","bind","handleFormSubmit","initDOM","bindEvents","loadContent","destroy","unbindEvents","element","remove","_this$id","_this$idBase","el","class","form","method","type","name","value","toString","content","window","jQuery","$","on","addEventListener","off","removeEventListener","saveWidget","innerHTML","preview","encodeWidget","hasPreview","isEmptyHTML","hash","formData","serializeForm","document","trigger","error","saveForm","event","preventDefault","tagName","attributes","createElement","attribute","Object","entries","setAttribute","Array","isArray","child","appendChild","innerText","widget","path","data","form_data","rendered_form","response","html","isEmptyNode","node","nodeType","TEXT_NODE","nodeValue","trim","ELEMENT_NODE","includes","hasChildNodes","from","childNodes","every","URLSearchParams","FormData"],"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/control.js"],"sourcesContent":["/**\r\n * WordPress dependencies\r\n */\r\nimport apiFetch from '@wordpress/api-fetch';\r\nimport { debounce } from '@wordpress/compose';\r\nimport { __ } from '@wordpress/i18n';\r\n\r\n/**\r\n * An API for creating and loading a widget control (a <div class=\"widget\">\r\n * element) that is compatible with most third party widget scripts. By not\r\n * using React for this, we ensure that we have complete contorl over the DOM\r\n * and do not accidentally remove any elements that a third party widget script\r\n * has attached an event listener to.\r\n *\r\n * @property {Element} element The control's DOM element.\r\n */\r\nexport default class Control {\r\n\t/**\r\n\t * Creates and loads a new control.\r\n\t *\r\n\t * @access public\r\n\t * @param {Object}   params\r\n\t * @param {string}   params.id\r\n\t * @param {string}   params.idBase\r\n\t * @param {Object}   params.instance\r\n\t * @param {Function} params.onChangeInstance\r\n\t * @param {Function} params.onChangeHasPreview\r\n\t * @param {Function} params.onError\r\n\t */\r\n\tconstructor( {\r\n\t\tid,\r\n\t\tidBase,\r\n\t\tinstance,\r\n\t\tonChangeInstance,\r\n\t\tonChangeHasPreview,\r\n\t\tonError,\r\n\t} ) {\r\n\t\tthis.id = id;\r\n\t\tthis.idBase = idBase;\r\n\t\tthis._instance = instance;\r\n\t\tthis._hasPreview = null;\r\n\t\tthis.onChangeInstance = onChangeInstance;\r\n\t\tthis.onChangeHasPreview = onChangeHasPreview;\r\n\t\tthis.onError = onError;\r\n\r\n\t\t// We can't use the real widget number as this is calculated by the\r\n\t\t// server and we may not ever *actually* save this widget. Instead, use\r\n\t\t// a fake but unique number.\r\n\t\tthis.number = ++lastNumber;\r\n\r\n\t\tthis.handleFormChange = debounce(\r\n\t\t\tthis.handleFormChange.bind( this ),\r\n\t\t\t200\r\n\t\t);\r\n\t\tthis.handleFormSubmit = this.handleFormSubmit.bind( this );\r\n\r\n\t\tthis.initDOM();\r\n\t\tthis.bindEvents();\r\n\t\tthis.loadContent();\r\n\t}\r\n\r\n\t/**\r\n\t * Clean up the control so that it can be garabge collected.\r\n\t *\r\n\t * @access public\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.unbindEvents();\r\n\t\tthis.element.remove();\r\n\t\t// TODO: How do we make third party widget scripts remove their event\r\n\t\t// listeners?\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the control's DOM structure.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tinitDOM() {\r\n\t\tthis.element = el( 'div', { class: 'widget open' }, [\r\n\t\t\tel( 'div', { class: 'widget-inside' }, [\r\n\t\t\t\t( this.form = el( 'form', { class: 'form', method: 'post' }, [\r\n\t\t\t\t\t// These hidden form inputs are what most widgets' scripts\r\n\t\t\t\t\t// use to access data about the widget.\r\n\t\t\t\t\tel( 'input', {\r\n\t\t\t\t\t\tclass: 'widget-id',\r\n\t\t\t\t\t\ttype: 'hidden',\r\n\t\t\t\t\t\tname: 'widget-id',\r\n\t\t\t\t\t\tvalue: this.id ?? `${ this.idBase }-${ this.number }`,\r\n\t\t\t\t\t} ),\r\n\t\t\t\t\tel( 'input', {\r\n\t\t\t\t\t\tclass: 'id_base',\r\n\t\t\t\t\t\ttype: 'hidden',\r\n\t\t\t\t\t\tname: 'id_base',\r\n\t\t\t\t\t\tvalue: this.idBase ?? this.id,\r\n\t\t\t\t\t} ),\r\n\t\t\t\t\tel( 'input', {\r\n\t\t\t\t\t\tclass: 'widget-width',\r\n\t\t\t\t\t\ttype: 'hidden',\r\n\t\t\t\t\t\tname: 'widget-width',\r\n\t\t\t\t\t\tvalue: '250',\r\n\t\t\t\t\t} ),\r\n\t\t\t\t\tel( 'input', {\r\n\t\t\t\t\t\tclass: 'widget-height',\r\n\t\t\t\t\t\ttype: 'hidden',\r\n\t\t\t\t\t\tname: 'widget-height',\r\n\t\t\t\t\t\tvalue: '200',\r\n\t\t\t\t\t} ),\r\n\t\t\t\t\tel( 'input', {\r\n\t\t\t\t\t\tclass: 'widget_number',\r\n\t\t\t\t\t\ttype: 'hidden',\r\n\t\t\t\t\t\tname: 'widget_number',\r\n\t\t\t\t\t\tvalue: this.idBase ? this.number.toString() : '',\r\n\t\t\t\t\t} ),\r\n\t\t\t\t\t( this.content = el( 'div', { class: 'widget-content' } ) ),\r\n\t\t\t\t\t// Non-multi widgets can be saved via a Save button.\r\n\t\t\t\t\tthis.id &&\r\n\t\t\t\t\t\tel(\r\n\t\t\t\t\t\t\t'button',\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tclass: 'button is-primary',\r\n\t\t\t\t\t\t\t\ttype: 'submit',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t__( 'Save' )\r\n\t\t\t\t\t\t),\r\n\t\t\t\t] ) ),\r\n\t\t\t] ),\r\n\t\t] );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds the control's event listeners.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tbindEvents() {\r\n\t\t// Prefer jQuery 'change' event instead of the native 'change' event\r\n\t\t// because many widgets use jQuery's event bus to trigger an update.\r\n\t\tif ( window.jQuery ) {\r\n\t\t\tconst { jQuery: $ } = window;\r\n\t\t\t$( this.form ).on( 'change', null, this.handleFormChange );\r\n\t\t\t$( this.form ).on( 'input', null, this.handleFormChange );\r\n\t\t\t$( this.form ).on( 'submit', this.handleFormSubmit );\r\n\t\t} else {\r\n\t\t\tthis.form.addEventListener( 'change', this.handleFormChange );\r\n\t\t\tthis.form.addEventListener( 'input', this.handleFormChange );\r\n\t\t\tthis.form.addEventListener( 'submit', this.handleFormSubmit );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the control's event listeners.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tunbindEvents() {\r\n\t\tif ( window.jQuery ) {\r\n\t\t\tconst { jQuery: $ } = window;\r\n\t\t\t$( this.form ).off( 'change', null, this.handleFormChange );\r\n\t\t\t$( this.form ).off( 'input', null, this.handleFormChange );\r\n\t\t\t$( this.form ).off( 'submit', this.handleFormSubmit );\r\n\t\t} else {\r\n\t\t\tthis.form.removeEventListener( 'change', this.handleFormChange );\r\n\t\t\tthis.form.removeEventListener( 'input', this.handleFormChange );\r\n\t\t\tthis.form.removeEventListener( 'submit', this.handleFormSubmit );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Fetches the widget's form HTML from the REST API and loads it into the\r\n\t * control's form.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tasync loadContent() {\r\n\t\ttry {\r\n\t\t\tif ( this.id ) {\r\n\t\t\t\tconst { form } = await saveWidget( this.id );\r\n\t\t\t\tthis.content.innerHTML = form;\r\n\t\t\t} else if ( this.idBase ) {\r\n\t\t\t\tconst { form, preview } = await encodeWidget( {\r\n\t\t\t\t\tidBase: this.idBase,\r\n\t\t\t\t\tinstance: this.instance,\r\n\t\t\t\t\tnumber: this.number,\r\n\t\t\t\t} );\r\n\t\t\t\tthis.content.innerHTML = form;\r\n\t\t\t\tthis.hasPreview = ! isEmptyHTML( preview );\r\n\r\n\t\t\t\t// If we don't have an instance, perform a save right away. This\r\n\t\t\t\t// happens when creating a new Legacy Widget block.\r\n\t\t\t\tif ( ! this.instance.hash ) {\r\n\t\t\t\t\tconst { instance } = await encodeWidget( {\r\n\t\t\t\t\t\tidBase: this.idBase,\r\n\t\t\t\t\t\tinstance: this.instance,\r\n\t\t\t\t\t\tnumber: this.number,\r\n\t\t\t\t\t\tformData: serializeForm( this.form ),\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tthis.instance = instance;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Trigger 'widget-added' when widget is ready. This event is what\r\n\t\t\t// widgets' scripts use to initialize, attach events, etc. The event\r\n\t\t\t// must be fired using jQuery's event bus as this is what widget\r\n\t\t\t// scripts expect. If jQuery is not loaded, do nothing - some\r\n\t\t\t// widgets will still work regardless.\r\n\t\t\tif ( window.jQuery ) {\r\n\t\t\t\tconst { jQuery: $ } = window;\r\n\t\t\t\t$( document ).trigger( 'widget-added', [ $( this.element ) ] );\r\n\t\t\t}\r\n\t\t} catch ( error ) {\r\n\t\t\tthis.onError( error );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Perform a save when a multi widget's form is changed. Non-multi widgets\r\n\t * are saved manually.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\thandleFormChange() {\r\n\t\tif ( this.idBase ) {\r\n\t\t\tthis.saveForm();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Perform a save when the control's form is manually submitted.\r\n\t *\r\n\t * @access private\r\n\t * @param {Event} event\r\n\t */\r\n\thandleFormSubmit( event ) {\r\n\t\tevent.preventDefault();\r\n\t\tthis.saveForm();\r\n\t}\r\n\r\n\t/**\r\n\t * Serialize the control's form, send it to the REST API, and update the\r\n\t * instance with the encoded instance that the REST API returns.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tasync saveForm() {\r\n\t\tconst formData = serializeForm( this.form );\r\n\r\n\t\ttry {\r\n\t\t\tif ( this.id ) {\r\n\t\t\t\tconst { form } = await saveWidget( this.id, formData );\r\n\t\t\t\tthis.content.innerHTML = form;\r\n\r\n\t\t\t\tif ( window.jQuery ) {\r\n\t\t\t\t\tconst { jQuery: $ } = window;\r\n\t\t\t\t\t$( document ).trigger( 'widget-updated', [\r\n\t\t\t\t\t\t$( this.element ),\r\n\t\t\t\t\t] );\r\n\t\t\t\t}\r\n\t\t\t} else if ( this.idBase ) {\r\n\t\t\t\tconst { instance, preview } = await encodeWidget( {\r\n\t\t\t\t\tidBase: this.idBase,\r\n\t\t\t\t\tinstance: this.instance,\r\n\t\t\t\t\tnumber: this.number,\r\n\t\t\t\t\tformData,\r\n\t\t\t\t} );\r\n\t\t\t\tthis.instance = instance;\r\n\t\t\t\tthis.hasPreview = ! isEmptyHTML( preview );\r\n\t\t\t}\r\n\t\t} catch ( error ) {\r\n\t\t\tthis.onError( error );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The widget's instance object.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tget instance() {\r\n\t\treturn this._instance;\r\n\t}\r\n\r\n\t/**\r\n\t * The widget's instance object.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tset instance( instance ) {\r\n\t\tif ( this._instance !== instance ) {\r\n\t\t\tthis._instance = instance;\r\n\t\t\tthis.onChangeInstance( instance );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Whether or not the widget can be previewed.\r\n\t *\r\n\t * @access public\r\n\t */\r\n\tget hasPreview() {\r\n\t\treturn this._hasPreview;\r\n\t}\r\n\r\n\t/**\r\n\t * Whether or not the widget can be previewed.\r\n\t *\r\n\t * @access private\r\n\t */\r\n\tset hasPreview( hasPreview ) {\r\n\t\tif ( this._hasPreview !== hasPreview ) {\r\n\t\t\tthis._hasPreview = hasPreview;\r\n\t\t\tthis.onChangeHasPreview( hasPreview );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet lastNumber = 0;\r\n\r\nfunction el( tagName, attributes = {}, content = null ) {\r\n\tconst element = document.createElement( tagName );\r\n\tfor ( const [ attribute, value ] of Object.entries( attributes ) ) {\r\n\t\telement.setAttribute( attribute, value );\r\n\t}\r\n\tif ( Array.isArray( content ) ) {\r\n\t\tfor ( const child of content ) {\r\n\t\t\tif ( child ) {\r\n\t\t\t\telement.appendChild( child );\r\n\t\t\t}\r\n\t\t}\r\n\t} else if ( typeof content === 'string' ) {\r\n\t\telement.innerText = content;\r\n\t}\r\n\treturn element;\r\n}\r\n\r\nasync function saveWidget( id, formData = null ) {\r\n\tlet widget;\r\n\tif ( formData ) {\r\n\t\twidget = await apiFetch( {\r\n\t\t\tpath: `/wp/v2/widgets/${ id }?context=edit`,\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tdata: {\r\n\t\t\t\tform_data: formData,\r\n\t\t\t},\r\n\t\t} );\r\n\t} else {\r\n\t\twidget = await apiFetch( {\r\n\t\t\tpath: `/wp/v2/widgets/${ id }?context=edit`,\r\n\t\t\tmethod: 'GET',\r\n\t\t} );\r\n\t}\r\n\treturn { form: widget.rendered_form };\r\n}\r\n\r\nasync function encodeWidget( { idBase, instance, number, formData = null } ) {\r\n\tconst response = await apiFetch( {\r\n\t\tpath: `/wp/v2/widget-types/${ idBase }/encode`,\r\n\t\tmethod: 'POST',\r\n\t\tdata: {\r\n\t\t\tinstance,\r\n\t\t\tnumber,\r\n\t\t\tform_data: formData,\r\n\t\t},\r\n\t} );\r\n\treturn {\r\n\t\tinstance: response.instance,\r\n\t\tform: response.form,\r\n\t\tpreview: response.preview,\r\n\t};\r\n}\r\n\r\nfunction isEmptyHTML( html ) {\r\n\tconst element = document.createElement( 'div' );\r\n\telement.innerHTML = html;\r\n\treturn isEmptyNode( element );\r\n}\r\n\r\nfunction isEmptyNode( node ) {\r\n\tswitch ( node.nodeType ) {\r\n\t\tcase node.TEXT_NODE:\r\n\t\t\t// Text nodes are empty if it's entirely whitespace.\r\n\t\t\treturn node.nodeValue.trim() === '';\r\n\t\tcase node.ELEMENT_NODE:\r\n\t\t\t// Elements that are \"embedded content\" are not empty.\r\n\t\t\t// https://dev.w3.org/html5/spec-LC/content-models.html#embedded-content-0\r\n\t\t\tif (\r\n\t\t\t\t[\r\n\t\t\t\t\t'AUDIO',\r\n\t\t\t\t\t'CANVAS',\r\n\t\t\t\t\t'EMBED',\r\n\t\t\t\t\t'IFRAME',\r\n\t\t\t\t\t'IMG',\r\n\t\t\t\t\t'MATH',\r\n\t\t\t\t\t'OBJECT',\r\n\t\t\t\t\t'SVG',\r\n\t\t\t\t\t'VIDEO',\r\n\t\t\t\t].includes( node.tagName )\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// Elements with no children are empty.\r\n\t\t\tif ( ! node.hasChildNodes() ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\t// Elements with children are empty if all their children are empty.\r\n\t\t\treturn Array.from( node.childNodes ).every( isEmptyNode );\r\n\t\tdefault:\r\n\t\t\treturn true;\r\n\t}\r\n}\r\n\r\nfunction serializeForm( form ) {\r\n\treturn new window.URLSearchParams(\r\n\t\tArray.from( new window.FormData( form ) )\r\n\t).toString();\r\n}\r\n"],"mappings":"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","ignoreList":[]}