{"version":3,"names":["clsx","useRef","useEffect","useDispatch","store","noticesStore","__","sprintf","Popover","useViewportMatch","Control","jsx","_jsx","jsxs","_jsxs","Form","title","isVisible","id","idBase","instance","isWide","onChangeInstance","onChangeHasPreview","ref","isMediumLargeViewport","outgoingInstances","Set","incomingInstances","createNotice","current","has","delete","control","nextInstance","add","onError","error","window","console","appendChild","element","destroy","className","children","focusOnMount","placement","offset","resize","flip","shift","hidden"],"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/form.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport { useRef, useEffect } from '@wordpress/element';\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { store as noticesStore } from '@wordpress/notices';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { Popover } from '@wordpress/components';\r\nimport { useViewportMatch } from '@wordpress/compose';\r\n/**\r\n * Internal dependencies\r\n */\r\nimport Control from './control';\r\n\r\nexport default function Form( {\r\n\ttitle,\r\n\tisVisible,\r\n\tid,\r\n\tidBase,\r\n\tinstance,\r\n\tisWide,\r\n\tonChangeInstance,\r\n\tonChangeHasPreview,\r\n} ) {\r\n\tconst ref = useRef();\r\n\r\n\tconst isMediumLargeViewport = useViewportMatch( 'small' );\r\n\r\n\t// We only want to remount the control when the instance changes\r\n\t// *externally*. For example, if the user performs an undo. To do this, we\r\n\t// keep track of changes made to instance by the control itself and then\r\n\t// ignore those.\r\n\tconst outgoingInstances = useRef( new Set() );\r\n\tconst incomingInstances = useRef( new Set() );\r\n\r\n\tconst { createNotice } = useDispatch( noticesStore );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( incomingInstances.current.has( instance ) ) {\r\n\t\t\tincomingInstances.current.delete( instance );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst control = new Control( {\r\n\t\t\tid,\r\n\t\t\tidBase,\r\n\t\t\tinstance,\r\n\t\t\tonChangeInstance( nextInstance ) {\r\n\t\t\t\toutgoingInstances.current.add( instance );\r\n\t\t\t\tincomingInstances.current.add( nextInstance );\r\n\t\t\t\tonChangeInstance( nextInstance );\r\n\t\t\t},\r\n\t\t\tonChangeHasPreview,\r\n\t\t\tonError( error ) {\r\n\t\t\t\twindow.console.error( error );\r\n\t\t\t\tcreateNotice(\r\n\t\t\t\t\t'error',\r\n\t\t\t\t\tsprintf(\r\n\t\t\t\t\t\t/* translators: %s: the name of the affected block. */\r\n\t\t\t\t\t\t__(\r\n\t\t\t\t\t\t\t'The \"%s\" block was affected by errors and may not function properly. Check the developer tools for more details.'\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tidBase || id\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t} );\r\n\r\n\t\tref.current.appendChild( control.element );\r\n\r\n\t\treturn () => {\r\n\t\t\tif ( outgoingInstances.current.has( instance ) ) {\r\n\t\t\t\toutgoingInstances.current.delete( instance );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcontrol.destroy();\r\n\t\t};\r\n\t}, [\r\n\t\tid,\r\n\t\tidBase,\r\n\t\tinstance,\r\n\t\tonChangeInstance,\r\n\t\tonChangeHasPreview,\r\n\t\tisMediumLargeViewport,\r\n\t] );\r\n\r\n\tif ( isWide && isMediumLargeViewport ) {\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={ clsx( {\r\n\t\t\t\t\t'wp-block-legacy-widget__container': isVisible,\r\n\t\t\t\t} ) }\r\n\t\t\t>\r\n\t\t\t\t{ isVisible && (\r\n\t\t\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\r\n\t\t\t\t\t\t{ title }\r\n\t\t\t\t\t</h3>\r\n\t\t\t\t) }\r\n\t\t\t\t<Popover\r\n\t\t\t\t\tfocusOnMount={ false }\r\n\t\t\t\t\tplacement=\"right\"\r\n\t\t\t\t\toffset={ 32 }\r\n\t\t\t\t\tresize={ false }\r\n\t\t\t\t\tflip={ false }\r\n\t\t\t\t\tshift\r\n\t\t\t\t>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tref={ ref }\r\n\t\t\t\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\r\n\t\t\t\t\t\thidden={ ! isVisible }\r\n\t\t\t\t\t></div>\r\n\t\t\t\t</Popover>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tref={ ref }\r\n\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\r\n\t\t\thidden={ ! isVisible }\r\n\t\t>\r\n\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\r\n\t\t\t\t{ title }\r\n\t\t\t</h3>\r\n\t\t</div>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}