{"version":3,"names":["clsx","useBlockProps","BlockControls","InspectorControls","BlockIcon","store","blockEditorStore","Flex","FlexBlock","Spinner","Placeholder","brush","brushIcon","__","useState","useCallback","useSelect","useEntityRecord","WidgetTypeSelector","InspectorCard","Form","Preview","NoPreview","ConvertToBlocksButton","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Edit","props","id","idBase","attributes","isWide","blockProps","className","children","Empty","NotEmpty","setAttributes","icon","label","selectedId","onSelect","isMulti","instance","clientId","isSelected","hasPreview","setHasPreview","widgetTypeId","record","widgetType","hasResolved","hasResolvedWidgetType","isNavigationMode","select","setInstance","nextInstance","mode","group","rawInstance","raw","name","description","title","isVisible","onChangeInstance","onChangeHasPreview"],"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/index.js"],"sourcesContent":["/**\r\n * External dependencies\r\n */\r\nimport clsx from 'clsx';\r\n\r\n/**\r\n * WordPress dependencies\r\n */\r\nimport {\r\n\tuseBlockProps,\r\n\tBlockControls,\r\n\tInspectorControls,\r\n\tBlockIcon,\r\n\tstore as blockEditorStore,\r\n} from '@wordpress/block-editor';\r\nimport { Flex, FlexBlock, Spinner, Placeholder } from '@wordpress/components';\r\nimport { brush as brushIcon } from '@wordpress/icons';\r\nimport { __ } from '@wordpress/i18n';\r\nimport { useState, useCallback } from '@wordpress/element';\r\nimport { useSelect } from '@wordpress/data';\r\nimport { useEntityRecord } from '@wordpress/core-data';\r\n\r\n/**\r\n * Internal dependencies\r\n */\r\nimport WidgetTypeSelector from './widget-type-selector';\r\nimport InspectorCard from './inspector-card';\r\nimport Form from './form';\r\nimport Preview from './preview';\r\nimport NoPreview from './no-preview';\r\nimport ConvertToBlocksButton from './convert-to-blocks-button';\r\n\r\nexport default function Edit( props ) {\r\n\tconst { id, idBase } = props.attributes;\r\n\tconst { isWide = false } = props;\r\n\r\n\tconst blockProps = useBlockProps( {\r\n\t\tclassName: clsx( {\r\n\t\t\t'is-wide-widget': isWide,\r\n\t\t} ),\r\n\t} );\r\n\r\n\treturn (\r\n\t\t<div { ...blockProps }>\r\n\t\t\t{ ! id && ! idBase ? (\r\n\t\t\t\t<Empty { ...props } />\r\n\t\t\t) : (\r\n\t\t\t\t<NotEmpty { ...props } />\r\n\t\t\t) }\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Empty( { attributes: { id, idBase }, setAttributes } ) {\r\n\treturn (\r\n\t\t<Placeholder\r\n\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\r\n\t\t\tlabel={ __( 'Legacy Widget' ) }\r\n\t\t>\r\n\t\t\t<Flex>\r\n\t\t\t\t<FlexBlock>\r\n\t\t\t\t\t<WidgetTypeSelector\r\n\t\t\t\t\t\tselectedId={ id ?? idBase }\r\n\t\t\t\t\t\tonSelect={ ( { selectedId, isMulti } ) => {\r\n\t\t\t\t\t\t\tif ( ! selectedId ) {\r\n\t\t\t\t\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t\t\t\t\tid: null,\r\n\t\t\t\t\t\t\t\t\tidBase: null,\r\n\t\t\t\t\t\t\t\t\tinstance: null,\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t} else if ( isMulti ) {\r\n\t\t\t\t\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t\t\t\t\tid: null,\r\n\t\t\t\t\t\t\t\t\tidBase: selectedId,\r\n\t\t\t\t\t\t\t\t\tinstance: {},\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsetAttributes( {\r\n\t\t\t\t\t\t\t\t\tid: selectedId,\r\n\t\t\t\t\t\t\t\t\tidBase: null,\r\n\t\t\t\t\t\t\t\t\tinstance: null,\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</FlexBlock>\r\n\t\t\t</Flex>\r\n\t\t</Placeholder>\r\n\t);\r\n}\r\n\r\nfunction NotEmpty( {\r\n\tattributes: { id, idBase, instance },\r\n\tsetAttributes,\r\n\tclientId,\r\n\tisSelected,\r\n\tisWide = false,\r\n} ) {\r\n\tconst [ hasPreview, setHasPreview ] = useState( null );\r\n\r\n\tconst widgetTypeId = id ?? idBase;\r\n\tconst { record: widgetType, hasResolved: hasResolvedWidgetType } =\r\n\t\tuseEntityRecord( 'root', 'widgetType', widgetTypeId );\r\n\r\n\tconst isNavigationMode = useSelect(\r\n\t\t( select ) => select( blockEditorStore ).isNavigationMode(),\r\n\t\t[]\r\n\t);\r\n\r\n\tconst setInstance = useCallback( ( nextInstance ) => {\r\n\t\tsetAttributes( { instance: nextInstance } );\r\n\t}, [] );\r\n\r\n\tif ( ! widgetType && hasResolvedWidgetType ) {\r\n\t\treturn (\r\n\t\t\t<Placeholder\r\n\t\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\r\n\t\t\t\tlabel={ __( 'Legacy Widget' ) }\r\n\t\t\t>\r\n\t\t\t\t{ __( 'Widget is missing.' ) }\r\n\t\t\t</Placeholder>\r\n\t\t);\r\n\t}\r\n\r\n\tif ( ! hasResolvedWidgetType ) {\r\n\t\treturn (\r\n\t\t\t<Placeholder>\r\n\t\t\t\t<Spinner />\r\n\t\t\t</Placeholder>\r\n\t\t);\r\n\t}\r\n\r\n\tconst mode =\r\n\t\tidBase && ( isNavigationMode || ! isSelected ) ? 'preview' : 'edit';\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{ idBase === 'text' && (\r\n\t\t\t\t<BlockControls group=\"other\">\r\n\t\t\t\t\t<ConvertToBlocksButton\r\n\t\t\t\t\t\tclientId={ clientId }\r\n\t\t\t\t\t\trawInstance={ instance.raw }\r\n\t\t\t\t\t/>\r\n\t\t\t\t</BlockControls>\r\n\t\t\t) }\r\n\r\n\t\t\t<InspectorControls>\r\n\t\t\t\t<InspectorCard\r\n\t\t\t\t\tname={ widgetType.name }\r\n\t\t\t\t\tdescription={ widgetType.description }\r\n\t\t\t\t/>\r\n\t\t\t</InspectorControls>\r\n\r\n\t\t\t<Form\r\n\t\t\t\ttitle={ widgetType.name }\r\n\t\t\t\tisVisible={ mode === 'edit' }\r\n\t\t\t\tid={ id }\r\n\t\t\t\tidBase={ idBase }\r\n\t\t\t\tinstance={ instance }\r\n\t\t\t\tisWide={ isWide }\r\n\t\t\t\tonChangeInstance={ setInstance }\r\n\t\t\t\tonChangeHasPreview={ setHasPreview }\r\n\t\t\t/>\r\n\r\n\t\t\t{ idBase && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{ hasPreview === null && mode === 'preview' && (\r\n\t\t\t\t\t\t<Placeholder>\r\n\t\t\t\t\t\t\t<Spinner />\r\n\t\t\t\t\t\t</Placeholder>\r\n\t\t\t\t\t) }\r\n\t\t\t\t\t{ hasPreview === true && (\r\n\t\t\t\t\t\t<Preview\r\n\t\t\t\t\t\t\tidBase={ idBase }\r\n\t\t\t\t\t\t\tinstance={ instance }\r\n\t\t\t\t\t\t\tisVisible={ mode === 'preview' }\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t) }\r\n\t\t\t\t\t{ hasPreview === false && mode === 'preview' && (\r\n\t\t\t\t\t\t<NoPreview name={ widgetType.name } />\r\n\t\t\t\t\t) }\r\n\t\t\t\t</>\r\n\t\t\t) }\r\n\t\t</>\r\n\t);\r\n}\r\n"],"mappings":"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","ignoreList":[]}